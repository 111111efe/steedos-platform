function(e,a,n){"use strict";var i=e("../../core/utils/console"),t=e("../../core/utils/type"),r=e("../../core/utils/iterator"),u=e("../core/utils"),l=e("../../core/utils/math"),s=Math,c=s.floor,o=s.max,V=s.abs;function m(e){var a={};return e.forEach(function(e){var n=e.pane;a[n]||(a[n]=[]),a[n].push(e)}),a}var f={transform:function(e,a){return(0,l.adjust)((0,u.getLog)(e,a))},addInterval:function(e,a){return(0,l.adjust)(e+a)},getInterval:function(e,a){return a}},v={transform:function(e,a){return(0,l.adjust)((0,u.raiseTo)(e,a))},addInterval:function(e,a){return(0,l.adjust)(e*a)},getInterval:function(e,a){return s.pow(e,a)}};function d(e,a){if(e.isLogarithmic){var n,i,t=e.logarithmicBase,r=e.tickValues,u=[];for(e.minValue=a.transform(e.minValue,t),e.oldMinValue=a.transform(e.oldMinValue,t),e.maxValue=a.transform(e.maxValue,t),e.oldMaxValue=a.transform(e.oldMaxValue,t),e.tickInterval=s.round(e.tickInterval),e.tickInterval<1&&(e.tickInterval=1),i=a.getInterval(t,e.tickInterval),n=a.transform(r[0],t);u.length<r.length;)u.push(n),n=a.addInterval(n,i);u.tickInterval=e.tickInterval,e.tickValues=u}}function h(e){return e.reduce(function(e,a){var n,i=a.getTicksValues(),r=i.majorTicksValues,u=a.getOptions(),l=a.getTranslator().getBusinessRange(),s=l.minVisible,c=l.maxVisible,o=a._tickInterval,m=u.synchronizedValue;return!(r&&r.length>0&&(0,t.isNumeric)(r[0])&&"discrete"!==u.type)||l.isEmpty()||l.breaks&&l.breaks.length||"zoom"===a.getViewport().action||(s===c&&(0,t.isDefined)(m)&&(o=V(r[0]-m)||1,s=r[0]-o,c=r[0]+o),d(n={axis:a,isLogarithmic:"logarithmic"===u.type,logarithmicBase:l.base,tickValues:r,minorValues:i.minorTicksValues,minorTickInterval:a._minorTickInterval,minValue:s,oldMinValue:s,maxValue:c,oldMaxValue:c,inverted:l.invert,tickInterval:o,synchronizedValue:m},f),e.push(n)),e},[])}function k(e){var a=e.reduce(function(e,a){return o(e,a.tickValues.length)},0);e.forEach(function(e){var n,i,r=0,u=e.synchronizedValue,s=e.tickValues,o=e.tickInterval;if((0,t.isDefined)(u))e.baseTickValue=e.invertedBaseTickValue=u,e.tickValues=[e.baseTickValue];else{if(s.length>1&&o){for(i=(n=c((a+1)/s.length))>1?c((a+1)/n):a,r=c((i-s.length)/2);r>0&&0!==s[0];)s.unshift((0,l.adjust)(s[0]-o)),r--;for(;s.length<i;)s.push((0,l.adjust)(s[s.length-1]+o));e.tickInterval=o/n}e.baseTickValue=s[0],e.invertedBaseTickValue=s[s.length-1]}})}function x(e){return e.maxValue-e.minValue||1}function g(e){for(var a=0;a<e.length;a++)if(!e[a].stubData)return e[a];return null}function I(e){var a=g(e),n=a.tickInterval;e.forEach(function(e){var i,r,u,l;e!==a&&(n&&e.tickInterval&&(e.stubData&&(0,t.isDefined)(e.synchronizedValue)&&(e.oldMinValue=e.minValue=e.baseTickValue-(a.baseTickValue-a.minValue)/n*e.tickInterval,e.oldMaxValue=e.maxValue=e.baseTickValue-(a.baseTickValue-a.maxValue)/n*e.tickInterval),i=n/x(a)/e.tickInterval*x(e),e.maxValue=e.minValue+x(e)/i),u=a.inverted&&!e.inverted||!a.inverted&&e.inverted?a.maxValue-a.invertedBaseTickValue:a.baseTickValue-a.minValue,l=x(e),r=(u/x(a)-(e.baseTickValue-e.minValue)/l)*l,e.minValue-=r,e.maxValue-=r)})}function T(e){var a,n,i=0,t=0;return e.forEach(function(e){var r=e.inverted;a=e.minValue>e.oldMinValue?(e.minValue-e.oldMinValue)/x(e):0,n=e.maxValue<e.oldMaxValue?(e.oldMaxValue-e.maxValue)/x(e):0,i=o(i,r?n:a),t=o(t,r?a:n)}),{start:i,end:t}}function b(e,a){e.forEach(function(e){var n=x(e),i=e.inverted;e.minValue=(0,l.adjust)(e.minValue-a[i?"end":"start"]*n),e.maxValue=(0,l.adjust)(e.maxValue+a[i?"start":"end"]*n)})}function p(e){var a=!1;e.forEach(function(e){a=a||(0,t.isDefined)(e.synchronizedValue)}),e.forEach(function(e){var n,i=e.tickInterval,t=e.tickValues,r=e.maxValue,u=e.minValue;if(a&&i){for(;(n=(0,l.adjust)(t[0]-i))>=u;)t.unshift(n);for(n=t[t.length-1];(n=(0,l.adjust)(n+i))<=r;)t.push(n)}for(;t[0]<u;)t.shift();for(;t[t.length-1]>r;)t.pop()})}function M(e){e.forEach(function(e){var a=e.axis,n=a.getTranslator().getBusinessRange();n.min===n.minVisible&&(n.min=e.minValue),n.max===n.maxVisible&&(n.max=e.maxValue),n.minVisible=e.minValue,n.maxVisible=e.maxValue,n.min>n.minVisible&&(n.min=n.minVisible),n.max<n.maxVisible&&(n.max=n.maxVisible),a.getTranslator().updateBusinessRange(n),a.setTicks({majorTicks:e.tickValues,minorTicks:e.minorValues})})}function E(e){var a,n=[];e.forEach(function(e){e.oldMaxValue-e.oldMinValue==0?n.push(e):(0,t.isDefined)(a)||(0,t.isDefined)(e.synchronizedValue)||(a=V((e.maxValue-e.minValue)/(e.tickValues[c(e.tickValues.length/2)]-e.minValue||e.maxValue)))}),(0,t.isDefined)(a)&&n.forEach(function(e){var n=e.tickValues[0],i=n*a;n>0?(e.maxValue=i,e.minValue=0):n<0&&(e.minValue=i,e.maxValue=0)})}function j(e){e.forEach(function(e){if(e.minorTickInterval){for(var a=[],n=e.minorTickInterval,i=e.tickInterval/n-1,t=1;t<e.tickValues.length;t++)for(var r=e.tickValues[t-1],u=0;u<i;u++)r+=n,a.push(r);e.minorValues=a}})}var y={synchronize:function(e){(0,r.each)(m(e),function(e,a){var n,i;if(a.length>1){if((n=h(a)).length<2||!g(n))return;k(n),I(n),b(n,i=T(n)),E(n),p(n),j(n),n.forEach(function(e){d(e,v)}),M(n)}})}};n.exports=y}

