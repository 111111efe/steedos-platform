function(e,t,i){"use strict";var n,o=m(e("../../core/renderer")),r=e("../../core/utils/window"),a=e("../../core/utils/common"),l,s=m(e("./ui.grid_core.virtual_scrolling_core")),d,u=m(e("./ui.grid_core.utils")),c=e("../../core/utils/iterator"),h=e("../../core/utils/deferred"),p,g=m(e("../../animation/translator")),f,_=m(e("../load_indicator"));function m(e){return e&&e.__esModule?e:{default:e}}var v="table",C="bottom-load-panel",w="table-content",S="group-space",I="content",y="dx-row",x="dx-freespace-row",T="dx-column-lines",z="dx-virtual-row",P="infinite",b="virtual",R="standard",B=25e4,L=function(e){return"virtual"===e.option("scrolling.mode")},E=function(e){return"infinite"===e.option("scrolling.mode")},V=function(e){var t=e.option("scrolling.rowRenderingMode");return"virtual"===t||"standard"!==t&&void 0},D=function(e,t,i,n){for(var o=i?0:1,r=0;r<t+o;r++){var a=e[i?e.length-1-r:r];a&&!n(a,r===t)&&t++}return t},H=(O=function(e){var t=e._virtualScrollController.beginPageIndex(-1);L(e)&&(t<0||e.viewportSize()>=0&&e.getViewportItemIndex()>=0&&(t*e.pageSize()>e.getViewportItemIndex()||t*e.pageSize()+e.itemsCount()<e.getViewportItemIndex()+e.viewportSize())&&e._dataSource.isLoading()?e._isLoading||(e._isLoading=!0,e.loadingChanged.fire(!0)):e._isLoading&&(e._isLoading=!1,e.loadingChanged.fire(!1)))},M={init:function(e){var t=this;t.callBase.apply(t,arguments),t._items=[],t._isLoaded=!0,t._virtualScrollController=new s.default.VirtualScrollController(t.component,{pageSize:function(){return t.pageSize()},totalItemsCount:function(){return t.totalItemsCount()},hasKnownLastPage:function(){return t.hasKnownLastPage()},pageIndex:function(t){return e.pageIndex(t)},isLoading:function(){return e.isLoading()&&!t.isCustomLoading()},pageCount:function(){return t.pageCount()},load:function(){return e.load()},updateLoading:function(){O(t)},itemsCount:function(){return t.itemsCount(!0)},items:function(){return e.items()},viewportItems:function(e){return e&&(t._items=e),t._items},onChanged:function(e){t.changed.fire(e)},changingDuration:function(e){return t._renderTime||0}})},_handleLoadingChanged:function(e){var t=this;L(this)||(this._isLoading=e,this.callBase.apply(this,arguments))},_handleLoadError:function(){var e=this;this._isLoading=!1,this.loadingChanged.fire(!1),this.callBase.apply(this,arguments)},_handleDataChanged:function(e){var t=this.callBase.bind(this);this._virtualScrollController.handleDataChanged(t,e)},_customizeRemoteOperations:function(e,t,i){var n=this;!this.option("legacyRendering")&&L(this)&&!i.reload&&!t&&i.skip&&this._renderTime<this.option("scrolling.renderingThreshold")&&(e.delay=void 0),this.callBase.apply(this,arguments)},items:function(){return this._items},itemsCount:function(e){return e?this.callBase():this._virtualScrollController.itemsCount()},load:function(e){return e?this.callBase(e):this._virtualScrollController.load()},isLoading:function(){return this._isLoading},isLoaded:function(){return this._dataSource.isLoaded()&&this._isLoaded},resetPagesCache:function(){this._virtualScrollController.reset(),this.callBase.apply(this,arguments)},_changeRowExpandCore:function(){var e=this.callBase.apply(this,arguments);return this.resetPagesCache(),O(this),e},reload:function(){this._dataSource.pageIndex(this.pageIndex());var e=this._virtualScrollController;if(e){var t=new h.Deferred;return this.callBase.apply(this,arguments).done(function(i){var n=e._delayDeferred;n?n.done(t.resolve).fail(t.reject):t.resolve(i)}).fail(t.reject),t}return this.callBase.apply(this,arguments)},refresh:function(e,t,i){var n=this,o=e.storeLoadOptions,r=this._dataSource;return(t||i.reload)&&(this._virtualScrollController.reset(),r.items().length=0,this._isLoaded=!1,O(this),this._isLoaded=!0,E(this)?(this.pageIndex(0),r.pageIndex(0),o.pageIndex=0,e.pageIndex=0,o.skip=0):(r.pageIndex(this.pageIndex()),r.paginate()&&(o.skip=this.pageIndex()*this.pageSize()))),this.callBase.apply(this,arguments)},dispose:function(){this._virtualScrollController.dispose(),this.callBase.apply(this,arguments)}},["virtualItemsCount","getContentOffset","getVirtualContentSize","setContentSize","setViewportPosition","getViewportItemIndex","setViewportItemIndex","getItemIndexByPosition","viewportSize","viewportItemSize","getItemSize","getItemSizes","pageIndex","beginPageIndex","endPageIndex","loadIfNeed"].forEach(function(e){M[e]=function(){var t=this._virtualScrollController;return t[e].apply(t,arguments)}}),M),O,M,W=(N=function(e,t){var i,n=e.parent("."+t);n.length&&(e=n),i=t===x?e.length-1:e.length;for(var o=0;o<i;o++)e.eq(o).remove()},{init:function(){var e=this,t=e.getController("data");if(e.callBase(),t.pageChanged.add(function(){e.scrollToPage(t.pageIndex())}),!e.option("legacyRendering")&&t.pageIndex()>0){var i=function i(){e.resizeCompleted.remove(i),e.scrollToPage(t.pageIndex())};e.resizeCompleted.add(i)}},scrollToPage:function(e){var t,i=this,n=this._dataController,o=n?n.pageSize():0;if(L(this)||E(this)){var r=n.getItemSize(),a=n.getItemSizes(),l=e*o;for(var s in t=l*r,a)s<=l&&(t+=a[s]-r)}else t=0;this.scrollTo({y:t,x:this._scrollLeft})},renderDelayedTemplates:function(e){this._updateContentPosition(!0),this.callBase.apply(this,arguments)},_renderCore:function(e){var t=this,i=new Date;this.callBase.apply(this,arguments);var n=this._dataController._dataSource;if(n&&e){var o=e.items?e.items.length:20,r=this._dataController.viewportSize()||20;V(this)?n._renderTime=(new Date-i)*r/o:n._renderTime=new Date-i}},_getRowElements:function(e){var t=this.callBase(e);return t&&t.not(".dx-virtual-row")},_renderContent:function(e,t){var i=this,n;return this._dataController.virtualItemsCount()&&this.option("legacyRendering")?((0,r.hasWindow)()&&t.addClass(this.addWidgetPrefix("table-content")),e.children().length?e.children().first().replaceWith(t):e.append(t),1===e.children("table").length&&(e.append(this._createTable()),this._contentHeight=0),e):this.callBase.apply(this,arguments)},_removeRowsElements:function(e,t,i){var n=this._getRowElements(e).toArray();n="append"===i?n.slice(0,t):n.slice(-t);var r=this.getController("errorHandling");n.map(function(e){var t=(0,o.default)(e);r&&r.removeErrorRow(t.next()),t.remove()})},_restoreErrorRow:function(e){var t=this.getController("editing");t&&t.hasChanges()&&this._getRowElements(e).each(function(e,i){var n=(0,o.default)(i).data("options");if(n){var r=t.getEditDataByKey(n.key);r&&t._showErrorRow(r)}})},_updateContent:function(e,t){var i,n,o=this,r=this._findContentElement(),a=t&&t.changeType;if("append"===a||"prepend"===a){i=r.children().first();var l=this._getBodies(e);this.option("legacyRendering")||1!==l.length?l["append"===a?"appendTo":"prependTo"](i):this._getBodies(i)["append"===a?"append":"prepend"](l.children()),e.remove(),n=this._getFreeSpaceRowElements(i),N(n,x),t.removeCount&&this._removeRowsElements(i,t.removeCount,a),this._restoreErrorRow(i)}else this.callBase.apply(this,arguments);this._updateBottomLoading()},_addVirtualRow:function(e,t,i,n){if(n){var o=this._createEmptyRow("dx-virtual-row",t,n);o=this._wrapRowIfNeed(e,o),this._appendEmptyRow(e,o,i)}},_updateContentPosition:function(e){var t=this,i=t._dataController,n=t._rowHeight||20;if(i.viewportItemSize(n),t.option("legacyRendering")||!L(t)&&!V(t))(0,a.deferUpdate)(function(){t._updateContentPositionCore()});else{if(!e){var r=t._getRowElements(t._tableElement).toArray().map(function(e){return e.getBoundingClientRect().height});i.setContentSize(r)}var l=i.getContentOffset("begin"),s=i.getContentOffset("end"),d=t.getTableElements(),u=d.children("tbody").children(".dx-virtual-row");N(u,"dx-virtual-row"),d.each(function(e){var i=e>0;t._isFixedTableRendering=i,t._addVirtualRow((0,o.default)(this),i,"top",l),t._addVirtualRow((0,o.default)(this),i,"bottom",s),t._isFixedTableRendering=!1}),!e&&t._updateScrollTopPosition(l)}},_updateScrollTopPosition:function(e){this._scrollTop<e&&!this._isScrollByEvent&&this._dataController.pageIndex()>0&&this.scrollTo({top:e,left:this._scrollLeft})},_updateContentPositionCore:function(){var e,t,i,n,o,r,l,s=this,d=s._rowHeight||20,u;s._dataController.virtualItemsCount()&&(n=(e=s._findContentElement()).children(),o=n.eq(0),r=n.eq(1),s._contentTableHeight=o[0].offsetHeight,s._dataController.viewportItemSize(d),s._dataController.setContentSize(s._contentTableHeight),t=s._dataController.getVirtualContentSize(),i=s._dataController.getContentOffset(),(0,a.deferRender)(function(){g.default.move(o,{left:0,top:i}),(l=s._contentHeight!==t||0===t||!s._isTableLinesDisplaysCorrect(r)||!s._isColumnElementsEqual(o.find("col"),r.find("col")))&&(s._contentHeight=t,s._renderVirtualTableContent(r,t)),s._updateScrollTopPosition(i)}))},_isTableLinesDisplaysCorrect:function(e){var t;return e.find(".dx-column-lines").length>0===this.option("showColumnLines")},_isColumnElementsEqual:function(e,t){var i=e.length===t.length;return i&&(0,c.each)(e,function(e,n){if(n.style.width!==t[e].style.width)return i=!1}),i},_renderVirtualTableContent:function(e,t){var i,n=this,o=this._columnsController.getVisibleColumns(),r=this._createColGroup(o).prop("outerHTML"),a="",l=this.option("showColumnLines")?"dx-column-lines":"",s=function(e){return"<tr style='height:"+e+"px;' class='"+x+" dx-row "+l+"' >"+a+"</tr>"};for(i=0;i<o.length;i++){var d=this._getCellClasses(o[i]),u=d.length?" class='"+d.join(" ")+"'":"";a+="<td"+u+"/>"}for(;t>25e4;)r+=s(25e4),t-=25e4;r+=s(t),e.addClass(this.addWidgetPrefix("table")),e.html(r)},_getCellClasses:function(e){var t=[],i=e.cssClass,n="expand"===e.command;return i&&t.push(i),n&&t.push(this.addWidgetPrefix("group-space")),t},_findBottomLoadPanel:function(e){var t=e||this.element(),i=t&&t.find("."+this.addWidgetPrefix("bottom-load-panel"));if(i&&i.length)return i},_updateBottomLoading:function(){var e=this,t=this.option("scrolling.mode"),i="virtual"===t,n="infinite"===t,r=!this._dataController.hasKnownLastPage()&&this._dataController.isLoaded()&&(i||n),a=this._findContentElement(),l=this._findBottomLoadPanel(a);r?l||(0,o.default)("<div>").addClass(this.addWidgetPrefix("bottom-load-panel")).append(this._createComponent((0,o.default)("<div>"),_.default).$element()).appendTo(a):l&&l.remove()},_handleScroll:function(e){var t=this;this._hasHeight&&this._rowHeight&&this._dataController.setViewportPosition(e.scrollOffset.top),this.callBase.apply(this,arguments)},_needUpdateRowHeight:function(e){var t=this;return this.callBase.apply(this,arguments)||e>0&&"infinite"===this.option("scrolling.mode")&&"virtual"!==this.option("scrolling.rowRenderingMode")},_updateRowHeight:function(){var e,t=this;this.callBase.apply(this,arguments),this._rowHeight&&(this._updateContentPosition(),e=this._hasHeight?this.element().outerHeight():(0,o.default)((0,r.getWindow)()).outerHeight(),this._dataController.viewportSize(Math.ceil(e/this._rowHeight)))},updateFreeSpaceRowHeight:function(){var e=this.callBase.apply(this,arguments);return e&&this._updateContentPosition(),e},setLoading:function(e,t){var i=this,n=this.callBase,o=this._dataController,r;o.pageIndex()>0&&o.isLoaded()&&!!this._findBottomLoadPanel()&&(e=!1),n.call(this,e,t)},_resizeCore:function(){var e=this,t=e.element();e.callBase(),e.component.$element()&&!e._windowScroll&&t.closest((0,r.getWindow)().document).length&&(e._windowScroll=s.default.subscribeToExternalScrollers(t,function(t){!e._hasHeight&&e._rowHeight&&e._dataController.setViewportPosition(t)},e.component.$element()),e.on("disposing",function(){e._windowScroll.dispose()})),e.loadIfNeed()},loadIfNeed:function(){var e=this._dataController;e&&e.loadIfNeed&&e.loadIfNeed()},setColumnWidths:function(e){var t,i=this.getScrollable();this.callBase.apply(this,arguments),"virtual"===this.option("scrolling.mode")&&(t=i?i.$content():this.element(),this.callBase(e,t.children("."+this.addWidgetPrefix("content")).children(":not(."+this.addWidgetPrefix("table-content")+")")))},dispose:function(){clearTimeout(this._scrollTimeoutID),this.callBase()}}),N,k;i.exports={defaultOptions:function(){return{scrolling:{timeout:300,updateTimeout:300,minTimeout:0,renderingThreshold:100,removeInvisiblePages:!0,rowPageSize:5,mode:"standard",preloadEnabled:!1,rowRenderingMode:"standard"}}},extenders:{dataSourceAdapter:H,controllers:{data:(k={_refreshDataSource:function(){var e=this.callBase.apply(this,arguments)||(new h.Deferred).resolve().promise();return e.done(this.initVirtualRows.bind(this)),e},getRowPageSize:function(){var e=this.option("scrolling.rowPageSize"),t=this.pageSize();return t&&t<e?t:e},reload:function(){var e=this,t=e._rowsScrollController||e._dataSource,i=t&&t.getItemIndexByPosition(),n=this.callBase.apply(this,arguments);return n&&n.done(function(){if(L(e)||V(e)){var t=e.getRowIndexOffset(),n=Math.floor(i)-t,r=e.component,a=r.getScrollable&&r.getScrollable();if(a&&!e.option("legacyRendering")){var l=r.getRowElement(n),s=l&&l[0]&&(0,o.default)(l[0]),d=s&&s.position().top;d>0&&(d=Math.round(d+s.outerHeight()*(i%1)),a.scrollTo({y:d}))}}})},initVirtualRows:function(){var e=this,t=V(e);if("virtual"!==e.option("scrolling.mode")&&!0!==t||!1===t||e.option("legacyRendering")||!e.option("scrolling.rowPageSize"))return e._visibleItems=null,void(e._rowsScrollController=null);e._rowPageIndex=Math.ceil(e.pageIndex()*e.pageSize()/e.getRowPageSize()),e._visibleItems=[];var i=function(t){return"data"===t.rowType||"group"===t.rowType&&e._dataSource.isGroupItemCountable(t.data)};e._rowsScrollController=new s.default.VirtualScrollController(e.component,{pageSize:function(){return e.getRowPageSize()},totalItemsCount:function(){return L(e)?e.totalItemsCount():e._items.filter(i).length},hasKnownLastPage:function(){return!0},pageIndex:function(t){return void 0!==t&&(e._rowPageIndex=t),e._rowPageIndex},isLoading:function(){return e.isLoading()},pageCount:function e(){var e=Math.ceil(this.totalItemsCount()/this.pageSize());return e||1},load:function(){e._rowsScrollController.pageIndex()>=this.pageCount()&&(e._rowPageIndex=this.pageCount()-1,e._rowsScrollController.pageIndex(e._rowPageIndex)),!e._rowsScrollController._dataSource.items().length&&this.totalItemsCount()||e._rowsScrollController.handleDataChanged(function(t){(t=t||{}).changeType=t.changeType||"refresh",t.items=t.items||e._visibleItems,e._visibleItems.forEach(function(e,t){e.rowIndex=t}),e._fireChanged(t)})},updateLoading:function(){},itemsCount:function(){return e._rowsScrollController._dataSource.items().filter(i).length},correctCount:function(e,t,n){return D(e,t,n,i)},items:function(t){var n=e.dataSource(),o=n&&n.virtualItemsCount(),r=o?o.begin:0,a=e.getRowPageSize(),l=e._rowPageIndex*a-r,s=a,d=e._items;return l<0?[]:(l&&(l=this.correctCount(d,l),d=d.slice(l)),s&&(s=this.correctCount(d,s),d=d.slice(0,s)),t?d.filter(i):d)},viewportItems:function(t){return t&&(e._visibleItems=t),e._visibleItems},onChanged:function(){},changingDuration:function(t){var i=e.dataSource();return i&&i._renderTime||0}},!0),e.isLoaded()&&e._rowsScrollController.load()},_updateItemsCore:function(e){var t=this,i=this.getRowIndexDelta();this.callBase.apply(this,arguments);var n=this._rowsScrollController;if(n){var o=this._visibleItems,r="refresh"===e.changeType||e.isLiveUpdate;if("append"===e.changeType&&e.items&&!e.items.length)return;r||"append"===e.changeType||"prepend"===e.changeType?(e.cancel=!0,r&&n.reset(),n.load()):("update"===e.changeType?e.rowIndices.forEach(function(t,i){var n=e.changeTypes[i],r=e.items[i];"update"===n?o[t]=r:"insert"===n?o.splice(t,0,r):"remove"===n&&o.splice(t,1)}):(o.forEach(function(e,n){o[n]=t._items[n+i]||o[n]}),e.items=o),o.forEach(function(e,t){e.rowIndex=t}))}},_applyChange:function(e){var t=this,i=e.items,n=e.changeType,o=e.removeCount;if(o){var r="prepend"===n;o=D(t._items,o,r,function(e,i){return"data"===e.rowType||"group"===e.rowType&&(t._dataSource.isGroupItemCountable(e.data)||i)}),e.removeCount=o}switch(n){case"prepend":t._items.unshift.apply(t._items,i),o&&t._items.splice(-o);break;case"append":t._items.push.apply(t._items,i),o&&t._items.splice(0,o);break;default:t.callBase(e)}},items:function(e){return e?this._items:this._visibleItems||this._items},getRowIndexDelta:function(){var e=this._visibleItems,t=0;return e&&e[0]&&(t=this._items.indexOf(e[0])),t<0?0:t},getRowIndexOffset:function(){var e=0,t=this.dataSource(),i=this._rowsScrollController;return i?e=i.beginPageIndex()*i._dataSource.pageSize():"virtual"===this.option("scrolling.mode")&&t&&(e=t.beginPageIndex()*t.pageSize()),e},viewportSize:function(){var e=this._rowsScrollController;e&&e.viewportSize.apply(e,arguments);var t=this._dataSource;return t&&t.viewportSize.apply(t,arguments)},viewportItemSize:function(){var e=this._rowsScrollController;e&&e.viewportItemSize.apply(e,arguments);var t=this._dataSource;return t&&t.viewportItemSize.apply(t,arguments)},setViewportPosition:function(){var e=this._rowsScrollController,t=this._dataSource;e?e.setViewportPosition.apply(e,arguments).done(function(){t&&t.setViewportItemIndex(e.getViewportItemIndex())}):t&&t.setViewportPosition.apply(t,arguments)},setContentSize:function(e){var t=this._rowsScrollController;t&&t.setContentSize(e);var i=this._dataSource;return i&&i.setContentSize(e)},loadIfNeed:function(){var e=this._rowsScrollController;e&&e.loadIfNeed();var t=this._dataSource;return t&&t.loadIfNeed()},getItemSize:function(){var e=this._rowsScrollController;if(e)return e.getItemSize.apply(e,arguments);var t=this._dataSource;return t&&t.getItemSize.apply(t,arguments)},getItemSizes:function(){var e=this._rowsScrollController;if(e)return e.getItemSizes.apply(e,arguments);var t=this._dataSource;return t&&t.getItemSizes.apply(t,arguments)},getContentOffset:function(){var e=this._rowsScrollController;if(e)return e.getContentOffset.apply(e,arguments);var t=this._dataSource;return t&&t.getContentOffset.apply(t,arguments)},dispose:function(){var e=this._rowsScrollController;e&&e.dispose(),this.callBase.apply(this,arguments)}},u.default.proxyMethod(k,"virtualItemsCount"),u.default.proxyMethod(k,"getVirtualContentSize"),u.default.proxyMethod(k,"setViewportItemIndex"),k),resizing:{resize:function(){var e,t=this,i=t.callBase;if(t.option("legacyRendering")||!L(t)&&!V(t))e=i.apply(t);else{clearTimeout(t._resizeTimeout);var n=new Date-t._lastTime,o=t.option("scrolling.updateTimeout");t._lastTime&&n<o?(e=new h.Deferred,t._resizeTimeout=setTimeout(function(){i.apply(t).done(e.resolve).fail(e.reject),t._lastTime=new Date},o),t._lastTime=new Date):(e=i.apply(t),t._dataController.isLoaded()&&(t._lastTime=new Date))}return e},dispose:function(){this.callBase.apply(this,arguments),clearTimeout(this._resizeTimeout)}}},views:{rowsView:W}}}}

