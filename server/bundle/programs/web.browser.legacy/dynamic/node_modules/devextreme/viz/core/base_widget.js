function(e,t,n){"use strict";var i=e("../../core/utils/common").noop,r=e("../../core/utils/window"),s=e("../../core/dom_adapter"),a=e("../../core/utils/type"),h=e("../../core/utils/iterator").each,o=e("../../core/version"),c=e("../../core/utils/resize_callbacks"),_=e("../../core/utils/string").format,u=e("../../core/utils/type").isObject,d=e("../../core/utils/extend").extend,l=Math.floor,p=e("../../core/dom_component"),g=e("./helpers"),f=e("./utils").parseScalar,E=e("./errors_warnings"),m=E.log,v=e("./renderers/renderer"),C=e("./layout"),R="rtlEnabled",O="dx-sized-element",y=p.prototype.option;function T(){return!0}function S(){return!1}function A(e,t){return!(e.width===t.width&&e.height===t.height&&e.left===t.left&&e.top===t.top&&e.right===t.right&&e.bottom===t.bottom)}function w(e){var t,n=function(){clearTimeout(t),t=setTimeout(e,100)};return n.dispose=function(){return clearTimeout(t),this},n}function N(e){e.component.hasEvent("incidentOccurred")||m.apply(null,[e.target.id].concat(e.target.args||[]))}var z=function(e,t){return function(n,i){t("incidentOccurred",{target:{id:n,type:"E"===n[0]?"error":"warning",args:i,text:_.apply(null,[E.ERROR_MESSAGES[n]].concat(i||[])),widget:e,version:o}})}};function b(e){return e.reduce(function(e,t){return t>0&&!e?t:e},0)}var D=function(){var e={ctor:function(e,t){this.callBase(e,t);var n=s.createElement("div"),i=t&&a.isNumeric(t.width)?t.width+"px":"100%",r=t&&a.isNumeric(t.height)?t.height+"px":this._getDefaultSize().height+"px";s.setStyle(n,"width",i),s.setStyle(n,"height",r),s.setClass(n,"dx-sized-element"),s.insertElement(e,n)}},t=p.inherit(e),n=t.inherit;return t.inherit=function(e){for(var t in e)(a.isFunction(e[t])&&"_"!==t.substr(0,1)||"_dispose"===t||"_optionChanged"===t)&&(e[t]=i);return n.call(this,e)},t},L=!r.hasWindow();function M(e){return a.isDefined(e)&&e>0}function I(e,t){var n={},i;return h(e,function(e,t){t.name&&r(e)}),s.change=function(t){var n=e[t];return n&&((i=i||{})[t]=n),!!n},s.applyChanges=function(){i&&(h(i,function(e,t){r(t.newName||e)}),i=null)},s.dispose=function(){e=t=n=null},s;function r(i){var r=e[i];n[r.name]=t(i)}function s(e,t,i){n[e](t),i&&i()}}n.exports=L?D():p.inherit({_eventsMap:{onIncidentOccurred:{name:"incidentOccurred"},onDrawn:{name:"drawn"}},_getDefaultOptions:function(){return d(this.callBase(),{onIncidentOccurred:N})},_useLinks:!0,_init:function(){var e,t=this;t._$element.children(".dx-sized-element").remove(),t.callBase.apply(t,arguments),t._changesLocker=0,t._optionChangedLocker=0,t._changes=g.changes(),t._suspendChanges(),t._themeManager=t._createThemeManager(),t._themeManager.setCallback(function(){t._requestChange(t._themeDependentChanges)}),t._renderElementAttributes(),t._initRenderer(),(e=t._useLinks&&t._renderer.root)&&e.enableLinks().virtualLink("core").virtualLink("peripheral"),t._renderVisibilityChange(),t._attachVisibilityChangeHandlers(),t._initEventTrigger(),t._incidentOccurred=z(t.NAME,t._eventTrigger),t._layout=new C,e&&e.linkAfter("core"),t._initPlugins(),t._initCore(),e&&e.linkAfter(),t._change(t._initialChanges)},_initialChanges:["LAYOUT","RESIZE_HANDLER","THEME","DISABLED"],_initPlugins:function(){var e=this;h(e._plugins,function(t,n){n.init.call(e)})},_disposePlugins:function(){var e=this;h(e._plugins.slice().reverse(),function(t,n){n.dispose.call(e)})},_change:function(e){this._changes.add(e)},_suspendChanges:function(){++this._changesLocker},_resumeChanges:function(){var e=this;0==--this._changesLocker&&this._changes.count()>0&&!this._applyingChanges&&(this._renderer.lock(),this._applyingChanges=!0,this._applyChanges(),this._changes.reset(),this._applyingChanges=!1,this._renderer.unlock(),this._optionsQueue&&this._applyQueuedOptions(),this._optionChangedLocker++,this._notify(),this._optionChangedLocker--)},_applyQueuedOptions:function(){var e=this,t=this._optionsQueue;this._optionsQueue=null,this.beginUpdate(),h(t,function(e,t){t()}),this.endUpdate()},_requestChange:function(e){this._suspendChanges(),this._change(e),this._resumeChanges()},_applyChanges:function(){var e,t=this,n=this._changes,i=this._totalChangesOrder,r=i.length;for(e=0;e<r;++e)n.has(i[e])&&this["_change_"+i[e]]()},_optionChangesOrder:["EVENTS","THEME","RENDERER","RESIZE_HANDLER"],_layoutChangesOrder:["ELEMENT_ATTR","CONTAINER_SIZE","LAYOUT"],_customChangesOrder:["DISABLED"],_change_EVENTS:function(){this._eventTrigger.applyChanges()},_change_THEME:function(){this._setThemeAndRtl()},_change_RENDERER:function(){this._setRendererOptions()},_change_RESIZE_HANDLER:function(){this._setupResizeHandler()},_change_ELEMENT_ATTR:function(){this._renderElementAttributes(),this._change(["CONTAINER_SIZE"])},_change_CONTAINER_SIZE:function(){this._updateSize()},_change_LAYOUT:function(){this._setContentSize()},_change_DISABLED:function(){var e=this._renderer,t=e.root;this.option("disabled")?(this._initDisabledState=t.attr("pointer-events"),t.attr({"pointer-events":"none",filter:e.getGrayScaleFilter().id})):"none"===t.attr("pointer-events")&&t.attr({"pointer-events":a.isDefined(this._initDisabledState)?this._initDisabledState:null,filter:null})},_themeDependentChanges:["RENDERER"],_initRenderer:function(){var e=this;this._canvas=this._calculateCanvas(),this._renderer=new v.Renderer({cssClass:this._rootClassPrefix+" "+this._rootClass,pathModified:this.option("pathModified"),container:this._$element[0]}),this._renderer.resize(this._canvas.width,this._canvas.height)},_disposeRenderer:function(){this._renderer.dispose()},_getAnimationOptions:i,render:function(){this._requestChange(["CONTAINER_SIZE"]),this._onRender()},_onRender:i,_dispose:function(){var e=this;this.callBase.apply(this,arguments),this._removeResizeHandler(),this._layout.dispose(),this._eventTrigger.dispose(),this._disposeCore(),this._disposePlugins(),this._disposeRenderer(),this._themeManager.dispose(),this._themeManager=this._renderer=this._eventTrigger=null},_initEventTrigger:function(){var e=this;e._eventTrigger=I(e._eventsMap,function(t){return e._createActionByOption(t)})},_calculateCanvas:function(){var e=this,t=this.option("size")||{},n=this.option("margin")||{},i=this._getDefaultSize()||{},s=!M(t.width)&&r.hasWindow()?this._$element.width():0,a=!M(t.height)&&r.hasWindow()?this._$element.height():0,h={width:t.width<=0?0:l(b([t.width,s,i.width])),height:t.height<=0?0:l(b([t.height,a,i.height])),left:b([n.left,i.left]),top:b([n.top,i.top]),right:b([n.right,i.right]),bottom:b([n.bottom,i.bottom])};return(h.width-h.left-h.right<=0||h.height-h.top-h.bottom<=0)&&(h={width:0,height:0}),h},_updateSize:function(){var e=this,t=this._calculateCanvas();this._renderer.fixPlacement(),(A(this._canvas,t)||this.__forceRender)&&(this._canvas=t,this._recreateSizeDependentObjects(!0),this._renderer.resize(t.width,t.height),this._change(["LAYOUT"]))},_recreateSizeDependentObjects:i,_getMinSize:function(){return[0,0]},_getAlignmentRect:i,_setContentSize:function(){var e,t=this._canvas,n=this._layout,i=t.width>0&&t.height>0?[t.left,t.top,t.width-t.right,t.height-t.bottom]:[0,0,0,0];i=n.forward(i,this._getMinSize()),e=this._applySize(i)||i,n.backward(e,this._getAlignmentRect()||e)},_getOption:function(e,t){var n=this._themeManager.theme(e),i=this.option(e);return t?void 0!==i?i:n:d(!0,{},n,i)},_setupResizeHandler:function(){var e=this,t=f(this._getOption("redrawOnResize",!0),!0);e._resizeHandler&&e._removeResizeHandler(),e._resizeHandler=w(function(){t?e._requestChange(["CONTAINER_SIZE"]):e._renderer.fixPlacement()}),c.add(e._resizeHandler)},_removeResizeHandler:function(){this._resizeHandler&&(c.remove(this._resizeHandler),this._resizeHandler.dispose(),this._resizeHandler=null)},_onBeginUpdate:i,beginUpdate:function(){var e=this;return this._initialized&&0===this._updateLockCount&&(this._onBeginUpdate(),this._suspendChanges()),this.callBase.apply(this,arguments),this},endUpdate:function(){var e=this;return this.callBase.apply(this,arguments),0===this._updateLockCount&&this._resumeChanges(),this},option:function(e){var t=this;if(!(this._initialized&&this._applyingChanges&&(arguments.length>1||u(e))))return y.apply(this,arguments);this._optionsQueue=this._optionsQueue||[],this._optionsQueue.push(this._getActionForUpdating(arguments))},_getActionForUpdating:function(e){var t=this;return t._deprecatedOptionsSuppressed?function(){t._suppressDeprecatedWarnings(),y.apply(t,e),t._resumeDeprecatedWarnings()}:function(){y.apply(t,e)}},_clean:i,_render:i,_optionChanged:function(e){var t=this;if(!t._optionChangedLocker){var n=t.getPartialChangeOptionsName(e),i=[];n.length>0?n.forEach(function(e){return i.push(t._partialOptionChangesMap[e])}):i.push(t._optionChangesMap[e.name]),i=i.filter(function(e){return!!e}),t._eventTrigger.change(e.name)?t._change(["EVENTS"]):i.length>0?t._change(i):t.callBase.apply(t,arguments)}},_notify:i,_optionChangesMap:{size:"CONTAINER_SIZE",margin:"CONTAINER_SIZE",redrawOnResize:"RESIZE_HANDLER",theme:"THEME",rtlEnabled:"THEME",encodeHtml:"THEME",elementAttr:"ELEMENT_ATTR",disabled:"DISABLED"},_partialOptionChangesMap:{},_partialOptionChangesPath:{},getPartialChangeOptionsName:function(e){var t=this,n=e.fullName,i=n.split(/[.]/),r=e.name,s=e.value,h=this._partialOptionChangesPath[r],o=[];return h&&(!0===h?o.push(r):(h.forEach(function(e){n.indexOf(e)>=0&&o.push(e)}),1===i.length&&("object"===a.type(s)?t._addOptionsNameForPartialUpdate(s,h,o):"array"===a.type(s)&&s.length>0&&s.every(function(e){return t._checkOptionsForPartialUpdate(e,h)})&&s.forEach(function(e){return t._addOptionsNameForPartialUpdate(e,h,o)})))),o.filter(function(e,t,n){return n.indexOf(e)===t})},_checkOptionsForPartialUpdate:function(e,t){return!Object.keys(e).some(function(e){return-1===t.indexOf(e)})},_addOptionsNameForPartialUpdate:function(e,t,n){var i=Object.keys(e);this._checkOptionsForPartialUpdate(e,t)&&i.forEach(function(e){return t.indexOf(e)>-1&&n.push(e)})},_visibilityChanged:function(){this.render()},_setThemeAndRtl:function(){this._themeManager.setTheme(this.option("theme"),this.option("rtlEnabled"))},_getRendererOptions:function(){return{rtl:this.option("rtlEnabled"),encodeHtml:this.option("encodeHtml"),animation:this._getAnimationOptions()}},_setRendererOptions:function(){this._renderer.setOptions(this._getRendererOptions())},svg:function(){return this._renderer.svg()},getSize:function(){var e=this._canvas||{};return{width:e.width,height:e.height}},isReady:S,_dataIsReady:T,_resetIsReady:function(){this.isReady=S},_drawn:function(){var e=this;e.isReady=S,e._dataIsReady()&&e._renderer.onEndAnimation(function(){e.isReady=T}),e._eventTrigger("drawn",{})}}),g.replaceInherit(n.exports)}

