function(e,t,a){"use strict";var i,l=p(e("../../core/renderer")),n,s=p(e("./ui.grid_core.utils")),d=e("../../core/utils/common"),r=e("../../core/utils/iterator"),o=e("../../core/utils/type");function p(e){return e&&e.__esModule?e:{default:e}}var u="dx-master-detail-cell",c="dx-master-detail-row",h="dx-cell-focus-disabled",m="dx-row-lines",x;a.exports={defaultOptions:function(){return{masterDetail:{enabled:!1,autoExpandAll:!1,template:null}}},extenders:{controllers:{columns:{_getExpandColumnsCore:function(){var e=this.callBase();return this.option("masterDetail.enabled")&&e.push({type:"detailExpand",cellTemplate:s.default.getExpandCellTemplate()}),e}},data:(x=function(e){e._expandedItems=[],e._isExpandAll=e.option("masterDetail.autoExpandAll")},{init:function(){var e=this;x(this),this.callBase()},expandAll:function(e){var t=this;e<0?(this._isExpandAll=!0,this._expandedItems=[],this.updateItems()):this.callBase.apply(this,arguments)},collapseAll:function(e){var t=this;e<0?(this._isExpandAll=!1,this._expandedItems=[],this.updateItems()):this.callBase.apply(this,arguments)},isRowExpanded:function(e){var t=this,a=s.default.getIndexByKey(e,this._expandedItems);return Array.isArray(e)?this.callBase.apply(this,arguments):!!(this._isExpandAll^(a>=0&&this._expandedItems[a].visible))},_getRowIndicesForExpand:function(e){var t=this.getRowIndexByKey(e);return[t,t+1]},_changeRowExpandCore:function(e){var t,a,i=this;if(Array.isArray(e))return this.callBase.apply(this,arguments);if((t=s.default.getIndexByKey(e,this._expandedItems))>=0){var l=this._expandedItems[t].visible;this._expandedItems[t].visible=!l}else this._expandedItems.push({key:e,visible:!0}),(a=this.getController("editing"))&&a.correctEditRowIndexAfterExpand(e);this.updateItems({changeType:"update",rowIndices:this._getRowIndicesForExpand(e)})},_processDataItem:function(e,t){var a=this,i=this.callBase.apply(this,arguments);return i.isExpanded=this.isRowExpanded(i.key),void 0===t.detailColumnIndex&&(t.detailColumnIndex=-1,(0,r.each)(t.visibleColumns,function(e,a){if("expand"===a.command&&!(0,o.isDefined)(a.groupIndex))return t.detailColumnIndex=e,!1})),t.detailColumnIndex>=0&&(i.values[t.detailColumnIndex]=i.isExpanded),i},_processItems:function(e,t){var a,i=this,l=[];return e=i.callBase.apply(i,arguments),"loadingAll"===t?e:("refresh"===t&&(i._expandedItems=(0,d.grep)(i._expandedItems,function(e){return e.visible})),(0,r.each)(e,function(e,t){l.push(t),a=s.default.getIndexByKey(t.key,i._expandedItems),"data"===t.rowType&&(t.isExpanded||a>=0)&&!t.inserted&&l.push({visible:t.isExpanded,rowType:"detail",key:t.key,data:t.data,values:[]})}),l)},optionChanged:function(e){var t,a,i,l,n=this;if("masterDetail"===e.name){switch(e.name="dataSource",e.fullName){case"masterDetail":t=e.value||{},a=e.previousValue||{},i=t.enabled!==a.enabled,l=t.autoExpandAll!==a.autoExpandAll;break;case"masterDetail.enabled":i=!0;break;case"masterDetail.autoExpandAll":l=!0}(i||l)&&x(this)}this.callBase(e)}})},views:{rowsView:{_getCellTemplate:function(e){var t,a=this,i=e.column,l=this.getController("editing"),n=l&&l.isEditRow(e.rowIndex);return t="detail"!==i.command||n?this.callBase.apply(this,arguments):this.option("masterDetail.template")||{allowRenderToDetachedContainer:!1,render:this._getDefaultTemplate(i)}},_cellPrepared:function(e,t){var a=this,i=a.component;a.callBase.apply(a,arguments),"detail"===t.rowType&&"detail"===t.column.command&&e.find("."+a.getWidgetContainerClass()).each(function(){var e=(0,l.default)(this).parent().data("dxDataGrid");e&&e.on("contentReady",function(){if(a._isFixedColumns){var e=(0,l.default)(i.getRowElement(t.rowIndex));e&&2===e.length&&e.eq(0).height()!==e.eq(1).height()&&i.updateDimensions()}else{var n=i.getScrollable();n&&n.update()}})})},_isDetailRow:function(e){return e&&e.rowType&&0===e.rowType.indexOf("detail")},_createRow:function(e){var t=this.callBase(e);return e&&this._isDetailRow(e)&&(this.option("showRowLines")&&t.addClass("dx-row-lines"),t.addClass("dx-master-detail-row"),(0,o.isDefined)(e.visible)&&t.toggle(e.visible)),t},_renderCells:function(e,t){var a,i=t.row,l=this._columnsController.getVisibleColumns();i.rowType&&this._isDetailRow(i)?(a=this._renderCell(e,{value:null,row:i,rowIndex:i.rowIndex,column:{command:"detail"},columnIndex:0})).addClass("dx-cell-focus-disabled").addClass("dx-master-detail-cell").attr("colSpan",l.length):this.callBase.apply(this,arguments)}}}}}}

