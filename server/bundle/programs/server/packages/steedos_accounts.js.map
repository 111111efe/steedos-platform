{"version":3,"sources":["meteor://💻app/packages/steedos:accounts/checkNpm.js","meteor://💻app/packages/steedos:accounts/lib/URI.js","meteor://💻app/packages/steedos_accounts/lib/core.coffee","meteor://💻app/lib/core.coffee","meteor://💻app/packages/steedos_accounts/lib/force_bind_phone.coffee","meteor://💻app/lib/force_bind_phone.coffee","meteor://💻app/packages/steedos_accounts/lib/accounts.coffee","meteor://💻app/lib/accounts.coffee","meteor://💻app/packages/steedos:accounts/password_server.js","meteor://💻app/packages/steedos_accounts/server/methods/update_phone.coffee","meteor://💻app/server/methods/update_phone.coffee","meteor://💻app/packages/steedos_accounts/server/methods/disable_phone.coffee","meteor://💻app/server/methods/disable_phone.coffee","meteor://💻app/packages/steedos_accounts/server/methods/join_space_from_login.coffee","meteor://💻app/server/methods/join_space_from_login.coffee","meteor://💻app/packages/steedos_accounts/server/methods/check_user.coffee","meteor://💻app/server/methods/check_user.coffee"],"names":["checkNpmVersions","module","link","v","cookies","phone","sha256","root","factory","define","amd","URI","punycode","IPv6","SecondLevelDomains","SLD","_URI","url","base","_urlSupplied","arguments","length","_baseSupplied","undefined","TypeError","location","href","absoluteTo","version","p","prototype","hasOwn","Object","hasOwnProperty","escapeRegEx","string","replace","getType","value","String","toString","call","slice","isArray","obj","filterArrayValues","data","lookup","i","_match","test","splice","arrayContains","list","_type","match","arraysEqual","one","two","sort","l","trimSlashes","text","trim_expression","_parts","protocol","username","password","hostname","urn","port","path","query","fragment","duplicateQueryParameters","escapeQuerySpace","protocol_expression","idn_expression","punycode_expression","ip4_expression","ip6_expression","find_uri_expression","findUri","start","end","trim","defaultPorts","http","https","ftp","gopher","ws","wss","invalid_hostname_characters","domAttributes","getDomAttribute","node","nodeName","toLowerCase","type","escapeForDumbFirefox36","escape","strictEncodeURIComponent","encodeURIComponent","encode","decode","decodeURIComponent","iso8859","unescape","unicode","characters","pathname","expression","map","reserved","urnpath","encodeQuery","escaped","decodeQuery","e","_part","generateAccessor","_group","c","generateSegmentedPathFunction","_sep","_codingFuncName","_innerCodingFuncName","actualCodingFunc","segments","split","join","decodePath","decodeUrnPath","recodePath","recodeUrnPath","encodeReserved","parse","parts","pos","indexOf","substring","parseAuthority","parseHost","bracketPos","t","charAt","firstColon","firstSlash","nextColon","parseUserinfo","lastIndexOf","shift","parseQuery","items","splits","name","push","build","buildAuthority","buildHost","buildUserinfo","buildQuery","unique","key","buildQueryParameter","addQuery","concat","removeQuery","hasQuery","withinArray","_booly","Boolean","op","commonPath","Math","min","withinString","callback","options","_start","_end","_trim","_attributeOpen","lastIndex","exec","index","ignoreHtml","attributeOpen","max","search","ignore","result","ensureValidHostname","toASCII","noConflict","removeAll","unconflicted","URITemplate","deferBuild","_deferred_build","_string","clone","valueOf","generateSimpleAccessor","generatePrefixAccessor","_key","hash","res","_object","attribute","src","is","what","ip","ip4","ip6","sld","idn","relative","has","_protocol","_port","_hostname","scheme","x","origin","authority","host","userinfo","resource","subdomain","domain","sub","RegExp","tld","get","ReferenceError","directory","filename","decodePathSegment","mutatedDirectory","normalizePath","suffix","s","segment","separator","absolute","Error","pop","unshift","segmentCoded","q","setQuery","setSearch","addSearch","removeSearch","hasSearch","normalize","normalizeProtocol","normalizeQuery","normalizeFragment","normalizeHostname","normalizePort","best","_path","_was_relative","_leadingParents","_parent","_pos","normalizePathname","normalizeSearch","normalizeHash","d","readable","uri","toUnicode","qp","kv","resolved","properties","basedir","relativeTo","relativeParts","baseParts","common","relativePath","basePath","parents","equals","one_map","two_map","checked","one_query","two_query","Steedos","Meteor","absoluteUrl","_","extend","Accounts","updatePhone","number","isServer","isClient","disablePhoneWithoutExpiredDays","expiredDays","getPhoneNumber","isIncludePrefix","user","ref","ref1","db","users","findOne","mobile","E164","getPhoneNumberWithoutPrefix","getPhonePrefix","prefix","checkPhoneStateExpired","ref2","settings","forceAccountBindPhone","methods","checkForceBindPhone","spaces","noForceUsers","space_settings","check","Array","find","space","$in","forEach","n","ref3","values","union","userId","isForceBindPhone","ref4","ref5","isMobile","onLogin","isPhoneVerified","setTimeout","fetch","getProperty","error","results","routerPath","setupUrl","toastr","reason","FlowRouter","go","current","closeButton","timeOut","extendedTimeOut","onclick","openWindow","pwdField","sendVerificationEmail","process","env","MAIL_URL","Package","AccountsTemplates","configure","defaultLayout","defaultLayoutRegions","nav","defaultContentRegion","showForgotPasswordLink","overrideLoginErrors","enablePasswordChange","homeRoutePath","negativeValidation","positiveValidation","negativeFeedback","positiveFeedback","showLabels","preSignUpHook","profile","locale","getLocale","configureRoute","redirect","queryParams","document","email","emails","address","$","body","addClass","removeClass","message","removeField","addFields","_id","required","displayName","re","errStr","placeholder","forgotPwd","minLength","emailTemplates","siteName","from","accounts","disableAccountRegistration","forbidClientAccountCreation","bcrypt","NpmModuleBcrypt","bcryptHash","wrapAsync","bcryptCompare","compare","passwordValidator","Match","OneOf","digest","algorithm","checkPassword","_checkPassword","getPasswordString","SHA256","hashPassword","_bcryptRounds","handleError","msg","throwError","_options","ambiguousErrorMessages","generateCasePermutationsForString","permutations","ch","flatten","lowerCaseChar","upperCaseChar","toUpperCase","selectorForFastCaseInsensitiveLookup","fieldName","orClause","prefixPermutation","selector","_escapeRegExp","caseInsensitiveClause","$and","$or","_findUserByQueryForSteedos","id","fieldValue","candidateUsers","NonEmptyString","Where","userQueryValidator","Optional","keys","registerLoginHandler","password2","srp","services","verifier","newVerifier","SRP","generateVerifier","identity","salt","EJSON","stringify","format","v1","v2","hashedIdentityAndPassword","salted","update","$unset","$set","Phone","require","currentNumber","currentUser","currentUserId","repeatNumberUser","fields","verified","modified","now","outDays","Number","Date","floor","getTime","joinSpaceFromLogin","rootOrg","space_logined","space_user","user_email","space_users","organizations","parent","insert","user_accepted","is_logined_from_space","checkUser","company"],"mappings":"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","file":"/packages/steedos_accounts.js","sourcesContent":["import {\n\tcheckNpmVersions\n} from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n\tcookies: \"^0.6.2\",\n\tphone: \"^1.0.12\",\n\tsha256: \"^0.2.0\"\n}, 'steedos:accounts');","/*!\n * URI.js - Mutating URLs\n *\n * Version: 1.17.0\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *   GPL v3 http://opensource.org/licenses/GPL-3.0\n *\n */\n(function (root, factory) {\n  'use strict';\n  // https://github.com/umdjs/umd/blob/master/returnExports.js\n  // if (typeof exports === 'object') {\n  //   // Node\n  //   module.exports = factory(require('./punycode'), require('./IPv6'), require('./SecondLevelDomains'));\n  // } else\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['./punycode', './IPv6', './SecondLevelDomains'], factory);\n  } else {\n    // Browser globals (root is window)\n    root.URI = factory(root.punycode, root.IPv6, root.SecondLevelDomains, root);\n  }\n}(this, function (punycode, IPv6, SLD, root) {\n  'use strict';\n  /*global location, escape, unescape */\n  // FIXME: v2.0.0 renamce non-camelCase properties to uppercase\n  /*jshint camelcase: false */\n\n  // save current URI variable, if any\n  var _URI = root && root.URI;\n\n  function URI(url, base) {\n    var _urlSupplied = arguments.length >= 1;\n    var _baseSupplied = arguments.length >= 2;\n\n    // Allow instantiation without the 'new' keyword\n    if (!(this instanceof URI)) {\n      if (_urlSupplied) {\n        if (_baseSupplied) {\n          return new URI(url, base);\n        }\n\n        return new URI(url);\n      }\n\n      return new URI();\n    }\n\n    if (url === undefined) {\n      if (_urlSupplied) {\n        throw new TypeError('undefined is not a valid argument for URI');\n      }\n\n      if (typeof location !== 'undefined') {\n        url = location.href + '';\n      } else {\n        url = '';\n      }\n    }\n\n    this.href(url);\n\n    // resolve to base according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#constructor\n    if (base !== undefined) {\n      return this.absoluteTo(base);\n    }\n\n    return this;\n  }\n\n  URI.version = '1.17.0';\n\n  var p = URI.prototype;\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  function escapeRegEx(string) {\n    // https://github.com/medialize/URI.js/commit/85ac21783c11f8ccab06106dba9735a31a86924d#commitcomment-821963\n    return string.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n  }\n\n  function getType(value) {\n    // IE8 doesn't return [Object Undefined] but [Object Object] for undefined value\n    if (value === undefined) {\n      return 'Undefined';\n    }\n\n    return String(Object.prototype.toString.call(value)).slice(8, -1);\n  }\n\n  function isArray(obj) {\n    return getType(obj) === 'Array';\n  }\n\n  function filterArrayValues(data, value) {\n    var lookup = {};\n    var i, length;\n\n    if (getType(value) === 'RegExp') {\n      lookup = null;\n    } else if (isArray(value)) {\n      for (i = 0, length = value.length; i < length; i++) {\n        lookup[value[i]] = true;\n      }\n    } else {\n      lookup[value] = true;\n    }\n\n    for (i = 0, length = data.length; i < length; i++) {\n      /*jshint laxbreak: true */\n      var _match = lookup && lookup[data[i]] !== undefined\n        || !lookup && value.test(data[i]);\n      /*jshint laxbreak: false */\n      if (_match) {\n        data.splice(i, 1);\n        length--;\n        i--;\n      }\n    }\n\n    return data;\n  }\n\n  function arrayContains(list, value) {\n    var i, length;\n\n    // value may be string, number, array, regexp\n    if (isArray(value)) {\n      // Note: this can be optimized to O(n) (instead of current O(m * n))\n      for (i = 0, length = value.length; i < length; i++) {\n        if (!arrayContains(list, value[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    var _type = getType(value);\n    for (i = 0, length = list.length; i < length; i++) {\n      if (_type === 'RegExp') {\n        if (typeof list[i] === 'string' && list[i].match(value)) {\n          return true;\n        }\n      } else if (list[i] === value) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function arraysEqual(one, two) {\n    if (!isArray(one) || !isArray(two)) {\n      return false;\n    }\n\n    // arrays can't be equal if they have different amount of content\n    if (one.length !== two.length) {\n      return false;\n    }\n\n    one.sort();\n    two.sort();\n\n    for (var i = 0, l = one.length; i < l; i++) {\n      if (one[i] !== two[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function trimSlashes(text) {\n    var trim_expression = /^\\/+|\\/+$/g;\n    return text.replace(trim_expression, '');\n  }\n\n  URI._parts = function() {\n    return {\n      protocol: null,\n      username: null,\n      password: null,\n      hostname: null,\n      urn: null,\n      port: null,\n      path: null,\n      query: null,\n      fragment: null,\n      // state\n      duplicateQueryParameters: URI.duplicateQueryParameters,\n      escapeQuerySpace: URI.escapeQuerySpace\n    };\n  };\n  // state: allow duplicate query parameters (a=1&a=1)\n  URI.duplicateQueryParameters = false;\n  // state: replaces + with %20 (space in query strings)\n  URI.escapeQuerySpace = true;\n  // static properties\n  URI.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;\n  URI.idn_expression = /[^a-z0-9\\.-]/i;\n  URI.punycode_expression = /(xn--)/i;\n  // well, 333.444.555.666 matches, but it sure ain't no IPv4 - do we care?\n  URI.ip4_expression = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n  // credits to Rich Brown\n  // source: http://forums.intermapper.com/viewtopic.php?p=1096#1096\n  // specification: http://www.ietf.org/rfc/rfc4291.txt\n  URI.ip6_expression = /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/;\n  // expression used is \"gruber revised\" (@gruber v2) determined to be the\n  // best solution in a regex-golf we did a couple of ages ago at\n  // * http://mathiasbynens.be/demo/url-regex\n  // * http://rodneyrehm.de/t/url-regex.html\n  URI.find_uri_expression = /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/ig;\n  URI.findUri = {\n    // valid \"scheme://\" or \"www.\"\n    start: /\\b(?:([a-z][a-z0-9.+-]*:\\/\\/)|www\\.)/gi,\n    // everything up to the next whitespace\n    end: /[\\s\\r\\n]|$/,\n    // trim trailing punctuation captured by end RegExp\n    trim: /[`!()\\[\\]{};:'\".,<>?«»“”„‘’]+$/\n  };\n  // http://www.iana.org/assignments/uri-schemes.html\n  // http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports\n  URI.defaultPorts = {\n    http: '80',\n    https: '443',\n    ftp: '21',\n    gopher: '70',\n    ws: '80',\n    wss: '443'\n  };\n  // allowed hostname characters according to RFC 3986\n  // ALPHA DIGIT \"-\" \".\" \"_\" \"~\" \"!\" \"$\" \"&\" \"'\" \"(\" \")\" \"*\" \"+\" \",\" \";\" \"=\" %encoded\n  // I've never seen a (non-IDN) hostname other than: ALPHA DIGIT . -\n  URI.invalid_hostname_characters = /[^a-zA-Z0-9\\.-]/;\n  // map DOM Elements to their URI attribute\n  URI.domAttributes = {\n    'a': 'href',\n    'blockquote': 'cite',\n    'link': 'href',\n    'base': 'href',\n    'script': 'src',\n    'form': 'action',\n    'img': 'src',\n    'area': 'href',\n    'iframe': 'src',\n    'embed': 'src',\n    'source': 'src',\n    'track': 'src',\n    'input': 'src', // but only if type=\"image\"\n    'audio': 'src',\n    'video': 'src'\n  };\n  URI.getDomAttribute = function(node) {\n    if (!node || !node.nodeName) {\n      return undefined;\n    }\n\n    var nodeName = node.nodeName.toLowerCase();\n    // <input> should only expose src for type=\"image\"\n    if (nodeName === 'input' && node.type !== 'image') {\n      return undefined;\n    }\n\n    return URI.domAttributes[nodeName];\n  };\n\n  function escapeForDumbFirefox36(value) {\n    // https://github.com/medialize/URI.js/issues/91\n    return escape(value);\n  }\n\n  // encoding / decoding according to RFC3986\n  function strictEncodeURIComponent(string) {\n    // see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/encodeURIComponent\n    return encodeURIComponent(string)\n      .replace(/[!'()*]/g, escapeForDumbFirefox36)\n      .replace(/\\*/g, '%2A');\n  }\n  URI.encode = strictEncodeURIComponent;\n  URI.decode = decodeURIComponent;\n  URI.iso8859 = function() {\n    URI.encode = escape;\n    URI.decode = unescape;\n  };\n  URI.unicode = function() {\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = decodeURIComponent;\n  };\n  URI.characters = {\n    pathname: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,\n        map: {\n          // -._~!'()*\n          '%24': '$',\n          '%26': '&',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '=',\n          '%3A': ':',\n          '%40': '@'\n        }\n      },\n      decode: {\n        expression: /[\\/\\?#]/g,\n        map: {\n          '/': '%2F',\n          '?': '%3F',\n          '#': '%23'\n        }\n      }\n    },\n    reserved: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,\n        map: {\n          // gen-delims\n          '%3A': ':',\n          '%2F': '/',\n          '%3F': '?',\n          '%23': '#',\n          '%5B': '[',\n          '%5D': ']',\n          '%40': '@',\n          // sub-delims\n          '%21': '!',\n          '%24': '$',\n          '%26': '&',\n          '%27': '\\'',\n          '%28': '(',\n          '%29': ')',\n          '%2A': '*',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '='\n        }\n      }\n    },\n    urnpath: {\n      // The characters under `encode` are the characters called out by RFC 2141 as being acceptable\n      // for usage in a URN. RFC2141 also calls out \"-\", \".\", and \"_\" as acceptable characters, but\n      // these aren't encoded by encodeURIComponent, so we don't have to call them out here. Also\n      // note that the colon character is not featured in the encoding map; this is because URI.js\n      // gives the colons in URNs semantic meaning as the delimiters of path segements, and so it\n      // should not appear unencoded in a segment itself.\n      // See also the note above about RFC3986 and capitalalized hex digits.\n      encode: {\n        expression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,\n        map: {\n          '%21': '!',\n          '%24': '$',\n          '%27': '\\'',\n          '%28': '(',\n          '%29': ')',\n          '%2A': '*',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '=',\n          '%40': '@'\n        }\n      },\n      // These characters are the characters called out by RFC2141 as \"reserved\" characters that\n      // should never appear in a URN, plus the colon character (see note above).\n      decode: {\n        expression: /[\\/\\?#:]/g,\n        map: {\n          '/': '%2F',\n          '?': '%3F',\n          '#': '%23',\n          ':': '%3A'\n        }\n      }\n    }\n  };\n  URI.encodeQuery = function(string, escapeQuerySpace) {\n    var escaped = URI.encode(string + '');\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    return escapeQuerySpace ? escaped.replace(/%20/g, '+') : escaped;\n  };\n  URI.decodeQuery = function(string, escapeQuerySpace) {\n    string += '';\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    try {\n      return URI.decode(escapeQuerySpace ? string.replace(/\\+/g, '%20') : string);\n    } catch(e) {\n      // we're not going to mess with weird encodings,\n      // give up and return the undecoded original string\n      // see https://github.com/medialize/URI.js/issues/87\n      // see https://github.com/medialize/URI.js/issues/92\n      return string;\n    }\n  };\n  // generate encode/decode path functions\n  var _parts = {'encode':'encode', 'decode':'decode'};\n  var _part;\n  var generateAccessor = function(_group, _part) {\n    return function(string) {\n      try {\n        return URI[_part](string + '').replace(URI.characters[_group][_part].expression, function(c) {\n          return URI.characters[_group][_part].map[c];\n        });\n      } catch (e) {\n        // we're not going to mess with weird encodings,\n        // give up and return the undecoded original string\n        // see https://github.com/medialize/URI.js/issues/87\n        // see https://github.com/medialize/URI.js/issues/92\n        return string;\n      }\n    };\n  };\n\n  for (_part in _parts) {\n    URI[_part + 'PathSegment'] = generateAccessor('pathname', _parts[_part]);\n    URI[_part + 'UrnPathSegment'] = generateAccessor('urnpath', _parts[_part]);\n  }\n\n  var generateSegmentedPathFunction = function(_sep, _codingFuncName, _innerCodingFuncName) {\n    return function(string) {\n      // Why pass in names of functions, rather than the function objects themselves? The\n      // definitions of some functions (but in particular, URI.decode) will occasionally change due\n      // to URI.js having ISO8859 and Unicode modes. Passing in the name and getting it will ensure\n      // that the functions we use here are \"fresh\".\n      var actualCodingFunc;\n      if (!_innerCodingFuncName) {\n        actualCodingFunc = URI[_codingFuncName];\n      } else {\n        actualCodingFunc = function(string) {\n          return URI[_codingFuncName](URI[_innerCodingFuncName](string));\n        };\n      }\n\n      var segments = (string + '').split(_sep);\n\n      for (var i = 0, length = segments.length; i < length; i++) {\n        segments[i] = actualCodingFunc(segments[i]);\n      }\n\n      return segments.join(_sep);\n    };\n  };\n\n  // This takes place outside the above loop because we don't want, e.g., encodeUrnPath functions.\n  URI.decodePath = generateSegmentedPathFunction('/', 'decodePathSegment');\n  URI.decodeUrnPath = generateSegmentedPathFunction(':', 'decodeUrnPathSegment');\n  URI.recodePath = generateSegmentedPathFunction('/', 'encodePathSegment', 'decode');\n  URI.recodeUrnPath = generateSegmentedPathFunction(':', 'encodeUrnPathSegment', 'decode');\n\n  URI.encodeReserved = generateAccessor('reserved', 'encode');\n\n  URI.parse = function(string, parts) {\n    var pos;\n    if (!parts) {\n      parts = {};\n    }\n    // [protocol\"://\"[username[\":\"password]\"@\"]hostname[\":\"port]\"/\"?][path][\"?\"querystring][\"#\"fragment]\n\n    // extract fragment\n    pos = string.indexOf('#');\n    if (pos > -1) {\n      // escaping?\n      parts.fragment = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract query\n    pos = string.indexOf('?');\n    if (pos > -1) {\n      // escaping?\n      parts.query = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract protocol\n    if (string.substring(0, 2) === '//') {\n      // relative-scheme\n      parts.protocol = null;\n      string = string.substring(2);\n      // extract \"user:pass@host:port\"\n      string = URI.parseAuthority(string, parts);\n    } else {\n      pos = string.indexOf(':');\n      if (pos > -1) {\n        parts.protocol = string.substring(0, pos) || null;\n        if (parts.protocol && !parts.protocol.match(URI.protocol_expression)) {\n          // : may be within the path\n          parts.protocol = undefined;\n        } else if (string.substring(pos + 1, pos + 3) === '//') {\n          string = string.substring(pos + 3);\n\n          // extract \"user:pass@host:port\"\n          string = URI.parseAuthority(string, parts);\n        } else {\n          string = string.substring(pos + 1);\n          parts.urn = true;\n        }\n      }\n    }\n\n    // what's left must be the path\n    parts.path = string;\n\n    // and we're done\n    return parts;\n  };\n  URI.parseHost = function(string, parts) {\n    // Copy chrome, IE, opera backslash-handling behavior.\n    // Back slashes before the query string get converted to forward slashes\n    // See: https://github.com/joyent/node/blob/386fd24f49b0e9d1a8a076592a404168faeecc34/lib/url.js#L115-L124\n    // See: https://code.google.com/p/chromium/issues/detail?id=25916\n    // https://github.com/medialize/URI.js/pull/233\n    string = string.replace(/\\\\/g, '/');\n\n    // extract host:port\n    var pos = string.indexOf('/');\n    var bracketPos;\n    var t;\n\n    if (pos === -1) {\n      pos = string.length;\n    }\n\n    if (string.charAt(0) === '[') {\n      // IPv6 host - http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04#section-6\n      // I claim most client software breaks on IPv6 anyways. To simplify things, URI only accepts\n      // IPv6+port in the format [2001:db8::1]:80 (for the time being)\n      bracketPos = string.indexOf(']');\n      parts.hostname = string.substring(1, bracketPos) || null;\n      parts.port = string.substring(bracketPos + 2, pos) || null;\n      if (parts.port === '/') {\n        parts.port = null;\n      }\n    } else {\n      var firstColon = string.indexOf(':');\n      var firstSlash = string.indexOf('/');\n      var nextColon = string.indexOf(':', firstColon + 1);\n      if (nextColon !== -1 && (firstSlash === -1 || nextColon < firstSlash)) {\n        // IPv6 host contains multiple colons - but no port\n        // this notation is actually not allowed by RFC 3986, but we're a liberal parser\n        parts.hostname = string.substring(0, pos) || null;\n        parts.port = null;\n      } else {\n        t = string.substring(0, pos).split(':');\n        parts.hostname = t[0] || null;\n        parts.port = t[1] || null;\n      }\n    }\n\n    if (parts.hostname && string.substring(pos).charAt(0) !== '/') {\n      pos++;\n      string = '/' + string;\n    }\n\n    return string.substring(pos) || '/';\n  };\n  URI.parseAuthority = function(string, parts) {\n    string = URI.parseUserinfo(string, parts);\n    return URI.parseHost(string, parts);\n  };\n  URI.parseUserinfo = function(string, parts) {\n    // extract username:password\n    var firstSlash = string.indexOf('/');\n    var pos = string.lastIndexOf('@', firstSlash > -1 ? firstSlash : string.length - 1);\n    var t;\n\n    // authority@ must come before /path\n    if (pos > -1 && (firstSlash === -1 || pos < firstSlash)) {\n      t = string.substring(0, pos).split(':');\n      parts.username = t[0] ? URI.decode(t[0]) : null;\n      t.shift();\n      parts.password = t[0] ? URI.decode(t.join(':')) : null;\n      string = string.substring(pos + 1);\n    } else {\n      parts.username = null;\n      parts.password = null;\n    }\n\n    return string;\n  };\n  URI.parseQuery = function(string, escapeQuerySpace) {\n    if (!string) {\n      return {};\n    }\n\n    // throw out the funky business - \"?\"[name\"=\"value\"&\"]+\n    string = string.replace(/&+/g, '&').replace(/^\\?*&*|&+$/g, '');\n\n    if (!string) {\n      return {};\n    }\n\n    var items = {};\n    var splits = string.split('&');\n    var length = splits.length;\n    var v, name, value;\n\n    for (var i = 0; i < length; i++) {\n      v = splits[i].split('=');\n      name = URI.decodeQuery(v.shift(), escapeQuerySpace);\n      // no \"=\" is null according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#collect-url-parameters\n      value = v.length ? URI.decodeQuery(v.join('='), escapeQuerySpace) : null;\n\n      if (hasOwn.call(items, name)) {\n        if (typeof items[name] === 'string' || items[name] === null) {\n          items[name] = [items[name]];\n        }\n\n        items[name].push(value);\n      } else {\n        items[name] = value;\n      }\n    }\n\n    return items;\n  };\n\n  URI.build = function(parts) {\n    var t = '';\n\n    if (parts.protocol) {\n      t += parts.protocol + ':';\n    }\n\n    if (!parts.urn && (t || parts.hostname)) {\n      t += '//';\n    }\n\n    t += (URI.buildAuthority(parts) || '');\n\n    if (typeof parts.path === 'string') {\n      if (parts.path.charAt(0) !== '/' && typeof parts.hostname === 'string') {\n        t += '/';\n      }\n\n      t += parts.path;\n    }\n\n    if (typeof parts.query === 'string' && parts.query) {\n      t += '?' + parts.query;\n    }\n\n    if (typeof parts.fragment === 'string' && parts.fragment) {\n      t += '#' + parts.fragment;\n    }\n    return t;\n  };\n  URI.buildHost = function(parts) {\n    var t = '';\n\n    if (!parts.hostname) {\n      return '';\n    } else if (URI.ip6_expression.test(parts.hostname)) {\n      t += '[' + parts.hostname + ']';\n    } else {\n      t += parts.hostname;\n    }\n\n    if (parts.port) {\n      t += ':' + parts.port;\n    }\n\n    return t;\n  };\n  URI.buildAuthority = function(parts) {\n    return URI.buildUserinfo(parts) + URI.buildHost(parts);\n  };\n  URI.buildUserinfo = function(parts) {\n    var t = '';\n\n    if (parts.username) {\n      t += URI.encode(parts.username);\n\n      if (parts.password) {\n        t += ':' + URI.encode(parts.password);\n      }\n\n      t += '@';\n    }\n\n    return t;\n  };\n  URI.buildQuery = function(data, duplicateQueryParameters, escapeQuerySpace) {\n    // according to http://tools.ietf.org/html/rfc3986 or http://labs.apache.org/webarch/uri/rfc/rfc3986.html\n    // being »-._~!$&'()*+,;=:@/?« %HEX and alnum are allowed\n    // the RFC explicitly states ?/foo being a valid use case, no mention of parameter syntax!\n    // URI.js treats the query string as being application/x-www-form-urlencoded\n    // see http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type\n\n    var t = '';\n    var unique, key, i, length;\n    for (key in data) {\n      if (hasOwn.call(data, key) && key) {\n        if (isArray(data[key])) {\n          unique = {};\n          for (i = 0, length = data[key].length; i < length; i++) {\n            if (data[key][i] !== undefined && unique[data[key][i] + ''] === undefined) {\n              t += '&' + URI.buildQueryParameter(key, data[key][i], escapeQuerySpace);\n              if (duplicateQueryParameters !== true) {\n                unique[data[key][i] + ''] = true;\n              }\n            }\n          }\n        } else if (data[key] !== undefined) {\n          t += '&' + URI.buildQueryParameter(key, data[key], escapeQuerySpace);\n        }\n      }\n    }\n\n    return t.substring(1);\n  };\n  URI.buildQueryParameter = function(name, value, escapeQuerySpace) {\n    // http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type -- application/x-www-form-urlencoded\n    // don't append \"=\" for null values, according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#url-parameter-serialization\n    return URI.encodeQuery(name, escapeQuerySpace) + (value !== null ? '=' + URI.encodeQuery(value, escapeQuerySpace) : '');\n  };\n\n  URI.addQuery = function(data, name, value) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.addQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (data[name] === undefined) {\n        data[name] = value;\n        return;\n      } else if (typeof data[name] === 'string') {\n        data[name] = [data[name]];\n      }\n\n      if (!isArray(value)) {\n        value = [value];\n      }\n\n      data[name] = (data[name] || []).concat(value);\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n  };\n  URI.removeQuery = function(data, name, value) {\n    var i, length, key;\n\n    if (isArray(name)) {\n      for (i = 0, length = name.length; i < length; i++) {\n        data[name[i]] = undefined;\n      }\n    } else if (getType(name) === 'RegExp') {\n      for (key in data) {\n        if (name.test(key)) {\n          data[key] = undefined;\n        }\n      }\n    } else if (typeof name === 'object') {\n      for (key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.removeQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (value !== undefined) {\n        if (getType(value) === 'RegExp') {\n          if (!isArray(data[name]) && value.test(data[name])) {\n            data[name] = undefined;\n          } else {\n            data[name] = filterArrayValues(data[name], value);\n          }\n        } else if (data[name] === String(value) && (!isArray(value) || value.length === 1)) {\n          data[name] = undefined;\n        } else if (isArray(data[name])) {\n          data[name] = filterArrayValues(data[name], value);\n        }\n      } else {\n        data[name] = undefined;\n      }\n    } else {\n      throw new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter');\n    }\n  };\n  URI.hasQuery = function(data, name, value, withinArray) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          if (!URI.hasQuery(data, key, name[key])) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    } else if (typeof name !== 'string') {\n      throw new TypeError('URI.hasQuery() accepts an object, string as the name parameter');\n    }\n\n    switch (getType(value)) {\n      case 'Undefined':\n        // true if exists (but may be empty)\n        return name in data; // data[name] !== undefined;\n\n      case 'Boolean':\n        // true if exists and non-empty\n        var _booly = Boolean(isArray(data[name]) ? data[name].length : data[name]);\n        return value === _booly;\n\n      case 'Function':\n        // allow complex comparison\n        return !!value(data[name], name, data);\n\n      case 'Array':\n        if (!isArray(data[name])) {\n          return false;\n        }\n\n        var op = withinArray ? arrayContains : arraysEqual;\n        return op(data[name], value);\n\n      case 'RegExp':\n        if (!isArray(data[name])) {\n          return Boolean(data[name] && data[name].match(value));\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      case 'Number':\n        value = String(value);\n        /* falls through */\n      case 'String':\n        if (!isArray(data[name])) {\n          return data[name] === value;\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      default:\n        throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');\n    }\n  };\n\n\n  URI.commonPath = function(one, two) {\n    var length = Math.min(one.length, two.length);\n    var pos;\n\n    // find first non-matching character\n    for (pos = 0; pos < length; pos++) {\n      if (one.charAt(pos) !== two.charAt(pos)) {\n        pos--;\n        break;\n      }\n    }\n\n    if (pos < 1) {\n      return one.charAt(0) === two.charAt(0) && one.charAt(0) === '/' ? '/' : '';\n    }\n\n    // revert to last /\n    if (one.charAt(pos) !== '/' || two.charAt(pos) !== '/') {\n      pos = one.substring(0, pos).lastIndexOf('/');\n    }\n\n    return one.substring(0, pos + 1);\n  };\n\n  URI.withinString = function(string, callback, options) {\n    options || (options = {});\n    var _start = options.start || URI.findUri.start;\n    var _end = options.end || URI.findUri.end;\n    var _trim = options.trim || URI.findUri.trim;\n    var _attributeOpen = /[a-z0-9-]=[\"']?$/i;\n\n    _start.lastIndex = 0;\n    while (true) {\n      var match = _start.exec(string);\n      if (!match) {\n        break;\n      }\n\n      var start = match.index;\n      if (options.ignoreHtml) {\n        // attribut(e=[\"']?$)\n        var attributeOpen = string.slice(Math.max(start - 3, 0), start);\n        if (attributeOpen && _attributeOpen.test(attributeOpen)) {\n          continue;\n        }\n      }\n\n      var end = start + string.slice(start).search(_end);\n      var slice = string.slice(start, end).replace(_trim, '');\n      if (options.ignore && options.ignore.test(slice)) {\n        continue;\n      }\n\n      end = start + slice.length;\n      var result = callback(slice, start, end, string);\n      string = string.slice(0, start) + result + string.slice(end);\n      _start.lastIndex = start + result.length;\n    }\n\n    _start.lastIndex = 0;\n    return string;\n  };\n\n  URI.ensureValidHostname = function(v) {\n    // Theoretically URIs allow percent-encoding in Hostnames (according to RFC 3986)\n    // they are not part of DNS and therefore ignored by URI.js\n\n    if (v.match(URI.invalid_hostname_characters)) {\n      // test punycode\n      if (!punycode) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-] and Punycode.js is not available');\n      }\n\n      if (punycode.toASCII(v).match(URI.invalid_hostname_characters)) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n    }\n  };\n\n  // noConflict\n  URI.noConflict = function(removeAll) {\n    if (removeAll) {\n      var unconflicted = {\n        URI: this.noConflict()\n      };\n\n      if (root.URITemplate && typeof root.URITemplate.noConflict === 'function') {\n        unconflicted.URITemplate = root.URITemplate.noConflict();\n      }\n\n      if (root.IPv6 && typeof root.IPv6.noConflict === 'function') {\n        unconflicted.IPv6 = root.IPv6.noConflict();\n      }\n\n      if (root.SecondLevelDomains && typeof root.SecondLevelDomains.noConflict === 'function') {\n        unconflicted.SecondLevelDomains = root.SecondLevelDomains.noConflict();\n      }\n\n      return unconflicted;\n    } else if (root.URI === this) {\n      root.URI = _URI;\n    }\n\n    return this;\n  };\n\n  p.build = function(deferBuild) {\n    if (deferBuild === true) {\n      this._deferred_build = true;\n    } else if (deferBuild === undefined || this._deferred_build) {\n      this._string = URI.build(this._parts);\n      this._deferred_build = false;\n    }\n\n    return this;\n  };\n\n  p.clone = function() {\n    return new URI(this);\n  };\n\n  p.valueOf = p.toString = function() {\n    return this.build(false)._string;\n  };\n\n\n  function generateSimpleAccessor(_part){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        this._parts[_part] = v || null;\n        this.build(!build);\n        return this;\n      }\n    };\n  }\n\n  function generatePrefixAccessor(_part, _key){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        if (v !== null) {\n          v = v + '';\n          if (v.charAt(0) === _key) {\n            v = v.substring(1);\n          }\n        }\n\n        this._parts[_part] = v;\n        this.build(!build);\n        return this;\n      }\n    };\n  }\n\n  p.protocol = generateSimpleAccessor('protocol');\n  p.username = generateSimpleAccessor('username');\n  p.password = generateSimpleAccessor('password');\n  p.hostname = generateSimpleAccessor('hostname');\n  p.port = generateSimpleAccessor('port');\n  p.query = generatePrefixAccessor('query', '?');\n  p.fragment = generatePrefixAccessor('fragment', '#');\n\n  p.search = function(v, build) {\n    var t = this.query(v, build);\n    return typeof t === 'string' && t.length ? ('?' + t) : t;\n  };\n  p.hash = function(v, build) {\n    var t = this.fragment(v, build);\n    return typeof t === 'string' && t.length ? ('#' + t) : t;\n  };\n\n  p.pathname = function(v, build) {\n    if (v === undefined || v === true) {\n      var res = this._parts.path || (this._parts.hostname ? '/' : '');\n      return v ? (this._parts.urn ? URI.decodeUrnPath : URI.decodePath)(res) : res;\n    } else {\n      if (this._parts.urn) {\n        this._parts.path = v ? URI.recodeUrnPath(v) : '';\n      } else {\n        this._parts.path = v ? URI.recodePath(v) : '/';\n      }\n      this.build(!build);\n      return this;\n    }\n  };\n  p.path = p.pathname;\n  p.href = function(href, build) {\n    var key;\n\n    if (href === undefined) {\n      return this.toString();\n    }\n\n    this._string = '';\n    this._parts = URI._parts();\n\n    var _URI = href instanceof URI;\n    var _object = typeof href === 'object' && (href.hostname || href.path || href.pathname);\n    if (href.nodeName) {\n      var attribute = URI.getDomAttribute(href);\n      href = href[attribute] || '';\n      _object = false;\n    }\n\n    // window.location is reported to be an object, but it's not the sort\n    // of object we're looking for:\n    // * location.protocol ends with a colon\n    // * location.query != object.search\n    // * location.hash != object.fragment\n    // simply serializing the unknown object should do the trick\n    // (for location, not for everything...)\n    if (!_URI && _object && href.pathname !== undefined) {\n      href = href.toString();\n    }\n\n    if (typeof href === 'string' || href instanceof String) {\n      this._parts = URI.parse(String(href), this._parts);\n    } else if (_URI || _object) {\n      var src = _URI ? href._parts : href;\n      for (key in src) {\n        if (hasOwn.call(this._parts, key)) {\n          this._parts[key] = src[key];\n        }\n      }\n    } else {\n      throw new TypeError('invalid input');\n    }\n\n    this.build(!build);\n    return this;\n  };\n\n  // identification accessors\n  p.is = function(what) {\n    var ip = false;\n    var ip4 = false;\n    var ip6 = false;\n    var name = false;\n    var sld = false;\n    var idn = false;\n    var punycode = false;\n    var relative = !this._parts.urn;\n\n    if (this._parts.hostname) {\n      relative = false;\n      ip4 = URI.ip4_expression.test(this._parts.hostname);\n      ip6 = URI.ip6_expression.test(this._parts.hostname);\n      ip = ip4 || ip6;\n      name = !ip;\n      sld = name && SLD && SLD.has(this._parts.hostname);\n      idn = name && URI.idn_expression.test(this._parts.hostname);\n      punycode = name && URI.punycode_expression.test(this._parts.hostname);\n    }\n\n    switch (what.toLowerCase()) {\n      case 'relative':\n        return relative;\n\n      case 'absolute':\n        return !relative;\n\n      // hostname identification\n      case 'domain':\n      case 'name':\n        return name;\n\n      case 'sld':\n        return sld;\n\n      case 'ip':\n        return ip;\n\n      case 'ip4':\n      case 'ipv4':\n      case 'inet4':\n        return ip4;\n\n      case 'ip6':\n      case 'ipv6':\n      case 'inet6':\n        return ip6;\n\n      case 'idn':\n        return idn;\n\n      case 'url':\n        return !this._parts.urn;\n\n      case 'urn':\n        return !!this._parts.urn;\n\n      case 'punycode':\n        return punycode;\n    }\n\n    return null;\n  };\n\n  // component specific input validation\n  var _protocol = p.protocol;\n  var _port = p.port;\n  var _hostname = p.hostname;\n\n  p.protocol = function(v, build) {\n    if (v !== undefined) {\n      if (v) {\n        // accept trailing ://\n        v = v.replace(/:(\\/\\/)?$/, '');\n\n        if (!v.match(URI.protocol_expression)) {\n          throw new TypeError('Protocol \"' + v + '\" contains characters other than [A-Z0-9.+-] or doesn\\'t start with [A-Z]');\n        }\n      }\n    }\n    return _protocol.call(this, v, build);\n  };\n  p.scheme = p.protocol;\n  p.port = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      if (v === 0) {\n        v = null;\n      }\n\n      if (v) {\n        v += '';\n        if (v.charAt(0) === ':') {\n          v = v.substring(1);\n        }\n\n        if (v.match(/[^0-9]/)) {\n          throw new TypeError('Port \"' + v + '\" contains characters other than [0-9]');\n        }\n      }\n    }\n    return _port.call(this, v, build);\n  };\n  p.hostname = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      var x = {};\n      var res = URI.parseHost(v, x);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      v = x.hostname;\n    }\n    return _hostname.call(this, v, build);\n  };\n\n  // compound accessors\n  p.origin = function(v, build) {\n    var parts;\n\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      var protocol = this.protocol();\n      var authority = this.authority();\n      if (!authority) return '';\n      return (protocol ? protocol + '://' : '') + this.authority();\n    } else {\n      var origin = URI(v);\n      this\n        .protocol(origin.protocol())\n        .authority(origin.authority())\n        .build(!build);\n      return this;\n    }\n  };\n  p.host = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildHost(this._parts) : '';\n    } else {\n      var res = URI.parseHost(v, this._parts);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.authority = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildAuthority(this._parts) : '';\n    } else {\n      var res = URI.parseAuthority(v, this._parts);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.userinfo = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      if (!this._parts.username) {\n        return '';\n      }\n\n      var t = URI.buildUserinfo(this._parts);\n      return t.substring(0, t.length -1);\n    } else {\n      if (v[v.length-1] !== '@') {\n        v += '@';\n      }\n\n      URI.parseUserinfo(v, this._parts);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.resource = function(v, build) {\n    var parts;\n\n    if (v === undefined) {\n      return this.path() + this.search() + this.hash();\n    }\n\n    parts = URI.parse(v);\n    this._parts.path = parts.path;\n    this._parts.query = parts.query;\n    this._parts.fragment = parts.fragment;\n    this.build(!build);\n    return this;\n  };\n\n  // fraction accessors\n  p.subdomain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    // convenience, return \"www\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // grab domain and add another segment\n      var end = this._parts.hostname.length - this.domain().length - 1;\n      return this._parts.hostname.substring(0, end) || '';\n    } else {\n      var e = this._parts.hostname.length - this.domain().length;\n      var sub = this._parts.hostname.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(sub));\n\n      if (v && v.charAt(v.length - 1) !== '.') {\n        v += '.';\n      }\n\n      if (v) {\n        URI.ensureValidHostname(v);\n      }\n\n      this._parts.hostname = this._parts.hostname.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.domain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // convenience, return \"example.org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // if hostname consists of 1 or 2 segments, it must be the domain\n      var t = this._parts.hostname.match(/\\./g);\n      if (t && t.length < 2) {\n        return this._parts.hostname;\n      }\n\n      // grab tld and add another segment\n      var end = this._parts.hostname.length - this.tld(build).length - 1;\n      end = this._parts.hostname.lastIndexOf('.', end -1) + 1;\n      return this._parts.hostname.substring(end) || '';\n    } else {\n      if (!v) {\n        throw new TypeError('cannot set domain empty');\n      }\n\n      URI.ensureValidHostname(v);\n\n      if (!this._parts.hostname || this.is('IP')) {\n        this._parts.hostname = v;\n      } else {\n        var replace = new RegExp(escapeRegEx(this.domain()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.tld = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // return \"org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      var pos = this._parts.hostname.lastIndexOf('.');\n      var tld = this._parts.hostname.substring(pos + 1);\n\n      if (build !== true && SLD && SLD.list[tld.toLowerCase()]) {\n        return SLD.get(this._parts.hostname) || tld;\n      }\n\n      return tld;\n    } else {\n      var replace;\n\n      if (!v) {\n        throw new TypeError('cannot set TLD empty');\n      } else if (v.match(/[^a-zA-Z0-9-]/)) {\n        if (SLD && SLD.is(v)) {\n          replace = new RegExp(escapeRegEx(this.tld()) + '$');\n          this._parts.hostname = this._parts.hostname.replace(replace, v);\n        } else {\n          throw new TypeError('TLD \"' + v + '\" contains characters other than [A-Z0-9]');\n        }\n      } else if (!this._parts.hostname || this.is('IP')) {\n        throw new ReferenceError('cannot set TLD on non-domain host');\n      } else {\n        replace = new RegExp(escapeRegEx(this.tld()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.directory = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path && !this._parts.hostname) {\n        return '';\n      }\n\n      if (this._parts.path === '/') {\n        return '/';\n      }\n\n      var end = this._parts.path.length - this.filename().length - 1;\n      var res = this._parts.path.substring(0, end) || (this._parts.hostname ? '/' : '');\n\n      return v ? URI.decodePath(res) : res;\n\n    } else {\n      var e = this._parts.path.length - this.filename().length;\n      var directory = this._parts.path.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(directory));\n\n      // fully qualifier directories begin with a slash\n      if (!this.is('relative')) {\n        if (!v) {\n          v = '/';\n        }\n\n        if (v.charAt(0) !== '/') {\n          v = '/' + v;\n        }\n      }\n\n      // directories always end with a slash\n      if (v && v.charAt(v.length - 1) !== '/') {\n        v += '/';\n      }\n\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.filename = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var pos = this._parts.path.lastIndexOf('/');\n      var res = this._parts.path.substring(pos+1);\n\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      var mutatedDirectory = false;\n\n      if (v.charAt(0) === '/') {\n        v = v.substring(1);\n      }\n\n      if (v.match(/\\.?\\//)) {\n        mutatedDirectory = true;\n      }\n\n      var replace = new RegExp(escapeRegEx(this.filename()) + '$');\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n\n      if (mutatedDirectory) {\n        this.normalizePath(build);\n      } else {\n        this.build(!build);\n      }\n\n      return this;\n    }\n  };\n  p.suffix = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var filename = this.filename();\n      var pos = filename.lastIndexOf('.');\n      var s, res;\n\n      if (pos === -1) {\n        return '';\n      }\n\n      // suffix may only contain alnum characters (yup, I made this up.)\n      s = filename.substring(pos+1);\n      res = (/^[a-z0-9%]+$/i).test(s) ? s : '';\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      if (v.charAt(0) === '.') {\n        v = v.substring(1);\n      }\n\n      var suffix = this.suffix();\n      var replace;\n\n      if (!suffix) {\n        if (!v) {\n          return this;\n        }\n\n        this._parts.path += '.' + URI.recodePath(v);\n      } else if (!v) {\n        replace = new RegExp(escapeRegEx('.' + suffix) + '$');\n      } else {\n        replace = new RegExp(escapeRegEx(suffix) + '$');\n      }\n\n      if (replace) {\n        v = URI.recodePath(v);\n        this._parts.path = this._parts.path.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.segment = function(segment, v, build) {\n    var separator = this._parts.urn ? ':' : '/';\n    var path = this.path();\n    var absolute = path.substring(0, 1) === '/';\n    var segments = path.split(separator);\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      throw new Error('Bad segment \"' + segment + '\", must be 0-based integer');\n    }\n\n    if (absolute) {\n      segments.shift();\n    }\n\n    if (segment < 0) {\n      // allow negative indexes to address from the end\n      segment = Math.max(segments.length + segment, 0);\n    }\n\n    if (v === undefined) {\n      /*jshint laxbreak: true */\n      return segment === undefined\n        ? segments\n        : segments[segment];\n      /*jshint laxbreak: false */\n    } else if (segment === null || segments[segment] === undefined) {\n      if (isArray(v)) {\n        segments = [];\n        // collapse empty elements within array\n        for (var i=0, l=v.length; i < l; i++) {\n          if (!v[i].length && (!segments.length || !segments[segments.length -1].length)) {\n            continue;\n          }\n\n          if (segments.length && !segments[segments.length -1].length) {\n            segments.pop();\n          }\n\n          segments.push(trimSlashes(v[i]));\n        }\n      } else if (v || typeof v === 'string') {\n        v = trimSlashes(v);\n        if (segments[segments.length -1] === '') {\n          // empty trailing elements have to be overwritten\n          // to prevent results such as /foo//bar\n          segments[segments.length -1] = v;\n        } else {\n          segments.push(v);\n        }\n      }\n    } else {\n      if (v) {\n        segments[segment] = trimSlashes(v);\n      } else {\n        segments.splice(segment, 1);\n      }\n    }\n\n    if (absolute) {\n      segments.unshift('');\n    }\n\n    return this.path(segments.join(separator), build);\n  };\n  p.segmentCoded = function(segment, v, build) {\n    var segments, i, l;\n\n    if (typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (v === undefined) {\n      segments = this.segment(segment, v, build);\n      if (!isArray(segments)) {\n        segments = segments !== undefined ? URI.decode(segments) : undefined;\n      } else {\n        for (i = 0, l = segments.length; i < l; i++) {\n          segments[i] = URI.decode(segments[i]);\n        }\n      }\n\n      return segments;\n    }\n\n    if (!isArray(v)) {\n      v = (typeof v === 'string' || v instanceof String) ? URI.encode(v) : v;\n    } else {\n      for (i = 0, l = v.length; i < l; i++) {\n        v[i] = URI.encode(v[i]);\n      }\n    }\n\n    return this.segment(segment, v, build);\n  };\n\n  // mutating query string\n  var q = p.query;\n  p.query = function(v, build) {\n    if (v === true) {\n      return URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    } else if (typeof v === 'function') {\n      var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n      var result = v.call(this, data);\n      this._parts.query = URI.buildQuery(result || data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else if (v !== undefined && typeof v !== 'string') {\n      this._parts.query = URI.buildQuery(v, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else {\n      return q.call(this, v, build);\n    }\n  };\n  p.setQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\n    if (typeof name === 'string' || name instanceof String) {\n      data[name] = value !== undefined ? value : null;\n    } else if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          data[key] = name[key];\n        }\n      }\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.addQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.addQuery(data, name, value === undefined ? null : value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.removeQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.removeQuery(data, name, value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.hasQuery = function(name, value, withinArray) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    return URI.hasQuery(data, name, value, withinArray);\n  };\n  p.setSearch = p.setQuery;\n  p.addSearch = p.addQuery;\n  p.removeSearch = p.removeQuery;\n  p.hasSearch = p.hasQuery;\n\n  // sanitizing URLs\n  p.normalize = function() {\n    if (this._parts.urn) {\n      return this\n        .normalizeProtocol(false)\n        .normalizePath(false)\n        .normalizeQuery(false)\n        .normalizeFragment(false)\n        .build();\n    }\n\n    return this\n      .normalizeProtocol(false)\n      .normalizeHostname(false)\n      .normalizePort(false)\n      .normalizePath(false)\n      .normalizeQuery(false)\n      .normalizeFragment(false)\n      .build();\n  };\n  p.normalizeProtocol = function(build) {\n    if (typeof this._parts.protocol === 'string') {\n      this._parts.protocol = this._parts.protocol.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeHostname = function(build) {\n    if (this._parts.hostname) {\n      if (this.is('IDN') && punycode) {\n        this._parts.hostname = punycode.toASCII(this._parts.hostname);\n      } else if (this.is('IPv6') && IPv6) {\n        this._parts.hostname = IPv6.best(this._parts.hostname);\n      }\n\n      this._parts.hostname = this._parts.hostname.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePort = function(build) {\n    // remove port of it's the protocol's default\n    if (typeof this._parts.protocol === 'string' && this._parts.port === URI.defaultPorts[this._parts.protocol]) {\n      this._parts.port = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePath = function(build) {\n    var _path = this._parts.path;\n    if (!_path) {\n      return this;\n    }\n\n    if (this._parts.urn) {\n      this._parts.path = URI.recodeUrnPath(this._parts.path);\n      this.build(!build);\n      return this;\n    }\n\n    if (this._parts.path === '/') {\n      return this;\n    }\n\n    var _was_relative;\n    var _leadingParents = '';\n    var _parent, _pos;\n\n    // handle relative paths\n    if (_path.charAt(0) !== '/') {\n      _was_relative = true;\n      _path = '/' + _path;\n    }\n\n    // handle relative files (as opposed to directories)\n    if (_path.slice(-3) === '/..' || _path.slice(-2) === '/.') {\n      _path += '/';\n    }\n\n    // resolve simples\n    _path = _path\n      .replace(/(\\/(\\.\\/)+)|(\\/\\.$)/g, '/')\n      .replace(/\\/{2,}/g, '/');\n\n    // remember leading parents\n    if (_was_relative) {\n      _leadingParents = _path.substring(1).match(/^(\\.\\.\\/)+/) || '';\n      if (_leadingParents) {\n        _leadingParents = _leadingParents[0];\n      }\n    }\n\n    // resolve parents\n    while (true) {\n      _parent = _path.indexOf('/..');\n      if (_parent === -1) {\n        // no more ../ to resolve\n        break;\n      } else if (_parent === 0) {\n        // top level cannot be relative, skip it\n        _path = _path.substring(3);\n        continue;\n      }\n\n      _pos = _path.substring(0, _parent).lastIndexOf('/');\n      if (_pos === -1) {\n        _pos = _parent;\n      }\n      _path = _path.substring(0, _pos) + _path.substring(_parent + 3);\n    }\n\n    // revert to relative\n    if (_was_relative && this.is('relative')) {\n      _path = _leadingParents + _path.substring(1);\n    }\n\n    _path = URI.recodePath(_path);\n    this._parts.path = _path;\n    this.build(!build);\n    return this;\n  };\n  p.normalizePathname = p.normalizePath;\n  p.normalizeQuery = function(build) {\n    if (typeof this._parts.query === 'string') {\n      if (!this._parts.query.length) {\n        this._parts.query = null;\n      } else {\n        this.query(URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace));\n      }\n\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeFragment = function(build) {\n    if (!this._parts.fragment) {\n      this._parts.fragment = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeSearch = p.normalizeQuery;\n  p.normalizeHash = p.normalizeFragment;\n\n  p.iso8859 = function() {\n    // expect unicode input, iso8859 output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = escape;\n    URI.decode = decodeURIComponent;\n    try {\n      this.normalize();\n    } finally {\n      URI.encode = e;\n      URI.decode = d;\n    }\n    return this;\n  };\n\n  p.unicode = function() {\n    // expect iso8859 input, unicode output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = unescape;\n    try {\n      this.normalize();\n    } finally {\n      URI.encode = e;\n      URI.decode = d;\n    }\n    return this;\n  };\n\n  p.readable = function() {\n    var uri = this.clone();\n    // removing username, password, because they shouldn't be displayed according to RFC 3986\n    uri.username('').password('').normalize();\n    var t = '';\n    if (uri._parts.protocol) {\n      t += uri._parts.protocol + '://';\n    }\n\n    if (uri._parts.hostname) {\n      if (uri.is('punycode') && punycode) {\n        t += punycode.toUnicode(uri._parts.hostname);\n        if (uri._parts.port) {\n          t += ':' + uri._parts.port;\n        }\n      } else {\n        t += uri.host();\n      }\n    }\n\n    if (uri._parts.hostname && uri._parts.path && uri._parts.path.charAt(0) !== '/') {\n      t += '/';\n    }\n\n    t += uri.path(true);\n    if (uri._parts.query) {\n      var q = '';\n      for (var i = 0, qp = uri._parts.query.split('&'), l = qp.length; i < l; i++) {\n        var kv = (qp[i] || '').split('=');\n        q += '&' + URI.decodeQuery(kv[0], this._parts.escapeQuerySpace)\n          .replace(/&/g, '%26');\n\n        if (kv[1] !== undefined) {\n          q += '=' + URI.decodeQuery(kv[1], this._parts.escapeQuerySpace)\n            .replace(/&/g, '%26');\n        }\n      }\n      t += '?' + q.substring(1);\n    }\n\n    t += URI.decodeQuery(uri.hash(), true);\n    return t;\n  };\n\n  // resolving relative and absolute URLs\n  p.absoluteTo = function(base) {\n    var resolved = this.clone();\n    var properties = ['protocol', 'username', 'password', 'hostname', 'port'];\n    var basedir, i, p;\n\n    if (this._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    if (!(base instanceof URI)) {\n      base = new URI(base);\n    }\n\n    if (!resolved._parts.protocol) {\n      resolved._parts.protocol = base._parts.protocol;\n    }\n\n    if (this._parts.hostname) {\n      return resolved;\n    }\n\n    for (i = 0; (p = properties[i]); i++) {\n      resolved._parts[p] = base._parts[p];\n    }\n\n    if (!resolved._parts.path) {\n      resolved._parts.path = base._parts.path;\n      if (!resolved._parts.query) {\n        resolved._parts.query = base._parts.query;\n      }\n    } else if (resolved._parts.path.substring(-2) === '..') {\n      resolved._parts.path += '/';\n    }\n\n    if (resolved.path().charAt(0) !== '/') {\n      basedir = base.directory();\n      basedir = basedir ? basedir : base.path().indexOf('/') === 0 ? '/' : '';\n      resolved._parts.path = (basedir ? (basedir + '/') : '') + resolved._parts.path;\n      resolved.normalizePath();\n    }\n\n    resolved.build();\n    return resolved;\n  };\n  p.relativeTo = function(base) {\n    var relative = this.clone().normalize();\n    var relativeParts, baseParts, common, relativePath, basePath;\n\n    if (relative._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    base = new URI(base).normalize();\n    relativeParts = relative._parts;\n    baseParts = base._parts;\n    relativePath = relative.path();\n    basePath = base.path();\n\n    if (relativePath.charAt(0) !== '/') {\n      throw new Error('URI is already relative');\n    }\n\n    if (basePath.charAt(0) !== '/') {\n      throw new Error('Cannot calculate a URI relative to another relative URI');\n    }\n\n    if (relativeParts.protocol === baseParts.protocol) {\n      relativeParts.protocol = null;\n    }\n\n    if (relativeParts.username !== baseParts.username || relativeParts.password !== baseParts.password) {\n      return relative.build();\n    }\n\n    if (relativeParts.protocol !== null || relativeParts.username !== null || relativeParts.password !== null) {\n      return relative.build();\n    }\n\n    if (relativeParts.hostname === baseParts.hostname && relativeParts.port === baseParts.port) {\n      relativeParts.hostname = null;\n      relativeParts.port = null;\n    } else {\n      return relative.build();\n    }\n\n    if (relativePath === basePath) {\n      relativeParts.path = '';\n      return relative.build();\n    }\n\n    // determine common sub path\n    common = URI.commonPath(relativePath, basePath);\n\n    // If the paths have nothing in common, return a relative URL with the absolute path.\n    if (!common) {\n      return relative.build();\n    }\n\n    var parents = baseParts.path\n      .substring(common.length)\n      .replace(/[^\\/]*$/, '')\n      .replace(/.*?\\//g, '../');\n\n    relativeParts.path = (parents + relativeParts.path.substring(common.length)) || './';\n\n    return relative.build();\n  };\n\n  // comparing URIs\n  p.equals = function(uri) {\n    var one = this.clone();\n    var two = new URI(uri);\n    var one_map = {};\n    var two_map = {};\n    var checked = {};\n    var one_query, two_query, key;\n\n    one.normalize();\n    two.normalize();\n\n    // exact match\n    if (one.toString() === two.toString()) {\n      return true;\n    }\n\n    // extract query string\n    one_query = one.query();\n    two_query = two.query();\n    one.query('');\n    two.query('');\n\n    // definitely not equal if not even non-query parts match\n    if (one.toString() !== two.toString()) {\n      return false;\n    }\n\n    // query parameters have the same length, even if they're permuted\n    if (one_query.length !== two_query.length) {\n      return false;\n    }\n\n    one_map = URI.parseQuery(one_query, this._parts.escapeQuerySpace);\n    two_map = URI.parseQuery(two_query, this._parts.escapeQuerySpace);\n\n    for (key in one_map) {\n      if (hasOwn.call(one_map, key)) {\n        if (!isArray(one_map[key])) {\n          if (one_map[key] !== two_map[key]) {\n            return false;\n          }\n        } else if (!arraysEqual(one_map[key], two_map[key])) {\n          return false;\n        }\n\n        checked[key] = true;\n      }\n    }\n\n    for (key in two_map) {\n      if (hasOwn.call(two_map, key)) {\n        if (!checked[key]) {\n          // two contains a parameter not present in one\n          return false;\n        }\n      }\n    }\n\n    return true;\n  };\n\n  // state\n  p.duplicateQueryParameters = function(v) {\n    this._parts.duplicateQueryParameters = !!v;\n    return this;\n  };\n\n  p.escapeQuerySpace = function(v) {\n    this._parts.escapeQuerySpace = !!v;\n    return this;\n  };\n\n  return URI;\n}));\n","Steedos.uri = new URI(Meteor.absoluteUrl());\n\n_.extend Accounts,\n\tupdatePhone: (number,callback)->\n\t\tif Meteor.isServer\n\t\t\tMeteor.call 'updatePhone', { number }\n\t\tif Meteor.isClient\n\t\t\tMeteor.call 'updatePhone', { number }, callback,\n\tdisablePhoneWithoutExpiredDays: (expiredDays,callback)->\n\t\tif Meteor.isServer\n\t\t\tMeteor.call 'disablePhoneWithoutExpiredDays', expiredDays\n\t\tif Meteor.isClient\n\t\t\tMeteor.call 'disablePhoneWithoutExpiredDays', expiredDays, callback\n\tgetPhoneNumber: (isIncludePrefix, user) ->\n\t\tif Meteor.isClient\n\t\t\tphone = Accounts.user()?.phone\n\t\telse\n\t\t\tif typeof user == \"string\"\n\t\t\t\tphone = db.users.findOne(user)?.phone\n\t\t\telse\n\t\t\t\tphone = user?.phone\n\t\tunless phone\n\t\t\treturn \"\"\n\t\tif isIncludePrefix\n\t\t\treturn phone.number\n\t\telse\n\t\t\tunless phone.mobile\n\t\t\t\t# 如果数据库中不存在mobile值，则用算法计算出不带前缀的手机号\n\t\t\t\treturn E164.getPhoneNumberWithoutPrefix phone.number\n\t\t\treturn phone.mobile\n\tgetPhonePrefix: (user) ->\n\t\t# 返回当前用户手机号前缀，如果找不到则返回默认的\"+86\"\n\t\tif Meteor.isClient and !user\n\t\t\tphone = Accounts.user()?.phone\n\t\telse\n\t\t\tif typeof user == \"string\"\n\t\t\t\tphone = db.users.findOne(user)?.phone\n\t\t\telse\n\t\t\t\tphone = user?.phone\n\t\tunless phone\n\t\t\treturn \"+86\"\n\t\tif phone.mobile\n\t\t\tprefix = phone.number.replace phone.mobile, \"\"\n\t\telse\n\t\t\t# 如果数据库中不存在mobile值，则用算法计算出手机号前缀\n\t\t\tprefix = E164.getPhonePrefix(phone.number)\n\t\t\tif prefix\n\t\t\t\tprefix = \"+#{prefix}\"\n\t\treturn if prefix then prefix else \"+86\"\n\n# if Meteor.isClient\n# \tMeteor.startup ->\n# \t\tTracker.autorun (c)->\n# \t\t\tif !Meteor.userId() and !Meteor.loggingIn()\n# \t\t\t\tcurrentPath = FlowRouter.current().path\n# \t\t\t\tif currentPath != undefined and !/^\\/steedos\\b/.test(currentPath)\n# \t\t\t\t\t# 没有登录且路由不以/steedos开头则跳转到登录界面\n# \t\t\t\t\tSteedos.redirectToSignIn()\n","Steedos.uri = new URI(Meteor.absoluteUrl());\n\n_.extend(Accounts, {\n  updatePhone: function(number, callback) {\n    if (Meteor.isServer) {\n      Meteor.call('updatePhone', {\n        number: number\n      });\n    }\n    if (Meteor.isClient) {\n      return Meteor.call('updatePhone', {\n        number: number\n      }, callback);\n    }\n  },\n  disablePhoneWithoutExpiredDays: function(expiredDays, callback) {\n    if (Meteor.isServer) {\n      Meteor.call('disablePhoneWithoutExpiredDays', expiredDays);\n    }\n    if (Meteor.isClient) {\n      return Meteor.call('disablePhoneWithoutExpiredDays', expiredDays, callback);\n    }\n  },\n  getPhoneNumber: function(isIncludePrefix, user) {\n    var phone, ref, ref1;\n    if (Meteor.isClient) {\n      phone = (ref = Accounts.user()) != null ? ref.phone : void 0;\n    } else {\n      if (typeof user === \"string\") {\n        phone = (ref1 = db.users.findOne(user)) != null ? ref1.phone : void 0;\n      } else {\n        phone = user != null ? user.phone : void 0;\n      }\n    }\n    if (!phone) {\n      return \"\";\n    }\n    if (isIncludePrefix) {\n      return phone.number;\n    } else {\n      if (!phone.mobile) {\n        return E164.getPhoneNumberWithoutPrefix(phone.number);\n      }\n      return phone.mobile;\n    }\n  },\n  getPhonePrefix: function(user) {\n    var phone, prefix, ref, ref1;\n    if (Meteor.isClient && !user) {\n      phone = (ref = Accounts.user()) != null ? ref.phone : void 0;\n    } else {\n      if (typeof user === \"string\") {\n        phone = (ref1 = db.users.findOne(user)) != null ? ref1.phone : void 0;\n      } else {\n        phone = user != null ? user.phone : void 0;\n      }\n    }\n    if (!phone) {\n      return \"+86\";\n    }\n    if (phone.mobile) {\n      prefix = phone.number.replace(phone.mobile, \"\");\n    } else {\n      prefix = E164.getPhonePrefix(phone.number);\n      if (prefix) {\n        prefix = \"+\" + prefix;\n      }\n    }\n    if (prefix) {\n      return prefix;\n    } else {\n      return \"+86\";\n    }\n  }\n});\n","if Meteor.settings?.public?.phone?.forceAccountBindPhone\n\tif Meteor.isServer\n\t\tMeteor.methods\n\t\t\tcheckForceBindPhone: (spaces) ->\n\t\t\t\tcheck spaces, Array\n\t\t\t\tspace_settings = db.space_settings.find({key:\"contacts_no_force_phone_users\",space: {$in: spaces}})\n\t\t\t\tnoForceUsers = []\n\t\t\t\tspace_settings.forEach (n,i)->\n\t\t\t\t\tif n.values?.length\n\t\t\t\t\t\tnoForceUsers = _.union noForceUsers, n.values\n\t\t\t\tif noForceUsers and noForceUsers.length\n\t\t\t\t\treturn if noForceUsers.indexOf(Meteor.userId()) > -1 then false else true\n\t\t\t\treturn true\n\n\tif Meteor.isClient\n\t\tSteedos.isForceBindPhone = false\n\t\tcheckPhoneStateExpired = ->\n\t\t\t# 过期后把绑定状态还原为未绑定\n\t\t\texpiredDays = Meteor.settings?.public?.phone?.expiredDays\n\t\t\tif expiredDays\n\t\t\t\tAccounts.disablePhoneWithoutExpiredDays(expiredDays)\n\t\t\n\t\tunless Steedos.isMobile()\n\t\t\tAccounts.onLogin ()->\n\t\t\t\tif Accounts.isPhoneVerified()\n\t\t\t\t\tcheckPhoneStateExpired()\n\t\t\t\t\treturn\n\t\t\t\tMeteor.setTimeout ()->\n\t\t\t\t\tif Accounts.isPhoneVerified()\n\t\t\t\t\t\tcheckPhoneStateExpired()\n\t\t\t\t\t\treturn\n\t\t\t\t\tspaces = db.spaces.find().fetch().getProperty(\"_id\")\n\t\t\t\t\tunless spaces.length\n\t\t\t\t\t\treturn\n\t\t\t\t\tMeteor.call \"checkForceBindPhone\", spaces, (error, results)->\n\t\t\t\t\t\tif error\n\t\t\t\t\t\t\ttoastr.error(t(error.reason))\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tSteedos.isForceBindPhone = results\n\t\t\t\t\t\tif Steedos.isForceBindPhone and !Accounts.isPhoneVerified()\n\t\t\t\t\t\t\t# 未验证手机号时，强行跳转到手机号绑定界面\n\t\t\t\t\t\t\tsetupUrl = \"/accounts/setup/phone\"\n\t\t\t\t\t\t\tSteedos.isForceBindPhone = false\n\t\t\t\t\t\t\t# 暂时先停掉手机号强制绑定功能，等国际化相关功能完成后再放开\n\t\t\t\t\t\t\t# qhd要求放开，CN发版本前要把国际化相关功能完成，否则CN发版本前还是要注释掉该功能\n\t\t\t\t\t\t\tFlowRouter.go setupUrl\n\t\t\t\t\t\t\treturn\n\n\t\t\t\t\t\trouterPath = FlowRouter.current()?.path\n\t\t\t\t\t\t# 当前路由本身就在手机验证路由中则不需要提醒手机号未绑定\n\t\t\t\t\t\tif /^\\/accounts\\/setup\\/phone\\b/.test routerPath\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t# 登录相关路由不需要提醒手机号未绑定\n\t\t\t\t\t\tif /^\\/steedos\\//.test routerPath\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\tif Accounts.isPhoneVerified()\n\t\t\t\t\t\t\tcheckPhoneStateExpired()\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tsetupUrl = Steedos.absoluteUrl(\"accounts/setup/phone\")\n\t\t\t\t\t\t\tunless Steedos.isForceBindPhone\n\t\t\t\t\t\t\t\ttoastr.error(null,t(\"accounts_phone_toastr_alert\"),{\n\t\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\t\ttimeOut: 0,\n\t\t\t\t\t\t\t\t\textendedTimeOut: 0,\n\t\t\t\t\t\t\t\t\tonclick: ->\n\t\t\t\t\t\t\t\t\t\tSteedos.openWindow(setupUrl,'setup_phone')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t, 200","var checkPhoneStateExpired, ref, ref1, ref2;\n\nif ((ref = Meteor.settings) != null ? (ref1 = ref[\"public\"]) != null ? (ref2 = ref1.phone) != null ? ref2.forceAccountBindPhone : void 0 : void 0 : void 0) {\n  if (Meteor.isServer) {\n    Meteor.methods({\n      checkForceBindPhone: function(spaces) {\n        var noForceUsers, space_settings;\n        check(spaces, Array);\n        space_settings = db.space_settings.find({\n          key: \"contacts_no_force_phone_users\",\n          space: {\n            $in: spaces\n          }\n        });\n        noForceUsers = [];\n        space_settings.forEach(function(n, i) {\n          var ref3;\n          if ((ref3 = n.values) != null ? ref3.length : void 0) {\n            return noForceUsers = _.union(noForceUsers, n.values);\n          }\n        });\n        if (noForceUsers && noForceUsers.length) {\n          if (noForceUsers.indexOf(Meteor.userId()) > -1) {\n            return false;\n          } else {\n            return true;\n          }\n        }\n        return true;\n      }\n    });\n  }\n  if (Meteor.isClient) {\n    Steedos.isForceBindPhone = false;\n    checkPhoneStateExpired = function() {\n      var expiredDays, ref3, ref4, ref5;\n      expiredDays = (ref3 = Meteor.settings) != null ? (ref4 = ref3[\"public\"]) != null ? (ref5 = ref4.phone) != null ? ref5.expiredDays : void 0 : void 0 : void 0;\n      if (expiredDays) {\n        return Accounts.disablePhoneWithoutExpiredDays(expiredDays);\n      }\n    };\n    if (!Steedos.isMobile()) {\n      Accounts.onLogin(function() {\n        if (Accounts.isPhoneVerified()) {\n          checkPhoneStateExpired();\n          return;\n        }\n        return Meteor.setTimeout(function() {\n          var spaces;\n          if (Accounts.isPhoneVerified()) {\n            checkPhoneStateExpired();\n            return;\n          }\n          spaces = db.spaces.find().fetch().getProperty(\"_id\");\n          if (!spaces.length) {\n            return;\n          }\n          return Meteor.call(\"checkForceBindPhone\", spaces, function(error, results) {\n            var ref3, routerPath, setupUrl;\n            if (error) {\n              toastr.error(t(error.reason));\n            } else {\n              Steedos.isForceBindPhone = results;\n            }\n            if (Steedos.isForceBindPhone && !Accounts.isPhoneVerified()) {\n              setupUrl = \"/accounts/setup/phone\";\n              Steedos.isForceBindPhone = false;\n              FlowRouter.go(setupUrl);\n              return;\n            }\n            routerPath = (ref3 = FlowRouter.current()) != null ? ref3.path : void 0;\n            if (/^\\/accounts\\/setup\\/phone\\b/.test(routerPath)) {\n              return;\n            }\n            if (/^\\/steedos\\//.test(routerPath)) {\n              return;\n            }\n            if (Accounts.isPhoneVerified()) {\n              return checkPhoneStateExpired();\n            } else {\n              setupUrl = Steedos.absoluteUrl(\"accounts/setup/phone\");\n              if (!Steedos.isForceBindPhone) {\n                return toastr.error(null, t(\"accounts_phone_toastr_alert\"), {\n                  closeButton: true,\n                  timeOut: 0,\n                  extendedTimeOut: 0,\n                  onclick: function() {\n                    return Steedos.openWindow(setupUrl, 'setup_phone');\n                  }\n                });\n              }\n            }\n          });\n        }, 200);\n      });\n    }\n  }\n}\n","# Options\nsendVerificationEmail = true\nif !process.env.MAIL_URL || ! Package[\"email\"]\n  sendVerificationEmail = false\nAccountsTemplates.configure\n  defaultLayout: 'loginLayout',\n  defaultLayoutRegions: \n    nav: 'loginNav',\n  defaultContentRegion: 'main',\n\n  showForgotPasswordLink: true,\n  overrideLoginErrors: true,\n  enablePasswordChange: true,\n\n  sendVerificationEmail: sendVerificationEmail,\n  # enforceEmailVerification: true,\n  # confirmPassword: true,\n  # continuousValidation: false,\n  # displayFormLabels: true,\n  # forbidClientAccountCreation: true,\n  # formValidationFeedback: true,\n  homeRoutePath: '/',\n  # showAddRemoveServices: false,\n  # showPlaceholders: true,\n\n  negativeValidation: true,\n  positiveValidation: true,\n  negativeFeedback: false,\n  positiveFeedback: true,\n  showLabels: false,\n\n  # Privacy Policy and Terms of Use\n  # privacyUrl: 'privacy',\n  # termsUrl: 'terms-of-use',\n\n  preSignUpHook: (password, options) ->\n    options.profile.locale = Steedos.getLocale();\n\n\n\n\nAccountsTemplates.configureRoute 'changePwd',\n  path: '/steedos/change-password'\nAccountsTemplates.configureRoute 'forgotPwd',\n  path: '/steedos/forgot-password'\n  redirect: '/steedos/forgot-password-token'\nAccountsTemplates.configureRoute 'resetPwd',\n  path: '/steedos/reset-password'\nAccountsTemplates.configureRoute 'signIn',\n  path: '/steedos/sign-in'\n  redirect: ()->\n    # path = FlowRouter.current().path\n    # if /^\\/oauth2\\b/.test(path)\n    #   location.reload()\n    # else\n    #   FlowRouter.go(FlowRouter.current().queryParams?.redirect || \"/\");\n    if FlowRouter.current().queryParams?.redirect \n      document.location.href = FlowRouter.current().queryParams?.redirect \n    else\n      FlowRouter.go(\"/\")\n      \nAccountsTemplates.configureRoute 'signUp',\n  path: '/steedos/sign-up'\nAccountsTemplates.configureRoute 'verifyEmail',\n  path: '/steedos/verify-email'\n  redirect: ()->\n    # 当且仅当用户只有一个邮箱时,设置主要邮箱\n    emails = Meteor.user()?.emails\n    if emails and emails.length == 1\n      email = emails[0].address\n      $(document.body).addClass(\"loading\")\n      Meteor.call \"users_set_primary_email\", email, (error, result)->\n        $(document.body).removeClass('loading')\n        if result?.error\n          toastr.error t(result.message)\n    FlowRouter.go \"/\"\nAccountsTemplates.configureRoute 'enrollAccount',\n  path: '/steedos/enroll-account'\n\n# add fields within sign-up form\npwdField = AccountsTemplates.removeField('password');\nAccountsTemplates.removeField('email');\nAccountsTemplates.addFields([\n  {\n    _id: 'company',\n    type: 'text'\n  },\n  {\n    _id: 'name',\n    type: 'text'\n  },\n  {\n    _id: 'email',\n    type: 'email',\n    required: true\n    displayName: \"email\",\n    re: /.+@(.+){2,}\\.(.+){2,}/,\n    errStr: 'Invalid email',\n    placeholder: {\n      forgotPwd:\"email_input_placeholder\"\n    }\n  },\n  {\n    _id: 'username_and_email',\n    type: 'text',\n    required: true,\n    displayName: \"Login\"\n  },\n  {\n    _id: \"username\",\n    type: \"text\",\n    displayName: \"username\",\n    required: false,#企业注册界面没有该字段，所以改为非必填\n    minLength: 6\n  },\n  pwdField\n]);\n\n\nif Meteor.isServer and Accounts.emailTemplates\n  Accounts.emailTemplates.siteName = \"Steedos\";\n  Accounts.emailTemplates.from = Meteor.settings.email?.from;\n\n\nif Meteor.settings?.public?.accounts?.disableAccountRegistration\n  AccountsTemplates.options.forbidClientAccountCreation = true\n","var pwdField, ref, ref1, ref2, ref3, sendVerificationEmail;\n\nsendVerificationEmail = true;\n\nif (!process.env.MAIL_URL || !Package[\"email\"]) {\n  sendVerificationEmail = false;\n}\n\nAccountsTemplates.configure({\n  defaultLayout: 'loginLayout',\n  defaultLayoutRegions: {\n    nav: 'loginNav'\n  },\n  defaultContentRegion: 'main',\n  showForgotPasswordLink: true,\n  overrideLoginErrors: true,\n  enablePasswordChange: true,\n  sendVerificationEmail: sendVerificationEmail,\n  homeRoutePath: '/',\n  negativeValidation: true,\n  positiveValidation: true,\n  negativeFeedback: false,\n  positiveFeedback: true,\n  showLabels: false,\n  preSignUpHook: function(password, options) {\n    return options.profile.locale = Steedos.getLocale();\n  }\n});\n\nAccountsTemplates.configureRoute('changePwd', {\n  path: '/steedos/change-password'\n});\n\nAccountsTemplates.configureRoute('forgotPwd', {\n  path: '/steedos/forgot-password',\n  redirect: '/steedos/forgot-password-token'\n});\n\nAccountsTemplates.configureRoute('resetPwd', {\n  path: '/steedos/reset-password'\n});\n\nAccountsTemplates.configureRoute('signIn', {\n  path: '/steedos/sign-in',\n  redirect: function() {\n    var ref, ref1;\n    if ((ref = FlowRouter.current().queryParams) != null ? ref.redirect : void 0) {\n      return document.location.href = (ref1 = FlowRouter.current().queryParams) != null ? ref1.redirect : void 0;\n    } else {\n      return FlowRouter.go(\"/\");\n    }\n  }\n});\n\nAccountsTemplates.configureRoute('signUp', {\n  path: '/steedos/sign-up'\n});\n\nAccountsTemplates.configureRoute('verifyEmail', {\n  path: '/steedos/verify-email',\n  redirect: function() {\n    var email, emails, ref;\n    emails = (ref = Meteor.user()) != null ? ref.emails : void 0;\n    if (emails && emails.length === 1) {\n      email = emails[0].address;\n      $(document.body).addClass(\"loading\");\n      Meteor.call(\"users_set_primary_email\", email, function(error, result) {\n        $(document.body).removeClass('loading');\n        if (result != null ? result.error : void 0) {\n          return toastr.error(t(result.message));\n        }\n      });\n    }\n    return FlowRouter.go(\"/\");\n  }\n});\n\nAccountsTemplates.configureRoute('enrollAccount', {\n  path: '/steedos/enroll-account'\n});\n\npwdField = AccountsTemplates.removeField('password');\n\nAccountsTemplates.removeField('email');\n\nAccountsTemplates.addFields([\n  {\n    _id: 'company',\n    type: 'text'\n  }, {\n    _id: 'name',\n    type: 'text'\n  }, {\n    _id: 'email',\n    type: 'email',\n    required: true,\n    displayName: \"email\",\n    re: /.+@(.+){2,}\\.(.+){2,}/,\n    errStr: 'Invalid email',\n    placeholder: {\n      forgotPwd: \"email_input_placeholder\"\n    }\n  }, {\n    _id: 'username_and_email',\n    type: 'text',\n    required: true,\n    displayName: \"Login\"\n  }, {\n    _id: \"username\",\n    type: \"text\",\n    displayName: \"username\",\n    required: false,\n    minLength: 6\n  }, pwdField\n]);\n\nif (Meteor.isServer && Accounts.emailTemplates) {\n  Accounts.emailTemplates.siteName = \"Steedos\";\n  Accounts.emailTemplates.from = (ref = Meteor.settings.email) != null ? ref.from : void 0;\n}\n\nif ((ref1 = Meteor.settings) != null ? (ref2 = ref1[\"public\"]) != null ? (ref3 = ref2.accounts) != null ? ref3.disableAccountRegistration : void 0 : void 0 : void 0) {\n  AccountsTemplates.options.forbidClientAccountCreation = true;\n}\n","/// BCRYPT\nvar bcrypt = NpmModuleBcrypt;\nvar bcryptHash = Meteor.wrapAsync(bcrypt.hash);\nvar bcryptCompare = Meteor.wrapAsync(bcrypt.compare);\n\nvar passwordValidator = Match.OneOf(\n  String,\n  { digest: String, algorithm: String }\n);\n\nvar checkPassword = Accounts._checkPassword;\n\n// Given a 'password' from the client, extract the string that we should\n// bcrypt. 'password' can be one of:\n//  - String (the plaintext password)\n//  - Object with 'digest' and 'algorithm' keys. 'algorithm' must be \"sha-256\".\n//\nvar getPasswordString = function (password) {\n  if (typeof password === \"string\") {\n    password = SHA256(password);\n  } else { // 'password' is an object\n    if (password.algorithm !== \"sha-256\") {\n      throw new Error(\"Invalid password hash algorithm. \" +\n                      \"Only 'sha-256' is allowed.\");\n    }\n    password = password.digest;\n  }\n  return password;\n};\n\n// Use bcrypt to hash the password for storage in the database.\n// `password` can be a string (in which case it will be run through\n// SHA256 before bcrypt) or an object with properties `digest` and\n// `algorithm` (in which case we bcrypt `password.digest`).\n//\nvar hashPassword = function (password) {\n  password = getPasswordString(password);\n  return bcryptHash(password, Accounts._bcryptRounds);\n};\n\n///\n/// ERROR HANDLER\n///\nvar handleError = function(msg, throwError) {\n  if(throwError === undefined){\n    throwError = true;\n  }\n  var error = new Meteor.Error(\n    403,\n    Accounts._options.ambiguousErrorMessages\n      ? \"Something went wrong. Please check your credentials.\"\n      : msg\n  );\n  if (throwError) {\n    throw error;\n  }\n  return error;\n};\n\n// Generates permutations of all case variations of a given string.\nvar generateCasePermutationsForString = function (string) {\n  var permutations = [''];\n  for (var i = 0; i < string.length; i++) {\n    var ch = string.charAt(i);\n    permutations = _.flatten(_.map(permutations, function (prefix) {\n      var lowerCaseChar = ch.toLowerCase();\n      var upperCaseChar = ch.toUpperCase();\n      // Don't add unneccesary permutations when ch is not a letter\n      if (lowerCaseChar === upperCaseChar) {\n        return [prefix + ch];\n      } else {\n        return [prefix + lowerCaseChar, prefix + upperCaseChar];\n      }\n    }));\n  }\n  return permutations;\n};\n\n// Generates a MongoDB selector that can be used to perform a fast case\n// insensitive lookup for the given fieldName and string. Since MongoDB does\n// not support case insensitive indexes, and case insensitive regex queries\n// are slow, we construct a set of prefix selectors for all permutations of\n// the first 4 characters ourselves. We first attempt to matching against\n// these, and because 'prefix expression' regex queries do use indexes (see\n// http://docs.mongodb.org/v2.6/reference/operator/query/regex/#index-use),\n// this has been found to greatly improve performance (from 1200ms to 5ms in a\n// test with 1.000.000 users).\nvar selectorForFastCaseInsensitiveLookup = function (fieldName, string) {\n  // Performance seems to improve up to 4 prefix characters\n  var prefix = string.substring(0, Math.min(string.length, 4));\n  var orClause = _.map(generateCasePermutationsForString(prefix),\n    function (prefixPermutation) {\n      var selector = {};\n      selector[fieldName] =\n        new RegExp('^' + Meteor._escapeRegExp(prefixPermutation));\n      return selector;\n    });\n  var caseInsensitiveClause = {};\n  caseInsensitiveClause[fieldName] =\n    new RegExp('^' + Meteor._escapeRegExp(string) + '$', 'i')\n  return {$and: [{$or: orClause}, caseInsensitiveClause]};\n}\n\nAccounts._findUserByQueryForSteedos = function (query) {\n  var user = null;\n\n  if (query.id) {\n    user = Meteor.users.findOne({ _id: query.id });\n  } else {\n    var fieldName;\n    var fieldValue;\n    if (query.username) {\n      fieldName = 'username';\n      fieldValue = query.username;\n    } else if (query.email) {\n      fieldName = 'emails.address';\n      fieldValue = query.email;\n    } else if (query.phone) {\n      fieldName = 'phone.number';\n      // fieldValue如果自带区号，则不做处理，反之默认加上中国区号+86\n      if(/^\\+\\d+/g.test(query.phone)){\n        fieldValue = query.phone;\n      }\n      else{\n        fieldValue = \"+86\" + query.phone;\n      }\n      fieldName = \"$or\"\n      fieldValue = [{'phone.number':fieldValue},{username:query.phone}]\n    } else {\n      throw new Error(\"shouldn't happen (validation missed something)\");\n    }\n    var selector = {};\n    selector[fieldName] = fieldValue;\n    user = Meteor.users.findOne(selector);\n    // If user is not found, try a case insensitive lookup\n    if (!user && fieldName != \"$or\") {\n      selector = selectorForFastCaseInsensitiveLookup(fieldName, fieldValue);\n      var candidateUsers = Meteor.users.find(selector).fetch();\n      // No match if multiple candidates are found\n      if (candidateUsers.length === 1) {\n        user = candidateUsers[0];\n      }\n    }\n  }\n\n  return user;\n};\n\nvar NonEmptyString = Match.Where(function (x) {\n  check(x, String);\n  return x.length > 0;\n});\n\nvar userQueryValidator = Match.Where(function (user) {\n  check(user, {\n    id: Match.Optional(NonEmptyString),\n    username: Match.Optional(NonEmptyString),\n    email: Match.Optional(NonEmptyString),\n    phone: Match.Optional(NonEmptyString)\n  });\n  if (_.keys(user).length !== 1)\n    throw new Match.Error(\"User property must have exactly one field\");\n  return true;\n});\n\nAccounts.registerLoginHandler(\"password2\", function (options) {\n  if (! options.password2 || options.srp)\n    return undefined; // don't handle\n\n  check(options, {\n    user: userQueryValidator,\n    password2: passwordValidator\n  });\n\n\n  var user = Accounts._findUserByQueryForSteedos(options.user);\n  if (!user) {\n    handleError(\"User not found\");\n  }\n\n  if (!user.services || !user.services.password ||\n      !(user.services.password.bcrypt || user.services.password.srp)) {\n    handleError(\"User has no password set\");\n  }\n\n  if (!user.services.password.bcrypt) {\n    if (typeof options.password2 === \"string\") {\n      // The client has presented a plaintext password, and the user is\n      // not upgraded to bcrypt yet. We don't attempt to tell the client\n      // to upgrade to bcrypt, because it might be a standalone DDP\n      // client doesn't know how to do such a thing.\n      var verifier = user.services.password.srp;\n      var newVerifier = SRP.generateVerifier(options.password2, {\n        identity: verifier.identity, salt: verifier.salt});\n\n      if (verifier.verifier !== newVerifier.verifier) {\n        return {\n          userId: Accounts._options.ambiguousErrorMessages ? null : user._id,\n          error: handleError(\"Incorrect password\", false)\n        };\n      }\n\n      return {userId: user._id};\n    } else {\n      // Tell the client to use the SRP upgrade process.\n      throw new Meteor.Error(400, \"old password format\", EJSON.stringify({\n        format: 'srp',\n        identity: user.services.password.srp.identity\n      }));\n    }\n  }\n\n  return checkPassword(\n    user,\n    options.password2\n  );\n});\n\n// Handler to login using the SRP upgrade path. To use this login\n// handler, the client must provide:\n//   - srp: H(identity + \":\" + password)\n//   - password: a string or an object with properties 'digest' and 'algorithm'\n//\n// We use `options.srp` to verify that the client knows the correct\n// password without doing a full SRP flow. Once we've checked that, we\n// upgrade the user to bcrypt and remove the SRP information from the\n// user document.\n//\n// The client ends up using this login handler after trying the normal\n// login handler (above), which throws an error telling the client to\n// try the SRP upgrade path.\n//\n// XXX COMPAT WITH 0.8.1.3\nAccounts.registerLoginHandler(\"password2\", function (options) {\n  if (!options.srp || !options.password2) {\n    return undefined; // don't handle\n  }\n\n  check(options, {\n    user: userQueryValidator,\n    srp: String,\n    password2: passwordValidator\n  });\n\n  var user = Accounts._findUserByQueryForSteedos(options.user);\n  if (!user) {\n    handleError(\"User not found\");\n  }\n\n  // Check to see if another simultaneous login has already upgraded\n  // the user record to bcrypt.\n  if (user.services && user.services.password && user.services.password.bcrypt) {\n    return checkPassword(user, options.password2);\n  }\n\n  if (!(user.services && user.services.password && user.services.password.srp)) {\n    handleError(\"User has no password set\");\n  }\n\n  var v1 = user.services.password.srp.verifier;\n  var v2 = SRP.generateVerifier(\n    null,\n    {\n      hashedIdentityAndPassword: options.srp,\n      salt: user.services.password.srp.salt\n    }\n  ).verifier;\n  if (v1 !== v2) {\n    return {\n      userId: Accounts._options.ambiguousErrorMessages ? null : user._id,\n      error: handleError(\"Incorrect password\", false)\n    };\n  }\n\n  // Upgrade to bcrypt on successful login.\n  var salted = hashPassword(options.password2);\n  Meteor.users.update(\n    user._id,\n    {\n      $unset: { 'services.password.srp': 1 },\n      $set: { 'services.password.bcrypt': salted }\n    }\n  );\n\n  return {userId: user._id};\n});","Phone = require('phone')\n\nMeteor.methods updatePhone: (options) ->\n\tcheck options, Object\n\t{ number } = options\n\tcheck number, String\n\n\tnumber = Phone(number)[0]\n\tunless number\n\t\tthrow new Meteor.Error(403, \"accounts_phone_invalid\")\n\t\treturn false\n\n\tcurrentUserId = @userId\n\tunless currentUserId\n\t\treturn true\n\n\tcurrentUser = Accounts.user()\n\tcurrentNumber = currentUser.phone?.number\n\t# 手机号不变，则不用更新\n\tif currentNumber and currentNumber == number\n\t\treturn true\n\n\trepeatNumberUser = db.users.findOne({'phone.number':number},{fields:{_id:1,phone:1}})\n\tif repeatNumberUser\n\t\tif repeatNumberUser.phone?.verified\n\t\t\tthrow new Meteor.Error(403, \"accounts_phone_already_existed\")\n\t\t\treturn false\n\t\telse\n\t\t\t# 如果另一个用户手机号没有验证通过，则清除其账户下手机号相关字段\n\t\t\tdb.users.update {\n\t\t\t\t_id: repeatNumberUser._id\n\t\t\t}, $unset: \"phone\": 1,\"services.phone\": 1\n\n\tdb.users.update {\n\t\t_id: currentUserId\n\t}, $set: phone: {number: number, verified: false}\n\n\treturn true\n\n\n","var Phone;\n\nPhone = require('phone');\n\nMeteor.methods({\n  updatePhone: function(options) {\n    var currentNumber, currentUser, currentUserId, number, ref, ref1, repeatNumberUser;\n    check(options, Object);\n    number = options.number;\n    check(number, String);\n    number = Phone(number)[0];\n    if (!number) {\n      throw new Meteor.Error(403, \"accounts_phone_invalid\");\n      return false;\n    }\n    currentUserId = this.userId;\n    if (!currentUserId) {\n      return true;\n    }\n    currentUser = Accounts.user();\n    currentNumber = (ref = currentUser.phone) != null ? ref.number : void 0;\n    if (currentNumber && currentNumber === number) {\n      return true;\n    }\n    repeatNumberUser = db.users.findOne({\n      'phone.number': number\n    }, {\n      fields: {\n        _id: 1,\n        phone: 1\n      }\n    });\n    if (repeatNumberUser) {\n      if ((ref1 = repeatNumberUser.phone) != null ? ref1.verified : void 0) {\n        throw new Meteor.Error(403, \"accounts_phone_already_existed\");\n        return false;\n      } else {\n        db.users.update({\n          _id: repeatNumberUser._id\n        }, {\n          $unset: {\n            \"phone\": 1,\n            \"services.phone\": 1\n          }\n        });\n      }\n    }\n    db.users.update({\n      _id: currentUserId\n    }, {\n      $set: {\n        phone: {\n          number: number,\n          verified: false\n        }\n      }\n    });\n    return true;\n  }\n});\n","Meteor.methods disablePhoneWithoutExpiredDays: (expiredDays) ->\n\tcheck expiredDays, Number\n\n\tcurrentUserId = @userId\n\tunless currentUserId\n\t\treturn true\n\n\tcurrentUser = Accounts.user()\n\tverified = currentUser.phone?.verified\n\tmodified = currentUser.phone?.modified\n\tunless verified or modified\n\t\treturn true\n\n\tnow = new Date()\n\toutDays = Math.floor((now.getTime()-modified.getTime())/(24 * 60 * 60 * 1000))\n\tif outDays >= expiredDays\n\t\tdb.users.update {\n\t\t\t_id: currentUserId\n\t\t}, $set: \"phone.verified\": false\n\n\treturn true\n","Meteor.methods({\n  disablePhoneWithoutExpiredDays: function(expiredDays) {\n    var currentUser, currentUserId, modified, now, outDays, ref, ref1, verified;\n    check(expiredDays, Number);\n    currentUserId = this.userId;\n    if (!currentUserId) {\n      return true;\n    }\n    currentUser = Accounts.user();\n    verified = (ref = currentUser.phone) != null ? ref.verified : void 0;\n    modified = (ref1 = currentUser.phone) != null ? ref1.modified : void 0;\n    if (!(verified || modified)) {\n      return true;\n    }\n    now = new Date();\n    outDays = Math.floor((now.getTime() - modified.getTime()) / (24 * 60 * 60 * 1000));\n    if (outDays >= expiredDays) {\n      db.users.update({\n        _id: currentUserId\n      }, {\n        $set: {\n          \"phone.verified\": false\n        }\n      });\n    }\n    return true;\n  }\n});\n","Phone = require('phone')\n\nMeteor.methods joinSpaceFromLogin: (options) ->\n\tcheck options, Object\n\t{ space_logined } = options\n\tcheck space_logined, String\n\n\tcurrentUserId = @userId\n\tunless currentUserId\n\t\treturn true\n\n\tspace = db.spaces.findOne(space_logined)\n\tunless space\n\t\tthrow new Meteor.Error(400, \"space_users_error_space_not_found\")\n\t\treturn false\n\n\tcurrentUser = Accounts.user()\n\tspace_user = db.space_users.findOne({space: space_logined, user: currentUser._id})\n\tif space_user\n\t\treturn true\n\n\tuser_email = currentUser.emails[0].address\n\trootOrg = db.organizations.findOne({space:space_logined, parent: null},{fields: {_id:1}})\n\tdb.space_users.insert\n\t\temail: user_email\n\t\tuser: currentUser._id\n\t\tname: currentUser.name\n\t\torganizations: [rootOrg._id]\n\t\tspace: space_logined\n\t\tuser_accepted: true\n\t\tis_logined_from_space: true\n\n\treturn true\n\n\n","var Phone;\n\nPhone = require('phone');\n\nMeteor.methods({\n  joinSpaceFromLogin: function(options) {\n    var currentUser, currentUserId, rootOrg, space, space_logined, space_user, user_email;\n    check(options, Object);\n    space_logined = options.space_logined;\n    check(space_logined, String);\n    currentUserId = this.userId;\n    if (!currentUserId) {\n      return true;\n    }\n    space = db.spaces.findOne(space_logined);\n    if (!space) {\n      throw new Meteor.Error(400, \"space_users_error_space_not_found\");\n      return false;\n    }\n    currentUser = Accounts.user();\n    space_user = db.space_users.findOne({\n      space: space_logined,\n      user: currentUser._id\n    });\n    if (space_user) {\n      return true;\n    }\n    user_email = currentUser.emails[0].address;\n    rootOrg = db.organizations.findOne({\n      space: space_logined,\n      parent: null\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    db.space_users.insert({\n      email: user_email,\n      user: currentUser._id,\n      name: currentUser.name,\n      organizations: [rootOrg._id],\n      space: space_logined,\n      user_accepted: true,\n      is_logined_from_space: true\n    });\n    return true;\n  }\n});\n","Meteor.methods checkUser: (options) ->\n\tcheck options, Object\n\t{ company,name,email,password,profile } = options\n\tcheck company, String\n\tcheck name, String\n\tcheck email, String\n\tcheck password, Object\n\tcheck profile, Object\n\n\tunless company\n\t\tthrow new Meteor.Error(403, \"accounts_register_company_empty\")\n\t\treturn false\n\tunless name\n\t\tthrow new Meteor.Error(403, \"accounts_register_name_empty\")\n\t\treturn false\n\tunless email\n\t\tthrow new Meteor.Error(403, \"accounts_register_email_empty\")\n\t\treturn false\n\tunless password\n\t\tthrow new Meteor.Error(403, \"accounts_register_password_empty\")\n\t\treturn false\n\n\temail = email.toLowerCase().replace(/\\s+/gm, '')\n\tuser = db.users.findOne({'emails.address': email})\n\tif user\n\t\tthrow new Meteor.Error(403, \"accounts_register_email_exist\")\n\t\treturn false\n\n\treturn true\n","Meteor.methods({\n  checkUser: function(options) {\n    var company, email, name, password, profile, user;\n    check(options, Object);\n    company = options.company, name = options.name, email = options.email, password = options.password, profile = options.profile;\n    check(company, String);\n    check(name, String);\n    check(email, String);\n    check(password, Object);\n    check(profile, Object);\n    if (!company) {\n      throw new Meteor.Error(403, \"accounts_register_company_empty\");\n      return false;\n    }\n    if (!name) {\n      throw new Meteor.Error(403, \"accounts_register_name_empty\");\n      return false;\n    }\n    if (!email) {\n      throw new Meteor.Error(403, \"accounts_register_email_empty\");\n      return false;\n    }\n    if (!password) {\n      throw new Meteor.Error(403, \"accounts_register_password_empty\");\n      return false;\n    }\n    email = email.toLowerCase().replace(/\\s+/gm, '');\n    user = db.users.findOne({\n      'emails.address': email\n    });\n    if (user) {\n      throw new Meteor.Error(403, \"accounts_register_email_exist\");\n      return false;\n    }\n    return true;\n  }\n});\n"]}