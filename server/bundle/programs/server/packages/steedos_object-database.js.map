{"version":3,"sources":["meteor://💻app/packages/steedos_object-database/models/object.coffee","meteor://💻app/models/object.coffee","meteor://💻app/packages/steedos_object-database/models/object_fields.coffee","meteor://💻app/models/object_fields.coffee","meteor://💻app/packages/steedos_object-database/models/object_triggers.coffee","meteor://💻app/models/object_triggers.coffee","meteor://💻app/packages/steedos_object-database/models/object_actions.coffee","meteor://💻app/models/object_actions.coffee"],"names":["isRepeatedName","doc","other","Creator","getCollection","find","_id","$ne","space","name","fields","count","Objects","objects","icon","label","type","searchable","index","required","regEx","SimpleSchema","RegEx","code","optionsFunction","options","_","forEach","resources","sldsIcons","standard","svg","push","value","is_enable","defaultValue","enable_search","enable_files","enable_tasks","enable_notes","enable_events","enable_api","hidden","enable_share","enable_instances","enable_chatter","enable_audit","enable_trash","enable_space_global","is_view","omit","description","is_wide","sidebar","blackbox","list_views","actions","permission_set","triggers","custom","owner","app_unique_id","app_version","all","columns","filter_scope","user","allowCreate","allowDelete","allowEdit","allowRead","modifyAllRecords","viewAllRecords","admin","copy_odata","visible","on","todo","object_name","record_id","item_element","clipboard","o_name","path","record","getObjectById","SteedosOData","getODataPath","Session","get","attr","Clipboard","e","toastr","success","error","console","tagName","hasClass","trigger","when","userId","log","Meteor","Error","fieldNames","modifier","ref","$set","$unset","insert","object","shared","documents","object_collections","direct","remove","Collections","_collection","dropCollection","stack","_syncToObject","object_fields","table_fields","created","modified","created_by","modified_by","fetch","f","cf_arr","child_fields","test","split","size","extend","each","k","update","field","is_name","reference_to","_options","objectsByName","o","text","textarea","html","select","boolean","date","datetime","number","currency","password","lookup","master_detail","grid","url","email","sort_no","scale","sortable","group","allowedValues","multiple","readonly","precision","rows","sort","field_name","order","_reference_to","object_documents","ref1","ref2","ref3","ref4","ref5","ref6","ref7","length","findOne","check","object_triggers","Steedos","isSpaceAdmin","isLegalVersion","object_actions"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAAA,cAAA;;AAAAA,iBAAiB,UAACC,GAAD;AAChB,MAAAC,KAAA;AAAAA,UAAQC,QAAQC,aAAR,CAAsB,SAAtB,EAAiCC,IAAjC,CAAsC;AAACC,SAAK;AAACC,WAAKN,IAAIK;AAAV,KAAN;AAAsBE,WAAOP,IAAIO,KAAjC;AAAwCC,UAAMR,IAAIQ;AAAlD,GAAtC,EAA+F;AAACC,YAAO;AAACJ,WAAK;AAAN;AAAR,GAA/F,CAAR;;AACA,MAAGJ,MAAMS,KAAN,KAAgB,CAAnB;AACC,WAAO,IAAP;ACaC;;ADZF,SAAO,KAAP;AAJgB,CAAjB;;AAMAR,QAAQS,OAAR,CAAgBC,OAAhB,GACC;AAAAJ,QAAM,SAAN;AACAK,QAAM,QADN;AAEAC,SAAO,IAFP;AAGAL,UACC;AAAAD,UACC;AAAAO,YAAM,MAAN;AACAC,kBAAW,IADX;AAEAC,aAAM,IAFN;AAGAC,gBAAU,IAHV;AAIAC,aAAOC,aAAaC,KAAb,CAAmBC;AAJ1B,KADD;AAMAR,WACC;AAAAC,YAAM,MAAN;AACAG,gBAAU;AADV,KAPD;AASAL,UACC;AAAAE,YAAM,QAAN;AACAQ,uBAAiB;AAChB,YAAAC,OAAA;AAAAA,kBAAU,EAAV;;AACAC,UAAEC,OAAF,CAAUxB,QAAQyB,SAAR,CAAkBC,SAAlB,CAA4BC,QAAtC,EAAgD,UAACC,GAAD;ACkB1C,iBDjBLN,QAAQO,IAAR,CAAa;AAACC,mBAAOF,GAAR;AAAahB,mBAAOgB,GAApB;AAAyBjB,kBAAMiB;AAA/B,WAAb,CCiBK;ADlBN;;AAEA,eAAON,OAAP;AALD;AAAA,KAVD;AAgBAS,eACC;AAAAlB,YAAM,SAAN;AACAmB,oBAAc;AADd,KAjBD;AAmBAC,mBACC;AAAApB,YAAM;AAAN,KApBD;AAqBAqB,kBACC;AAAArB,YAAM;AAAN,KAtBD;AAuBAsB,kBACC;AAAAtB,YAAM;AAAN,KAxBD;AAyBAuB,kBACC;AAAAvB,YAAM;AAAN,KA1BD;AA2BAwB,mBACC;AAAAxB,YAAM;AAAN,KA5BD;AA6BAyB,gBACC;AAAAzB,YAAM,SAAN;AACAmB,oBAAc,IADd;AAEAO,cAAQ;AAFR,KA9BD;AAiCAC,kBACC;AAAA3B,YAAM,SAAN;AACAmB,oBAAc;AADd,KAlCD;AAoCAS,sBACC;AAAA5B,YAAM;AAAN,KArCD;AAsCA6B,oBACC;AAAA7B,YAAM;AAAN,KAvCD;AAwCA8B,kBACC;AAAA9B,YAAM;AAAN,KAzCD;AA0CA+B,kBACC;AAAA/B,YAAM;AAAN,KA3CD;AA4CAgC,yBACC;AAAAhC,YAAM,SAAN;AACAmB,oBAAc;AADd,KA7CD;AA+CAc,aACC;AAAAjC,YAAM,SAAN;AACAmB,oBAAc,KADd;AAEAe,YAAM;AAFN,KAhDD;AAmDAR,YACC;AAAA3B,aAAO,IAAP;AACAC,YAAM,SADN;AAEAkC,YAAM;AAFN,KApDD;AAuDAC,iBACC;AAAApC,aAAO,aAAP;AACAC,YAAM,UADN;AAEAoC,eAAS;AAFT,KAxDD;AA2DAC,aACC;AAAArC,YAAM,QAAN;AACAD,aAAO,MADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KA5DD;AAiEAhC,YACC;AAAAM,YAAM,QAAN;AACAD,aAAO,IADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KAlED;AAuEAa,gBACC;AAAAvC,YAAM,QAAN;AACAD,aAAO,MADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KAxED;AA6EAc,aACC;AAAAxC,YAAM,QAAN;AACAD,aAAO,IADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KA9ED;AAmFAe,oBACC;AAAAzC,YAAM,QAAN;AACAD,aAAO,MADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KApFD;AAyFAgB,cACC;AAAA1C,YAAM,QAAN;AACAD,aAAO,KADP;AAEAuC,gBAAU,IAFV;AAGAJ,YAAM,IAHN;AAIAR,cAAQ;AAJR,KA1FD;AA+FAiB,YACC;AAAA5C,aAAO,IAAP;AACAC,YAAM,SADN;AAEAkC,YAAM;AAFN,KAhGD;AAmGAU,WACC;AAAA5C,YAAM,QAAN;AACA0B,cAAQ;AADR,KApGD;AAsGAmB,mBACC;AAAA7C,YAAM,MAAN;AACA0B,cAAQ;AADR,KAvGD;AAyGAoB,iBACC;AAAA9C,YAAM,MAAN;AACA0B,cAAQ;AADR;AA1GD,GAJD;AAiHAa,cACC;AAAAQ,SACC;AAAAC,eAAS,CAAC,MAAD,EAAS,OAAT,EAAkB,WAAlB,EAA+B,UAA/B,CAAT;AACAjD,aAAM,IADN;AAEAkD,oBAAc;AAFd;AADD,GAlHD;AAuHAR,kBACC;AAAAS,UACC;AAAAC,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,KAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB,KADD;AAOAC,WACC;AAAAN,mBAAa,IAAb;AACAC,mBAAa,IADb;AAEAC,iBAAW,IAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,IAJlB;AAKAC,sBAAgB;AALhB;AARD,GAxHD;AAuIAhB,WACC;AAAAkB,gBACC;AAAA3D,aAAO,WAAP;AACA4D,eAAS,IADT;AAEAC,UAAI,QAFJ;AAGAC,YAAM,UAACC,WAAD,EAAcC,SAAd,EAAyBC,YAAzB;AACL,YAAAC,SAAA,EAAAC,MAAA,EAAAC,IAAA,EAAAC,MAAA;AAAAA,iBAASjF,QAAQkF,aAAR,CAAsBN,SAAtB,CAAT;;AAEA,aAAAK,UAAA,OAAGA,OAAQ3C,UAAX,GAAW,MAAX,KAAyB,IAAzB;AACCyC,mBAAAE,UAAA,OAASA,OAAQ3E,IAAjB,GAAiB,MAAjB;AACA0E,iBAAOG,aAAaC,YAAb,CAA0BC,QAAQC,GAAR,CAAY,SAAZ,CAA1B,EAAkDP,MAAlD,CAAP;AACAF,uBAAaU,IAAb,CAAkB,qBAAlB,EAAyCP,IAAzC;;AACA,cAAG,CAACH,aAAaU,IAAb,CAAkB,oBAAlB,CAAJ;AACCT,wBAAY,IAAIU,SAAJ,CAAcX,aAAa,CAAb,CAAd,CAAZ;AACAA,yBAAaU,IAAb,CAAkB,oBAAlB,EAAwC,IAAxC;AAEAT,sBAAUL,EAAV,CAAa,SAAb,EAAyB,UAACgB,CAAD;ACqDjB,qBDpDPC,OAAOC,OAAP,CAAe,MAAf,CCoDO;ADrDR;AAGAb,sBAAUL,EAAV,CAAa,OAAb,EAAuB,UAACgB,CAAD;AACtBC,qBAAOE,KAAP,CAAa,MAAb;ACqDO,qBDpDPC,QAAQD,KAAR,CAAc,GAAd,CCoDO;ADtDR;;AAKA,gBAAGf,aAAa,CAAb,EAAgBiB,OAAhB,KAA2B,IAA3B,IAAmCjB,aAAakB,QAAb,CAAsB,aAAtB,CAAtC;ACoDQ,qBDnDPlB,aAAamB,OAAb,CAAqB,OAArB,CCmDO;ADhET;AAJD;AAAA;ACwEM,iBDrDLN,OAAOE,KAAP,CAAa,cAAb,CCqDK;AACD;AD/EN;AAAA;AADD,GAxID;AAqKArC,YACC;AAAA,oCACC;AAAAkB,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AACL,YAAGD,eAAeC,GAAf,CAAH;AACC+F,kBAAQM,GAAR,CAAY,mBAAiBrG,IAAIQ,IAAjC;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,UAAtB,CAAN;ACwDI;;AACD,eDxDJvG,IAAI0D,MAAJ,GAAa,ICwDT;AD9DL;AAAA,KADD;AASA,oCACC;AAAAiB,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT,EAAcwG,UAAd,EAA0BC,QAA1B,EAAoCjF,OAApC;AACL,YAAAkF,GAAA;;AAAA,aAAAD,YAAA,QAAAC,MAAAD,SAAAE,IAAA,YAAAD,IAAmBlG,IAAnB,GAAmB,MAAnB,GAAmB,MAAnB,KAA2BR,IAAIQ,IAAJ,KAAYiG,SAASE,IAAT,CAAcnG,IAArD;AACCuF,kBAAQM,GAAR,CAAY,UAAZ;AACA,gBAAM,IAAIC,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,SAAtB,CAAN;AC2DI;;AD1DL,YAAGE,SAASE,IAAZ;AACCF,mBAASE,IAAT,CAAcjD,MAAd,GAAuB,IAAvB;AC4DI;;AD1DL,YAAG+C,SAASG,MAAT,IAAmBH,SAASG,MAAT,CAAgBlD,MAAtC;AC4DM,iBD3DL,OAAO+C,SAASG,MAAT,CAAgBlD,MC2DlB;AACD;ADtEN;AAAA,KAVD;AAuBA,mCACC;AAAAiB,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AAELE,gBAAQC,aAAR,CAAsB,eAAtB,EAAuC0G,MAAvC,CAA8C;AAACC,kBAAQ9G,IAAIQ,IAAb;AAAmBmD,iBAAOyC,MAA1B;AAAkC5F,gBAAM,MAAxC;AAAgDD,iBAAOP,IAAIO,KAA3D;AAAkEQ,gBAAM,MAAxE;AAAgFG,oBAAU,IAA1F;AAAgGD,iBAAO,IAAvG;AAA6GD,sBAAY;AAAzH,SAA9C;AACAd,gBAAQC,aAAR,CAAsB,kBAAtB,EAA0C0G,MAA1C,CAAiD;AAACrG,gBAAM,KAAP;AAAcD,iBAAOP,IAAIO,KAAzB;AAAgCoD,iBAAOyC,MAAvC;AAA+CvB,uBAAa7E,IAAIQ,IAAhE;AAAsEuG,kBAAQ,IAA9E;AAAoF/C,wBAAc,OAAlG;AAA2GD,mBAAS,CAAC,MAAD;AAApH,SAAjD;AC6EI,eD5EJ7D,QAAQC,aAAR,CAAsB,kBAAtB,EAA0C0G,MAA1C,CAAiD;AAACrG,gBAAM,QAAP;AAAiBD,iBAAOP,IAAIO,KAA5B;AAAmCoD,iBAAOyC,MAA1C;AAAkDvB,uBAAa7E,IAAIQ,IAAnE;AAAyEuG,kBAAQ,IAAjF;AAAuF/C,wBAAc,OAArG;AAA8GD,mBAAS,CAAC,MAAD;AAAvH,SAAjD,CC4EI;ADlFL;AAAA,KAxBD;AAgCA,oCACC;AAAAY,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AAEL,YAAAgH,SAAA,EAAAC,kBAAA;;AAAA,YAAGjH,IAAI4D,aAAJ,IAAqB5D,IAAI6D,WAA5B;AACC;ACsFI;;ADpFLoD,6BAAqB/G,QAAQC,aAAR,CAAsBH,IAAIQ,IAA1B,EAAgCR,IAAIO,KAApC,CAArB;AAEAyG,oBAAYC,mBAAmB7G,IAAnB,CAAwB,EAAxB,EAA2B;AAACK,kBAAQ;AAACJ,iBAAK;AAAN;AAAT,SAA3B,CAAZ;;AAEA,YAAG2G,UAAUtG,KAAV,KAAoB,CAAvB;AACC,gBAAM,IAAI4F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,QAAMvG,IAAIQ,IAAV,GAAe,yBAArC,CAAN;ACwFI;ADpGN;AAAA,KAjCD;AA+CA,mCACC;AAAAmE,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AAEL,YAAA2F,CAAA;AAAAzF,gBAAQC,aAAR,CAAsB,eAAtB,EAAuC+G,MAAvC,CAA8CC,MAA9C,CAAqD;AAACL,kBAAQ9G,IAAIQ,IAAb;AAAmBD,iBAAOP,IAAIO;AAA9B,SAArD;AAEAL,gBAAQC,aAAR,CAAsB,gBAAtB,EAAwC+G,MAAxC,CAA+CC,MAA/C,CAAsD;AAACL,kBAAQ9G,IAAIQ,IAAb;AAAmBD,iBAAOP,IAAIO;AAA9B,SAAtD;AAEAL,gBAAQC,aAAR,CAAsB,iBAAtB,EAAyC+G,MAAzC,CAAgDC,MAAhD,CAAuD;AAACL,kBAAQ9G,IAAIQ,IAAb;AAAmBD,iBAAOP,IAAIO;AAA9B,SAAvD;AAEAL,gBAAQC,aAAR,CAAsB,oBAAtB,EAA4C+G,MAA5C,CAAmDC,MAAnD,CAA0D;AAACtC,uBAAa7E,IAAIQ,IAAlB;AAAwBD,iBAAOP,IAAIO;AAAnC,SAA1D;AAEAL,gBAAQC,aAAR,CAAsB,kBAAtB,EAA0C+G,MAA1C,CAAiDC,MAAjD,CAAwD;AAACtC,uBAAa7E,IAAIQ,IAAlB;AAAwBD,iBAAOP,IAAIO;AAAnC,SAAxD;AAGAwF,gBAAQM,GAAR,CAAY,iBAAZ,EAA+BrG,IAAIQ,IAAnC;;AACA;ACmGM,iBDjGLN,QAAQkH,WAAR,CAAoB,OAAKpH,IAAIO,KAAT,GAAe,GAAf,GAAkBP,IAAIQ,IAA1C,EAAkD6G,WAAlD,CAA8DC,cAA9D,ECiGK;ADnGN,iBAAAxB,KAAA;AAGMH,cAAAG,KAAA;AACLC,kBAAQD,KAAR,CAAc,OAAK9F,IAAIO,KAAT,GAAe,GAAf,GAAkBP,IAAIQ,IAApC,EAA4C,KAAGmF,EAAE4B,KAAjD;AACA,gBAAM,IAAIjB,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,QAAMvG,IAAIQ,IAAV,GAAe,WAArC,CAAN;ACmGI;ADxHN;AAAA;AAhDD;AAtKD,CADD,C;;;;;;;;;;;;;;;;;;;AEPA,IAAAgH,aAAA,EAAAzH,cAAA;;AAAAyH,gBAAgB,UAACxH,GAAD;AACf,MAAAS,MAAA,EAAAgH,aAAA,EAAAC,YAAA;AAAAD,kBAAgBvH,QAAQC,aAAR,CAAsB,eAAtB,EAAuCC,IAAvC,CAA4C;AAACG,WAAOP,IAAIO,KAAZ;AAAmBuG,YAAQ9G,IAAI8G;AAA/B,GAA5C,EAAoF;AACnGrG,YAAQ;AACPkH,eAAS,CADF;AAEPC,gBAAU,CAFH;AAGPjE,aAAO,CAHA;AAIPkE,kBAAY,CAJL;AAKPC,mBAAa;AALN;AAD2F,GAApF,EAQbC,KARa,EAAhB;AAUAtH,WAAS,EAAT;AAEAiH,iBAAe,EAAf;;AAEAjG,IAAEC,OAAF,CAAU+F,aAAV,EAAyB,UAACO,CAAD;AACxB,QAAAC,MAAA,EAAAC,YAAA;;AAAA,QAAG,2CAA2CC,IAA3C,CAAgDH,EAAExH,IAAlD,CAAH;AACCyH,eAASD,EAAExH,IAAF,CAAO4H,KAAP,CAAa,KAAb,CAAT;AACAF,qBAAe,EAAf;AACAA,mBAAaD,OAAO,CAAP,CAAb,IAA0BD,CAA1B;;AACA,UAAG,CAACvG,EAAE4G,IAAF,CAAOX,aAAaO,OAAO,CAAP,CAAb,CAAP,CAAJ;AACCP,qBAAaO,OAAO,CAAP,CAAb,IAA0B,EAA1B;ACKG;;AACD,aDLHxG,EAAE6G,MAAF,CAASZ,aAAaO,OAAO,CAAP,CAAb,CAAT,EAAkCC,YAAlC,CCKG;ADXJ;ACaI,aDLHzH,OAAOuH,EAAExH,IAAT,IAAiBwH,CCKd;AACD;ADfJ;;AAWAvG,IAAE8G,IAAF,CAAOb,YAAP,EAAqB,UAACM,CAAD,EAAIQ,CAAJ;AACpB,QAAG/H,OAAO+H,CAAP,EAAUzH,IAAV,KAAkB,MAArB;AACC,UAAG,CAACU,EAAE4G,IAAF,CAAO5H,OAAO+H,CAAP,EAAU/H,MAAjB,CAAJ;AACCA,eAAO+H,CAAP,EAAU/H,MAAV,GAAmB,EAAnB;ACOG;;AACD,aDPHgB,EAAE6G,MAAF,CAAS7H,OAAO+H,CAAP,EAAU/H,MAAnB,EAA2BuH,CAA3B,CCOG;AACD;ADZJ;;ACcC,SDRD9H,QAAQC,aAAR,CAAsB,SAAtB,EAAiCsI,MAAjC,CAAwC;AAAClI,WAAOP,IAAIO,KAAZ;AAAmBC,UAAMR,IAAI8G;AAA7B,GAAxC,EAA8E;AAC7EH,UACC;AAAAlG,cAAQA;AAAR;AAF4E,GAA9E,CCQC;ADxCc,CAAhB;;AAqCAV,iBAAiB,UAACC,GAAD,EAAMQ,IAAN;AAChB,MAAAP,KAAA;AAAAA,UAAQC,QAAQC,aAAR,CAAsB,eAAtB,EAAuCC,IAAvC,CAA4C;AAAC0G,YAAQ9G,IAAI8G,MAAb;AAAsBvG,WAAOP,IAAIO,KAAjC;AAAwCF,SAAK;AAACC,WAAKN,IAAIK;AAAV,KAA7C;AAA6DG,UAAMA,QAAQR,IAAIQ;AAA/E,GAA5C,EAAkI;AAACC,YAAO;AAACJ,WAAK;AAAN;AAAR,GAAlI,CAAR;;AACA,MAAGJ,MAAMS,KAAN,KAAgB,CAAnB;AACC,WAAO,IAAP;AC0BC;;ADzBF,SAAO,KAAP;AAJgB,CAAjB;;AAMAR,QAAQS,OAAR,CAAgB8G,aAAhB,GACC;AAAAjH,QAAM,eAAN;AACAK,QAAM,QADN;AAEA2B,cAAY,IAFZ;AAGA1B,SAAM,IAHN;AAIAL,UACC;AAAAD,UACC;AAAAO,YAAM,MAAN;AACAC,kBAAY,IADZ;AAEAC,aAAO,IAFP;AAGAC,gBAAU,IAHV;AAIAC,aAAOC,aAAaC,KAAb,CAAmBqH;AAJ1B,KADD;AAMA5H,WACC;AAAAC,YAAM;AAAN,KAPD;AAQA4H,aACC;AAAA5H,YAAM,SAAN;AACA0B,cAAQ;AADR,KATD;AAWAqE,YACC;AAAA/F,YAAM,eAAN;AACA6H,oBAAc,SADd;AAEA1H,gBAAU,IAFV;AAGAK,uBAAiB;AAChB,YAAAsH,QAAA;;AAAAA,mBAAW,EAAX;;AACApH,UAAEC,OAAF,CAAUxB,QAAQ4I,aAAlB,EAAiC,UAACC,CAAD,EAAIP,CAAJ;ACgC3B,iBD/BLK,SAAS9G,IAAT,CAAc;AAACjB,mBAAOiI,EAAEjI,KAAV;AAAiBkB,mBAAOwG,CAAxB;AAA2B3H,kBAAMkI,EAAElI;AAAnC,WAAd,CC+BK;ADhCN;;AAEA,eAAOgI,QAAP;AAPD;AAAA,KAZD;AAoBA9H,UACC;AAAAA,YAAM,QAAN;AAEAS,eACC;AAAAwH,cAAM,IAAN;AACAC,kBAAU,KADV;AAEAC,cAAM,QAFN;AAGAC,gBAAQ,KAHR;AAIAC,iBAAS,UAJT;AAKAC,cAAM,IALN;AAMAC,kBAAU,MANV;AAOAC,gBAAQ,IAPR;AAQAC,kBAAU,IARV;AASAC,kBAAU,IATV;AAUAC,gBAAQ,KAVR;AAWAC,uBAAe,OAXf;AAYAC,cAAM,IAZN;AAaAC,aAAK,IAbL;AAcAC,eAAO;AAdP;AAHD,KArBD;AAuCAC,aACC;AAAAjJ,aAAO,KAAP;AACAC,YAAM,QADN;AAEAmB,oBAAc,GAFd;AAGA8H,aAAO,CAHP;AAIAC,gBAAU;AAJV,KAxCD;AA8CAC,WACC;AAAAnJ,YAAM;AAAN,KA/CD;AAiDAmB,kBACC;AAAAnB,YAAM;AAAN,KAlDD;AAoDAoJ,mBACC;AAAApJ,YAAM,MAAN;AACAqJ,gBAAU;AADV,KArDD;AAwDAA,cACC;AAAArJ,YAAM;AAAN,KAzDD;AA2DAG,cACC;AAAAH,YAAM;AAAN,KA5DD;AA8DAoC,aACC;AAAApC,YAAM;AAAN,KA/DD;AAiEAsJ,cACC;AAAAtJ,YAAM;AAAN,KAlED;AAsEA0B,YACC;AAAA1B,YAAM;AAAN,KAvED;AAyEAkC,UACC;AAAAlC,YAAM;AAAN,KA1ED;AA4EAE,WACC;AAAAF,YAAM;AAAN,KA7ED;AA+EAC,gBACC;AAAAD,YAAM;AAAN,KAhFD;AAkFAkJ,cACC;AAAAlJ,YAAM;AAAN,KAnFD;AAqFAuJ,eACC;AAAAvJ,YAAM,UAAN;AACAmB,oBAAc;AADd,KAtFD;AAyFA8H,WACC;AAAAjJ,YAAM,UAAN;AACAmB,oBAAc;AADd,KA1FD;AA6FA0G,kBACC;AAAA7H,YAAM,QAAN;AACAQ,uBAAiB;AAChB,YAAAsH,QAAA;;AAAAA,mBAAW,EAAX;;AACApH,UAAEC,OAAF,CAAUxB,QAAQS,OAAlB,EAA2B,UAACoI,CAAD,EAAIP,CAAJ;ACuCrB,iBDtCLK,SAAS9G,IAAT,CAAc;AAACjB,mBAAOiI,EAAEjI,KAAV;AAAiBkB,mBAAOwG,CAAxB;AAA2B3H,kBAAMkI,EAAElI;AAAnC,WAAd,CCsCK;ADvCN;;AAEA,eAAOgI,QAAP;AALD;AAAA,KA9FD;AAsGA0B,UACC;AAAAxJ,YAAM;AAAN,KAvGD;AAyGAS,aACC;AAAAT,YAAM,UAAN;AACAoC,eAAS;AADT,KA1GD;AA6GAD,iBACC;AAAApC,aAAO,aAAP;AACAC,YAAM,MADN;AAEAoC,eAAS;AAFT;AA9GD,GALD;AAuHAG,cACC;AAAAQ,SACC;AAAAC,eAAS,CAAC,MAAD,EAAS,OAAT,EAAkB,MAAlB,EAA0B,QAA1B,EAAoC,SAApC,EAA+C,UAA/C,CAAT;AACAyG,YAAM,CAAC;AAACC,oBAAY,SAAb;AAAwBC,eAAO;AAA/B,OAAD,CADN;AAEA1G,oBAAc;AAFd;AADD,GAxHD;AA6HAR,kBACC;AAAAS,UACC;AAAAC,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,KAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB,KADD;AAOAC,WACC;AAAAN,mBAAa,IAAb;AACAC,mBAAa,IADb;AAEAC,iBAAW,IAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,IAJlB;AAKAC,sBAAgB;AALhB;AARD,GA9HD;AA6IAd,YACC;AAAA,yCACC;AAAAkB,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACqDD,eDpDJwH,cAAcxH,GAAd,CCoDI;ADvDL;AAAA,KADD;AAKA,yCACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACuDD,eDtDJwH,cAAcxH,GAAd,CCsDI;ADzDL;AAAA,KAND;AAUA,yCACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACyDD,eDxDJwH,cAAcxH,GAAd,CCwDI;AD3DL;AAAA,KAXD;AAeA,0CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT,EAAcwG,UAAd,EAA0BC,QAA1B,EAAoCjF,OAApC;AACL,YAAAmJ,aAAA,EAAA7D,MAAA,EAAA8D,gBAAA,EAAAlE,GAAA,EAAAmE,IAAA,EAAAC,IAAA,EAAAC,IAAA,EAAAC,IAAA,EAAAC,IAAA,EAAAC,IAAA,EAAAC,IAAA;;AAAA,YAAGnL,IAAIQ,IAAJ,KAAY,MAAZ,KAAAiG,YAAA,QAAAC,MAAAD,SAAAE,IAAA,YAAAD,IAAsClG,IAAtC,GAAsC,MAAtC,GAAsC,MAAtC,KAA8CR,IAAIQ,IAAJ,KAAYiG,SAASE,IAAT,CAAcnG,IAA3E;AACC,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,gBAAtB,CAAN;AC4DI;;AD3DL,aAAAE,YAAA,QAAAoE,OAAApE,SAAAE,IAAA,YAAAkE,KAAmBrK,IAAnB,GAAmB,MAAnB,GAAmB,MAAnB,KAA2BT,eAAeC,GAAf,EAAoByG,SAASE,IAAT,CAAcnG,IAAlC,CAA3B;AACCuF,kBAAQM,GAAR,CAAY,0BAAwBrG,IAAIQ,IAAxC;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,UAAtB,CAAN;AC6DI;;AD3DL,YAAAE,YAAA,QAAAqE,OAAArE,SAAAE,IAAA,YAAAmE,KAAmBlC,YAAnB,GAAmB,MAAnB,GAAmB,MAAnB;AACC,cAAGnC,SAASE,IAAT,CAAciC,YAAd,CAA2BwC,MAA3B,KAAqC,CAAxC;AACCT,4BAAgBlE,SAASE,IAAT,CAAciC,YAAd,CAA2B,CAA3B,CAAhB;AADD;AAGC+B,4BAAgBlE,SAASE,IAAT,CAAciC,YAA9B;AAJF;ACkEK;;AD7DL,aAAAnC,YAAA,QAAAsE,OAAAtE,SAAAE,IAAA,YAAAoE,KAAmB9J,KAAnB,GAAmB,MAAnB,GAAmB,MAAnB,MAA6B,CAAAwF,YAAA,QAAAuE,OAAAvE,SAAAE,IAAA,YAAAqE,KAAiBjK,IAAjB,GAAiB,MAAjB,GAAiB,MAAjB,MAAyB,UAAzB,IAAC,CAAA0F,YAAA,QAAAwE,OAAAxE,SAAAE,IAAA,YAAAsE,KAAsDlK,IAAtD,GAAsD,MAAtD,GAAsD,MAAtD,MAA8D,MAA5F;AACC,gBAAM,IAAIuF,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,aAAtB,CAAN;AC+DI;;AD9DLO,iBAAS5G,QAAQC,aAAR,CAAsB,SAAtB,EAAiCkL,OAAjC,CAAyC;AAAChL,eAAKL,IAAI8G;AAAV,SAAzC,EAA4D;AAACrG,kBAAQ;AAACD,kBAAM,CAAP;AAAUM,mBAAO;AAAjB;AAAT,SAA5D,CAAT;;AAEA,YAAGgG,MAAH;AAEC8D,6BAAmB1K,QAAQC,aAAR,CAAsB2G,OAAOtG,IAA7B,EAAmCJ,IAAnC,EAAnB;;AACA,eAAAqG,YAAA,QAAAyE,OAAAzE,SAAAE,IAAA,YAAAuE,KAAmBtC,YAAnB,GAAmB,MAAnB,GAAmB,MAAnB,KAAmC5I,IAAI4I,YAAJ,KAAoB+B,aAAvD,IAAwEC,iBAAiBlK,KAAjB,KAA2B,CAAnG;AACC,kBAAM,IAAI4F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,OAAKO,OAAOhG,KAAZ,GAAkB,2BAAxC,CAAN;ACqEK;;ADnEN,eAAA2F,YAAA,QAAA0E,OAAA1E,SAAAG,MAAA,YAAAuE,KAAqBvC,YAArB,GAAqB,MAArB,GAAqB,MAArB,KAAqC5I,IAAI4I,YAAJ,KAAoB+B,aAAzD,IAA0EC,iBAAiBlK,KAAjB,KAA2B,CAArG;AACC,kBAAM,IAAI4F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,OAAKO,OAAOhG,KAAZ,GAAkB,2BAAxC,CAAN;AAPF;AC6EK;AD/FN;AAAA,KAhBD;AA8CA,0CACC;AAAA6D,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AAKL,YAAGD,eAAeC,GAAf,CAAH;AACC+F,kBAAQM,GAAR,CAAY,0BAAwBrG,IAAIQ,IAAxC;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,UAAtB,CAAN;ACiEI;;ADhEL,aAAAvG,OAAA,OAAGA,IAAKiB,KAAR,GAAQ,MAAR,MAAkB,CAAAjB,OAAA,OAACA,IAAKe,IAAN,GAAM,MAAN,MAAc,UAAd,IAAC,CAAAf,OAAA,OAA2BA,IAAKe,IAAhC,GAAgC,MAAhC,MAAwC,MAA3D;AACC,gBAAM,IAAIuF,OAAOC,KAAX,CAAiB,GAAjB,EAAqB,aAArB,CAAN;ACkEI;AD7EN;AAAA,KA/CD;AA2DA,0CACC;AAAA5B,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AACL,YAAGA,IAAIQ,IAAJ,KAAY,MAAf;AACC,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,SAAtB,CAAN;ACqEI;ADzEN;AAAA;AA5DD;AA9ID,CADD,C;;;;;;;;;;;;;;;;;;;AE3CA,IAAAiB,aAAA,EAAA8D,KAAA,EAAAvL,cAAA;;AAAAyH,gBAAgB,UAACxH,GAAD;AACf,MAAAuL,eAAA,EAAA9H,QAAA;AAAA8H,oBAAkBrL,QAAQC,aAAR,CAAsB,iBAAtB,EAAyCC,IAAzC,CAA8C;AAACG,WAAOP,IAAIO,KAAZ;AAAmBuG,YAAQ9G,IAAI8G,MAA/B;AAAuC7E,eAAW;AAAlD,GAA9C,EAAuG;AACxHxB,YAAQ;AACPkH,eAAS,CADF;AAEPC,gBAAU,CAFH;AAGPjE,aAAO,CAHA;AAIPkE,kBAAY,CAJL;AAKPC,mBAAa;AALN;AADgH,GAAvG,EAQfC,KARe,EAAlB;AAUAtE,aAAW,EAAX;;AAEAhC,IAAEC,OAAF,CAAU6J,eAAV,EAA2B,UAACvD,CAAD;ACMxB,WDLFvE,SAASuE,EAAExH,IAAX,IAAmBwH,CCKjB;ADNH;;ACQC,SDLD9H,QAAQC,aAAR,CAAsB,SAAtB,EAAiCsI,MAAjC,CAAwC;AAAClI,WAAOP,IAAIO,KAAZ;AAAmBC,UAAMR,IAAI8G;AAA7B,GAAxC,EAA8E;AAC7EH,UACC;AAAAlD,gBAAUA;AAAV;AAF4E,GAA9E,CCKC;ADrBc,CAAhB;;AAqBA1D,iBAAiB,UAACC,GAAD,EAAMQ,IAAN;AAChB,MAAAP,KAAA;AAAAA,UAAQC,QAAQC,aAAR,CAAsB,iBAAtB,EAAyCC,IAAzC,CAA8C;AAAC0G,YAAQ9G,IAAI8G,MAAb;AAAsBvG,WAAOP,IAAIO,KAAjC;AAAwCF,SAAK;AAACC,WAAKN,IAAIK;AAAV,KAA7C;AAA6DG,UAAMA,QAAQR,IAAIQ;AAA/E,GAA9C,EAAoI;AAACC,YAAO;AAACJ,WAAK;AAAN;AAAR,GAApI,CAAR;;AACA,MAAGJ,MAAMS,KAAN,KAAgB,CAAnB;AACC,WAAO,IAAP;ACuBC;;ADtBF,SAAO,KAAP;AAJgB,CAAjB;;AAMA4K,QAAQ,UAAClF,MAAD,EAASpG,GAAT;AACP,MAAGwL,QAAQC,YAAR,CAAqBrF,MAArB,EAA6BpG,IAAIO,KAAjC,CAAH;AACC,UAAM,IAAI+F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,iBAAtB,CAAN;ACyBC;;ADtBF,MAAGvG,IAAI2E,EAAJ,KAAU,QAAV,IAAsB,CAAC6G,QAAQE,cAAR,CAAuB1L,IAAIO,KAA3B,EAAiC,qBAAjC,CAA1B;AACC,UAAM,IAAI+F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,kBAAtB,CAAN;ACwBC;AD9BK,CAAR;;AAQArG,QAAQS,OAAR,CAAgB4K,eAAhB,GACC;AAAA/K,QAAM,iBAAN;AACAK,QAAM,oBADN;AAEAC,SAAM,KAFN;AAGAL,UACC;AAAAD,UACC;AAAAO,YAAM,MAAN;AACAC,kBAAY,IADZ;AAEAC,aAAO,IAFP;AAGAC,gBAAU,IAHV;AAIAC,aAAOC,aAAaC,KAAb,CAAmBC;AAJ1B,KADD;AAMAR,WACC;AAAAC,YAAM;AAAN,KAPD;AAQA+F,YACC;AAAA/F,YAAM,eAAN;AACA6H,oBAAc,SADd;AAEA1H,gBAAU,IAFV;AAGAK,uBAAiB;AAChB,YAAAsH,QAAA;;AAAAA,mBAAW,EAAX;;AACApH,UAAEC,OAAF,CAAUxB,QAAQ4I,aAAlB,EAAiC,UAACC,CAAD,EAAIP,CAAJ;AC6B3B,iBD5BLK,SAAS9G,IAAT,CAAc;AAACjB,mBAAOiI,EAAEjI,KAAV;AAAiBkB,mBAAOwG,CAAxB;AAA2B3H,kBAAMkI,EAAElI;AAAnC,WAAd,CC4BK;AD7BN;;AAEA,eAAOgI,QAAP;AAPD;AAAA,KATD;AAiBAlE,QACC;AAAA5D,YAAM,QAAN;AACAG,gBAAU,IADV;AAEAK,uBAAiB;AAChB,eAAO,CAAC;AAACT,iBAAO,KAAR;AAAekB,iBAAO,QAAtB;AAAgCnB,gBAAM;AAAtC,SAAD,EAAmD;AAACC,iBAAO,KAAR;AAAekB,iBAAO,QAAtB;AAAgCnB,gBAAM;AAAtC,SAAnD,CAAP;AAHD;AAAA,KAlBD;AAsBAsF,UACC;AAAApF,YAAM,QAAN;AACAG,gBAAU,IADV;AAEAK,uBAAiB;ACgDZ,eD/CJ,CACC;AAACT,iBAAO,QAAR;AAAkBkB,iBAAO,eAAzB;AAA0CnB,gBAAM;AAAhD,SADD,EAEC;AAACC,iBAAO,QAAR;AAAkBkB,iBAAO,cAAzB;AAAyCnB,gBAAM;AAA/C,SAFD,EAGC;AAACC,iBAAO,QAAR;AAAkBkB,iBAAO,eAAzB;AAA0CnB,gBAAM;AAAhD,SAHD,EAIC;AAACC,iBAAO,QAAR;AAAkBkB,iBAAO,cAAzB;AAAyCnB,gBAAM;AAA/C,SAJD,EAKC;AAACC,iBAAO,QAAR;AAAkBkB,iBAAO,eAAzB;AAA0CnB,gBAAM;AAAhD,SALD,EAMC;AAACC,iBAAO,QAAR;AAAkBkB,iBAAO,cAAzB;AAAyCnB,gBAAM;AAA/C,SAND,CC+CI;ADlDL;AAAA,KAvBD;AAkCAoB,eACC;AAAAlB,YAAM;AAAN,KAnCD;AAoCA6D,UACC;AAAA7D,YAAM,UAAN;AACAG,gBAAU,IADV;AAEAiC,eAAQ;AAFR;AArCD,GAJD;AA6CAG,cACC;AAAAQ,SACC;AAAAC,eAAS,CAAC,MAAD,EAAS,OAAT,EAAkB,QAAlB,EAA4B,IAA5B,EAAkC,MAAlC,EAA0C,WAA1C,CAAT;AACAC,oBAAc;AADd;AADD,GA9CD;AAkDAR,kBACC;AAAAS,UACC;AAAAC,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,KAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB,KADD;AAOAC,WACC;AAAAN,mBAAa,IAAb;AACAC,mBAAa,IADb;AAEAC,iBAAW,IAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,IAJlB;AAKAC,sBAAgB;AALhB;AARD,GAnDD;AAkEAd,YACC;AAAA,2CACC;AAAAkB,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AC0ED,eDzEJwH,cAAcxH,GAAd,CCyEI;AD5EL;AAAA,KADD;AAKA,2CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AC4ED,eD3EJwH,cAAcxH,GAAd,CC2EI;AD9EL;AAAA,KAND;AAUA,2CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AC8ED,eD7EJwH,cAAcxH,GAAd,CC6EI;ADhFL;AAAA,KAXD;AAgBA,4CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AC+ED,eD9EJsL,MAAMlF,MAAN,EAAcpG,GAAd,CC8EI;ADjFL;AAAA,KAjBD;AAsBA,4CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT,EAAcwG,UAAd,EAA0BC,QAA1B,EAAoCjF,OAApC;AACL,YAAAkF,GAAA;AAAA4E,cAAMlF,MAAN,EAAcpG,GAAd;;AACA,aAAAyG,YAAA,QAAAC,MAAAD,SAAAE,IAAA,YAAAD,IAAmBlG,IAAnB,GAAmB,MAAnB,GAAmB,MAAnB,KAA2BT,eAAeC,GAAf,EAAoByG,SAASE,IAAT,CAAcnG,IAAlC,CAA3B;AACCuF,kBAAQM,GAAR,CAAY,4BAA0BrG,IAAIQ,IAA1C;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,aAAWvG,IAAIQ,IAArC,CAAN;ACiFI;ADvFN;AAAA,KAvBD;AA+BA,4CACC;AAAAmE,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AACLsL,cAAMlF,MAAN,EAAcpG,GAAd;;AACA,YAAGD,eAAeC,GAAf,CAAH;AACC+F,kBAAQM,GAAR,CAAY,4BAA0BrG,IAAIQ,IAA1C;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,UAAtB,CAAN;ACmFI;ADzFN;AAAA;AAhCD;AAnED,CADD,C;;;;;;;;;;;;;;;;;;;AEnCA,IAAAiB,aAAA,EAAAzH,cAAA;;AAAAyH,gBAAgB,UAACxH,GAAD;AACf,MAAAuD,OAAA,EAAAoI,cAAA;AAAAA,mBAAiBzL,QAAQC,aAAR,CAAsB,gBAAtB,EAAwCC,IAAxC,CAA6C;AAAC0G,YAAQ9G,IAAI8G,MAAb;AAAqBvG,WAAOP,IAAIO,KAAhC;AAAuC0B,eAAW;AAAlD,GAA7C,EAAsG;AACtHxB,YAAQ;AACPkH,eAAS,CADF;AAEPC,gBAAU,CAFH;AAGPjE,aAAO,CAHA;AAIPkE,kBAAY,CAJL;AAKPC,mBAAa;AALN;AAD8G,GAAtG,EAQdC,KARc,EAAjB;AAUAxE,YAAU,EAAV;;AAEA9B,IAAEC,OAAF,CAAUiK,cAAV,EAA0B,UAAC3D,CAAD;ACMvB,WDLFzE,QAAQyE,EAAExH,IAAV,IAAkBwH,CCKhB;ADNH;;ACQC,SDLD9H,QAAQC,aAAR,CAAsB,SAAtB,EAAiCsI,MAAjC,CAAwC;AAAClI,WAAOP,IAAIO,KAAZ;AAAmBC,UAAMR,IAAI8G;AAA7B,GAAxC,EAA8E;AAC7EH,UACC;AAAApD,eAASA;AAAT;AAF4E,GAA9E,CCKC;ADrBc,CAAhB;;AAoBAxD,iBAAiB,UAACC,GAAD,EAAMQ,IAAN;AAChB,MAAAP,KAAA;AAAAA,UAAQC,QAAQC,aAAR,CAAsB,gBAAtB,EAAwCC,IAAxC,CAA6C;AAAC0G,YAAQ9G,IAAI8G,MAAb;AAAsBvG,WAAOP,IAAIO,KAAjC;AAAwCF,SAAK;AAACC,WAAKN,IAAIK;AAAV,KAA7C;AAA6DG,UAAMA,QAAQR,IAAIQ;AAA/E,GAA7C,EAAmI;AAACC,YAAO;AAACJ,WAAK;AAAN;AAAR,GAAnI,CAAR;;AACA,MAAGJ,MAAMS,KAAN,KAAgB,CAAnB;AACC,WAAO,IAAP;ACwBC;;ADvBF,SAAO,KAAP;AAJgB,CAAjB;;AAKAR,QAAQS,OAAR,CAAgBgL,cAAhB,GACC;AAAAnL,QAAM,gBAAN;AACAM,SAAO,MADP;AAEAD,QAAM,mBAFN;AAGAJ,UACC;AAAAqG,YACC;AAAA/F,YAAM,eAAN;AACA6H,oBAAc,SADd;AAEA1H,gBAAU,IAFV;AAGAK,uBAAiB;AAChB,YAAAsH,QAAA;;AAAAA,mBAAW,EAAX;;AACApH,UAAEC,OAAF,CAAUxB,QAAQ4I,aAAlB,EAAiC,UAACC,CAAD,EAAIP,CAAJ;AC4B3B,iBD3BLK,SAAS9G,IAAT,CAAc;AAACjB,mBAAOiI,EAAEjI,KAAV;AAAiBkB,mBAAOwG,CAAxB;AAA2B3H,kBAAMkI,EAAElI;AAAnC,WAAd,CC2BK;AD5BN;;AAEA,eAAOgI,QAAP;AAPD;AAAA,KADD;AASArI,UACC;AAAAO,YAAM,MAAN;AACAC,kBAAW,IADX;AAEAC,aAAM,IAFN;AAGAC,gBAAU,IAHV;AAIAC,aAAOC,aAAaC,KAAb,CAAmBC;AAJ1B,KAVD;AAeAR,WACC;AAAAC,YAAM;AAAN,KAhBD;AAiBAkB,eACC;AAAAlB,YAAM;AAAN,KAlBD;AAmBA2D,aACC;AAAA3D,YAAM,SAAN;AACAkC,YAAM;AADN,KApBD;AAsBA0B,QACC;AAAA5D,YAAM,QAAN;AACAoC,eAAQ,IADR;AAEAjC,gBAAU,IAFV;AAGAK,uBAAiB;ACuCZ,eDtCJ,CACC;AAACT,iBAAO,UAAR;AAAoBkB,iBAAO,MAA3B;AAAmCnB,gBAAM;AAAzC,SADD,EAEC;AAACC,iBAAO,aAAR;AAAuBkB,iBAAO,QAA9B;AAAwCnB,gBAAM;AAA9C,SAFD,CCsCI;AD1CL;AAAA,KAvBD;AA+BA+D,UACC;AAAA9D,aAAO,OAAP;AACAC,YAAM,UADN;AAEAG,gBAAU,IAFV;AAGAiC,eAAQ;AAHR;AAhCD,GAJD;AA0CAG,cACC;AAAAQ,SACC;AAAAC,eAAS,CAAC,MAAD,EAAS,OAAT,EAAkB,QAAlB,EAA4B,IAA5B,EAAkC,WAAlC,EAA+C,UAA/C,CAAT;AACAC,oBAAc;AADd;AADD,GA3CD;AA+CAR,kBACC;AAAAS,UACC;AAAAC,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,KAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB,KADD;AAOAC,WACC;AAAAN,mBAAa,IAAb;AACAC,mBAAa,IADb;AAEAC,iBAAW,IAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,IAJlB;AAKAC,sBAAgB;AALhB;AARD,GAhDD;AA+DAd,YACC;AAAA,0CACC;AAAAkB,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACmDD,eDlDJwH,cAAcxH,GAAd,CCkDI;ADrDL;AAAA,KADD;AAKA,0CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACqDD,eDpDJwH,cAAcxH,GAAd,CCoDI;ADvDL;AAAA,KAND;AAUA,0CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,cADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;ACuDD,eDtDJwH,cAAcxH,GAAd,CCsDI;ADzDL;AAAA,KAXD;AAgBA,2CACC;AAAA2E,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT,EAAcwG,UAAd,EAA0BC,QAA1B,EAAoCjF,OAApC;AACL,YAAAkF,GAAA;;AAAA,aAAAD,YAAA,QAAAC,MAAAD,SAAAE,IAAA,YAAAD,IAAmBlG,IAAnB,GAAmB,MAAnB,GAAmB,MAAnB,KAA2BT,eAAeC,GAAf,EAAoByG,SAASE,IAAT,CAAcnG,IAAlC,CAA3B;AACCuF,kBAAQM,GAAR,CAAY,2BAAyBrG,IAAIQ,IAAzC;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,UAAtB,CAAN;ACyDI;AD9DN;AAAA,KAjBD;AAwBA,2CACC;AAAA5B,UAAI,QAAJ;AACAwB,YAAM,eADN;AAEAvB,YAAM,UAACwB,MAAD,EAASpG,GAAT;AACLA,YAAI0E,OAAJ,GAAc,IAAd;;AACA,YAAG3E,eAAeC,GAAf,CAAH;AACC+F,kBAAQM,GAAR,CAAY,2BAAyBrG,IAAIQ,IAAzC;AACA,gBAAM,IAAI8F,OAAOC,KAAX,CAAiB,GAAjB,EAAsB,aAAWvG,IAAIQ,IAArC,CAAN;AC2DI;ADjEN;AAAA;AAzBD;AAhED,CADD,C","file":"/packages/steedos_object-database.js","sourcesContent":["#TODO object的name不能重复，需要考虑到系统表\r\nisRepeatedName = (doc)->\r\n\tother = Creator.getCollection(\"objects\").find({_id: {$ne: doc._id}, space: doc.space, name: doc.name}, {fields:{_id: 1}})\r\n\tif other.count() > 0\r\n\t\treturn true\r\n\treturn false\r\n\r\nCreator.Objects.objects =\r\n\tname: \"objects\"\r\n\ticon: \"orders\"\r\n\tlabel: \"对象\"\r\n\tfields:\r\n\t\tname:\r\n\t\t\ttype: \"text\"\r\n\t\t\tsearchable:true\r\n\t\t\tindex:true\r\n\t\t\trequired: true\r\n\t\t\tregEx: SimpleSchema.RegEx.code\r\n\t\tlabel:\r\n\t\t\ttype: \"text\"\r\n\t\t\trequired: true\r\n\t\ticon:\r\n\t\t\ttype: \"lookup\"\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\toptions = []\r\n\t\t\t\t_.forEach Creator.resources.sldsIcons.standard, (svg)->\r\n\t\t\t\t\toptions.push {value: svg, label: svg, icon: svg}\r\n\t\t\t\treturn options\r\n\t\tis_enable:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tdefaultValue: true\r\n\t\tenable_search:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_files:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_tasks:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_notes:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_events:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_api:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tdefaultValue: true\r\n\t\t\thidden: true\r\n\t\tenable_share:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tdefaultValue: false\r\n\t\tenable_instances:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_chatter:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_audit:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_trash:\r\n\t\t\ttype: \"boolean\"\r\n\t\tenable_space_global:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tdefaultValue: false\r\n\t\tis_view:\r\n\t\t\ttype: 'boolean'\r\n\t\t\tdefaultValue: false\r\n\t\t\tomit: true\r\n\t\thidden:\r\n\t\t\tlabel: \"隐藏\"\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tomit: true\r\n\t\tdescription:\r\n\t\t\tlabel: \"Description\"\r\n\t\t\ttype: \"textarea\"\r\n\t\t\tis_wide: true\r\n\t\tsidebar:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"左侧列表\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\tfields:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"字段\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\tlist_views:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"列表视图\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\tactions:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"操作\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\tpermission_set:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"权限设置\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\ttriggers:\r\n\t\t\ttype: \"object\"\r\n\t\t\tlabel: \"触发器\"\r\n\t\t\tblackbox: true\r\n\t\t\tomit: true\r\n\t\t\thidden: true\r\n\t\tcustom:\r\n\t\t\tlabel: \"规则\"\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tomit: true\r\n\t\towner:\r\n\t\t\ttype: \"lookup\"\r\n\t\t\thidden: true\r\n\t\tapp_unique_id:\r\n\t\t\ttype: 'text'\r\n\t\t\thidden: true\r\n\t\tapp_version:\r\n\t\t\ttype: 'text',\r\n\t\t\thidden: true\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tcolumns: [\"name\", \"label\", \"is_enable\", \"modified\"]\r\n\t\t\tlabel:\"全部\"\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: false\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: true\r\n\t\t\tallowDelete: true\r\n\t\t\tallowEdit: true\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: true\r\n\t\t\tviewAllRecords: true\r\n\r\n\tactions:\r\n\t\tcopy_odata:\r\n\t\t\tlabel: \"复制OData网址\"\r\n\t\t\tvisible: true\r\n\t\t\ton: \"record\"\r\n\t\t\ttodo: (object_name, record_id, item_element)->\r\n\t\t\t\trecord = Creator.getObjectById(record_id)\r\n\t\t\t\t#enable_api 属性未开放\r\n\t\t\t\tif record?.enable_api || true\r\n\t\t\t\t\to_name = record?.name\r\n\t\t\t\t\tpath = SteedosOData.getODataPath(Session.get(\"spaceId\"), o_name)\r\n\t\t\t\t\titem_element.attr('data-clipboard-text', path);\r\n\t\t\t\t\tif !item_element.attr('data-clipboard-new')\r\n\t\t\t\t\t\tclipboard = new Clipboard(item_element[0]);\r\n\t\t\t\t\t\titem_element.attr('data-clipboard-new', true)\r\n\r\n\t\t\t\t\t\tclipboard.on('success',  (e) ->\r\n\t\t\t\t\t\t\ttoastr.success('复制成功');\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\tclipboard.on('error',  (e) ->\r\n\t\t\t\t\t\t\ttoastr.error('复制失败');\r\n\t\t\t\t\t\t\tconsole.error \"e\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t#fix 详细页面(网页LI 手机版view-action)第一次点击复制不执行\r\n\t\t\t\t\t\tif item_element[0].tagName == 'LI' || item_element.hasClass('view-action')\r\n\t\t\t\t\t\t\titem_element.trigger(\"click\");\r\n\t\t\t\telse\r\n\t\t\t\t\ttoastr.error('复制失败: 未启用API');\r\n\r\n\r\n\ttriggers:\r\n\t\t\"before.insert.server.objects\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\tif isRepeatedName(doc)\r\n\t\t\t\t\tconsole.log(\"object对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复\"\r\n\t\t\t\tdoc.custom = true\r\n\r\n\t\t\"before.update.server.objects\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.update\"\r\n\t\t\ttodo: (userId, doc, fieldNames, modifier, options)->\r\n\t\t\t\tif modifier?.$set?.name && doc.name != modifier.$set.name\r\n\t\t\t\t\tconsole.log \"不能修改name\"\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"不能修改对象名\"\r\n\t\t\t\tif modifier.$set\r\n\t\t\t\t\tmodifier.$set.custom = true\r\n\r\n\t\t\t\tif modifier.$unset && modifier.$unset.custom\r\n\t\t\t\t\tdelete modifier.$unset.custom\r\n\r\n\r\n\t\t\"after.insert.server.objects\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t#新增object时，默认新建一个name字段\r\n\t\t\t\tCreator.getCollection(\"object_fields\").insert({object: doc.name, owner: userId, name: \"name\", space: doc.space, type: \"text\", required: true, index: true, searchable: true})\r\n\t\t\t\tCreator.getCollection(\"object_listviews\").insert({name: \"all\", space: doc.space, owner: userId, object_name: doc.name, shared: true, filter_scope: \"space\", columns: [\"name\"]})\r\n\t\t\t\tCreator.getCollection(\"object_listviews\").insert({name: \"recent\", space: doc.space, owner: userId, object_name: doc.name, shared: true, filter_scope: \"space\", columns: [\"name\"]})\r\n\r\n\t\t\"before.remove.server.objects\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\r\n\t\t\t\tif doc.app_unique_id && doc.app_version\r\n\t\t\t\t\treturn\r\n\r\n\t\t\t\tobject_collections = Creator.getCollection(doc.name, doc.space)\r\n\r\n\t\t\t\tdocuments = object_collections.find({},{fields: {_id: 1}})\r\n\r\n\t\t\t\tif documents.count() > 0\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象(#{doc.name})中已经有记录，请先删除记录后， 再删除此对象\"\r\n\r\n\t\t\"after.remove.server.objects\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t#删除object 后，自动删除fields、actions、triggers、permission_objects\r\n\t\t\t\tCreator.getCollection(\"object_fields\").direct.remove({object: doc.name, space: doc.space})\r\n\r\n\t\t\t\tCreator.getCollection(\"object_actions\").direct.remove({object: doc.name, space: doc.space})\r\n\r\n\t\t\t\tCreator.getCollection(\"object_triggers\").direct.remove({object: doc.name, space: doc.space})\r\n\r\n\t\t\t\tCreator.getCollection(\"permission_objects\").direct.remove({object_name: doc.name, space: doc.space})\r\n\r\n\t\t\t\tCreator.getCollection(\"object_listviews\").direct.remove({object_name: doc.name, space: doc.space})\r\n\r\n\t\t\t\t#drop collection\r\n\t\t\t\tconsole.log \"drop collection\", doc.name\r\n\t\t\t\ttry\r\n#\t\t\t\t\tCreator.getCollection(doc.name)._collection.dropCollection()\r\n\t\t\t\t\tCreator.Collections[\"c_#{doc.space}_#{doc.name}\"]._collection.dropCollection()\r\n\t\t\t\tcatch e\r\n\t\t\t\t\tconsole.error(\"c_#{doc.space}_#{doc.name}\", \"#{e.stack}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象(#{doc.name})不存在或已被删除\"","var isRepeatedName;\n\nisRepeatedName = function(doc) {\n  var other;\n  other = Creator.getCollection(\"objects\").find({\n    _id: {\n      $ne: doc._id\n    },\n    space: doc.space,\n    name: doc.name\n  }, {\n    fields: {\n      _id: 1\n    }\n  });\n  if (other.count() > 0) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Objects.objects = {\n  name: \"objects\",\n  icon: \"orders\",\n  label: \"对象\",\n  fields: {\n    name: {\n      type: \"text\",\n      searchable: true,\n      index: true,\n      required: true,\n      regEx: SimpleSchema.RegEx.code\n    },\n    label: {\n      type: \"text\",\n      required: true\n    },\n    icon: {\n      type: \"lookup\",\n      optionsFunction: function() {\n        var options;\n        options = [];\n        _.forEach(Creator.resources.sldsIcons.standard, function(svg) {\n          return options.push({\n            value: svg,\n            label: svg,\n            icon: svg\n          });\n        });\n        return options;\n      }\n    },\n    is_enable: {\n      type: \"boolean\",\n      defaultValue: true\n    },\n    enable_search: {\n      type: \"boolean\"\n    },\n    enable_files: {\n      type: \"boolean\"\n    },\n    enable_tasks: {\n      type: \"boolean\"\n    },\n    enable_notes: {\n      type: \"boolean\"\n    },\n    enable_events: {\n      type: \"boolean\"\n    },\n    enable_api: {\n      type: \"boolean\",\n      defaultValue: true,\n      hidden: true\n    },\n    enable_share: {\n      type: \"boolean\",\n      defaultValue: false\n    },\n    enable_instances: {\n      type: \"boolean\"\n    },\n    enable_chatter: {\n      type: \"boolean\"\n    },\n    enable_audit: {\n      type: \"boolean\"\n    },\n    enable_trash: {\n      type: \"boolean\"\n    },\n    enable_space_global: {\n      type: \"boolean\",\n      defaultValue: false\n    },\n    is_view: {\n      type: 'boolean',\n      defaultValue: false,\n      omit: true\n    },\n    hidden: {\n      label: \"隐藏\",\n      type: \"boolean\",\n      omit: true\n    },\n    description: {\n      label: \"Description\",\n      type: \"textarea\",\n      is_wide: true\n    },\n    sidebar: {\n      type: \"object\",\n      label: \"左侧列表\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    fields: {\n      type: \"object\",\n      label: \"字段\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    list_views: {\n      type: \"object\",\n      label: \"列表视图\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    actions: {\n      type: \"object\",\n      label: \"操作\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    permission_set: {\n      type: \"object\",\n      label: \"权限设置\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    triggers: {\n      type: \"object\",\n      label: \"触发器\",\n      blackbox: true,\n      omit: true,\n      hidden: true\n    },\n    custom: {\n      label: \"规则\",\n      type: \"boolean\",\n      omit: true\n    },\n    owner: {\n      type: \"lookup\",\n      hidden: true\n    },\n    app_unique_id: {\n      type: 'text',\n      hidden: true\n    },\n    app_version: {\n      type: 'text',\n      hidden: true\n    }\n  },\n  list_views: {\n    all: {\n      columns: [\"name\", \"label\", \"is_enable\", \"modified\"],\n      label: \"全部\",\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: false,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: true,\n      allowDelete: true,\n      allowEdit: true,\n      allowRead: true,\n      modifyAllRecords: true,\n      viewAllRecords: true\n    }\n  },\n  actions: {\n    copy_odata: {\n      label: \"复制OData网址\",\n      visible: true,\n      on: \"record\",\n      todo: function(object_name, record_id, item_element) {\n        var clipboard, o_name, path, record;\n        record = Creator.getObjectById(record_id);\n        if ((record != null ? record.enable_api : void 0) || true) {\n          o_name = record != null ? record.name : void 0;\n          path = SteedosOData.getODataPath(Session.get(\"spaceId\"), o_name);\n          item_element.attr('data-clipboard-text', path);\n          if (!item_element.attr('data-clipboard-new')) {\n            clipboard = new Clipboard(item_element[0]);\n            item_element.attr('data-clipboard-new', true);\n            clipboard.on('success', function(e) {\n              return toastr.success('复制成功');\n            });\n            clipboard.on('error', function(e) {\n              toastr.error('复制失败');\n              return console.error(\"e\");\n            });\n            if (item_element[0].tagName === 'LI' || item_element.hasClass('view-action')) {\n              return item_element.trigger(\"click\");\n            }\n          }\n        } else {\n          return toastr.error('复制失败: 未启用API');\n        }\n      }\n    }\n  },\n  triggers: {\n    \"before.insert.server.objects\": {\n      on: \"server\",\n      when: \"before.insert\",\n      todo: function(userId, doc) {\n        if (isRepeatedName(doc)) {\n          console.log(\"object对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\");\n        }\n        return doc.custom = true;\n      }\n    },\n    \"before.update.server.objects\": {\n      on: \"server\",\n      when: \"before.update\",\n      todo: function(userId, doc, fieldNames, modifier, options) {\n        var ref;\n        if ((modifier != null ? (ref = modifier.$set) != null ? ref.name : void 0 : void 0) && doc.name !== modifier.$set.name) {\n          console.log(\"不能修改name\");\n          throw new Meteor.Error(500, \"不能修改对象名\");\n        }\n        if (modifier.$set) {\n          modifier.$set.custom = true;\n        }\n        if (modifier.$unset && modifier.$unset.custom) {\n          return delete modifier.$unset.custom;\n        }\n      }\n    },\n    \"after.insert.server.objects\": {\n      on: \"server\",\n      when: \"after.insert\",\n      todo: function(userId, doc) {\n        Creator.getCollection(\"object_fields\").insert({\n          object: doc.name,\n          owner: userId,\n          name: \"name\",\n          space: doc.space,\n          type: \"text\",\n          required: true,\n          index: true,\n          searchable: true\n        });\n        Creator.getCollection(\"object_listviews\").insert({\n          name: \"all\",\n          space: doc.space,\n          owner: userId,\n          object_name: doc.name,\n          shared: true,\n          filter_scope: \"space\",\n          columns: [\"name\"]\n        });\n        return Creator.getCollection(\"object_listviews\").insert({\n          name: \"recent\",\n          space: doc.space,\n          owner: userId,\n          object_name: doc.name,\n          shared: true,\n          filter_scope: \"space\",\n          columns: [\"name\"]\n        });\n      }\n    },\n    \"before.remove.server.objects\": {\n      on: \"server\",\n      when: \"before.remove\",\n      todo: function(userId, doc) {\n        var documents, object_collections;\n        if (doc.app_unique_id && doc.app_version) {\n          return;\n        }\n        object_collections = Creator.getCollection(doc.name, doc.space);\n        documents = object_collections.find({}, {\n          fields: {\n            _id: 1\n          }\n        });\n        if (documents.count() > 0) {\n          throw new Meteor.Error(500, \"对象(\" + doc.name + \")中已经有记录，请先删除记录后， 再删除此对象\");\n        }\n      }\n    },\n    \"after.remove.server.objects\": {\n      on: \"server\",\n      when: \"after.remove\",\n      todo: function(userId, doc) {\n        var e;\n        Creator.getCollection(\"object_fields\").direct.remove({\n          object: doc.name,\n          space: doc.space\n        });\n        Creator.getCollection(\"object_actions\").direct.remove({\n          object: doc.name,\n          space: doc.space\n        });\n        Creator.getCollection(\"object_triggers\").direct.remove({\n          object: doc.name,\n          space: doc.space\n        });\n        Creator.getCollection(\"permission_objects\").direct.remove({\n          object_name: doc.name,\n          space: doc.space\n        });\n        Creator.getCollection(\"object_listviews\").direct.remove({\n          object_name: doc.name,\n          space: doc.space\n        });\n        console.log(\"drop collection\", doc.name);\n        try {\n          return Creator.Collections[\"c_\" + doc.space + \"_\" + doc.name]._collection.dropCollection();\n        } catch (error) {\n          e = error;\n          console.error(\"c_\" + doc.space + \"_\" + doc.name, \"\" + e.stack);\n          throw new Meteor.Error(500, \"对象(\" + doc.name + \")不存在或已被删除\");\n        }\n      }\n    }\n  }\n};\n","_syncToObject = (doc) ->\r\n\tobject_fields = Creator.getCollection(\"object_fields\").find({space: doc.space, object: doc.object}, {\r\n\t\tfields: {\r\n\t\t\tcreated: 0,\r\n\t\t\tmodified: 0,\r\n\t\t\towner: 0,\r\n\t\t\tcreated_by: 0,\r\n\t\t\tmodified_by: 0\r\n\t\t}\r\n\t}).fetch()\r\n\r\n\tfields = {}\r\n\r\n\ttable_fields = {}\r\n\r\n\t_.forEach object_fields, (f)->\r\n\t\tif /^[a-zA-Z_]\\w*(\\.\\$\\.\\w+){1}[a-zA-Z0-9]*$/.test(f.name)\r\n\t\t\tcf_arr = f.name.split(\".$.\")\r\n\t\t\tchild_fields = {}\r\n\t\t\tchild_fields[cf_arr[1]] = f\r\n\t\t\tif !_.size(table_fields[cf_arr[0]])\r\n\t\t\t\ttable_fields[cf_arr[0]] = {}\r\n\t\t\t_.extend(table_fields[cf_arr[0]], child_fields)\r\n\t\telse\r\n\t\t\tfields[f.name] = f\r\n\r\n\t_.each table_fields, (f, k)->\r\n\t\tif fields[k].type == \"grid\"\r\n\t\t\tif !_.size(fields[k].fields)\r\n\t\t\t\tfields[k].fields = {}\r\n\t\t\t_.extend(fields[k].fields, f)\r\n\r\n\tCreator.getCollection(\"objects\").update({space: doc.space, name: doc.object}, {\r\n\t\t$set:\r\n\t\t\tfields: fields\r\n\t})\r\n\r\nisRepeatedName = (doc, name)->\r\n\tother = Creator.getCollection(\"object_fields\").find({object: doc.object,  space: doc.space, _id: {$ne: doc._id}, name: name || doc.name}, {fields:{_id: 1}})\r\n\tif other.count() > 0\r\n\t\treturn true\r\n\treturn false\r\n\r\nCreator.Objects.object_fields =\r\n\tname: \"object_fields\"\r\n\ticon: \"orders\"\r\n\tenable_api: true\r\n\tlabel:\"字段\"\r\n\tfields:\r\n\t\tname:\r\n\t\t\ttype: \"text\"\r\n\t\t\tsearchable: true\r\n\t\t\tindex: true\r\n\t\t\trequired: true\r\n\t\t\tregEx: SimpleSchema.RegEx.field\r\n\t\tlabel:\r\n\t\t\ttype: \"text\"\r\n\t\tis_name:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\thidden: true\r\n\t\tobject:\r\n\t\t\ttype: \"master_detail\"\r\n\t\t\treference_to: \"objects\"\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t_options = []\r\n\t\t\t\t_.forEach Creator.objectsByName, (o, k)->\r\n\t\t\t\t\t_options.push {label: o.label, value: k, icon: o.icon}\r\n\t\t\t\treturn _options\r\n\t\ttype:\r\n\t\t\ttype: \"select\"\r\n#\t\t\trequired: true\r\n\t\t\toptions:\r\n\t\t\t\ttext: \"文本\",\r\n\t\t\t\ttextarea: \"长文本\"\r\n\t\t\t\thtml: \"Html文本\",\r\n\t\t\t\tselect: \"选择框\",\r\n\t\t\t\tboolean: \"Checkbox\"\r\n\t\t\t\tdate: \"日期\"\r\n\t\t\t\tdatetime: \"日期时间\"\r\n\t\t\t\tnumber: \"数值\"\r\n\t\t\t\tcurrency: \"金额\"\r\n\t\t\t\tpassword: \"密码\"\r\n\t\t\t\tlookup: \"相关表\"\r\n\t\t\t\tmaster_detail: \"主表/子表\"\r\n\t\t\t\tgrid: \"表格\"\r\n\t\t\t\turl: \"网址\"\r\n\t\t\t\temail: \"邮件地址\"\r\n\t\tsort_no:\r\n\t\t\tlabel: \"排序号\"\r\n\t\t\ttype: \"number\"\r\n\t\t\tdefaultValue: 100\r\n\t\t\tscale: 0\r\n\t\t\tsortable: true\r\n\r\n\t\tgroup:\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tdefaultValue:\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tallowedValues:\r\n\t\t\ttype: \"text\"\r\n\t\t\tmultiple: true\r\n\r\n\t\tmultiple:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\trequired:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\tis_wide:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\treadonly:\r\n\t\t\ttype: \"boolean\"\r\n\r\n#\t\tdisabled:\r\n#\t\t\ttype: \"boolean\"\r\n\t\thidden:\r\n\t\t\ttype: \"boolean\"\r\n\t\t#TODO 将此功能开放给用户时，需要关闭此属性\r\n\t\tomit:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\tindex:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\tsearchable:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\tsortable:\r\n\t\t\ttype: \"boolean\"\r\n\r\n\t\tprecision:\r\n\t\t\ttype: \"currency\"\r\n\t\t\tdefaultValue: 18\r\n\r\n\t\tscale:\r\n\t\t\ttype: \"currency\"\r\n\t\t\tdefaultValue: 2\r\n\r\n\t\treference_to: #在服务端处理此字段值，如果小于2个，则存储为字符串，否则存储为数组\r\n\t\t\ttype: \"lookup\"\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t_options = []\r\n\t\t\t\t_.forEach Creator.Objects, (o, k)->\r\n\t\t\t\t\t_options.push {label: o.label, value: k, icon: o.icon}\r\n\t\t\t\treturn _options\r\n#\t\t\tmultiple: true #先修改为单选\r\n\r\n\t\trows:\r\n\t\t\ttype: \"currency\"\r\n\r\n\t\toptions:\r\n\t\t\ttype: \"textarea\"\r\n\t\t\tis_wide: true\r\n\r\n\t\tdescription:\r\n\t\t\tlabel: \"Description\"\r\n\t\t\ttype: \"text\"\r\n\t\t\tis_wide: true\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tcolumns: [\"name\", \"label\", \"type\", \"object\", \"sort_no\", \"modified\"]\r\n\t\t\tsort: [{field_name: \"sort_no\", order: \"asc\"}]\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: false\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: true\r\n\t\t\tallowDelete: true\r\n\t\t\tallowEdit: true\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: true\r\n\t\t\tviewAllRecords: true\r\n\r\n\ttriggers:\t\t\t\t\r\n\t\t\"after.insert.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.update.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.update\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.remove.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"before.update.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.update\"\r\n\t\t\ttodo: (userId, doc, fieldNames, modifier, options)->\r\n\t\t\t\tif doc.name == 'name' && modifier?.$set?.name && doc.name != modifier.$set.name\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"不能修改此纪录的name属性\"\r\n\t\t\t\tif modifier?.$set?.name && isRepeatedName(doc, modifier.$set.name)\r\n\t\t\t\t\tconsole.log(\"update fields对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复\"\r\n\r\n\t\t\t\tif modifier?.$set?.reference_to\r\n\t\t\t\t\tif modifier.$set.reference_to.length == 1\r\n\t\t\t\t\t\t_reference_to = modifier.$set.reference_to[0]\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\t_reference_to = modifier.$set.reference_to\r\n\t\t\t\tif modifier?.$set?.index and (modifier?.$set?.type == 'textarea' or modifier?.$set?.type == 'html')\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"多行文本不支持建立索引\"\r\n\t\t\t\tobject = Creator.getCollection(\"objects\").findOne({_id: doc.object}, {fields: {name: 1, label: 1}})\r\n\r\n\t\t\t\tif object\r\n\r\n\t\t\t\t\tobject_documents = Creator.getCollection(object.name).find()\r\n\t\t\t\t\tif modifier?.$set?.reference_to && doc.reference_to != _reference_to && object_documents.count() > 0\r\n\t\t\t\t\t\tthrow new Meteor.Error 500, \"对象#{object.label}中已经有记录，不能修改reference_to字段\"\r\n\r\n\t\t\t\t\tif modifier?.$unset?.reference_to && doc.reference_to != _reference_to && object_documents.count() > 0\r\n\t\t\t\t\t\tthrow new Meteor.Error 500, \"对象#{object.label}中已经有记录，不能修改reference_to字段\"\r\n#\t\t\t\t\tif modifier?.$set?.reference_to\r\n#\t\t\t\t\t\tif modifier.$set.reference_to.length == 1\r\n#\t\t\t\t\t\t\tmodifier.$set.reference_to = modifier.$set.reference_to[0]\r\n\r\n\t\t\"before.insert.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\r\n#\t\t\t\tif doc.reference_to?.length == 1\r\n#\t\t\t\t\tdoc.reference_to = doc.reference_to[0]\r\n\r\n\t\t\t\tif isRepeatedName(doc)\r\n\t\t\t\t\tconsole.log(\"insert fields对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复\"\r\n\t\t\t\tif doc?.index and (doc?.type == 'textarea' or doc?.type == 'html')\r\n\t\t\t\t\tthrow new Meteor.Error 500,'多行文本不支持建立索引'\r\n\t\t\"before.remove.server.object_fields\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\tif doc.name == \"name\"\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"不能删除此纪录\"\r\n\r\n\r\n","var _syncToObject, isRepeatedName;\n\n_syncToObject = function(doc) {\n  var fields, object_fields, table_fields;\n  object_fields = Creator.getCollection(\"object_fields\").find({\n    space: doc.space,\n    object: doc.object\n  }, {\n    fields: {\n      created: 0,\n      modified: 0,\n      owner: 0,\n      created_by: 0,\n      modified_by: 0\n    }\n  }).fetch();\n  fields = {};\n  table_fields = {};\n  _.forEach(object_fields, function(f) {\n    var cf_arr, child_fields;\n    if (/^[a-zA-Z_]\\w*(\\.\\$\\.\\w+){1}[a-zA-Z0-9]*$/.test(f.name)) {\n      cf_arr = f.name.split(\".$.\");\n      child_fields = {};\n      child_fields[cf_arr[1]] = f;\n      if (!_.size(table_fields[cf_arr[0]])) {\n        table_fields[cf_arr[0]] = {};\n      }\n      return _.extend(table_fields[cf_arr[0]], child_fields);\n    } else {\n      return fields[f.name] = f;\n    }\n  });\n  _.each(table_fields, function(f, k) {\n    if (fields[k].type === \"grid\") {\n      if (!_.size(fields[k].fields)) {\n        fields[k].fields = {};\n      }\n      return _.extend(fields[k].fields, f);\n    }\n  });\n  return Creator.getCollection(\"objects\").update({\n    space: doc.space,\n    name: doc.object\n  }, {\n    $set: {\n      fields: fields\n    }\n  });\n};\n\nisRepeatedName = function(doc, name) {\n  var other;\n  other = Creator.getCollection(\"object_fields\").find({\n    object: doc.object,\n    space: doc.space,\n    _id: {\n      $ne: doc._id\n    },\n    name: name || doc.name\n  }, {\n    fields: {\n      _id: 1\n    }\n  });\n  if (other.count() > 0) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Objects.object_fields = {\n  name: \"object_fields\",\n  icon: \"orders\",\n  enable_api: true,\n  label: \"字段\",\n  fields: {\n    name: {\n      type: \"text\",\n      searchable: true,\n      index: true,\n      required: true,\n      regEx: SimpleSchema.RegEx.field\n    },\n    label: {\n      type: \"text\"\n    },\n    is_name: {\n      type: \"boolean\",\n      hidden: true\n    },\n    object: {\n      type: \"master_detail\",\n      reference_to: \"objects\",\n      required: true,\n      optionsFunction: function() {\n        var _options;\n        _options = [];\n        _.forEach(Creator.objectsByName, function(o, k) {\n          return _options.push({\n            label: o.label,\n            value: k,\n            icon: o.icon\n          });\n        });\n        return _options;\n      }\n    },\n    type: {\n      type: \"select\",\n      options: {\n        text: \"文本\",\n        textarea: \"长文本\",\n        html: \"Html文本\",\n        select: \"选择框\",\n        boolean: \"Checkbox\",\n        date: \"日期\",\n        datetime: \"日期时间\",\n        number: \"数值\",\n        currency: \"金额\",\n        password: \"密码\",\n        lookup: \"相关表\",\n        master_detail: \"主表/子表\",\n        grid: \"表格\",\n        url: \"网址\",\n        email: \"邮件地址\"\n      }\n    },\n    sort_no: {\n      label: \"排序号\",\n      type: \"number\",\n      defaultValue: 100,\n      scale: 0,\n      sortable: true\n    },\n    group: {\n      type: \"text\"\n    },\n    defaultValue: {\n      type: \"text\"\n    },\n    allowedValues: {\n      type: \"text\",\n      multiple: true\n    },\n    multiple: {\n      type: \"boolean\"\n    },\n    required: {\n      type: \"boolean\"\n    },\n    is_wide: {\n      type: \"boolean\"\n    },\n    readonly: {\n      type: \"boolean\"\n    },\n    hidden: {\n      type: \"boolean\"\n    },\n    omit: {\n      type: \"boolean\"\n    },\n    index: {\n      type: \"boolean\"\n    },\n    searchable: {\n      type: \"boolean\"\n    },\n    sortable: {\n      type: \"boolean\"\n    },\n    precision: {\n      type: \"currency\",\n      defaultValue: 18\n    },\n    scale: {\n      type: \"currency\",\n      defaultValue: 2\n    },\n    reference_to: {\n      type: \"lookup\",\n      optionsFunction: function() {\n        var _options;\n        _options = [];\n        _.forEach(Creator.Objects, function(o, k) {\n          return _options.push({\n            label: o.label,\n            value: k,\n            icon: o.icon\n          });\n        });\n        return _options;\n      }\n    },\n    rows: {\n      type: \"currency\"\n    },\n    options: {\n      type: \"textarea\",\n      is_wide: true\n    },\n    description: {\n      label: \"Description\",\n      type: \"text\",\n      is_wide: true\n    }\n  },\n  list_views: {\n    all: {\n      columns: [\"name\", \"label\", \"type\", \"object\", \"sort_no\", \"modified\"],\n      sort: [\n        {\n          field_name: \"sort_no\",\n          order: \"asc\"\n        }\n      ],\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: false,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: true,\n      allowDelete: true,\n      allowEdit: true,\n      allowRead: true,\n      modifyAllRecords: true,\n      viewAllRecords: true\n    }\n  },\n  triggers: {\n    \"after.insert.server.object_fields\": {\n      on: \"server\",\n      when: \"after.insert\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.update.server.object_fields\": {\n      on: \"server\",\n      when: \"after.update\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.remove.server.object_fields\": {\n      on: \"server\",\n      when: \"after.remove\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"before.update.server.object_fields\": {\n      on: \"server\",\n      when: \"before.update\",\n      todo: function(userId, doc, fieldNames, modifier, options) {\n        var _reference_to, object, object_documents, ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7;\n        if (doc.name === 'name' && (modifier != null ? (ref = modifier.$set) != null ? ref.name : void 0 : void 0) && doc.name !== modifier.$set.name) {\n          throw new Meteor.Error(500, \"不能修改此纪录的name属性\");\n        }\n        if ((modifier != null ? (ref1 = modifier.$set) != null ? ref1.name : void 0 : void 0) && isRepeatedName(doc, modifier.$set.name)) {\n          console.log(\"update fields对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\");\n        }\n        if (modifier != null ? (ref2 = modifier.$set) != null ? ref2.reference_to : void 0 : void 0) {\n          if (modifier.$set.reference_to.length === 1) {\n            _reference_to = modifier.$set.reference_to[0];\n          } else {\n            _reference_to = modifier.$set.reference_to;\n          }\n        }\n        if ((modifier != null ? (ref3 = modifier.$set) != null ? ref3.index : void 0 : void 0) && ((modifier != null ? (ref4 = modifier.$set) != null ? ref4.type : void 0 : void 0) === 'textarea' || (modifier != null ? (ref5 = modifier.$set) != null ? ref5.type : void 0 : void 0) === 'html')) {\n          throw new Meteor.Error(500, \"多行文本不支持建立索引\");\n        }\n        object = Creator.getCollection(\"objects\").findOne({\n          _id: doc.object\n        }, {\n          fields: {\n            name: 1,\n            label: 1\n          }\n        });\n        if (object) {\n          object_documents = Creator.getCollection(object.name).find();\n          if ((modifier != null ? (ref6 = modifier.$set) != null ? ref6.reference_to : void 0 : void 0) && doc.reference_to !== _reference_to && object_documents.count() > 0) {\n            throw new Meteor.Error(500, \"对象\" + object.label + \"中已经有记录，不能修改reference_to字段\");\n          }\n          if ((modifier != null ? (ref7 = modifier.$unset) != null ? ref7.reference_to : void 0 : void 0) && doc.reference_to !== _reference_to && object_documents.count() > 0) {\n            throw new Meteor.Error(500, \"对象\" + object.label + \"中已经有记录，不能修改reference_to字段\");\n          }\n        }\n      }\n    },\n    \"before.insert.server.object_fields\": {\n      on: \"server\",\n      when: \"before.insert\",\n      todo: function(userId, doc) {\n        if (isRepeatedName(doc)) {\n          console.log(\"insert fields对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\");\n        }\n        if ((doc != null ? doc.index : void 0) && ((doc != null ? doc.type : void 0) === 'textarea' || (doc != null ? doc.type : void 0) === 'html')) {\n          throw new Meteor.Error(500, '多行文本不支持建立索引');\n        }\n      }\n    },\n    \"before.remove.server.object_fields\": {\n      on: \"server\",\n      when: \"before.remove\",\n      todo: function(userId, doc) {\n        if (doc.name === \"name\") {\n          throw new Meteor.Error(500, \"不能删除此纪录\");\n        }\n      }\n    }\n  }\n};\n","_syncToObject = (doc) ->\r\n\tobject_triggers = Creator.getCollection(\"object_triggers\").find({space: doc.space, object: doc.object, is_enable: true}, {\r\n\t\tfields: {\r\n\t\t\tcreated: 0,\r\n\t\t\tmodified: 0,\r\n\t\t\towner: 0,\r\n\t\t\tcreated_by: 0,\r\n\t\t\tmodified_by: 0\r\n\t\t}\r\n\t}).fetch()\r\n\r\n\ttriggers = {}\r\n\r\n\t_.forEach object_triggers, (f)->\r\n\t\ttriggers[f.name] = f\r\n\r\n\tCreator.getCollection(\"objects\").update({space: doc.space, name: doc.object}, {\r\n\t\t$set:\r\n\t\t\ttriggers: triggers\r\n\t})\r\n\r\nisRepeatedName = (doc, name)->\r\n\tother = Creator.getCollection(\"object_triggers\").find({object: doc.object,  space: doc.space, _id: {$ne: doc._id}, name: name || doc.name}, {fields:{_id: 1}})\r\n\tif other.count() > 0\r\n\t\treturn true\r\n\treturn false\r\n\r\ncheck = (userId, doc)->\r\n\tif Steedos.isSpaceAdmin(userId, doc.space)\r\n\t\tthrow new Meteor.Error 500, \"只有工作去管理员才能配置触发器\"\r\n\r\n\t#TODO 校验关键字：remove、 drop、delete、db、collection、eval等，然后取消 企业版版限制\r\n\tif doc.on == 'server' && !Steedos.isLegalVersion(doc.space,\"workflow.enterprise\")\r\n\t\tthrow new Meteor.Error 500, \"只有企业版支持配置服务端的触发器\"\r\n\r\nCreator.Objects.object_triggers =\r\n\tname: \"object_triggers\"\r\n\ticon: \"asset_relationship\"\r\n\tlabel:\"触发器\"\r\n\tfields:\r\n\t\tname:\r\n\t\t\ttype: \"text\"\r\n\t\t\tsearchable: true\r\n\t\t\tindex: true\r\n\t\t\trequired: true\r\n\t\t\tregEx: SimpleSchema.RegEx.code\r\n\t\tlabel:\r\n\t\t\ttype: \"text\"\r\n\t\tobject:\r\n\t\t\ttype: \"master_detail\"\r\n\t\t\treference_to: \"objects\"\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t_options = []\r\n\t\t\t\t_.forEach Creator.objectsByName, (o, k)->\r\n\t\t\t\t\t_options.push {label: o.label, value: k, icon: o.icon}\r\n\t\t\t\treturn _options\r\n\t\ton:\r\n\t\t\ttype: \"lookup\"\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\treturn [{label: \"客户端\", value: \"client\", icon: \"address\"}, {label: \"服务端\", value: \"server\", icon: \"address\"}]\r\n\t\twhen:\r\n\t\t\ttype: \"lookup\"\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t[\r\n\t\t\t\t\t{label: \"新增记录之前\", value: \"before.insert\", icon: \"asset_relationship\"}\r\n\t\t\t\t\t{label: \"新增记录之后\", value: \"after.insert\", icon: \"asset_relationship\"}\r\n\t\t\t\t\t{label: \"修改记录之前\", value: \"before.update\", icon: \"asset_relationship\"}\r\n\t\t\t\t\t{label: \"修改记录之后\", value: \"after.update\", icon: \"asset_relationship\"}\r\n\t\t\t\t\t{label: \"删除记录之前\", value: \"before.remove\", icon: \"asset_relationship\"}\r\n\t\t\t\t\t{label: \"删除记录之后\", value: \"after.remove\", icon: \"asset_relationship\"}\r\n\t\t\t\t]\r\n\t\tis_enable:\r\n\t\t\ttype: \"boolean\"\r\n\t\ttodo:\r\n\t\t\ttype: \"textarea\"\r\n\t\t\trequired: true\r\n\t\t\tis_wide:true\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tcolumns: [\"name\", \"label\", \"object\", \"on\", \"when\", \"is_enable\"]\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: false\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: true\r\n\t\t\tallowDelete: true\r\n\t\t\tallowEdit: true\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: true\r\n\t\t\tviewAllRecords: true\r\n\r\n\ttriggers:\r\n\t\t\"after.insert.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.update.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.update\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.remove.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\r\n\t\t\"before.delete.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\tcheck(userId, doc)\r\n\r\n\t\t\"before.update.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.update\"\r\n\t\t\ttodo: (userId, doc, fieldNames, modifier, options)->\r\n\t\t\t\tcheck(userId, doc)\r\n\t\t\t\tif modifier?.$set?.name && isRepeatedName(doc, modifier.$set.name)\r\n\t\t\t\t\tconsole.log(\"update triggers对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复#{doc.name}\"\r\n\r\n\t\t\"before.insert.server.object_triggers\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\tcheck(userId, doc)\r\n\t\t\t\tif isRepeatedName(doc)\r\n\t\t\t\t\tconsole.log(\"insert triggers对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复\"","var _syncToObject, check, isRepeatedName;\n\n_syncToObject = function(doc) {\n  var object_triggers, triggers;\n  object_triggers = Creator.getCollection(\"object_triggers\").find({\n    space: doc.space,\n    object: doc.object,\n    is_enable: true\n  }, {\n    fields: {\n      created: 0,\n      modified: 0,\n      owner: 0,\n      created_by: 0,\n      modified_by: 0\n    }\n  }).fetch();\n  triggers = {};\n  _.forEach(object_triggers, function(f) {\n    return triggers[f.name] = f;\n  });\n  return Creator.getCollection(\"objects\").update({\n    space: doc.space,\n    name: doc.object\n  }, {\n    $set: {\n      triggers: triggers\n    }\n  });\n};\n\nisRepeatedName = function(doc, name) {\n  var other;\n  other = Creator.getCollection(\"object_triggers\").find({\n    object: doc.object,\n    space: doc.space,\n    _id: {\n      $ne: doc._id\n    },\n    name: name || doc.name\n  }, {\n    fields: {\n      _id: 1\n    }\n  });\n  if (other.count() > 0) {\n    return true;\n  }\n  return false;\n};\n\ncheck = function(userId, doc) {\n  if (Steedos.isSpaceAdmin(userId, doc.space)) {\n    throw new Meteor.Error(500, \"只有工作去管理员才能配置触发器\");\n  }\n  if (doc.on === 'server' && !Steedos.isLegalVersion(doc.space, \"workflow.enterprise\")) {\n    throw new Meteor.Error(500, \"只有企业版支持配置服务端的触发器\");\n  }\n};\n\nCreator.Objects.object_triggers = {\n  name: \"object_triggers\",\n  icon: \"asset_relationship\",\n  label: \"触发器\",\n  fields: {\n    name: {\n      type: \"text\",\n      searchable: true,\n      index: true,\n      required: true,\n      regEx: SimpleSchema.RegEx.code\n    },\n    label: {\n      type: \"text\"\n    },\n    object: {\n      type: \"master_detail\",\n      reference_to: \"objects\",\n      required: true,\n      optionsFunction: function() {\n        var _options;\n        _options = [];\n        _.forEach(Creator.objectsByName, function(o, k) {\n          return _options.push({\n            label: o.label,\n            value: k,\n            icon: o.icon\n          });\n        });\n        return _options;\n      }\n    },\n    on: {\n      type: \"lookup\",\n      required: true,\n      optionsFunction: function() {\n        return [\n          {\n            label: \"客户端\",\n            value: \"client\",\n            icon: \"address\"\n          }, {\n            label: \"服务端\",\n            value: \"server\",\n            icon: \"address\"\n          }\n        ];\n      }\n    },\n    when: {\n      type: \"lookup\",\n      required: true,\n      optionsFunction: function() {\n        return [\n          {\n            label: \"新增记录之前\",\n            value: \"before.insert\",\n            icon: \"asset_relationship\"\n          }, {\n            label: \"新增记录之后\",\n            value: \"after.insert\",\n            icon: \"asset_relationship\"\n          }, {\n            label: \"修改记录之前\",\n            value: \"before.update\",\n            icon: \"asset_relationship\"\n          }, {\n            label: \"修改记录之后\",\n            value: \"after.update\",\n            icon: \"asset_relationship\"\n          }, {\n            label: \"删除记录之前\",\n            value: \"before.remove\",\n            icon: \"asset_relationship\"\n          }, {\n            label: \"删除记录之后\",\n            value: \"after.remove\",\n            icon: \"asset_relationship\"\n          }\n        ];\n      }\n    },\n    is_enable: {\n      type: \"boolean\"\n    },\n    todo: {\n      type: \"textarea\",\n      required: true,\n      is_wide: true\n    }\n  },\n  list_views: {\n    all: {\n      columns: [\"name\", \"label\", \"object\", \"on\", \"when\", \"is_enable\"],\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: false,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: true,\n      allowDelete: true,\n      allowEdit: true,\n      allowRead: true,\n      modifyAllRecords: true,\n      viewAllRecords: true\n    }\n  },\n  triggers: {\n    \"after.insert.server.object_triggers\": {\n      on: \"server\",\n      when: \"after.insert\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.update.server.object_triggers\": {\n      on: \"server\",\n      when: \"after.update\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.remove.server.object_triggers\": {\n      on: \"server\",\n      when: \"after.remove\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"before.delete.server.object_triggers\": {\n      on: \"server\",\n      when: \"before.remove\",\n      todo: function(userId, doc) {\n        return check(userId, doc);\n      }\n    },\n    \"before.update.server.object_triggers\": {\n      on: \"server\",\n      when: \"before.update\",\n      todo: function(userId, doc, fieldNames, modifier, options) {\n        var ref;\n        check(userId, doc);\n        if ((modifier != null ? (ref = modifier.$set) != null ? ref.name : void 0 : void 0) && isRepeatedName(doc, modifier.$set.name)) {\n          console.log(\"update triggers对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\" + doc.name);\n        }\n      }\n    },\n    \"before.insert.server.object_triggers\": {\n      on: \"server\",\n      when: \"before.insert\",\n      todo: function(userId, doc) {\n        check(userId, doc);\n        if (isRepeatedName(doc)) {\n          console.log(\"insert triggers对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\");\n        }\n      }\n    }\n  }\n};\n","_syncToObject = (doc) ->\r\n\tobject_actions = Creator.getCollection(\"object_actions\").find({object: doc.object, space: doc.space, is_enable: true}, {\r\n\t\tfields: {\r\n\t\t\tcreated: 0,\r\n\t\t\tmodified: 0,\r\n\t\t\towner: 0,\r\n\t\t\tcreated_by: 0,\r\n\t\t\tmodified_by: 0\r\n\t\t}\r\n\t}).fetch()\r\n\r\n\tactions = {}\r\n\r\n\t_.forEach object_actions, (f)->\r\n\t\tactions[f.name] = f\r\n\r\n\tCreator.getCollection(\"objects\").update({space: doc.space, name: doc.object}, {\r\n\t\t$set:\r\n\t\t\tactions: actions\r\n\t})\r\nisRepeatedName = (doc, name)->\r\n\tother = Creator.getCollection(\"object_actions\").find({object: doc.object,  space: doc.space, _id: {$ne: doc._id}, name: name || doc.name}, {fields:{_id: 1}})\r\n\tif other.count() > 0\r\n\t\treturn true\r\n\treturn false\r\nCreator.Objects.object_actions =\r\n\tname: \"object_actions\"\r\n\tlabel: \"对象操作\"\r\n\ticon: \"marketing_actions\"\r\n\tfields:\r\n\t\tobject:\r\n\t\t\ttype: \"master_detail\"\r\n\t\t\treference_to: \"objects\"\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t_options = []\r\n\t\t\t\t_.forEach Creator.objectsByName, (o, k)->\r\n\t\t\t\t\t_options.push {label: o.label, value: k, icon: o.icon}\r\n\t\t\t\treturn _options\r\n\t\tname:\r\n\t\t\ttype: \"text\"\r\n\t\t\tsearchable:true\r\n\t\t\tindex:true\r\n\t\t\trequired: true\r\n\t\t\tregEx: SimpleSchema.RegEx.code\r\n\t\tlabel:\r\n\t\t\ttype: \"text\"\r\n\t\tis_enable:\r\n\t\t\ttype: \"boolean\"\r\n\t\tvisible:\r\n\t\t\ttype: \"boolean\"\r\n\t\t\tomit: true\r\n\t\ton:\r\n\t\t\ttype: \"lookup\"\r\n\t\t\tis_wide:true\r\n\t\t\trequired: true\r\n\t\t\toptionsFunction: ()->\r\n\t\t\t\t[\r\n\t\t\t\t\t{label: \"显示在列表右上角\", value: \"list\", icon: \"contact_list\"}\r\n\t\t\t\t\t{label: \"显示在记录查看页右上角\", value: \"record\", icon: \"contract\"}\r\n\t\t\t\t]\r\n\t\ttodo:\r\n\t\t\tlabel: \"执行的脚本\"\r\n\t\t\ttype: \"textarea\"\r\n\t\t\trequired: true\r\n\t\t\tis_wide:true\r\n\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tcolumns: [\"name\", \"label\", \"object\", \"on\", \"is_enable\", \"modified\"]\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: false\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: true\r\n\t\t\tallowDelete: true\r\n\t\t\tallowEdit: true\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: true\r\n\t\t\tviewAllRecords: true\r\n\r\n\ttriggers:\r\n\t\t\"after.insert.server.object_actions\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.update.server.object_actions\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.update\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\t\t\"after.remove.server.object_actions\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"after.remove\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\t_syncToObject(doc)\r\n\r\n\t\t\"before.update.server.object_actions\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.update\"\r\n\t\t\ttodo: (userId, doc, fieldNames, modifier, options)->\r\n\t\t\t\tif modifier?.$set?.name && isRepeatedName(doc, modifier.$set.name)\r\n\t\t\t\t\tconsole.log(\"update actions对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复\"\r\n\r\n\t\t\"before.insert.server.object_actions\":\r\n\t\t\ton: \"server\"\r\n\t\t\twhen: \"before.insert\"\r\n\t\t\ttodo: (userId, doc)->\r\n\t\t\t\tdoc.visible = true\r\n\t\t\t\tif isRepeatedName(doc)\r\n\t\t\t\t\tconsole.log(\"insert actions对象名称不能重复#{doc.name}\")\r\n\t\t\t\t\tthrow new Meteor.Error 500, \"对象名称不能重复#{doc.name}\"","var _syncToObject, isRepeatedName;\n\n_syncToObject = function(doc) {\n  var actions, object_actions;\n  object_actions = Creator.getCollection(\"object_actions\").find({\n    object: doc.object,\n    space: doc.space,\n    is_enable: true\n  }, {\n    fields: {\n      created: 0,\n      modified: 0,\n      owner: 0,\n      created_by: 0,\n      modified_by: 0\n    }\n  }).fetch();\n  actions = {};\n  _.forEach(object_actions, function(f) {\n    return actions[f.name] = f;\n  });\n  return Creator.getCollection(\"objects\").update({\n    space: doc.space,\n    name: doc.object\n  }, {\n    $set: {\n      actions: actions\n    }\n  });\n};\n\nisRepeatedName = function(doc, name) {\n  var other;\n  other = Creator.getCollection(\"object_actions\").find({\n    object: doc.object,\n    space: doc.space,\n    _id: {\n      $ne: doc._id\n    },\n    name: name || doc.name\n  }, {\n    fields: {\n      _id: 1\n    }\n  });\n  if (other.count() > 0) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Objects.object_actions = {\n  name: \"object_actions\",\n  label: \"对象操作\",\n  icon: \"marketing_actions\",\n  fields: {\n    object: {\n      type: \"master_detail\",\n      reference_to: \"objects\",\n      required: true,\n      optionsFunction: function() {\n        var _options;\n        _options = [];\n        _.forEach(Creator.objectsByName, function(o, k) {\n          return _options.push({\n            label: o.label,\n            value: k,\n            icon: o.icon\n          });\n        });\n        return _options;\n      }\n    },\n    name: {\n      type: \"text\",\n      searchable: true,\n      index: true,\n      required: true,\n      regEx: SimpleSchema.RegEx.code\n    },\n    label: {\n      type: \"text\"\n    },\n    is_enable: {\n      type: \"boolean\"\n    },\n    visible: {\n      type: \"boolean\",\n      omit: true\n    },\n    on: {\n      type: \"lookup\",\n      is_wide: true,\n      required: true,\n      optionsFunction: function() {\n        return [\n          {\n            label: \"显示在列表右上角\",\n            value: \"list\",\n            icon: \"contact_list\"\n          }, {\n            label: \"显示在记录查看页右上角\",\n            value: \"record\",\n            icon: \"contract\"\n          }\n        ];\n      }\n    },\n    todo: {\n      label: \"执行的脚本\",\n      type: \"textarea\",\n      required: true,\n      is_wide: true\n    }\n  },\n  list_views: {\n    all: {\n      columns: [\"name\", \"label\", \"object\", \"on\", \"is_enable\", \"modified\"],\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: false,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: true,\n      allowDelete: true,\n      allowEdit: true,\n      allowRead: true,\n      modifyAllRecords: true,\n      viewAllRecords: true\n    }\n  },\n  triggers: {\n    \"after.insert.server.object_actions\": {\n      on: \"server\",\n      when: \"after.insert\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.update.server.object_actions\": {\n      on: \"server\",\n      when: \"after.update\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"after.remove.server.object_actions\": {\n      on: \"server\",\n      when: \"after.remove\",\n      todo: function(userId, doc) {\n        return _syncToObject(doc);\n      }\n    },\n    \"before.update.server.object_actions\": {\n      on: \"server\",\n      when: \"before.update\",\n      todo: function(userId, doc, fieldNames, modifier, options) {\n        var ref;\n        if ((modifier != null ? (ref = modifier.$set) != null ? ref.name : void 0 : void 0) && isRepeatedName(doc, modifier.$set.name)) {\n          console.log(\"update actions对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\");\n        }\n      }\n    },\n    \"before.insert.server.object_actions\": {\n      on: \"server\",\n      when: \"before.insert\",\n      todo: function(userId, doc) {\n        doc.visible = true;\n        if (isRepeatedName(doc)) {\n          console.log(\"insert actions对象名称不能重复\" + doc.name);\n          throw new Meteor.Error(500, \"对象名称不能重复\" + doc.name);\n        }\n      }\n    }\n  }\n};\n"]}