{"version":3,"sources":["meteor://💻app/packages/steedos_objects-core/i18n.coffee","meteor://💻app/i18n.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs.coffee","meteor://💻app/cfs/cfs.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs_fix.coffee","meteor://💻app/cfs/cfs_fix.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs_files.coffee","meteor://💻app/cfs/cfs_files.coffee","meteor://💻app/packages/steedos_objects-core/cfs/stores.coffee","meteor://💻app/cfs/stores.coffee"],"names":["i18n","module","watch","require","v","getBrowserLocale","sprintf","t","key","parameters","locale","translator","createTranslator","__","context","_","isObject","tr","trl","setOptions","purify","defaultLocale","TAPi18n","__original","options","translated","_getLanguageFilePath","lang_tag","path","conf","cdn_path","i18n_files_route","replace","Meteor","absoluteUrl","isClient","l","window","navigator","userLanguage","language","indexOf","SimpleSchema","prototype","prefix","self","each","_schema","value","label","Template","registerHelper","args","startup","Session","set","Tracker","autorun","get","setLanguage","T9n","setLocale","moment","user","onChangeLocale","newLocale","$","extend","fn","dataTable","defaults","Tabular","tablesByName","table","columns","column","data","sTitle","collection","_name","zeroRecords","cfs","FS","HTTP","setBaseUrl","getContentType","filename","_exp","split","pop","toLowerCase","StorageAdapter","on","storeName","error","fileObj","console","Collection","Creator","Objects","name","table_name","icon","enable_search","enable_api","hidden","fields","original","type","blackbox","omit","metadata","reference_to","uploadedAt","created_by","modified_by","list_views","all","filter_scope","permission_set","allowCreate","allowDelete","allowEdit","allowRead","modifyAllRecords","viewAllRecords","admin","actions","download","visible","todo","object_name","record_id","file","fileId","length","ref","ref1","rev","url","record","isCordova","Steedos","size","cordovaDownload","location","stores","store_name","file_store","settings","store","Store","OSS","isServer","region","aliyun","internal","bucket","folder","accessKeyId","secretAccessKey","S3","aws","FileSystem","join","steedosStorageDir","fileKeyMaker","absolutePath","filenameInStore","mkdirp","month","now","pathname","year","_getInfo","Date","getFullYear","getMonth","resolve","sync","collectionName","_id","filter","allow","contentTypes","insert","update","remove","db","files","before","userId","doc"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,aAAA;AAAAC,OAAAC,KAAA,CAAAC,QAAA;AAAA,uBAAAC,CAAA;AAAAJ,WAAAI,CAAA;AAAA;AAAA;AAAA,IAAAC,gBAAA,EAAAC,OAAA;AACAA,UAAUH,QAAQ,YAAR,EAAsBG,OAAhC;AACA,KAACN,IAAD,GAAQA,IAAR;;AAEA,KAACO,CAAD,GAAK,UAACC,GAAD,EAAMC,UAAN,EAAkBC,MAAlB;AACJ,MAAAC,UAAA;;AAAA,MAAGD,WAAU,OAAb;AACCA,aAAS,OAAT;ACMC;;ADJF,MAAGA,MAAH;AACCC,iBAAaX,KAAKY,gBAAL,CAAsB,EAAtB,EAA0BF,MAA1B,CAAb;AADD;AAGCC,iBAAaX,KAAKa,EAAlB;ACMC;;ADJF,MAAAJ,cAAA,OAAGA,WAAYK,OAAf,GAAe,MAAf;AACCN,UAAMA,MAAM,GAAN,GAAYC,WAAWK,OAA7B;ACMC;;ADJF,MAAGL,cAAA,QAAgB,CAAEM,EAAEC,QAAF,CAAWP,UAAX,CAArB;AAEC,WAAOH,QAAQK,WAAWH,GAAX,CAAR,EAAyBC,UAAzB,CAAP;ACKC;;ADHF,SAAOE,WAAWH,GAAX,EAAgBC,UAAhB,CAAP;AAhBI,CAAL;;AAkBA,KAACQ,EAAD,GAAMV,CAAN;AAEA,KAACW,GAAD,GAAOX,CAAP;AAGAP,KAAKmB,UAAL,CACC;AAAAC,UAAQ,IAAR;AACAC,iBAAe;AADf,CADD;;AAIA,IAAG,OAAAC,OAAA,oBAAAA,YAAA,IAAH;AACCA,UAAQC,UAAR,GAAqBD,QAAQT,EAA7B;;AAEAS,UAAQT,EAAR,GAAa,UAACL,GAAD,EAAMgB,OAAN,EAAed,MAAf;AAEZ,QAAAe,UAAA;AAAAA,iBAAalB,EAAEC,GAAF,EAAOgB,OAAP,EAAgBd,MAAhB,CAAb;;AACA,QAAGe,eAAcjB,GAAjB;AACC,aAAOiB,UAAP;ACKE;;ADFH,WAAOH,QAAQC,UAAR,CAAmBf,GAAnB,EAAwBgB,OAAxB,EAAiCd,MAAjC,CAAP;AAPY,GAAb;;AASAY,UAAQI,oBAAR,GAA+B,UAACC,QAAD;AAE9B,QAAAC,IAAA;AAAAA,WAAU,KAAAC,IAAA,CAAAC,QAAA,WAAsB,KAAED,IAAF,CAAOC,QAA7B,GAA2C,KAAED,IAAF,CAAOE,gBAA5D;AACAH,WAAOA,KAAKI,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAP;;AACA,QAAGJ,KAAK,CAAL,MAAW,GAAd;AACCA,aAAOK,OAAOC,WAAP,GAAqBF,OAArB,CAA6B,MAA7B,EAAqC,EAArC,IAA2CJ,IAAlD;ACIE;;ADFH,WAAUA,OAAK,GAAL,GAAQD,QAAR,GAAiB,OAA3B;AAP8B,GAA/B;ACYA;;ADHD,IAAGM,OAAOE,QAAV;AACC9B,qBAAmB;AAClB,QAAA+B,CAAA,EAAA1B,MAAA;AAAA0B,QAAIC,OAAOC,SAAP,CAAiBC,YAAjB,IAAiCF,OAAOC,SAAP,CAAiBE,QAAlD,IAA8D,IAAlE;;AACA,QAAGJ,EAAEK,OAAF,CAAU,IAAV,KAAkB,CAArB;AACC/B,eAAS,OAAT;AADD;AAGCA,eAAS,OAAT;ACOE;;ADNH,WAAOA,MAAP;AANkB,GAAnB;;AASAgC,eAAaC,SAAb,CAAuB3C,IAAvB,GAA8B,UAAC4C,MAAD;AAC7B,QAAAC,IAAA;AAAAA,WAAO,IAAP;ACQE,WDPF9B,EAAE+B,IAAF,CAAOD,KAAKE,OAAZ,EAAqB,UAACC,KAAD,EAAQxC,GAAR;AACpB,UAAI,CAACwC,KAAL;AACC;ACQG;;ADPJ,UAAG,CAACH,KAAKE,OAAL,CAAavC,GAAb,EAAkByC,KAAtB;ACSK,eDRJJ,KAAKE,OAAL,CAAavC,GAAb,EAAkByC,KAAlB,GAA0B;AACzB,iBAAO1C,EAAEqC,SAAS,GAAT,GAAepC,IAAIwB,OAAJ,CAAY,KAAZ,EAAkB,GAAlB,CAAjB,CAAP;AADyB,SCQtB;AAGD;ADfL,MCOE;ADT2B,GAA9B;;AAUAkB,WAASC,cAAT,CAAwB,GAAxB,EAA6B,UAAC3C,GAAD,EAAM4C,IAAN;AAC5B,WAAO9B,QAAQT,EAAR,CAAWL,GAAX,EAAgB4C,IAAhB,CAAP;AADD;AAGAnB,SAAOoB,OAAP,CAAe;AAEdH,aAASC,cAAT,CAAwB,GAAxB,EAA6B,UAAC3C,GAAD,EAAM4C,IAAN;AAC5B,aAAO9B,QAAQT,EAAR,CAAWL,GAAX,EAAgB4C,IAAhB,CAAP;AADD;AAGAE,YAAQC,GAAR,CAAY,gBAAZ,EAA8BlD,kBAA9B;AAEAmD,YAAQC,OAAR,CAAgB;AACf,UAAGH,QAAQI,GAAR,CAAY,gBAAZ,MAAiC,OAApC;AACC,YAAG,OAAApC,OAAA,oBAAAA,YAAA,IAAH;AACCA,kBAAQqC,WAAR,CAAoB,OAApB;ACSI;;ADRLC,YAAID,WAAJ,CAAgB,OAAhB;AACA3D,aAAK6D,SAAL,CAAe,OAAf;ACUI,eDTJC,OAAOpD,MAAP,CAAc,OAAd,CCSI;ADdL;AAOC,YAAG,OAAAY,OAAA,oBAAAA,YAAA,IAAH;AACCA,kBAAQqC,WAAR,CAAoB,IAApB;ACUI;;ADTLC,YAAID,WAAJ,CAAgB,IAAhB;AACA3D,aAAK6D,SAAL,CAAe,IAAf;ACWI,eDVJC,OAAOpD,MAAP,CAAc,IAAd,CCUI;AACD;ADvBL;AAcA8C,YAAQC,OAAR,CAAgB;AACfH,cAAQC,GAAR,CAAY,gBAAZ,EAA8B,OAA9B;;AACA,UAAGtB,OAAO8B,IAAP,EAAH;AACC,YAAG9B,OAAO8B,IAAP,GAAcrD,MAAjB;ACYM,iBDXL4C,QAAQC,GAAR,CAAY,gBAAZ,EAA6BtB,OAAO8B,IAAP,GAAcrD,MAA3C,CCWK;ADbP;ACeI;ADjBL;ACmBE,WDbFV,KAAKgE,cAAL,CAAoB,UAACC,SAAD;AAEnBC,QAAEC,MAAF,CAAS,IAAT,EAAeD,EAAEE,EAAF,CAAKC,SAAL,CAAeC,QAA9B,EACC;AAAA9B,kBACC;AAAA,qBAAkBjC,EAAE,oBAAF,CAAlB;AACA,wBAAkBA,EAAE,uBAAF,CADlB;AAEA,kBAAkBA,EAAE,iBAAF,CAFlB;AAGA,uBAAkBA,EAAE,sBAAF,CAHlB;AAIA,0BAAkBA,EAAE,yBAAF,CAJlB;AAKA,yBAAkBA,EAAE,wBAAF,CALlB;AAMA,uBAAkBA,EAAE,sBAAF,CANlB;AAOA,wBAAkBA,EAAE,uBAAF,CAPlB;AAQA,4BAAkBA,EAAE,2BAAF,CARlB;AASA,wBAAkBA,EAAE,uBAAF,CATlB;AAUA,oBAAkBA,EAAE,mBAAF,CAVlB;AAWA,yBAAkBA,EAAE,wBAAF,CAXlB;AAYA,sBACC;AAAA,qBAAcA,EAAE,2BAAF,CAAd;AACA,oBAAcA,EAAE,0BAAF,CADd;AAEA,oBAAcA,EAAE,0BAAF,CAFd;AAGA,wBAAcA,EAAE,8BAAF;AAHd,WAbD;AAiBA,kBACC;AAAA,6BAAkBA,EAAE,+BAAF,CAAlB;AACA,8BAAkBA,EAAE,gCAAF;AADlB;AAlBD;AADD,OADD;ACsCG,aDfHQ,EAAE+B,IAAF,CAAOyB,QAAQC,YAAf,EAA6B,UAACC,KAAD;ACgBxB,eDfJ1D,EAAE+B,IAAF,CAAO2B,MAAMjD,OAAN,CAAckD,OAArB,EAA8B,UAACC,MAAD;AAC7B,cAAI,CAACA,OAAOC,IAAR,IAAgBD,OAAOC,IAAP,KAAe,KAAnC;AACC;ACgBK;;ADfND,iBAAOE,MAAP,GAAgBtE,EAAE,KAAKkE,MAAMK,UAAN,CAAiBC,KAAtB,GAA8B,GAA9B,GAAoCJ,OAAOC,IAAP,CAAY5C,OAAZ,CAAoB,KAApB,EAA0B,GAA1B,CAAtC,CAAhB;;AACA,cAAG,CAACyC,MAAMjD,OAAN,CAAcgB,QAAlB;AACCiC,kBAAMjD,OAAN,CAAcgB,QAAd,GAAyB,EAAzB;ACiBK;;ADhBNiC,gBAAMjD,OAAN,CAAcgB,QAAd,CAAuBwC,WAAvB,GAAqCzE,EAAE,iBAAF,IAAuBA,EAAEkE,MAAMK,UAAN,CAAiBC,KAAnB,CAA5D;AAND,UCeI;ADhBL,QCeG;ADxCJ,MCaE;ADxCH;ACiFA,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5JD,KAACE,GAAD,GAAO,EAAP;AAEAhD,OAAOoB,OAAP,CAAe;ACCb,SDAA6B,GAAGC,IAAH,CAAQC,UAAR,CAAmB,MAAnB,CCAA;ADDF;;AAOAH,IAAII,cAAJ,GAAqB,UAACC,QAAD;AACjB,MAAAC,IAAA;;AAAAA,SAAOD,SAASE,KAAT,CAAe,GAAf,EAAoBC,GAApB,GAA0BC,WAA1B,EAAP;;AACA,MAAI,MAAMH,IAAN,KAAc,KAAlB;AACE,WAAO,aAAP;AADF,SAEK,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,qBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,4BAAP;AADG,SAEA,IAAK,MAAMA,IAAN,KAAc,MAAf,IAA2B,MAAMA,IAAN,KAAc,OAA7C;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,wBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,sBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,sBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,uBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,eAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,SAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,2BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,aAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG;AAGH,WAAO,0BAAP;ACDH;AD9GkB,CAArB,C;;;;;;;;;;;;AETAL,GAAGS,cAAH,CAAkBhD,SAAlB,CAA4BiD,EAA5B,CAA+B,OAA/B,EAAwC,UAACC,SAAD,EAAYC,KAAZ,EAAmBC,OAAnB;AACtCC,UAAQF,KAAR,CAAc,8BAAd;AACAE,UAAQF,KAAR,CAAcA,KAAd;AACAE,UAAQF,KAAR,CAAcC,OAAd;ACCA,SDAAC,QAAQF,KAAR,CAAcD,SAAd,CCAA;ADJF;AAMAX,GAAGe,UAAH,CAActD,SAAd,CAAwBiD,EAAxB,CAA2B,OAA3B,EAAoC,UAACE,KAAD,EAAQC,OAAR,EAAiBF,SAAjB;AAClCG,UAAQF,KAAR,CAAc,0BAAd;AACAE,UAAQF,KAAR,CAAcA,KAAd;AACAE,UAAQF,KAAR,CAAcC,OAAd;ACEA,SDDAC,QAAQF,KAAR,CAAcD,SAAd,CCCA;ADLF,G;;;;;;;;;;;;AENAK,QAAQC,OAAR,CAAgB,sBAAhB,IACC;AAAAC,QAAM,sBAAN;AACAC,cAAY,sBADZ;AAEApD,SAAO,MAFP;AAGAqD,QAAM,QAHN;AAIAC,iBAAe,IAJf;AAKAC,cAAY,IALZ;AAMAC,UAAQ,IANR;AAOAC,UACC;AAAAC,cACC;AAAA1D,aAAM,IAAN;AACA2D,YAAM,QADN;AAEAC,gBAAU,IAFV;AAGAC,YAAM;AAHN,KADD;AAKA,qBACC;AAAA7D,aAAM,KAAN;AACA2D,YAAM;AADN,KAND;AASA,qBACC;AAAA3D,aAAM,MAAN;AACA2D,YAAM;AADN,KAVD;AAYAG,cACC;AAAA9D,aAAM,IAAN;AACA2D,YAAM,QADN;AAEAC,gBAAU,IAFV;AAGAC,YAAM;AAHN,KAbD;AAiBA,sBACC;AAAA7D,aAAM,KAAN;AACA2D,YAAM,QADN;AAEAI,oBAAc,OAFd;AAGAF,YAAM;AAHN,KAlBD;AAsBA,2BACC;AAAA7D,aAAM,KAAN;AACA2D,YAAM,MADN;AAEAE,YAAM;AAFN,KAvBD;AA0BA,uBACC;AAAA7D,aAAM,MAAN;AACA2D,YAAM,eADN;AAEAI,oBAAc,WAFd;AAGAP,cAAQ;AAHR,KA3BD;AA+BAQ,gBACC;AAAAhE,aAAM,MAAN;AACA2D,YAAM;AADN,KAhCD;AAkCAM,gBACC;AAAAT,cAAQ;AAAR,KAnCD;AAoCAU,iBACC;AAAAV,cAAQ;AAAR;AArCD,GARD;AA+CAW,cACC;AAAAC,SACC;AAAAC,oBAAc,OAAd;AACA5C,eAAS,CAAC,eAAD,EAAkB,qBAAlB,EAAyC,YAAzC,EAAuD,eAAvD;AADT;AADD,GAhDD;AAoDA6C,kBACC;AAAAxD,UACC;AAAAyD,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB,KADD;AAOAC,WACC;AAAAN,mBAAa,KAAb;AACAC,mBAAa,KADb;AAEAC,iBAAW,KAFX;AAGAC,iBAAW,IAHX;AAIAC,wBAAkB,KAJlB;AAKAC,sBAAgB;AALhB;AARD,GArDD;AAoEAE,WACC;AAAAC,cACC;AAAA/E,aAAO,IAAP;AACAgF,eAAS,IADT;AAEArC,UAAI,QAFJ;AAGAsC,YAAM,UAACC,WAAD,EAAcC,SAAd;AACL,YAAAC,IAAA,EAAAC,MAAA,EAAAhD,QAAA,EAAAiD,MAAA,EAAAC,GAAA,EAAAC,IAAA,EAAAC,GAAA,EAAAC,GAAA;AAAAN,eAAO,KAAKO,MAAZ;AACAN,iBAASF,SAAT;;AACA,YAAGE,MAAH;AACC,cAAGrG,OAAO4G,SAAV;AACCF,kBAAMG,QAAQ5G,WAAR,CAAoB,sBAAoBoG,MAAxC,CAAN;AACAhD,uBAAA+C,QAAA,QAAAG,MAAAH,KAAA1B,QAAA,YAAA6B,IAA2BpC,IAA3B,GAA2B,MAA3B,GAA2B,MAA3B;AACAsC,kBAAMJ,MAAN;AACAC,qBAAAF,QAAA,QAAAI,OAAAJ,KAAA1B,QAAA,YAAA8B,KAAyBM,IAAzB,GAAyB,MAAzB,GAAyB,MAAzB;ACcM,mBDbND,QAAQE,eAAR,CAAwBL,GAAxB,EAA6BrD,QAA7B,EAAuCoD,GAAvC,EAA4CH,MAA5C,CCaM;ADlBP;ACoBO,mBDbNlG,OAAO4G,QAAP,GAAkBH,QAAQ5G,WAAR,CAAoB,sBAAoBoG,MAApB,GAA2B,gBAA/C,CCaZ;ADrBR;ACuBK;AD7BN;AAAA;AADD;AArED,CADD,C;;;;;;;;;;;;AEAA,IAAAY,MAAA;AAAAA,SAAS,CAAC,SAAD,EAAY,QAAZ,EAAsB,QAAtB,EAAgC,QAAhC,EAA0C,OAA1C,CAAT;;AAEAnI,EAAE+B,IAAF,CAAOoG,MAAP,EAAe,UAACC,UAAD;AACXC;AAAA,MAAAA,UAAA,EAAAZ,GAAA,EAAAC,IAAA;;AACA,QAAAD,MAAAvG,OAAAoH,QAAA,WAAApE,GAAA,YAAAuD,IAA+Bc,KAA/B,GAA+B,MAA/B,MAAwC,KAAxC;AACI,QAAGrH,OAAOE,QAAV;AACIiH,mBAAa,IAAIlE,GAAGqE,KAAH,CAASC,GAAb,CAAiBL,UAAjB,CAAb;AADJ,WAEK,IAAGlH,OAAOwH,QAAV;AACDL,mBAAa,IAAIlE,GAAGqE,KAAH,CAASC,GAAb,CAAiBL,UAAjB,EACT;AAAAO,gBAAQzH,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BD,MAAnC;AACAE,kBAAU3H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BC,QADrC;AAEAC,gBAAQ5H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BE,MAFnC;AAGAC,gBAAQ7H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BG,MAHnC;AAIAC,qBAAa9H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BI,WAJxC;AAKAC,yBAAiB/H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoB0E,MAApB,CAA2BK;AAL5C,OADS,CAAb;AAJR;AAAA,SAYK,MAAAvB,OAAAxG,OAAAoH,QAAA,WAAApE,GAAA,YAAAwD,KAA+Ba,KAA/B,GAA+B,MAA/B,MAAwC,IAAxC;AACD,QAAGrH,OAAOE,QAAV;AACIiH,mBAAa,IAAIlE,GAAGqE,KAAH,CAASU,EAAb,CAAgBd,UAAhB,CAAb;AADJ,WAEK,IAAGlH,OAAOwH,QAAV;AACDL,mBAAa,IAAIlE,GAAGqE,KAAH,CAASU,EAAb,CAAgBd,UAAhB,EACT;AAAAO,gBAAQzH,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoBiF,GAApB,CAAwBR,MAAhC;AACAG,gBAAQ5H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoBiF,GAApB,CAAwBL,MADhC;AAEAC,gBAAQ7H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoBiF,GAApB,CAAwBJ,MAFhC;AAGAC,qBAAa9H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoBiF,GAApB,CAAwBH,WAHrC;AAIAC,yBAAiB/H,OAAOoH,QAAP,CAAgBpE,GAAhB,CAAoBiF,GAApB,CAAwBF;AAJzC,OADS,CAAb;AAJH;AAAA;AAWD,QAAG/H,OAAOE,QAAV;AACIiH,mBAAa,IAAIlE,GAAGqE,KAAH,CAASY,UAAb,CAAwBhB,UAAxB,CAAb;AADJ,WAEK,IAAGlH,OAAOwH,QAAV;AACDL,mBAAa,IAAIlE,GAAGqE,KAAH,CAASY,UAAb,CAAwBhB,UAAxB,EAAoC;AACzCvH,cAAMzB,QAAQ,MAAR,EAAgBiK,IAAhB,CAAqBlE,QAAQmE,iBAA7B,EAAgD,WAASlB,UAAzD,CADmC;AAEzCmB,sBAAc,UAACvE,OAAD;AAEV,cAAAwE,YAAA,EAAAjF,QAAA,EAAAkF,eAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,GAAA,EAAA/I,IAAA,EAAAgJ,QAAA,EAAAtB,KAAA,EAAAuB,IAAA;AAAAvB,kBAAQvD,WAAYA,QAAQ+E,QAAR,CAAiB3B,UAAjB,CAApB;;AAEA,cAAGG,SAAUA,MAAM9I,GAAnB;AACI,mBAAO8I,MAAM9I,GAAb;ACMjB;;ADFa8E,qBAAWS,QAAQK,IAAR,EAAX;AACAoE,4BAAkBzE,QAAQK,IAAR,CAAa;AAACkD,mBAAOH;AAAR,WAAb,CAAlB;AAEAwB,gBAAM,IAAII,IAAJ,EAAN;AACAF,iBAAOF,IAAIK,WAAJ,EAAP;AACAN,kBAAQC,IAAIM,QAAJ,KAAiB,CAAzB;AACArJ,iBAAOzB,QAAQ,MAAR,CAAP;AACAsK,mBAAStK,QAAQ,QAAR,CAAT;AACAyK,qBAAWhJ,KAAKwI,IAAL,CAAUlE,QAAQmE,iBAAlB,EAAqC,WAASlB,UAAT,GAAoB,GAApB,GAAyB0B,IAAzB,GAAgC,GAAhC,GAAsCH,KAA3E,CAAX;AAEAH,yBAAe3I,KAAKsJ,OAAL,CAAaN,QAAb,CAAf;AAEAH,iBAAOU,IAAP,CAAYZ,YAAZ;AAGA,iBAAOM,OAAO,GAAP,GAAaH,KAAb,GAAqB,GAArB,GAA2B3E,QAAQqF,cAAnC,GAAoD,GAApD,GAA0DrF,QAAQsF,GAAlE,GAAwE,GAAxE,IAA+Eb,mBAAmBlF,QAAlG,CAAP;AA1BqC;AAAA,OAApC,CAAb;AAdH;AC4CN;;ADAC,MAAG6D,eAAc,QAAjB;AACIlE,QAAIkE,UAAJ,IAAkB,IAAIjE,GAAGe,UAAP,CAAkBkD,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAkC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADJ,SAQK,IAAGrC,eAAc,QAAd,IAA0BA,eAAc,SAA3C;AACDlE,QAAIkE,UAAJ,IAAkB,IAAIjE,GAAGe,UAAP,CAAkBkD,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAkC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADC,SAQA,IAAGrC,eAAc,QAAjB;AACDlE,QAAIkE,UAAJ,IAAkB,IAAIjE,GAAGe,UAAP,CAAkBkD,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAkC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADC;AASDvG,QAAIkE,UAAJ,IAAkB,IAAIjE,GAAGe,UAAP,CAAkBkD,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD;AAAR,KADc,CAAlB;ACOL;;ADJCnE,MAAIkE,UAAJ,EAAgBoC,KAAhB,CACI;AAAAE,YAAQ;AACJ,aAAO,IAAP;AADJ;AAEAC,YAAQ;AACJ,aAAO,IAAP;AAHJ;AAIAC,YAAQ;AACJ,aAAO,IAAP;AALJ;AAMA3D,cAAU;AACN,aAAO,IAAP;AAPJ;AAAA,GADJ;;AAUA,MAAGmB,eAAc,SAAjB;AACIyC,OAAGzC,UAAH,IAAiBlE,IAAIkE,UAAJ,CAAjB;AACAyC,OAAGzC,UAAH,EAAe0C,KAAf,CAAqBC,MAArB,CAA4BL,MAA5B,CAAmC,UAACM,MAAD,EAASC,GAAT;ACUrC,aDTMA,IAAID,MAAJ,GAAaA,MCSnB;ADVE;ACYL;;ADTC,MAAG5C,eAAc,OAAjB;ACWA,WDVIyC,GAAG,SAAOzC,UAAP,GAAkB,aAArB,IAAqClE,IAAIkE,UAAJ,EAAgB0C,KCUzD;AACD;ADjHH,G","file":"/packages/steedos_objects-core.js","sourcesContent":["import i18n from 'meteor/universe:i18n';\nsprintf = require('sprintf-js').sprintf;\n@i18n = i18n;\n\n@t = (key, parameters, locale) ->\n\tif locale == \"zh-cn\"\n\t\tlocale = \"zh-CN\"\n\n\tif locale\n\t\ttranslator = i18n.createTranslator('', locale);\n\telse\n\t\ttranslator = i18n.__;\n\n\tif parameters?.context\n\t\tkey = key + \"_\" + parameters.context;\n\t\t\t\n\tif parameters? and !(_.isObject parameters)\n\t\t# 兼容老格式 key中包含 %s，只支持一个参数。\n\t\treturn sprintf(translator(key), parameters)\n\n\treturn translator(key, parameters)\n\n@tr = t\n\n@trl = t\n\n# 重写tap:i18n函数，向后兼容\ni18n.setOptions\n\tpurify: null\n\tdefaultLocale: 'zh-CN'\n\nif TAPi18n?\n\tTAPi18n.__original = TAPi18n.__\n\n\tTAPi18n.__ = (key, options, locale)->\n\n\t\ttranslated = t(key, options, locale);\t\t\n\t\tif translated != key\n\t\t\treturn translated\n\n\t\t# i18n 翻译不出来，尝试用 tap:i18n 翻译\n\t\treturn TAPi18n.__original key, options, locale\n\n\tTAPi18n._getLanguageFilePath = (lang_tag) ->\n\n\t\tpath = if @.conf.cdn_path? then @.conf.cdn_path else @.conf.i18n_files_route\n\t\tpath = path.replace /\\/$/, \"\"\n\t\tif path[0] == \"/\"\n\t\t\tpath = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path\n\n\t\treturn \"#{path}/#{lang_tag}.json\"\n\nif Meteor.isClient\n\tgetBrowserLocale = ()->\n\t\tl = window.navigator.userLanguage || window.navigator.language || 'en'\n\t\tif l.indexOf(\"zh\") >=0\n\t\t\tlocale = \"zh-cn\"\n\t\telse\n\t\t\tlocale = \"en-us\"\n\t\treturn locale\n\n\n\tSimpleSchema.prototype.i18n = (prefix) ->\n\t\tself = this\n\t\t_.each(self._schema, (value, key) ->\n\t\t\tif (!value)\n\t\t\t\treturn\n\t\t\tif !self._schema[key].label\n\t\t\t\tself._schema[key].label = ()->\n\t\t\t\t\treturn t(prefix + \"_\" + key.replace(/\\./g,\"_\"))\n\t\t)\n\n\tTemplate.registerHelper '_', (key, args)->\n\t\treturn TAPi18n.__(key, args);\n\n\tMeteor.startup ->\n\n\t\tTemplate.registerHelper '_', (key, args)->\n\t\t\treturn TAPi18n.__(key, args);\n\n\t\tSession.set(\"steedos-locale\", getBrowserLocale())\n\n\t\tTracker.autorun ()->\n\t\t\tif Session.get(\"steedos-locale\") != \"en-us\"\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"zh-CN\")\n\t\t\t\tT9n.setLanguage(\"zh-CN\")\n\t\t\t\ti18n.setLocale(\"zh-CN\")\n\t\t\t\tmoment.locale(\"zh-cn\")\n\t\t\telse\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"en\")\n\t\t\t\tT9n.setLanguage(\"en\")\n\t\t\t\ti18n.setLocale(\"en\")\n\t\t\t\tmoment.locale(\"en\")\n\n\t\tTracker.autorun ()->\n\t\t\tSession.set(\"steedos-locale\", \"zh-CN\")\n\t\t\tif Meteor.user()\n\t\t\t\tif Meteor.user().locale\n\t\t\t\t\tSession.set(\"steedos-locale\",Meteor.user().locale)\n\n\t\ti18n.onChangeLocale (newLocale)->\n\n\t\t\t$.extend true, $.fn.dataTable.defaults,\n\t\t\t\tlanguage:\n\t\t\t\t\t\"decimal\":        t(\"dataTables.decimal\"),\n\t\t\t\t\t\"emptyTable\":     t(\"dataTables.emptyTable\"),\n\t\t\t\t\t\"info\":           t(\"dataTables.info\"),\n\t\t\t\t\t\"infoEmpty\":      t(\"dataTables.infoEmpty\"),\n\t\t\t\t\t\"infoFiltered\":   t(\"dataTables.infoFiltered\"),\n\t\t\t\t\t\"infoPostFix\":    t(\"dataTables.infoPostFix\"),\n\t\t\t\t\t\"thousands\":      t(\"dataTables.thousands\"),\n\t\t\t\t\t\"lengthMenu\":     t(\"dataTables.lengthMenu\"),\n\t\t\t\t\t\"loadingRecords\": t(\"dataTables.loadingRecords\"),\n\t\t\t\t\t\"processing\":     t(\"dataTables.processing\"),\n\t\t\t\t\t\"search\":         t(\"dataTables.search\"),\n\t\t\t\t\t\"zeroRecords\":    t(\"dataTables.zeroRecords\"),\n\t\t\t\t\t\"paginate\":\n\t\t\t\t\t\t\"first\":      t(\"dataTables.paginate.first\"),\n\t\t\t\t\t\t\"last\":       t(\"dataTables.paginate.last\"),\n\t\t\t\t\t\t\"next\":       t(\"dataTables.paginate.next\"),\n\t\t\t\t\t\t\"previous\":   t(\"dataTables.paginate.previous\")\n\t\t\t\t\t\"aria\":\n\t\t\t\t\t\t\"sortAscending\":  t(\"dataTables.aria.sortAscending\"),\n\t\t\t\t\t\t\"sortDescending\": t(\"dataTables.aria.sortDescending\")\n\n\t\t\t_.each Tabular.tablesByName, (table) ->\n\t\t\t\t_.each table.options.columns, (column) ->\n\t\t\t\t\tif (!column.data || column.data == \"_id\")\n\t\t\t\t\t\treturn\n\t\t\t\t\tcolumn.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g,\"_\"));\n\t\t\t\t\tif !table.options.language\n\t\t\t\t\t\ttable.options.language = {}\n\t\t\t\t\ttable.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name)\n\t\t\t\t\treturn \n\n\n","var getBrowserLocale, sprintf;\n\nimport i18n from 'meteor/universe:i18n';\n\nsprintf = require('sprintf-js').sprintf;\n\nthis.i18n = i18n;\n\nthis.t = function(key, parameters, locale) {\n  var translator;\n  if (locale === \"zh-cn\") {\n    locale = \"zh-CN\";\n  }\n  if (locale) {\n    translator = i18n.createTranslator('', locale);\n  } else {\n    translator = i18n.__;\n  }\n  if (parameters != null ? parameters.context : void 0) {\n    key = key + \"_\" + parameters.context;\n  }\n  if ((parameters != null) && !(_.isObject(parameters))) {\n    return sprintf(translator(key), parameters);\n  }\n  return translator(key, parameters);\n};\n\nthis.tr = t;\n\nthis.trl = t;\n\ni18n.setOptions({\n  purify: null,\n  defaultLocale: 'zh-CN'\n});\n\nif (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n  TAPi18n.__original = TAPi18n.__;\n  TAPi18n.__ = function(key, options, locale) {\n    var translated;\n    translated = t(key, options, locale);\n    if (translated !== key) {\n      return translated;\n    }\n    return TAPi18n.__original(key, options, locale);\n  };\n  TAPi18n._getLanguageFilePath = function(lang_tag) {\n    var path;\n    path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n    path = path.replace(/\\/$/, \"\");\n    if (path[0] === \"/\") {\n      path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n    }\n    return path + \"/\" + lang_tag + \".json\";\n  };\n}\n\nif (Meteor.isClient) {\n  getBrowserLocale = function() {\n    var l, locale;\n    l = window.navigator.userLanguage || window.navigator.language || 'en';\n    if (l.indexOf(\"zh\") >= 0) {\n      locale = \"zh-cn\";\n    } else {\n      locale = \"en-us\";\n    }\n    return locale;\n  };\n  SimpleSchema.prototype.i18n = function(prefix) {\n    var self;\n    self = this;\n    return _.each(self._schema, function(value, key) {\n      if (!value) {\n        return;\n      }\n      if (!self._schema[key].label) {\n        return self._schema[key].label = function() {\n          return t(prefix + \"_\" + key.replace(/\\./g, \"_\"));\n        };\n      }\n    });\n  };\n  Template.registerHelper('_', function(key, args) {\n    return TAPi18n.__(key, args);\n  });\n  Meteor.startup(function() {\n    Template.registerHelper('_', function(key, args) {\n      return TAPi18n.__(key, args);\n    });\n    Session.set(\"steedos-locale\", getBrowserLocale());\n    Tracker.autorun(function() {\n      if (Session.get(\"steedos-locale\") !== \"en-us\") {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"zh-CN\");\n        }\n        T9n.setLanguage(\"zh-CN\");\n        i18n.setLocale(\"zh-CN\");\n        return moment.locale(\"zh-cn\");\n      } else {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"en\");\n        }\n        T9n.setLanguage(\"en\");\n        i18n.setLocale(\"en\");\n        return moment.locale(\"en\");\n      }\n    });\n    Tracker.autorun(function() {\n      Session.set(\"steedos-locale\", \"zh-CN\");\n      if (Meteor.user()) {\n        if (Meteor.user().locale) {\n          return Session.set(\"steedos-locale\", Meteor.user().locale);\n        }\n      }\n    });\n    return i18n.onChangeLocale(function(newLocale) {\n      $.extend(true, $.fn.dataTable.defaults, {\n        language: {\n          \"decimal\": t(\"dataTables.decimal\"),\n          \"emptyTable\": t(\"dataTables.emptyTable\"),\n          \"info\": t(\"dataTables.info\"),\n          \"infoEmpty\": t(\"dataTables.infoEmpty\"),\n          \"infoFiltered\": t(\"dataTables.infoFiltered\"),\n          \"infoPostFix\": t(\"dataTables.infoPostFix\"),\n          \"thousands\": t(\"dataTables.thousands\"),\n          \"lengthMenu\": t(\"dataTables.lengthMenu\"),\n          \"loadingRecords\": t(\"dataTables.loadingRecords\"),\n          \"processing\": t(\"dataTables.processing\"),\n          \"search\": t(\"dataTables.search\"),\n          \"zeroRecords\": t(\"dataTables.zeroRecords\"),\n          \"paginate\": {\n            \"first\": t(\"dataTables.paginate.first\"),\n            \"last\": t(\"dataTables.paginate.last\"),\n            \"next\": t(\"dataTables.paginate.next\"),\n            \"previous\": t(\"dataTables.paginate.previous\")\n          },\n          \"aria\": {\n            \"sortAscending\": t(\"dataTables.aria.sortAscending\"),\n            \"sortDescending\": t(\"dataTables.aria.sortDescending\")\n          }\n        }\n      });\n      return _.each(Tabular.tablesByName, function(table) {\n        return _.each(table.options.columns, function(column) {\n          if (!column.data || column.data === \"_id\") {\n            return;\n          }\n          column.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g, \"_\"));\n          if (!table.options.language) {\n            table.options.language = {};\n          }\n          table.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name);\n        });\n      });\n    });\n  });\n}\n","@cfs = {}\n\nMeteor.startup ->\n  FS.HTTP.setBaseUrl(\"/api\")\n\n\n# 通过文件扩展名获取文件contentType\n# http://reference.sitepoint.com/html/mime-types\n# 参照s3上传附件后的contentType\ncfs.getContentType = (filename) ->\n    _exp = filename.split('.').pop().toLowerCase()\n    if ('.' + _exp == '.au') \n      return 'audio/basic'\n    else if ('.' + _exp == '.avi') \n      return 'video/x-msvideo'\n    else if ('.' + _exp == '.bmp') \n      return 'image/bmp'\n    else if ('.' + _exp == '.bz2') \n      return 'application/x-bzip2'\n    else if ('.' + _exp == '.css') \n      return 'text/css'\n    else if ('.' + _exp == '.dtd') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.doc') \n      return 'application/msword'\n    else if ('.' + _exp == '.docx') \n      return 'application/msword'\n    else if ('.' + _exp == '.dotx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.es') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.exe') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.gif') \n      return 'image/gif'\n    else if ('.' + _exp == '.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.hqx') \n      return 'application/mac-binhex40'\n    else if ('.' + _exp == '.html') \n      return 'text/html'\n    else if ('.' + _exp == '.jar') \n      return 'application/x-java-archive'\n    else if (('.' + _exp == '.jpg') || ('.' + _exp == '.jpeg')) \n      return 'image/jpeg'\n    else if ('.' + _exp == '.js') \n      return 'application/x-javascript'\n    else if ('.' + _exp == '.jsp') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.midi') \n      return 'audio/midi'\n    else if ('.' + _exp == '.mp3') \n      return 'audio/mpeg'\n    else if ('.' + _exp == '.mpeg') \n      return 'video/mpeg'\n    else if ('.' + _exp == '.ogg') \n      return 'application/ogg'\n    else if ('.' + _exp == '.pdf') \n      return 'application/pdf'\n    else if ('.' + _exp == '.pl') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.png') \n      return 'image/png'\n    else if ('.' + _exp == '.potx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppsx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppt') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.pptx') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.ps') \n      return 'application/postscript'\n    else if ('.' + _exp == '.qt') \n      return 'video/quicktime'\n    else if ('.' + _exp == '.ra') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.ram') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.rdf') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.rtf') \n      return 'text/rtf'\n    else if ('.' + _exp == '.sgml') \n      return 'text/sgml'\n    else if ('.' + _exp == '.sit') \n      return 'application/x-stuffit'\n    else if ('.' + _exp == '.sldx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.svg') \n      return 'image/svg+xml'\n    else if ('.' + _exp == '.swf') \n      return 'application/x-shockwave-flash'\n    else if ('.' + _exp == '.tar.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.tgz') \n      return 'application/x-compressed'\n    else if ('.' + _exp == '.tiff') \n      return 'image/tiff'\n    else if ('.' + _exp == '.tsv') \n      return 'text/tab-separated-values'\n    else if ('.' + _exp == '.txt') \n      return 'text/plain'\n    else if ('.' + _exp == '.wav') \n      return 'audio/x-wav'\n    else if ('.' + _exp == '.xlam') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xls') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xlsb') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xlsx') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xltx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xml') \n      return 'text/xml'\n    else if ('.' + _exp == '.zip') \n      return 'application/zip'\n    else \n      return 'application/octet-stream'\n    \n\n\n","this.cfs = {};\n\nMeteor.startup(function() {\n  return FS.HTTP.setBaseUrl(\"/api\");\n});\n\ncfs.getContentType = function(filename) {\n  var _exp;\n  _exp = filename.split('.').pop().toLowerCase();\n  if ('.' + _exp === '.au') {\n    return 'audio/basic';\n  } else if ('.' + _exp === '.avi') {\n    return 'video/x-msvideo';\n  } else if ('.' + _exp === '.bmp') {\n    return 'image/bmp';\n  } else if ('.' + _exp === '.bz2') {\n    return 'application/x-bzip2';\n  } else if ('.' + _exp === '.css') {\n    return 'text/css';\n  } else if ('.' + _exp === '.dtd') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.doc') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.docx') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.dotx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.es') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.exe') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.gif') {\n    return 'image/gif';\n  } else if ('.' + _exp === '.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.hqx') {\n    return 'application/mac-binhex40';\n  } else if ('.' + _exp === '.html') {\n    return 'text/html';\n  } else if ('.' + _exp === '.jar') {\n    return 'application/x-java-archive';\n  } else if (('.' + _exp === '.jpg') || ('.' + _exp === '.jpeg')) {\n    return 'image/jpeg';\n  } else if ('.' + _exp === '.js') {\n    return 'application/x-javascript';\n  } else if ('.' + _exp === '.jsp') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.midi') {\n    return 'audio/midi';\n  } else if ('.' + _exp === '.mp3') {\n    return 'audio/mpeg';\n  } else if ('.' + _exp === '.mpeg') {\n    return 'video/mpeg';\n  } else if ('.' + _exp === '.ogg') {\n    return 'application/ogg';\n  } else if ('.' + _exp === '.pdf') {\n    return 'application/pdf';\n  } else if ('.' + _exp === '.pl') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.png') {\n    return 'image/png';\n  } else if ('.' + _exp === '.potx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppsx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppt') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.pptx') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.ps') {\n    return 'application/postscript';\n  } else if ('.' + _exp === '.qt') {\n    return 'video/quicktime';\n  } else if ('.' + _exp === '.ra') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.ram') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.rdf') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.rtf') {\n    return 'text/rtf';\n  } else if ('.' + _exp === '.sgml') {\n    return 'text/sgml';\n  } else if ('.' + _exp === '.sit') {\n    return 'application/x-stuffit';\n  } else if ('.' + _exp === '.sldx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.svg') {\n    return 'image/svg+xml';\n  } else if ('.' + _exp === '.swf') {\n    return 'application/x-shockwave-flash';\n  } else if ('.' + _exp === '.tar.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.tgz') {\n    return 'application/x-compressed';\n  } else if ('.' + _exp === '.tiff') {\n    return 'image/tiff';\n  } else if ('.' + _exp === '.tsv') {\n    return 'text/tab-separated-values';\n  } else if ('.' + _exp === '.txt') {\n    return 'text/plain';\n  } else if ('.' + _exp === '.wav') {\n    return 'audio/x-wav';\n  } else if ('.' + _exp === '.xlam') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xls') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xlsb') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xlsx') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xltx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xml') {\n    return 'text/xml';\n  } else if ('.' + _exp === '.zip') {\n    return 'application/zip';\n  } else {\n    return 'application/octet-stream';\n  }\n};\n","FS.StorageAdapter.prototype.on 'error', (storeName, error, fileObj)->\n  console.error(\"FS.StorageAdapter emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)\n\nFS.Collection.prototype.on 'error', (error, fileObj, storeName)->\n  console.error(\"FS.Collection emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)","FS.StorageAdapter.prototype.on('error', function(storeName, error, fileObj) {\n  console.error(\"FS.StorageAdapter emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n\nFS.Collection.prototype.on('error', function(error, fileObj, storeName) {\n  console.error(\"FS.Collection emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n","Creator.Objects[\"cfs.files.filerecord\"] = \n\tname: \"cfs.files.filerecord\"\n\ttable_name: \"cfs.files.filerecord\"\n\tlabel: \"附件版本\"\n\ticon: \"drafts\"\n\tenable_search: true\n\tenable_api: true\n\thidden: true\n\tfields:\n\t\toriginal:\n\t\t\tlabel:\"文件\"\n\t\t\ttype: \"object\"\n\t\t\tblackbox: true\n\t\t\tomit: true\n\t\t\"original.name\":\n\t\t\tlabel:\"文件名\"\n\t\t\ttype: \"text\"\n\t\t\t# is_name: true\n\t\t\"original.size\":\n\t\t\tlabel:\"文件大小\"\n\t\t\ttype: \"number\"\n\t\tmetadata:\n\t\t\tlabel:\"属性\"\n\t\t\ttype: \"object\"\n\t\t\tblackbox: true\n\t\t\tomit: true\n\t\t\"metadata.owner\":\n\t\t\tlabel:\"上传者\"\n\t\t\ttype: \"lookup\"\n\t\t\treference_to: \"users\"\n\t\t\tomit: true\n\t\t\"metadata.owner_name\":\n\t\t\tlabel:\"上传者\"\n\t\t\ttype: \"text\"\n\t\t\tomit: true\n\t\t\"metadata.parent\":\n\t\t\tlabel:\"所属文件\"\n\t\t\ttype: \"master_detail\"\n\t\t\treference_to: \"cms_files\"\n\t\t\thidden: true\n\t\tuploadedAt: \n\t\t\tlabel:\"上传时间\"\n\t\t\ttype: \"datetime\"\n\t\tcreated_by:\n\t\t\thidden: true\n\t\tmodified_by:\n\t\t\thidden: true\n\n\tlist_views:\n\t\tall:\n\t\t\tfilter_scope: \"space\"\n\t\t\tcolumns: [\"original.name\", \"metadata.owner_name\", \"uploadedAt\", \"original.size\"]\n\t\n\tpermission_set:\n\t\tuser:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: true \n\t\tadmin:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: true \n\n\tactions:\n\t\tdownload:\n\t\t\tlabel: \"下载\"\n\t\t\tvisible: true\n\t\t\ton: \"record\"\n\t\t\ttodo: (object_name, record_id)->\n\t\t\t\tfile = this.record\n\t\t\t\tfileId = record_id\n\t\t\t\tif fileId\n\t\t\t\t\tif Meteor.isCordova\n\t\t\t\t\t\turl = Steedos.absoluteUrl(\"/api/files/files/#{fileId}\")\n\t\t\t\t\t\tfilename = file?.original?.name\n\t\t\t\t\t\trev = fileId\n\t\t\t\t\t\tlength = file?.original?.size\n\t\t\t\t\t\tSteedos.cordovaDownload(url, filename, rev, length)\n\t\t\t\t\telse\n\t\t\t\t\t\twindow.location = Steedos.absoluteUrl(\"/api/files/files/#{fileId}?download=true\")","Creator.Objects[\"cfs.files.filerecord\"] = {\n  name: \"cfs.files.filerecord\",\n  table_name: \"cfs.files.filerecord\",\n  label: \"附件版本\",\n  icon: \"drafts\",\n  enable_search: true,\n  enable_api: true,\n  hidden: true,\n  fields: {\n    original: {\n      label: \"文件\",\n      type: \"object\",\n      blackbox: true,\n      omit: true\n    },\n    \"original.name\": {\n      label: \"文件名\",\n      type: \"text\"\n    },\n    \"original.size\": {\n      label: \"文件大小\",\n      type: \"number\"\n    },\n    metadata: {\n      label: \"属性\",\n      type: \"object\",\n      blackbox: true,\n      omit: true\n    },\n    \"metadata.owner\": {\n      label: \"上传者\",\n      type: \"lookup\",\n      reference_to: \"users\",\n      omit: true\n    },\n    \"metadata.owner_name\": {\n      label: \"上传者\",\n      type: \"text\",\n      omit: true\n    },\n    \"metadata.parent\": {\n      label: \"所属文件\",\n      type: \"master_detail\",\n      reference_to: \"cms_files\",\n      hidden: true\n    },\n    uploadedAt: {\n      label: \"上传时间\",\n      type: \"datetime\"\n    },\n    created_by: {\n      hidden: true\n    },\n    modified_by: {\n      hidden: true\n    }\n  },\n  list_views: {\n    all: {\n      filter_scope: \"space\",\n      columns: [\"original.name\", \"metadata.owner_name\", \"uploadedAt\", \"original.size\"]\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: true\n    },\n    admin: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: true\n    }\n  },\n  actions: {\n    download: {\n      label: \"下载\",\n      visible: true,\n      on: \"record\",\n      todo: function(object_name, record_id) {\n        var file, fileId, filename, length, ref, ref1, rev, url;\n        file = this.record;\n        fileId = record_id;\n        if (fileId) {\n          if (Meteor.isCordova) {\n            url = Steedos.absoluteUrl(\"/api/files/files/\" + fileId);\n            filename = file != null ? (ref = file.original) != null ? ref.name : void 0 : void 0;\n            rev = fileId;\n            length = file != null ? (ref1 = file.original) != null ? ref1.size : void 0 : void 0;\n            return Steedos.cordovaDownload(url, filename, rev, length);\n          } else {\n            return window.location = Steedos.absoluteUrl(\"/api/files/files/\" + fileId + \"?download=true\");\n          }\n        }\n      }\n    }\n  }\n};\n","stores = ['avatars', 'audios', 'images', 'videos', 'files']\n\n_.each stores, (store_name)->\n    file_store\n    if Meteor.settings.public.cfs?.store == \"OSS\"\n        if Meteor.isClient\n            file_store = new FS.Store.OSS(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.OSS store_name,\n                region: Meteor.settings.cfs.aliyun.region\n                internal: Meteor.settings.cfs.aliyun.internal\n                bucket: Meteor.settings.cfs.aliyun.bucket\n                folder: Meteor.settings.cfs.aliyun.folder\n                accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId\n                secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\n\n    else if Meteor.settings.public.cfs?.store == \"S3\"\n        if Meteor.isClient\n            file_store = new FS.Store.S3(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.S3 store_name,\n                region: Meteor.settings.cfs.aws.region\n                bucket: Meteor.settings.cfs.aws.bucket\n                folder: Meteor.settings.cfs.aws.folder\n                accessKeyId: Meteor.settings.cfs.aws.accessKeyId\n                secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\n    else\n        if Meteor.isClient\n            file_store = new FS.Store.FileSystem(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.FileSystem(store_name, {\n                    path: require('path').join(Creator.steedosStorageDir, \"files/#{store_name}\"),\n                    fileKeyMaker: (fileObj)->\n                        # Lookup the copy\n                        store = fileObj and fileObj._getInfo(store_name)\n                        # If the store and key is found return the key\n                        if store and store.key\n                            return store.key\n\n                        # TO CUSTOMIZE, REPLACE CODE AFTER THIS POINT\n\n                        filename = fileObj.name();\n                        filenameInStore = fileObj.name({store: store_name})\n\n                        now = new Date\n                        year = now.getFullYear()\n                        month = now.getMonth() + 1\n                        path = require('path')\n                        mkdirp = require('mkdirp')\n                        pathname = path.join(Creator.steedosStorageDir, \"files/#{store_name}/\" + year + '/' + month)\n                        # Set absolute path\n                        absolutePath = path.resolve(pathname)\n                        # Ensure the path exists\n                        mkdirp.sync(absolutePath)\n\n                        # If no store key found we resolve / generate a key\n                        return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename)\n\n                })\n\n    if store_name == 'audios'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['audio/*'] # allow only audios in this FS.Collection\n                }\n            }\n    else if store_name == 'images' || store_name == 'avatars'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['image/*'] # allow only images in this FS.Collection\n                }\n            }\n    else if store_name == 'videos'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['video/*'] # allow only videos in this FS.Collection\n                }\n            }\n    else\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store]\n\n    cfs[store_name].allow\n        insert: ->\n            return true\n        update: ->\n            return true\n        remove: ->\n            return true\n        download: ->\n            return true\n\n    if store_name == 'avatars'\n        db[store_name] = cfs[store_name]\n        db[store_name].files.before.insert (userId, doc) ->\n            doc.userId = userId\n\n    if store_name == 'files'\n        db[\"cfs.#{store_name}.filerecord\"] = cfs[store_name].files","var stores;\n\nstores = ['avatars', 'audios', 'images', 'videos', 'files'];\n\n_.each(stores, function(store_name) {\n  file_store;\n  var file_store, ref, ref1;\n  if (((ref = Meteor.settings[\"public\"].cfs) != null ? ref.store : void 0) === \"OSS\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.OSS(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.OSS(store_name, {\n        region: Meteor.settings.cfs.aliyun.region,\n        internal: Meteor.settings.cfs.aliyun.internal,\n        bucket: Meteor.settings.cfs.aliyun.bucket,\n        folder: Meteor.settings.cfs.aliyun.folder,\n        accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\n      });\n    }\n  } else if (((ref1 = Meteor.settings[\"public\"].cfs) != null ? ref1.store : void 0) === \"S3\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.S3(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.S3(store_name, {\n        region: Meteor.settings.cfs.aws.region,\n        bucket: Meteor.settings.cfs.aws.bucket,\n        folder: Meteor.settings.cfs.aws.folder,\n        accessKeyId: Meteor.settings.cfs.aws.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\n      });\n    }\n  } else {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.FileSystem(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.FileSystem(store_name, {\n        path: require('path').join(Creator.steedosStorageDir, \"files/\" + store_name),\n        fileKeyMaker: function(fileObj) {\n          var absolutePath, filename, filenameInStore, mkdirp, month, now, path, pathname, store, year;\n          store = fileObj && fileObj._getInfo(store_name);\n          if (store && store.key) {\n            return store.key;\n          }\n          filename = fileObj.name();\n          filenameInStore = fileObj.name({\n            store: store_name\n          });\n          now = new Date;\n          year = now.getFullYear();\n          month = now.getMonth() + 1;\n          path = require('path');\n          mkdirp = require('mkdirp');\n          pathname = path.join(Creator.steedosStorageDir, (\"files/\" + store_name + \"/\") + year + '/' + month);\n          absolutePath = path.resolve(pathname);\n          mkdirp.sync(absolutePath);\n          return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename);\n        }\n      });\n    }\n  }\n  if (store_name === 'audios') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['audio/*']\n        }\n      }\n    });\n  } else if (store_name === 'images' || store_name === 'avatars') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['image/*']\n        }\n      }\n    });\n  } else if (store_name === 'videos') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['video/*']\n        }\n      }\n    });\n  } else {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store]\n    });\n  }\n  cfs[store_name].allow({\n    insert: function() {\n      return true;\n    },\n    update: function() {\n      return true;\n    },\n    remove: function() {\n      return true;\n    },\n    download: function() {\n      return true;\n    }\n  });\n  if (store_name === 'avatars') {\n    db[store_name] = cfs[store_name];\n    db[store_name].files.before.insert(function(userId, doc) {\n      return doc.userId = userId;\n    });\n  }\n  if (store_name === 'files') {\n    return db[\"cfs.\" + store_name + \".filerecord\"] = cfs[store_name].files;\n  }\n});\n"]}