{"version":3,"sources":["meteor://💻app/packages/steedos_objects-core/i18n.coffee","meteor://💻app/i18n.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs.coffee","meteor://💻app/cfs/cfs.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs_fix.coffee","meteor://💻app/cfs/cfs_fix.coffee","meteor://💻app/packages/steedos_objects-core/cfs/stores.coffee","meteor://💻app/cfs/stores.coffee"],"names":["i18n","module","watch","require","v","getBrowserLocale","sprintf","t","key","parameters","locale","translator","createTranslator","__","context","_","isObject","tr","trl","setOptions","purify","defaultLocale","TAPi18n","__original","options","translated","_getLanguageFilePath","lang_tag","path","conf","cdn_path","i18n_files_route","replace","Meteor","absoluteUrl","isClient","l","window","navigator","userLanguage","language","indexOf","SimpleSchema","prototype","prefix","self","each","_schema","value","label","Template","registerHelper","args","startup","Session","set","Tracker","autorun","get","setLanguage","T9n","setLocale","moment","user","onChangeLocale","newLocale","$","extend","fn","dataTable","defaults","Tabular","tablesByName","table","columns","column","data","sTitle","collection","_name","zeroRecords","cfs","FS","HTTP","setBaseUrl","getContentType","filename","_exp","split","pop","toLowerCase","StorageAdapter","on","storeName","error","fileObj","console","Collection","stores","store_name","file_store","ref","ref1","settings","store","Store","OSS","isServer","region","aliyun","internal","bucket","folder","accessKeyId","secretAccessKey","S3","aws","FileSystem","join","Creator","steedosStorageDir","fileKeyMaker","absolutePath","filenameInStore","mkdirp","month","now","pathname","year","_getInfo","name","Date","getFullYear","getMonth","resolve","sync","collectionName","_id","filter","allow","contentTypes","insert","update","remove","download","db","files","before","userId","doc"],"mappings":"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","file":"/packages/steedos_objects-core.js","sourcesContent":["import i18n from 'meteor/universe:i18n';\nsprintf = require('sprintf-js').sprintf;\n@i18n = i18n;\n\n@t = (key, parameters, locale) ->\n\tif locale == \"zh-cn\"\n\t\tlocale = \"zh-CN\"\n\n\tif locale\n\t\ttranslator = i18n.createTranslator('', locale);\n\telse\n\t\ttranslator = i18n.__;\n\n\tif parameters?.context\n\t\tkey = key + \"_\" + parameters.context;\n\t\t\t\n\tif parameters? and !(_.isObject parameters)\n\t\t# 兼容老格式 key中包含 %s，只支持一个参数。\n\t\treturn sprintf(translator(key), parameters)\n\n\treturn translator(key, parameters)\n\n@tr = t\n\n@trl = t\n\n# 重写tap:i18n函数，向后兼容\ni18n.setOptions\n\tpurify: null\n\tdefaultLocale: 'zh-CN'\n\nif TAPi18n?\n\tTAPi18n.__original = TAPi18n.__\n\n\tTAPi18n.__ = (key, options, locale)->\n\n\t\ttranslated = t(key, options, locale);\t\t\n\t\tif translated != key\n\t\t\treturn translated\n\n\t\t# i18n 翻译不出来，尝试用 tap:i18n 翻译\n\t\treturn TAPi18n.__original key, options, locale\n\n\tTAPi18n._getLanguageFilePath = (lang_tag) ->\n\n\t\tpath = if @.conf.cdn_path? then @.conf.cdn_path else @.conf.i18n_files_route\n\t\tpath = path.replace /\\/$/, \"\"\n\t\tif path[0] == \"/\"\n\t\t\tpath = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path\n\n\t\treturn \"#{path}/#{lang_tag}.json\"\n\nif Meteor.isClient\n\tgetBrowserLocale = ()->\n\t\tl = window.navigator.userLanguage || window.navigator.language || 'en'\n\t\tif l.indexOf(\"zh\") >=0\n\t\t\tlocale = \"zh-cn\"\n\t\telse\n\t\t\tlocale = \"en-us\"\n\t\treturn locale\n\n\n\tSimpleSchema.prototype.i18n = (prefix) ->\n\t\tself = this\n\t\t_.each(self._schema, (value, key) ->\n\t\t\tif (!value)\n\t\t\t\treturn\n\t\t\tif !self._schema[key].label\n\t\t\t\tself._schema[key].label = ()->\n\t\t\t\t\treturn t(prefix + \"_\" + key.replace(/\\./g,\"_\"))\n\t\t)\n\n\tTemplate.registerHelper '_', (key, args)->\n\t\treturn TAPi18n.__(key, args);\n\n\tMeteor.startup ->\n\n\t\tTemplate.registerHelper '_', (key, args)->\n\t\t\treturn TAPi18n.__(key, args);\n\n\t\tSession.set(\"steedos-locale\", getBrowserLocale())\n\n\t\tTracker.autorun ()->\n\t\t\tif Session.get(\"steedos-locale\") != \"en-us\"\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"zh-CN\")\n\t\t\t\tT9n.setLanguage(\"zh-CN\")\n\t\t\t\ti18n.setLocale(\"zh-CN\")\n\t\t\t\tmoment.locale(\"zh-cn\")\n\t\t\telse\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"en\")\n\t\t\t\tT9n.setLanguage(\"en\")\n\t\t\t\ti18n.setLocale(\"en\")\n\t\t\t\tmoment.locale(\"en\")\n\n\t\tTracker.autorun ()->\n\t\t\tSession.set(\"steedos-locale\", \"zh-CN\")\n\t\t\tif Meteor.user()\n\t\t\t\tif Meteor.user().locale\n\t\t\t\t\tSession.set(\"steedos-locale\",Meteor.user().locale)\n\n\t\ti18n.onChangeLocale (newLocale)->\n\n\t\t\t$.extend true, $.fn.dataTable.defaults,\n\t\t\t\tlanguage:\n\t\t\t\t\t\"decimal\":        t(\"dataTables.decimal\"),\n\t\t\t\t\t\"emptyTable\":     t(\"dataTables.emptyTable\"),\n\t\t\t\t\t\"info\":           t(\"dataTables.info\"),\n\t\t\t\t\t\"infoEmpty\":      t(\"dataTables.infoEmpty\"),\n\t\t\t\t\t\"infoFiltered\":   t(\"dataTables.infoFiltered\"),\n\t\t\t\t\t\"infoPostFix\":    t(\"dataTables.infoPostFix\"),\n\t\t\t\t\t\"thousands\":      t(\"dataTables.thousands\"),\n\t\t\t\t\t\"lengthMenu\":     t(\"dataTables.lengthMenu\"),\n\t\t\t\t\t\"loadingRecords\": t(\"dataTables.loadingRecords\"),\n\t\t\t\t\t\"processing\":     t(\"dataTables.processing\"),\n\t\t\t\t\t\"search\":         t(\"dataTables.search\"),\n\t\t\t\t\t\"zeroRecords\":    t(\"dataTables.zeroRecords\"),\n\t\t\t\t\t\"paginate\":\n\t\t\t\t\t\t\"first\":      t(\"dataTables.paginate.first\"),\n\t\t\t\t\t\t\"last\":       t(\"dataTables.paginate.last\"),\n\t\t\t\t\t\t\"next\":       t(\"dataTables.paginate.next\"),\n\t\t\t\t\t\t\"previous\":   t(\"dataTables.paginate.previous\")\n\t\t\t\t\t\"aria\":\n\t\t\t\t\t\t\"sortAscending\":  t(\"dataTables.aria.sortAscending\"),\n\t\t\t\t\t\t\"sortDescending\": t(\"dataTables.aria.sortDescending\")\n\n\t\t\t_.each Tabular.tablesByName, (table) ->\n\t\t\t\t_.each table.options.columns, (column) ->\n\t\t\t\t\tif (!column.data || column.data == \"_id\")\n\t\t\t\t\t\treturn\n\t\t\t\t\tcolumn.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g,\"_\"));\n\t\t\t\t\tif !table.options.language\n\t\t\t\t\t\ttable.options.language = {}\n\t\t\t\t\ttable.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name)\n\t\t\t\t\treturn \n\n\n","var getBrowserLocale, sprintf;\n\nimport i18n from 'meteor/universe:i18n';\n\nsprintf = require('sprintf-js').sprintf;\n\nthis.i18n = i18n;\n\nthis.t = function(key, parameters, locale) {\n  var translator;\n  if (locale === \"zh-cn\") {\n    locale = \"zh-CN\";\n  }\n  if (locale) {\n    translator = i18n.createTranslator('', locale);\n  } else {\n    translator = i18n.__;\n  }\n  if (parameters != null ? parameters.context : void 0) {\n    key = key + \"_\" + parameters.context;\n  }\n  if ((parameters != null) && !(_.isObject(parameters))) {\n    return sprintf(translator(key), parameters);\n  }\n  return translator(key, parameters);\n};\n\nthis.tr = t;\n\nthis.trl = t;\n\ni18n.setOptions({\n  purify: null,\n  defaultLocale: 'zh-CN'\n});\n\nif (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n  TAPi18n.__original = TAPi18n.__;\n  TAPi18n.__ = function(key, options, locale) {\n    var translated;\n    translated = t(key, options, locale);\n    if (translated !== key) {\n      return translated;\n    }\n    return TAPi18n.__original(key, options, locale);\n  };\n  TAPi18n._getLanguageFilePath = function(lang_tag) {\n    var path;\n    path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n    path = path.replace(/\\/$/, \"\");\n    if (path[0] === \"/\") {\n      path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n    }\n    return path + \"/\" + lang_tag + \".json\";\n  };\n}\n\nif (Meteor.isClient) {\n  getBrowserLocale = function() {\n    var l, locale;\n    l = window.navigator.userLanguage || window.navigator.language || 'en';\n    if (l.indexOf(\"zh\") >= 0) {\n      locale = \"zh-cn\";\n    } else {\n      locale = \"en-us\";\n    }\n    return locale;\n  };\n  SimpleSchema.prototype.i18n = function(prefix) {\n    var self;\n    self = this;\n    return _.each(self._schema, function(value, key) {\n      if (!value) {\n        return;\n      }\n      if (!self._schema[key].label) {\n        return self._schema[key].label = function() {\n          return t(prefix + \"_\" + key.replace(/\\./g, \"_\"));\n        };\n      }\n    });\n  };\n  Template.registerHelper('_', function(key, args) {\n    return TAPi18n.__(key, args);\n  });\n  Meteor.startup(function() {\n    Template.registerHelper('_', function(key, args) {\n      return TAPi18n.__(key, args);\n    });\n    Session.set(\"steedos-locale\", getBrowserLocale());\n    Tracker.autorun(function() {\n      if (Session.get(\"steedos-locale\") !== \"en-us\") {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"zh-CN\");\n        }\n        T9n.setLanguage(\"zh-CN\");\n        i18n.setLocale(\"zh-CN\");\n        return moment.locale(\"zh-cn\");\n      } else {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"en\");\n        }\n        T9n.setLanguage(\"en\");\n        i18n.setLocale(\"en\");\n        return moment.locale(\"en\");\n      }\n    });\n    Tracker.autorun(function() {\n      Session.set(\"steedos-locale\", \"zh-CN\");\n      if (Meteor.user()) {\n        if (Meteor.user().locale) {\n          return Session.set(\"steedos-locale\", Meteor.user().locale);\n        }\n      }\n    });\n    return i18n.onChangeLocale(function(newLocale) {\n      $.extend(true, $.fn.dataTable.defaults, {\n        language: {\n          \"decimal\": t(\"dataTables.decimal\"),\n          \"emptyTable\": t(\"dataTables.emptyTable\"),\n          \"info\": t(\"dataTables.info\"),\n          \"infoEmpty\": t(\"dataTables.infoEmpty\"),\n          \"infoFiltered\": t(\"dataTables.infoFiltered\"),\n          \"infoPostFix\": t(\"dataTables.infoPostFix\"),\n          \"thousands\": t(\"dataTables.thousands\"),\n          \"lengthMenu\": t(\"dataTables.lengthMenu\"),\n          \"loadingRecords\": t(\"dataTables.loadingRecords\"),\n          \"processing\": t(\"dataTables.processing\"),\n          \"search\": t(\"dataTables.search\"),\n          \"zeroRecords\": t(\"dataTables.zeroRecords\"),\n          \"paginate\": {\n            \"first\": t(\"dataTables.paginate.first\"),\n            \"last\": t(\"dataTables.paginate.last\"),\n            \"next\": t(\"dataTables.paginate.next\"),\n            \"previous\": t(\"dataTables.paginate.previous\")\n          },\n          \"aria\": {\n            \"sortAscending\": t(\"dataTables.aria.sortAscending\"),\n            \"sortDescending\": t(\"dataTables.aria.sortDescending\")\n          }\n        }\n      });\n      return _.each(Tabular.tablesByName, function(table) {\n        return _.each(table.options.columns, function(column) {\n          if (!column.data || column.data === \"_id\") {\n            return;\n          }\n          column.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g, \"_\"));\n          if (!table.options.language) {\n            table.options.language = {};\n          }\n          table.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name);\n        });\n      });\n    });\n  });\n}\n","@cfs = {}\n\nMeteor.startup ->\n  FS.HTTP.setBaseUrl(\"/api\")\n\n\n# 通过文件扩展名获取文件contentType\n# http://reference.sitepoint.com/html/mime-types\n# 参照s3上传附件后的contentType\ncfs.getContentType = (filename) ->\n    _exp = filename.split('.').pop().toLowerCase()\n    if ('.' + _exp == '.au') \n      return 'audio/basic'\n    else if ('.' + _exp == '.avi') \n      return 'video/x-msvideo'\n    else if ('.' + _exp == '.bmp') \n      return 'image/bmp'\n    else if ('.' + _exp == '.bz2') \n      return 'application/x-bzip2'\n    else if ('.' + _exp == '.css') \n      return 'text/css'\n    else if ('.' + _exp == '.dtd') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.doc') \n      return 'application/msword'\n    else if ('.' + _exp == '.docx') \n      return 'application/msword'\n    else if ('.' + _exp == '.dotx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.es') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.exe') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.gif') \n      return 'image/gif'\n    else if ('.' + _exp == '.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.hqx') \n      return 'application/mac-binhex40'\n    else if ('.' + _exp == '.html') \n      return 'text/html'\n    else if ('.' + _exp == '.jar') \n      return 'application/x-java-archive'\n    else if (('.' + _exp == '.jpg') || ('.' + _exp == '.jpeg')) \n      return 'image/jpeg'\n    else if ('.' + _exp == '.js') \n      return 'application/x-javascript'\n    else if ('.' + _exp == '.jsp') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.midi') \n      return 'audio/midi'\n    else if ('.' + _exp == '.mp3') \n      return 'audio/mpeg'\n    else if ('.' + _exp == '.mpeg') \n      return 'video/mpeg'\n    else if ('.' + _exp == '.ogg') \n      return 'application/ogg'\n    else if ('.' + _exp == '.pdf') \n      return 'application/pdf'\n    else if ('.' + _exp == '.pl') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.png') \n      return 'image/png'\n    else if ('.' + _exp == '.potx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppsx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppt') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.pptx') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.ps') \n      return 'application/postscript'\n    else if ('.' + _exp == '.qt') \n      return 'video/quicktime'\n    else if ('.' + _exp == '.ra') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.ram') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.rdf') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.rtf') \n      return 'text/rtf'\n    else if ('.' + _exp == '.sgml') \n      return 'text/sgml'\n    else if ('.' + _exp == '.sit') \n      return 'application/x-stuffit'\n    else if ('.' + _exp == '.sldx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.svg') \n      return 'image/svg+xml'\n    else if ('.' + _exp == '.swf') \n      return 'application/x-shockwave-flash'\n    else if ('.' + _exp == '.tar.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.tgz') \n      return 'application/x-compressed'\n    else if ('.' + _exp == '.tiff') \n      return 'image/tiff'\n    else if ('.' + _exp == '.tsv') \n      return 'text/tab-separated-values'\n    else if ('.' + _exp == '.txt') \n      return 'text/plain'\n    else if ('.' + _exp == '.wav') \n      return 'audio/x-wav'\n    else if ('.' + _exp == '.xlam') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xls') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xlsb') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xlsx') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xltx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xml') \n      return 'text/xml'\n    else if ('.' + _exp == '.zip') \n      return 'application/zip'\n    else \n      return 'application/octet-stream'\n    \n\n\n","this.cfs = {};\n\nMeteor.startup(function() {\n  return FS.HTTP.setBaseUrl(\"/api\");\n});\n\ncfs.getContentType = function(filename) {\n  var _exp;\n  _exp = filename.split('.').pop().toLowerCase();\n  if ('.' + _exp === '.au') {\n    return 'audio/basic';\n  } else if ('.' + _exp === '.avi') {\n    return 'video/x-msvideo';\n  } else if ('.' + _exp === '.bmp') {\n    return 'image/bmp';\n  } else if ('.' + _exp === '.bz2') {\n    return 'application/x-bzip2';\n  } else if ('.' + _exp === '.css') {\n    return 'text/css';\n  } else if ('.' + _exp === '.dtd') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.doc') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.docx') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.dotx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.es') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.exe') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.gif') {\n    return 'image/gif';\n  } else if ('.' + _exp === '.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.hqx') {\n    return 'application/mac-binhex40';\n  } else if ('.' + _exp === '.html') {\n    return 'text/html';\n  } else if ('.' + _exp === '.jar') {\n    return 'application/x-java-archive';\n  } else if (('.' + _exp === '.jpg') || ('.' + _exp === '.jpeg')) {\n    return 'image/jpeg';\n  } else if ('.' + _exp === '.js') {\n    return 'application/x-javascript';\n  } else if ('.' + _exp === '.jsp') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.midi') {\n    return 'audio/midi';\n  } else if ('.' + _exp === '.mp3') {\n    return 'audio/mpeg';\n  } else if ('.' + _exp === '.mpeg') {\n    return 'video/mpeg';\n  } else if ('.' + _exp === '.ogg') {\n    return 'application/ogg';\n  } else if ('.' + _exp === '.pdf') {\n    return 'application/pdf';\n  } else if ('.' + _exp === '.pl') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.png') {\n    return 'image/png';\n  } else if ('.' + _exp === '.potx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppsx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppt') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.pptx') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.ps') {\n    return 'application/postscript';\n  } else if ('.' + _exp === '.qt') {\n    return 'video/quicktime';\n  } else if ('.' + _exp === '.ra') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.ram') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.rdf') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.rtf') {\n    return 'text/rtf';\n  } else if ('.' + _exp === '.sgml') {\n    return 'text/sgml';\n  } else if ('.' + _exp === '.sit') {\n    return 'application/x-stuffit';\n  } else if ('.' + _exp === '.sldx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.svg') {\n    return 'image/svg+xml';\n  } else if ('.' + _exp === '.swf') {\n    return 'application/x-shockwave-flash';\n  } else if ('.' + _exp === '.tar.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.tgz') {\n    return 'application/x-compressed';\n  } else if ('.' + _exp === '.tiff') {\n    return 'image/tiff';\n  } else if ('.' + _exp === '.tsv') {\n    return 'text/tab-separated-values';\n  } else if ('.' + _exp === '.txt') {\n    return 'text/plain';\n  } else if ('.' + _exp === '.wav') {\n    return 'audio/x-wav';\n  } else if ('.' + _exp === '.xlam') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xls') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xlsb') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xlsx') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xltx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xml') {\n    return 'text/xml';\n  } else if ('.' + _exp === '.zip') {\n    return 'application/zip';\n  } else {\n    return 'application/octet-stream';\n  }\n};\n","FS.StorageAdapter.prototype.on 'error', (storeName, error, fileObj)->\n  console.error(\"FS.StorageAdapter emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)\n\nFS.Collection.prototype.on 'error', (error, fileObj, storeName)->\n  console.error(\"FS.Collection emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)","FS.StorageAdapter.prototype.on('error', function(storeName, error, fileObj) {\n  console.error(\"FS.StorageAdapter emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n\nFS.Collection.prototype.on('error', function(error, fileObj, storeName) {\n  console.error(\"FS.Collection emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n","stores = ['avatars', 'audios', 'images', 'videos', 'files']\n\n_.each stores, (store_name)->\n    file_store\n    if Meteor.settings.public.cfs?.store == \"OSS\"\n        if Meteor.isClient\n            file_store = new FS.Store.OSS(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.OSS store_name,\n                region: Meteor.settings.cfs.aliyun.region\n                internal: Meteor.settings.cfs.aliyun.internal\n                bucket: Meteor.settings.cfs.aliyun.bucket\n                folder: Meteor.settings.cfs.aliyun.folder\n                accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId\n                secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\n\n    else if Meteor.settings.public.cfs?.store == \"S3\"\n        if Meteor.isClient\n            file_store = new FS.Store.S3(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.S3 store_name,\n                region: Meteor.settings.cfs.aws.region\n                bucket: Meteor.settings.cfs.aws.bucket\n                folder: Meteor.settings.cfs.aws.folder\n                accessKeyId: Meteor.settings.cfs.aws.accessKeyId\n                secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\n    else\n        if Meteor.isClient\n            file_store = new FS.Store.FileSystem(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.FileSystem(store_name, {\n                    path: require('path').join(Creator.steedosStorageDir, \"files/#{store_name}\"),\n                    fileKeyMaker: (fileObj)->\n                        # Lookup the copy\n                        store = fileObj and fileObj._getInfo(store_name)\n                        # If the store and key is found return the key\n                        if store and store.key\n                            return store.key\n\n                        # TO CUSTOMIZE, REPLACE CODE AFTER THIS POINT\n\n                        filename = fileObj.name();\n                        filenameInStore = fileObj.name({store: store_name})\n\n                        now = new Date\n                        year = now.getFullYear()\n                        month = now.getMonth() + 1\n                        path = require('path')\n                        mkdirp = require('mkdirp')\n                        pathname = path.join(Creator.steedosStorageDir, \"files/#{store_name}/\" + year + '/' + month)\n                        # Set absolute path\n                        absolutePath = path.resolve(pathname)\n                        # Ensure the path exists\n                        mkdirp.sync(absolutePath)\n\n                        # If no store key found we resolve / generate a key\n                        return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename)\n\n                })\n\n    if store_name == 'audios'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['audio/*'] # allow only audios in this FS.Collection\n                }\n            }\n    else if store_name == 'images' || store_name == 'avatars'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['image/*'] # allow only images in this FS.Collection\n                }\n            }\n    else if store_name == 'videos'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['video/*'] # allow only videos in this FS.Collection\n                }\n            }\n    else\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store]\n\n    cfs[store_name].allow\n        insert: ->\n            return true\n        update: ->\n            return true\n        remove: ->\n            return true\n        download: ->\n            return true\n\n    if store_name == 'avatars'\n        db[store_name] = cfs[store_name]\n        db[store_name].files.before.insert (userId, doc) ->\n            doc.userId = userId\n\n    if store_name == 'files'\n        db[\"cfs.#{store_name}.filerecord\"] = cfs[store_name].files","var stores;\n\nstores = ['avatars', 'audios', 'images', 'videos', 'files'];\n\n_.each(stores, function(store_name) {\n  file_store;\n  var file_store, ref, ref1;\n  if (((ref = Meteor.settings[\"public\"].cfs) != null ? ref.store : void 0) === \"OSS\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.OSS(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.OSS(store_name, {\n        region: Meteor.settings.cfs.aliyun.region,\n        internal: Meteor.settings.cfs.aliyun.internal,\n        bucket: Meteor.settings.cfs.aliyun.bucket,\n        folder: Meteor.settings.cfs.aliyun.folder,\n        accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\n      });\n    }\n  } else if (((ref1 = Meteor.settings[\"public\"].cfs) != null ? ref1.store : void 0) === \"S3\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.S3(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.S3(store_name, {\n        region: Meteor.settings.cfs.aws.region,\n        bucket: Meteor.settings.cfs.aws.bucket,\n        folder: Meteor.settings.cfs.aws.folder,\n        accessKeyId: Meteor.settings.cfs.aws.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\n      });\n    }\n  } else {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.FileSystem(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.FileSystem(store_name, {\n        path: require('path').join(Creator.steedosStorageDir, \"files/\" + store_name),\n        fileKeyMaker: function(fileObj) {\n          var absolutePath, filename, filenameInStore, mkdirp, month, now, path, pathname, store, year;\n          store = fileObj && fileObj._getInfo(store_name);\n          if (store && store.key) {\n            return store.key;\n          }\n          filename = fileObj.name();\n          filenameInStore = fileObj.name({\n            store: store_name\n          });\n          now = new Date;\n          year = now.getFullYear();\n          month = now.getMonth() + 1;\n          path = require('path');\n          mkdirp = require('mkdirp');\n          pathname = path.join(Creator.steedosStorageDir, (\"files/\" + store_name + \"/\") + year + '/' + month);\n          absolutePath = path.resolve(pathname);\n          mkdirp.sync(absolutePath);\n          return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename);\n        }\n      });\n    }\n  }\n  if (store_name === 'audios') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['audio/*']\n        }\n      }\n    });\n  } else if (store_name === 'images' || store_name === 'avatars') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['image/*']\n        }\n      }\n    });\n  } else if (store_name === 'videos') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['video/*']\n        }\n      }\n    });\n  } else {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store]\n    });\n  }\n  cfs[store_name].allow({\n    insert: function() {\n      return true;\n    },\n    update: function() {\n      return true;\n    },\n    remove: function() {\n      return true;\n    },\n    download: function() {\n      return true;\n    }\n  });\n  if (store_name === 'avatars') {\n    db[store_name] = cfs[store_name];\n    db[store_name].files.before.insert(function(userId, doc) {\n      return doc.userId = userId;\n    });\n  }\n  if (store_name === 'files') {\n    return db[\"cfs.\" + store_name + \".filerecord\"] = cfs[store_name].files;\n  }\n});\n"]}