{"version":3,"sources":["meteor://💻app/packages/steedos_objects-core/i18n.coffee","meteor://💻app/i18n.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs.coffee","meteor://💻app/cfs/cfs.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs_fix.coffee","meteor://💻app/cfs/cfs_fix.coffee","meteor://💻app/packages/steedos_objects-core/cfs/stores.coffee","meteor://💻app/cfs/stores.coffee"],"names":["i18n","module","watch","require","v","absoluteUrl","getBrowserLocale","sprintf","t","key","parameters","locale","translator","createTranslator","__","context","_","isObject","tr","trl","url","e","root_url","replace","Meteor","isCordova","isClient","URL","pathname","error","setOptions","purify","defaultLocale","hostUrl","TAPi18n","__original","options","translated","_getLanguageFilePath","lang_tag","path","conf","cdn_path","i18n_files_route","l","window","navigator","userLanguage","language","indexOf","SimpleSchema","prototype","prefix","Template","registerHelper","args","startup","Session","set","Tracker","autorun","get","setLanguage","T9n","setLocale","moment","user","onChangeLocale","newLocale","$","extend","fn","dataTable","defaults","each","Tabular","tablesByName","table","columns","column","data","sTitle","collection","_name","zeroRecords","cfs","FS","HTTP","setBaseUrl","getContentType","filename","_exp","split","pop","toLowerCase","StorageAdapter","on","storeName","fileObj","console","Collection","stores","store_name","file_store","ref","ref1","settings","store","Store","OSS","isServer","region","aliyun","internal","bucket","folder","accessKeyId","secretAccessKey","S3","aws","FileSystem","join","Creator","steedosStorageDir","fileKeyMaker","absolutePath","filenameInStore","mkdirp","month","now","year","_getInfo","name","Date","getFullYear","getMonth","resolve","sync","collectionName","_id","filter","allow","contentTypes","insert","update","remove","download","db","files","before","userId","doc"],"mappings":"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","file":"/packages/steedos_objects-core.js","sourcesContent":["import i18n from 'meteor/universe:i18n';\r\nsprintf = require('sprintf-js').sprintf;\r\n@i18n = i18n;\r\n\r\n@t = (key, parameters, locale) ->\r\n\tif locale == \"zh-cn\"\r\n\t\tlocale = \"zh-CN\"\r\n\r\n\tif locale\r\n\t\ttranslator = i18n.createTranslator('', locale);\r\n\telse\r\n\t\ttranslator = i18n.__;\r\n\r\n\tif parameters?.context\r\n\t\tkey = key + \"_\" + parameters.context;\r\n\t\t\t\r\n\tif parameters? and !(_.isObject parameters)\r\n\t\t# 兼容老格式 key中包含 %s，只支持一个参数。\r\n\t\treturn sprintf(translator(key), parameters)\r\n\r\n\treturn translator(key, parameters)\r\n\r\n@tr = t\r\n\r\n@trl = t\r\nabsoluteUrl = (url)->\r\n\tif url\r\n\t\t# url以\"/\"开头的话，去掉开头的\"/\"\r\n\t\turl = url.replace(/^\\//,\"\")\r\n\tif (Meteor.isCordova)\r\n\t\treturn Meteor.absoluteUrl(url);\r\n\telse\r\n\t\tif Meteor.isClient\r\n\t\t\ttry\r\n\t\t\t\troot_url = new URL(Meteor.absoluteUrl())\r\n\t\t\t\tif url\r\n\t\t\t\t\treturn root_url.pathname + url\r\n\t\t\t\telse\r\n\t\t\t\t\treturn root_url.pathname\r\n\t\t\tcatch e\r\n\t\t\t\treturn Meteor.absoluteUrl(url)\r\n\t\telse\r\n\t\t\tMeteor.absoluteUrl(url)\r\n# 重写tap:i18n函数，向后兼容\r\ni18n.setOptions\r\n\tpurify: null\r\n\tdefaultLocale: 'zh-CN'\r\n\thostUrl: absoluteUrl()\r\n\r\nif TAPi18n?\r\n\tTAPi18n.__original = TAPi18n.__\r\n\r\n\tTAPi18n.__ = (key, options, locale)->\r\n\r\n\t\ttranslated = t(key, options, locale);\t\t\r\n\t\tif translated != key\r\n\t\t\treturn translated\r\n\r\n\t\t# i18n 翻译不出来，尝试用 tap:i18n 翻译\r\n\t\treturn TAPi18n.__original key, options, locale\r\n\r\n\tTAPi18n._getLanguageFilePath = (lang_tag) ->\r\n\r\n\t\tpath = if @.conf.cdn_path? then @.conf.cdn_path else @.conf.i18n_files_route\r\n\t\tpath = path.replace /\\/$/, \"\"\r\n\t\tif path[0] == \"/\"\r\n\t\t\tpath = absoluteUrl().replace(/\\/+$/, \"\") + path\r\n\r\n\t\treturn \"#{path}/#{lang_tag}.json\"\r\n\r\nif Meteor.isClient\r\n\tgetBrowserLocale = ()->\r\n\t\tl = window.navigator.userLanguage || window.navigator.language || 'en'\r\n\t\tif l.indexOf(\"zh\") >=0\r\n\t\t\tlocale = \"zh-cn\"\r\n\t\telse\r\n\t\t\tlocale = \"en-us\"\r\n\t\treturn locale\r\n\r\n\r\n\t# 停用业务对象翻译\r\n\tSimpleSchema.prototype.i18n = (prefix) ->\r\n\t\treturn\r\n\t\t# self = this\r\n\t\t# _.each(self._schema, (value, key) ->\r\n\t\t# \tif (!value)\r\n\t\t# \t\treturn\r\n\t\t# \tif !self._schema[key].label\r\n\t\t# \t\tself._schema[key].label = ()->\r\n\t\t# \t\t\treturn t(prefix + \"_\" + key.replace(/\\./g,\"_\"))\r\n\t\t# )\r\n\r\n\tTemplate.registerHelper '_', (key, args)->\r\n\t\treturn TAPi18n.__(key, args);\r\n\r\n\tMeteor.startup ->\r\n\r\n\t\tTemplate.registerHelper '_', (key, args)->\r\n\t\t\treturn TAPi18n.__(key, args);\r\n\r\n\t\tSession.set(\"steedos-locale\", getBrowserLocale())\r\n\r\n\t\tTracker.autorun ()->\r\n\t\t\tif Session.get(\"steedos-locale\") != \"en-us\"\r\n\t\t\t\tif TAPi18n?\r\n\t\t\t\t\tTAPi18n.setLanguage(\"zh-CN\")\r\n\t\t\t\tT9n.setLanguage(\"zh-CN\")\r\n\t\t\t\ti18n.setLocale(\"zh-CN\")\r\n\t\t\t\tmoment.locale(\"zh-cn\")\r\n\t\t\telse\r\n\t\t\t\tif TAPi18n?\r\n\t\t\t\t\tTAPi18n.setLanguage(\"en\")\r\n\t\t\t\tT9n.setLanguage(\"en\")\r\n\t\t\t\ti18n.setLocale(\"en\")\r\n\t\t\t\tmoment.locale(\"en\")\r\n\r\n\t\tTracker.autorun ()->\r\n\t\t\tSession.set(\"steedos-locale\", \"zh-CN\")\r\n\t\t\tif Meteor.user()\r\n\t\t\t\tif Meteor.user().locale\r\n\t\t\t\t\tSession.set(\"steedos-locale\",Meteor.user().locale)\r\n\r\n\t\ti18n.onChangeLocale (newLocale)->\r\n\r\n\t\t\t$.extend true, $.fn.dataTable.defaults,\r\n\t\t\t\tlanguage:\r\n\t\t\t\t\t\"decimal\":        t(\"dataTables.decimal\"),\r\n\t\t\t\t\t\"emptyTable\":     t(\"dataTables.emptyTable\"),\r\n\t\t\t\t\t\"info\":           t(\"dataTables.info\"),\r\n\t\t\t\t\t\"infoEmpty\":      t(\"dataTables.infoEmpty\"),\r\n\t\t\t\t\t\"infoFiltered\":   t(\"dataTables.infoFiltered\"),\r\n\t\t\t\t\t\"infoPostFix\":    t(\"dataTables.infoPostFix\"),\r\n\t\t\t\t\t\"thousands\":      t(\"dataTables.thousands\"),\r\n\t\t\t\t\t\"lengthMenu\":     t(\"dataTables.lengthMenu\"),\r\n\t\t\t\t\t\"loadingRecords\": t(\"dataTables.loadingRecords\"),\r\n\t\t\t\t\t\"processing\":     t(\"dataTables.processing\"),\r\n\t\t\t\t\t\"search\":         t(\"dataTables.search\"),\r\n\t\t\t\t\t\"zeroRecords\":    t(\"dataTables.zeroRecords\"),\r\n\t\t\t\t\t\"paginate\":\r\n\t\t\t\t\t\t\"first\":      t(\"dataTables.paginate.first\"),\r\n\t\t\t\t\t\t\"last\":       t(\"dataTables.paginate.last\"),\r\n\t\t\t\t\t\t\"next\":       t(\"dataTables.paginate.next\"),\r\n\t\t\t\t\t\t\"previous\":   t(\"dataTables.paginate.previous\")\r\n\t\t\t\t\t\"aria\":\r\n\t\t\t\t\t\t\"sortAscending\":  t(\"dataTables.aria.sortAscending\"),\r\n\t\t\t\t\t\t\"sortDescending\": t(\"dataTables.aria.sortDescending\")\r\n\r\n\t\t\t_.each Tabular.tablesByName, (table) ->\r\n\t\t\t\t_.each table.options.columns, (column) ->\r\n\t\t\t\t\tif (!column.data || column.data == \"_id\")\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tcolumn.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g,\"_\"));\r\n\t\t\t\t\tif !table.options.language\r\n\t\t\t\t\t\ttable.options.language = {}\r\n\t\t\t\t\ttable.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name)\r\n\t\t\t\t\treturn \r\n\r\n\r\n","var absoluteUrl, getBrowserLocale, sprintf;\n\nimport i18n from 'meteor/universe:i18n';\n\nsprintf = require('sprintf-js').sprintf;\n\nthis.i18n = i18n;\n\nthis.t = function(key, parameters, locale) {\n  var translator;\n  if (locale === \"zh-cn\") {\n    locale = \"zh-CN\";\n  }\n  if (locale) {\n    translator = i18n.createTranslator('', locale);\n  } else {\n    translator = i18n.__;\n  }\n  if (parameters != null ? parameters.context : void 0) {\n    key = key + \"_\" + parameters.context;\n  }\n  if ((parameters != null) && !(_.isObject(parameters))) {\n    return sprintf(translator(key), parameters);\n  }\n  return translator(key, parameters);\n};\n\nthis.tr = t;\n\nthis.trl = t;\n\nabsoluteUrl = function(url) {\n  var e, root_url;\n  if (url) {\n    url = url.replace(/^\\//, \"\");\n  }\n  if (Meteor.isCordova) {\n    return Meteor.absoluteUrl(url);\n  } else {\n    if (Meteor.isClient) {\n      try {\n        root_url = new URL(Meteor.absoluteUrl());\n        if (url) {\n          return root_url.pathname + url;\n        } else {\n          return root_url.pathname;\n        }\n      } catch (error) {\n        e = error;\n        return Meteor.absoluteUrl(url);\n      }\n    } else {\n      return Meteor.absoluteUrl(url);\n    }\n  }\n};\n\ni18n.setOptions({\n  purify: null,\n  defaultLocale: 'zh-CN',\n  hostUrl: absoluteUrl()\n});\n\nif (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n  TAPi18n.__original = TAPi18n.__;\n  TAPi18n.__ = function(key, options, locale) {\n    var translated;\n    translated = t(key, options, locale);\n    if (translated !== key) {\n      return translated;\n    }\n    return TAPi18n.__original(key, options, locale);\n  };\n  TAPi18n._getLanguageFilePath = function(lang_tag) {\n    var path;\n    path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n    path = path.replace(/\\/$/, \"\");\n    if (path[0] === \"/\") {\n      path = absoluteUrl().replace(/\\/+$/, \"\") + path;\n    }\n    return path + \"/\" + lang_tag + \".json\";\n  };\n}\n\nif (Meteor.isClient) {\n  getBrowserLocale = function() {\n    var l, locale;\n    l = window.navigator.userLanguage || window.navigator.language || 'en';\n    if (l.indexOf(\"zh\") >= 0) {\n      locale = \"zh-cn\";\n    } else {\n      locale = \"en-us\";\n    }\n    return locale;\n  };\n  SimpleSchema.prototype.i18n = function(prefix) {};\n  Template.registerHelper('_', function(key, args) {\n    return TAPi18n.__(key, args);\n  });\n  Meteor.startup(function() {\n    Template.registerHelper('_', function(key, args) {\n      return TAPi18n.__(key, args);\n    });\n    Session.set(\"steedos-locale\", getBrowserLocale());\n    Tracker.autorun(function() {\n      if (Session.get(\"steedos-locale\") !== \"en-us\") {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"zh-CN\");\n        }\n        T9n.setLanguage(\"zh-CN\");\n        i18n.setLocale(\"zh-CN\");\n        return moment.locale(\"zh-cn\");\n      } else {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"en\");\n        }\n        T9n.setLanguage(\"en\");\n        i18n.setLocale(\"en\");\n        return moment.locale(\"en\");\n      }\n    });\n    Tracker.autorun(function() {\n      Session.set(\"steedos-locale\", \"zh-CN\");\n      if (Meteor.user()) {\n        if (Meteor.user().locale) {\n          return Session.set(\"steedos-locale\", Meteor.user().locale);\n        }\n      }\n    });\n    return i18n.onChangeLocale(function(newLocale) {\n      $.extend(true, $.fn.dataTable.defaults, {\n        language: {\n          \"decimal\": t(\"dataTables.decimal\"),\n          \"emptyTable\": t(\"dataTables.emptyTable\"),\n          \"info\": t(\"dataTables.info\"),\n          \"infoEmpty\": t(\"dataTables.infoEmpty\"),\n          \"infoFiltered\": t(\"dataTables.infoFiltered\"),\n          \"infoPostFix\": t(\"dataTables.infoPostFix\"),\n          \"thousands\": t(\"dataTables.thousands\"),\n          \"lengthMenu\": t(\"dataTables.lengthMenu\"),\n          \"loadingRecords\": t(\"dataTables.loadingRecords\"),\n          \"processing\": t(\"dataTables.processing\"),\n          \"search\": t(\"dataTables.search\"),\n          \"zeroRecords\": t(\"dataTables.zeroRecords\"),\n          \"paginate\": {\n            \"first\": t(\"dataTables.paginate.first\"),\n            \"last\": t(\"dataTables.paginate.last\"),\n            \"next\": t(\"dataTables.paginate.next\"),\n            \"previous\": t(\"dataTables.paginate.previous\")\n          },\n          \"aria\": {\n            \"sortAscending\": t(\"dataTables.aria.sortAscending\"),\n            \"sortDescending\": t(\"dataTables.aria.sortDescending\")\n          }\n        }\n      });\n      return _.each(Tabular.tablesByName, function(table) {\n        return _.each(table.options.columns, function(column) {\n          if (!column.data || column.data === \"_id\") {\n            return;\n          }\n          column.sTitle = t(\"\" + table.collection._name + \"_\" + column.data.replace(/\\./g, \"_\"));\n          if (!table.options.language) {\n            table.options.language = {};\n          }\n          table.options.language.zeroRecords = t(\"dataTables.zero\") + t(table.collection._name);\n        });\n      });\n    });\n  });\n}\n","@cfs = {}\r\n\r\nMeteor.startup ->\r\n  FS.HTTP.setBaseUrl(\"/api\")\r\n\r\n\r\n# 通过文件扩展名获取文件contentType\r\n# http://reference.sitepoint.com/html/mime-types\r\n# 参照s3上传附件后的contentType\r\ncfs.getContentType = (filename) ->\r\n    _exp = filename.split('.').pop().toLowerCase()\r\n    if ('.' + _exp == '.au') \r\n      return 'audio/basic'\r\n    else if ('.' + _exp == '.avi') \r\n      return 'video/x-msvideo'\r\n    else if ('.' + _exp == '.bmp') \r\n      return 'image/bmp'\r\n    else if ('.' + _exp == '.bz2') \r\n      return 'application/x-bzip2'\r\n    else if ('.' + _exp == '.css') \r\n      return 'text/css'\r\n    else if ('.' + _exp == '.dtd') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.doc') \r\n      return 'application/msword'\r\n    else if ('.' + _exp == '.docx') \r\n      return 'application/msword'\r\n    else if ('.' + _exp == '.dotx') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.es') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.exe') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.gif') \r\n      return 'image/gif'\r\n    else if ('.' + _exp == '.gz') \r\n      return 'application/x-gzip'\r\n    else if ('.' + _exp == '.hqx') \r\n      return 'application/mac-binhex40'\r\n    else if ('.' + _exp == '.html') \r\n      return 'text/html'\r\n    else if ('.' + _exp == '.jar') \r\n      return 'application/x-java-archive'\r\n    else if (('.' + _exp == '.jpg') || ('.' + _exp == '.jpeg')) \r\n      return 'image/jpeg'\r\n    else if ('.' + _exp == '.js') \r\n      return 'application/x-javascript'\r\n    else if ('.' + _exp == '.jsp') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.midi') \r\n      return 'audio/midi'\r\n    else if ('.' + _exp == '.mp3') \r\n      return 'audio/mpeg'\r\n    else if ('.' + _exp == '.mpeg') \r\n      return 'video/mpeg'\r\n    else if ('.' + _exp == '.ogg') \r\n      return 'application/ogg'\r\n    else if ('.' + _exp == '.pdf') \r\n      return 'application/pdf'\r\n    else if ('.' + _exp == '.pl') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.png') \r\n      return 'image/png'\r\n    else if ('.' + _exp == '.potx') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.ppsx') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.ppt') \r\n      return 'application/vnd.ms-powerpoint'\r\n    else if ('.' + _exp == '.pptx') \r\n      return 'application/vnd.ms-powerpoint'\r\n    else if ('.' + _exp == '.ps') \r\n      return 'application/postscript'\r\n    else if ('.' + _exp == '.qt') \r\n      return 'video/quicktime'\r\n    else if ('.' + _exp == '.ra') \r\n      return 'audio/x-pn-realaudio'\r\n    else if ('.' + _exp == '.ram') \r\n      return 'audio/x-pn-realaudio'\r\n    else if ('.' + _exp == '.rdf') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.rtf') \r\n      return 'text/rtf'\r\n    else if ('.' + _exp == '.sgml') \r\n      return 'text/sgml'\r\n    else if ('.' + _exp == '.sit') \r\n      return 'application/x-stuffit'\r\n    else if ('.' + _exp == '.sldx') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.svg') \r\n      return 'image/svg+xml'\r\n    else if ('.' + _exp == '.swf') \r\n      return 'application/x-shockwave-flash'\r\n    else if ('.' + _exp == '.tar.gz') \r\n      return 'application/x-gzip'\r\n    else if ('.' + _exp == '.tgz') \r\n      return 'application/x-compressed'\r\n    else if ('.' + _exp == '.tiff') \r\n      return 'image/tiff'\r\n    else if ('.' + _exp == '.tsv') \r\n      return 'text/tab-separated-values'\r\n    else if ('.' + _exp == '.txt') \r\n      return 'text/plain'\r\n    else if ('.' + _exp == '.wav') \r\n      return 'audio/x-wav'\r\n    else if ('.' + _exp == '.xlam') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.xls') \r\n      return 'application/vnd.ms-excel'\r\n    else if ('.' + _exp == '.xlsb') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.xlsx') \r\n      return 'application/vnd.ms-excel'\r\n    else if ('.' + _exp == '.xltx') \r\n      return 'application/octet-stream'\r\n    else if ('.' + _exp == '.xml') \r\n      return 'text/xml'\r\n    else if ('.' + _exp == '.zip') \r\n      return 'application/zip'\r\n    else \r\n      return 'application/octet-stream'\r\n    \r\n\r\n\r\n","this.cfs = {};\n\nMeteor.startup(function() {\n  return FS.HTTP.setBaseUrl(\"/api\");\n});\n\ncfs.getContentType = function(filename) {\n  var _exp;\n  _exp = filename.split('.').pop().toLowerCase();\n  if ('.' + _exp === '.au') {\n    return 'audio/basic';\n  } else if ('.' + _exp === '.avi') {\n    return 'video/x-msvideo';\n  } else if ('.' + _exp === '.bmp') {\n    return 'image/bmp';\n  } else if ('.' + _exp === '.bz2') {\n    return 'application/x-bzip2';\n  } else if ('.' + _exp === '.css') {\n    return 'text/css';\n  } else if ('.' + _exp === '.dtd') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.doc') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.docx') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.dotx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.es') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.exe') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.gif') {\n    return 'image/gif';\n  } else if ('.' + _exp === '.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.hqx') {\n    return 'application/mac-binhex40';\n  } else if ('.' + _exp === '.html') {\n    return 'text/html';\n  } else if ('.' + _exp === '.jar') {\n    return 'application/x-java-archive';\n  } else if (('.' + _exp === '.jpg') || ('.' + _exp === '.jpeg')) {\n    return 'image/jpeg';\n  } else if ('.' + _exp === '.js') {\n    return 'application/x-javascript';\n  } else if ('.' + _exp === '.jsp') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.midi') {\n    return 'audio/midi';\n  } else if ('.' + _exp === '.mp3') {\n    return 'audio/mpeg';\n  } else if ('.' + _exp === '.mpeg') {\n    return 'video/mpeg';\n  } else if ('.' + _exp === '.ogg') {\n    return 'application/ogg';\n  } else if ('.' + _exp === '.pdf') {\n    return 'application/pdf';\n  } else if ('.' + _exp === '.pl') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.png') {\n    return 'image/png';\n  } else if ('.' + _exp === '.potx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppsx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppt') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.pptx') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.ps') {\n    return 'application/postscript';\n  } else if ('.' + _exp === '.qt') {\n    return 'video/quicktime';\n  } else if ('.' + _exp === '.ra') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.ram') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.rdf') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.rtf') {\n    return 'text/rtf';\n  } else if ('.' + _exp === '.sgml') {\n    return 'text/sgml';\n  } else if ('.' + _exp === '.sit') {\n    return 'application/x-stuffit';\n  } else if ('.' + _exp === '.sldx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.svg') {\n    return 'image/svg+xml';\n  } else if ('.' + _exp === '.swf') {\n    return 'application/x-shockwave-flash';\n  } else if ('.' + _exp === '.tar.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.tgz') {\n    return 'application/x-compressed';\n  } else if ('.' + _exp === '.tiff') {\n    return 'image/tiff';\n  } else if ('.' + _exp === '.tsv') {\n    return 'text/tab-separated-values';\n  } else if ('.' + _exp === '.txt') {\n    return 'text/plain';\n  } else if ('.' + _exp === '.wav') {\n    return 'audio/x-wav';\n  } else if ('.' + _exp === '.xlam') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xls') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xlsb') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xlsx') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xltx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xml') {\n    return 'text/xml';\n  } else if ('.' + _exp === '.zip') {\n    return 'application/zip';\n  } else {\n    return 'application/octet-stream';\n  }\n};\n","FS.StorageAdapter.prototype.on 'error', (storeName, error, fileObj)->\r\n  console.error(\"FS.StorageAdapter emit error\")\r\n  console.error(error)\r\n  console.error(fileObj)\r\n  console.error(storeName)\r\n\r\nFS.Collection.prototype.on 'error', (error, fileObj, storeName)->\r\n  console.error(\"FS.Collection emit error\")\r\n  console.error(error)\r\n  console.error(fileObj)\r\n  console.error(storeName)","FS.StorageAdapter.prototype.on('error', function(storeName, error, fileObj) {\n  console.error(\"FS.StorageAdapter emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n\nFS.Collection.prototype.on('error', function(error, fileObj, storeName) {\n  console.error(\"FS.Collection emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n","stores = ['avatars', 'audios', 'images', 'videos', 'files']\r\n\r\n_.each stores, (store_name)->\r\n    file_store\r\n    if Meteor.settings.public.cfs?.store == \"OSS\"\r\n        if Meteor.isClient\r\n            file_store = new FS.Store.OSS(store_name)\r\n        else if Meteor.isServer\r\n            file_store = new FS.Store.OSS store_name,\r\n                region: Meteor.settings.cfs.aliyun.region\r\n                internal: Meteor.settings.cfs.aliyun.internal\r\n                bucket: Meteor.settings.cfs.aliyun.bucket\r\n                folder: Meteor.settings.cfs.aliyun.folder\r\n                accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId\r\n                secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\r\n\r\n    else if Meteor.settings.public.cfs?.store == \"S3\"\r\n        if Meteor.isClient\r\n            file_store = new FS.Store.S3(store_name)\r\n        else if Meteor.isServer\r\n            file_store = new FS.Store.S3 store_name,\r\n                region: Meteor.settings.cfs.aws.region\r\n                bucket: Meteor.settings.cfs.aws.bucket\r\n                folder: Meteor.settings.cfs.aws.folder\r\n                accessKeyId: Meteor.settings.cfs.aws.accessKeyId\r\n                secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\r\n    else\r\n        if Meteor.isClient\r\n            file_store = new FS.Store.FileSystem(store_name)\r\n        else if Meteor.isServer\r\n            file_store = new FS.Store.FileSystem(store_name, {\r\n                    path: require('path').join(Creator.steedosStorageDir, \"files/#{store_name}\"),\r\n                    fileKeyMaker: (fileObj)->\r\n                        # Lookup the copy\r\n                        store = fileObj and fileObj._getInfo(store_name)\r\n                        # If the store and key is found return the key\r\n                        if store and store.key\r\n                            return store.key\r\n\r\n                        # TO CUSTOMIZE, REPLACE CODE AFTER THIS POINT\r\n\r\n                        filename = fileObj.name();\r\n                        filenameInStore = fileObj.name({store: store_name})\r\n\r\n                        now = new Date\r\n                        year = now.getFullYear()\r\n                        month = now.getMonth() + 1\r\n                        path = require('path')\r\n                        mkdirp = require('mkdirp')\r\n                        pathname = path.join(Creator.steedosStorageDir, \"files/#{store_name}/\" + year + '/' + month)\r\n                        # Set absolute path\r\n                        absolutePath = path.resolve(pathname)\r\n                        # Ensure the path exists\r\n                        mkdirp.sync(absolutePath)\r\n\r\n                        # If no store key found we resolve / generate a key\r\n                        return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename)\r\n\r\n                })\r\n\r\n    if store_name == 'audios'\r\n        cfs[store_name] = new FS.Collection store_name,\r\n            stores: [file_store],\r\n            filter: {\r\n                allow: {\r\n                    contentTypes: ['audio/*'] # allow only audios in this FS.Collection\r\n                }\r\n            }\r\n    else if store_name == 'images' || store_name == 'avatars'\r\n        cfs[store_name] = new FS.Collection store_name,\r\n            stores: [file_store],\r\n            filter: {\r\n                allow: {\r\n                    contentTypes: ['image/*'] # allow only images in this FS.Collection\r\n                }\r\n            }\r\n    else if store_name == 'videos'\r\n        cfs[store_name] = new FS.Collection store_name,\r\n            stores: [file_store],\r\n            filter: {\r\n                allow: {\r\n                    contentTypes: ['video/*'] # allow only videos in this FS.Collection\r\n                }\r\n            }\r\n    else\r\n        cfs[store_name] = new FS.Collection store_name,\r\n            stores: [file_store]\r\n\r\n    cfs[store_name].allow\r\n        insert: ->\r\n            return true\r\n        update: ->\r\n            return true\r\n        remove: ->\r\n            return true\r\n        download: ->\r\n            return true\r\n\r\n    if store_name == 'avatars'\r\n        db[store_name] = cfs[store_name]\r\n        db[store_name].files.before.insert (userId, doc) ->\r\n            doc.userId = userId\r\n\r\n    if store_name == 'files'\r\n        db[\"cfs.#{store_name}.filerecord\"] = cfs[store_name].files","var stores;\n\nstores = ['avatars', 'audios', 'images', 'videos', 'files'];\n\n_.each(stores, function(store_name) {\n  file_store;\n  var file_store, ref, ref1;\n  if (((ref = Meteor.settings[\"public\"].cfs) != null ? ref.store : void 0) === \"OSS\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.OSS(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.OSS(store_name, {\n        region: Meteor.settings.cfs.aliyun.region,\n        internal: Meteor.settings.cfs.aliyun.internal,\n        bucket: Meteor.settings.cfs.aliyun.bucket,\n        folder: Meteor.settings.cfs.aliyun.folder,\n        accessKeyId: Meteor.settings.cfs.aliyun.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aliyun.secretAccessKey\n      });\n    }\n  } else if (((ref1 = Meteor.settings[\"public\"].cfs) != null ? ref1.store : void 0) === \"S3\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.S3(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.S3(store_name, {\n        region: Meteor.settings.cfs.aws.region,\n        bucket: Meteor.settings.cfs.aws.bucket,\n        folder: Meteor.settings.cfs.aws.folder,\n        accessKeyId: Meteor.settings.cfs.aws.accessKeyId,\n        secretAccessKey: Meteor.settings.cfs.aws.secretAccessKey\n      });\n    }\n  } else {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.FileSystem(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.FileSystem(store_name, {\n        path: require('path').join(Creator.steedosStorageDir, \"files/\" + store_name),\n        fileKeyMaker: function(fileObj) {\n          var absolutePath, filename, filenameInStore, mkdirp, month, now, path, pathname, store, year;\n          store = fileObj && fileObj._getInfo(store_name);\n          if (store && store.key) {\n            return store.key;\n          }\n          filename = fileObj.name();\n          filenameInStore = fileObj.name({\n            store: store_name\n          });\n          now = new Date;\n          year = now.getFullYear();\n          month = now.getMonth() + 1;\n          path = require('path');\n          mkdirp = require('mkdirp');\n          pathname = path.join(Creator.steedosStorageDir, (\"files/\" + store_name + \"/\") + year + '/' + month);\n          absolutePath = path.resolve(pathname);\n          mkdirp.sync(absolutePath);\n          return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename);\n        }\n      });\n    }\n  }\n  if (store_name === 'audios') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['audio/*']\n        }\n      }\n    });\n  } else if (store_name === 'images' || store_name === 'avatars') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['image/*']\n        }\n      }\n    });\n  } else if (store_name === 'videos') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['video/*']\n        }\n      }\n    });\n  } else {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store]\n    });\n  }\n  cfs[store_name].allow({\n    insert: function() {\n      return true;\n    },\n    update: function() {\n      return true;\n    },\n    remove: function() {\n      return true;\n    },\n    download: function() {\n      return true;\n    }\n  });\n  if (store_name === 'avatars') {\n    db[store_name] = cfs[store_name];\n    db[store_name].files.before.insert(function(userId, doc) {\n      return doc.userId = userId;\n    });\n  }\n  if (store_name === 'files') {\n    return db[\"cfs.\" + store_name + \".filerecord\"] = cfs[store_name].files;\n  }\n});\n"]}