{"version":3,"sources":["meteor://💻app/packages/steedos_objects/core.coffee","meteor://💻app/core.coffee","meteor://💻app/packages/steedos_objects/loadStandardObjects.coffee","meteor://💻app/loadStandardObjects.coffee","meteor://💻app/packages/steedos_objects/coreSupport.coffee","meteor://💻app/coreSupport.coffee","meteor://💻app/packages/steedos_objects/server/methods/object_options.coffee","meteor://💻app/server/methods/object_options.coffee","meteor://💻app/packages/steedos_objects/server/routes/api_workflow_view_instance.coffee","meteor://💻app/server/routes/api_workflow_view_instance.coffee","meteor://💻app/packages/steedos_objects/lib/listviews.coffee","meteor://💻app/lib/listviews.coffee","meteor://💻app/packages/steedos_objects/lib/add_simple_schema_validation_error.coffee","meteor://💻app/lib/add_simple_schema_validation_error.coffee","meteor://💻app/packages/steedos_objects/lib/field_simple_schema_validation_error.coffee","meteor://💻app/lib/field_simple_schema_validation_error.coffee","meteor://💻app/packages/steedos:objects/lib/eval.js","meteor://💻app/packages/steedos_objects/lib/convert.coffee","meteor://💻app/lib/convert.coffee","meteor://💻app/packages/steedos_objects/lib/formular.coffee","meteor://💻app/lib/formular.coffee","meteor://💻app/packages/steedos_objects/lib/object.coffee","meteor://💻app/lib/object.coffee","meteor://💻app/packages/steedos_objects/lib/fields.coffee","meteor://💻app/lib/fields.coffee","meteor://💻app/packages/steedos_objects/lib/triggers.coffee","meteor://💻app/lib/triggers.coffee","meteor://💻app/packages/steedos_objects/lib/permission_sets.coffee","meteor://💻app/lib/permission_sets.coffee","meteor://💻app/packages/steedos_objects/lib/collections.coffee","meteor://💻app/lib/collections.coffee","meteor://💻app/packages/steedos_objects/lib/actions.coffee","meteor://💻app/lib/actions.coffee"],"names":["db","Creator","Objects","Collections","Menus","Apps","Reports","subs","steedosSchema","e","steedosCore","require","Meteor","isDevelopment","startup","ex","init","error","console","log","Fiber","path","deps","app","Tracker","Dependency","object","_TEMPLATE","SimpleSchema","extendOptions","filtersFunction","Match","Optional","OneOf","Function","String","optionsFunction","createFunction","isServer","fiberLoadObjects","obj","object_name","loadObjects","run","name","list_views","space","convertObject","Object","initTriggers","initListViews","getObjectName","getObject","space_id","ref","ref1","_","isArray","isClient","depend","Session","get","startsWith","objectsByName","find","o","_collection_name","getObjectById","object_id","findWhere","_id","removeObject","getCollection","spaceId","removeCollection","isSpaceAdmin","userId","findOne","admins","indexOf","evaluateFormula","formular","context","options","isString","Formular","checkFormula","evaluateFilters","filters","selector","each","filter","action","value","length","isCommonSpace","getOrderlySetByIds","docs","ids","id_key","hit_first","values","getProperty","sortBy","doc","_index","sortingMethod","value1","value2","isValue1Empty","isValue2Empty","locale","key","Date","getTime","Steedos","toString","localeCompare","getObjectRelateds","_object","permissions","related_objects","enable_files","push","foreign_key","related_object","related_object_name","fields","related_field","related_field_name","type","reference_to","splice","enable_tasks","enable_notes","enable_events","enable_instances","enable_approvals","getPermissions","enable_audit","modifyAllRecords","getUserContext","isUnSafeMode","USER_CONTEXT","space_user_org","su","suFields","Error","mobile","position","email","company","organization","company_id","company_ids","user","fullname","getRelativeUrl","url","test","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","getUserCompanyId","getUserCompanyIds","processPermissions","po","allowCreate","allowRead","allowEdit","allowDelete","viewAllRecords","viewCompanyRecords","modifyCompanyRecords","process","env","STEEDOS_STORAGE_DIR","steedosStorageDir","resolve","join","__meteor_bootstrap__","serverDir","methods","collection","name_field_key","options_limit","query","query_options","records","results","searchTextQuery","selected","sort","params","NAME_FIELD_KEY","searchText","$regex","$or","$in","extend","$nin","filterQuery","limit","isObject","fetch","record","label","message","JSON","stringify","JsonRoutes","add","req","res","next","box","current_user_id","current_user_info","flowId","hashData","ins","insId","record_id","redirect_url","ref2","workflowUrl","x_auth_token","x_user_id","uuflowManager","check_authorization","body","check","instanceId","settings","webservices","workflow","flow","inbox_users","includes","cc_users","outbox_users","state","submitter","applicant","permissionManager","getFlowPermissions","spaces","sendResult","code","data","update","$pull","errors","errorMessage","reason","getInitWidthPercent","columns","_schema","column_num","init_width_percent","getSchema","field_name","field","is_wide","pick","autoform","getFieldIsWide","getTabularOrder","list_view_id","setting","map","column","hidden","compact","order","index","default_extra_columns","extra_columns","getObjectDefaultColumns","getObjectDefaultExtraColumns","union","getObjectDefaultSort","TabularSelectedIds","convertListView","default_columens","list_view","list_view_name","oitem","clone","has","filter_scope","parse","forEach","isFunction","_value","getRelatedList","list","getRelatedObjects","related_object_item","related","tabular_order","without","transformSortToTabular","replace","is_file","getObjectFirstListView","first","getListViews","getListView","exac","listViews","getListViewIsRecent","listView","getObjectDefaultView","defaultView","isAllView","isRecentView","tabularColumns","tabular_sort","item","column_index","transformSortToDX","dx_sort","RegEx","RegExp","_regExMessages","_globalMessages","regEx","exp","msg","messages","evalInContext","js","eval","call","getOption","option","foo","split","triggers","trigger","_todo","_todo_from_code","_todo_from_db","on","todo","actions","_visible","error1","actionsByName","visible","_options","_type","beforeOpenFunction","defaultValue","is_company_limited","_option","v","k","_regEx","Number","Boolean","_optionsFunction","_reference_to","_createFunction","_beforeOpenFunction","_filtersFunction","_defaultValue","_is_company_limited","_filters","isDate","pop","_is_date","PREFIX","_prependPrefixForFormula","prefix","fieldVariable","reg","rev","m","$1","formula_str","_CONTEXT","_VALUES","isBoolean","toastr","formatObjectName","_db","defaultColumns","defaultListViewId","disabled_list_views","ref3","schema","self","icon","description","is_view","is_enable","enable_search","enable_api","custom","enable_share","enable_tree","open_window","filter_company","calendar","sidebar","enable_chatter","enable_trash","enable_space_global","idFieldName","database_name","is_name","primary","baseObject","item_name","copyItem","permission_set","admin","all","list_view_item","ReactiveVar","unreadable_fields","uneditable_fields","readonly","disabled","required","createCollection","_name","getObjectSchema","contains","attachSchema","_simpleSchema","prototype","i18n","t","fkey","i18n_key","getObjectODataRouterPrefix","autorun","bootstrapLoaded","fieldsArr","_ref_obj","autoform_type","fs","isUnLimited","multiple","rows","language","isMobile","isPad","afFieldInput","dateMobileOptions","outFormat","timezoneId","dxDateBoxOptions","displayFormat","height","dialogsInBody","toolbar","fontNames","dependOn","depend_on","create","lookup_field","Modal","show","formId","operation","onSuccess","result","addItems","reference_sort","optionsSort","reference_limit","optionsLimit","omit","include","blackbox","objectSwitche","optionsMethod","optionsMethodParams","references","_reference","link","defaultIcon","showIcon","firstOption","precision","scale","decimal","Array","editable","accept","system","Email","allowedValues","optional","unique","group","filterable","searchable","inlineHelpText","isProduction","sortable","getFieldDisplayValue","field_value","html","moment","val","format","checkFieldTypeSupportBetweenQuery","field_type","pushBetweenBuiltinOptionals","operations","builtinValues","getBetweenBuiltinValues","builtinItem","is_check_only","getBetweenTimeBuiltinValues","getBetweenBuiltinValueItem","getBetweenTimeBuiltinValueItem","getBetweenBuiltinOperation","betweenBuiltinValues","getQuarterStartMonth","month","getMonth","getLastQuarterFirstDay","year","getFullYear","getNextQuarterFirstDay","getMonthDays","days","endDate","millisecond","startDate","getLastMonthFirstDay","currentMonth","currentYear","endValue","firstDay","lastDay","lastMonday","lastMonthFinalDay","lastMonthFirstDay","lastQuarterEndDay","lastQuarterStartDay","lastSunday","last_120_days","last_30_days","last_60_days","last_7_days","last_90_days","minusDay","monday","nextMonday","nextMonthFinalDay","nextMonthFirstDay","nextQuarterEndDay","nextQuarterStartDay","nextSunday","nextYear","next_120_days","next_30_days","next_60_days","next_7_days","next_90_days","now","previousYear","startValue","strEndDay","strFirstDay","strLastDay","strMonday","strStartDay","strSunday","strToday","strTomorrow","strYestday","sunday","thisQuarterEndDay","thisQuarterStartDay","tomorrow","week","yestday","getDay","fv","setHours","getHours","getTimezoneOffset","getFieldDefaultOperation","getFieldOperation","optionals","equal","unequal","less_than","greater_than","less_or_equal","greater_or_equal","not_contain","starts_with","between","getObjectFieldsName","fieldsName","sort_no","cleanTrigger","initTrigger","_trigger_hooks","todoWrapper","apply","arguments","when","before","insert","remove","after","reverse","_hook","trigger_name","_trigger_hook","findOne_permission_object","find_permission_object","unionPlus","getObjectPermissions","getRecordPermissions","isOwner","record_company_id","user_company_ids","owner","locked","getAllPermissions","_i","isOrganizationAdmin","isWorkflowAdmin","psets","psetsAdmin","psetsAdmin_pos","psetsCurrent","psetsCurrentNames","psetsCurrent_pos","psetsGuest","psetsGuest_pos","psetsMember","psetsMember_pos","psetsOrganizationAdmin","psetsOrganizationAdmin_pos","psetsUser","psetsUser_pos","psetsWorkflowAdmin","psetsWorkflowAdmin_pos","set_ids","spaceUser","objects","assigned_apps","users","permission_set_id","created","modified","created_by","modified_by","pluck","profile","getAssignedApps","bind","assigned_menus","getAssignedMenus","user_permission_sets","array","other","apps","psetBase","pset","uniq","aboutMenu","adminMenus","allMenus","currentPsetNames","menus","otherMenuApps","otherMenus","admin_menus","n","flatten","menu","psetsMenu","permission_sets","intersection","permission_objects","isNull","permission_set_ids","opsetAdmin","opsetGuest","opsetMember","opsetOrganizationAdmin","opsetUser","opsetWorkflowAdmin","pos","posAdmin","posGuest","posMember","posOrganizationAdmin","posUser","posWorkflowAdmin","prof","guest","member","workflow_admin","organization_admin","disabled_actions","unrelated_objects","creator_db_url","oplog_url","MONGO_URL_CREATOR","MONGO_OPLOG_URL_CREATOR","_CREATOR_DATASOURCE","_driver","MongoInternals","RemoteCollectionDriver","oplogUrl","collection_key","Collection","action_name","executeAction","item_element","moreArgs","todoArgs","odata","slice","concat","set","defer","$","click","href","getObjectUrl","window","open","record_title","call_back","text","swal","title","showCancelButton","confirmButtonText","cancelButtonText","appid","dxDataGridInstance","gridContainer","gridObjectNameClass","info","isOpenerRemove","success","opener","dxTreeList","dxDataGrid","refresh","Template","creator_grid","close","FlowRouter","go"],"mappings":"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","file":"/packages/steedos_objects.js","sourcesContent":["@db = {}\nif !Creator?\n\t@Creator = {}\nCreator.Objects = {}\nCreator.Collections = {}\nCreator.Menus = []\nCreator.Apps = {}\nCreator.Reports = {}\nCreator.subs = {}\nCreator.steedosSchema = {}","this.db = {};\n\nif (typeof Creator === \"undefined\" || Creator === null) {\n  this.Creator = {};\n}\n\nCreator.Objects = {};\n\nCreator.Collections = {};\n\nCreator.Menus = [];\n\nCreator.Apps = {};\n\nCreator.Reports = {};\n\nCreator.subs = {};\n\nCreator.steedosSchema = {};\n","try\n\tsteedosCore = require('@steedos/core')\n\tif Meteor.isDevelopment\n\t\tMeteor.startup ->\n\t\t\ttry\n\t\t\t\tsteedosCore.init()\n\t\t\tcatch ex\n\t\t\t\tconsole.log(ex)\ncatch e\n\tconsole.log(e)","var e, steedosCore;\n\ntry {\n  steedosCore = require('@steedos/core');\n  if (Meteor.isDevelopment) {\n    Meteor.startup(function() {\n      var ex;\n      try {\n        return steedosCore.init();\n      } catch (error) {\n        ex = error;\n        return console.log(ex);\n      }\n    });\n  }\n} catch (error) {\n  e = error;\n  console.log(e);\n}\n","Creator.deps = {\n\tapp: new Tracker.Dependency\n\tobject: new Tracker.Dependency\n};\n\nCreator._TEMPLATE = {\n\tApps: {},\n\tObjects: {}\n}\n\nMeteor.startup ->\n\tSimpleSchema.extendOptions({filtersFunction: Match.Optional(Match.OneOf(Function, String))})\n\tSimpleSchema.extendOptions({optionsFunction: Match.Optional(Match.OneOf(Function, String))})\n\tSimpleSchema.extendOptions({createFunction: Match.Optional(Match.OneOf(Function, String))})\n\n# Creator.fiberLoadObjects 供steedos-cli项目使用\nif Meteor.isServer\n\tFiber = require('fibers')\n\tCreator.fiberLoadObjects = (obj, object_name)->\n\t\tFiber(()->\n\t\t\tCreator.loadObjects(obj, object_name)\n\t\t).run()\n\nCreator.loadObjects = (obj, object_name)->\n\tif !object_name\n\t\tobject_name = obj.name\n\n\tif !obj.list_views\n\t\tobj.list_views = {}\n\n\tif obj.space\n\t\tobject_name = 'c_' + obj.space + '_' + obj.name\n\n\tCreator.convertObject(obj)\n\tnew Creator.Object(obj);\n\n\tCreator.initTriggers(object_name)\n\tCreator.initListViews(object_name)\n\treturn obj\n\nCreator.getObjectName = (object) ->\n\tif object.space\n\t\treturn \"c_#{object.space}_#{object.name}\"\n\treturn object.name\n\nCreator.getObject = (object_name, space_id)->\n\tif _.isArray(object_name)\n\t\treturn ;\n\tif Meteor.isClient\n\t\tCreator.deps?.object?.depend()\n\tif !object_name and Meteor.isClient\n\t\tobject_name = Session.get(\"object_name\")\n\tif !space_id && object_name\n\t\tif Meteor.isClient && !object_name.startsWith('c_')\n\t\t\tspace_id = Session.get(\"spaceId\")\n\n\tif object_name\n\t\tif space_id\n\t\t\tobj = Creator.objectsByName[\"c_#{space_id}_#{object_name}\"]\n\t\t\tif obj\n\t\t\t\treturn obj\n\n\t\tobj = _.find Creator.objectsByName, (o)->\n\t\t\t\treturn o._collection_name == object_name\n\t\tif obj\n\t\t\treturn obj\n\n\t\treturn Creator.objectsByName[object_name]\n\nCreator.getObjectById = (object_id)->\n\treturn _.findWhere(Creator.objectsByName, {_id: object_id})\n\nCreator.removeObject = (object_name)->\n\tconsole.log(\"removeObject\", object_name)\n\tdelete Creator.Objects[object_name]\n\tdelete Creator.objectsByName[object_name]\n\nCreator.getCollection = (object_name, spaceId)->\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\tif object_name\n\t\treturn Creator.Collections[Creator.getObject(object_name, spaceId)?._collection_name]\n\nCreator.removeCollection = (object_name)->\n\tdelete Creator.Collections[object_name]\n\nCreator.isSpaceAdmin = (spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\n\tspace = Creator.getObject(\"spaces\")?.db?.findOne(spaceId)\n\tif space?.admins\n\t\treturn space.admins.indexOf(userId) >= 0\n\n\nCreator.evaluateFormula = (formular, context, options)->\n\n\tif !_.isString(formular)\n\t\treturn formular\n\n\tif Creator.Formular.checkFormula(formular)\n\t\treturn Creator.Formular.run(formular, context, options)\n\n\treturn formular\n\nCreator.evaluateFilters = (filters, context)->\n\tselector = {}\n\t_.each filters, (filter)->\n\t\tif filter?.length == 3\n\t\t\tname = filter[0]\n\t\t\taction = filter[1]\n\t\t\tvalue = Creator.evaluateFormula(filter[2], context)\n\t\t\tselector[name] = {}\n\t\t\tselector[name][action] = value\n\tconsole.log(\"evaluateFilters-->selector\", selector)\n\treturn selector\n\nCreator.isCommonSpace = (spaceId) ->\n\treturn spaceId == 'common'\n\n###\n\tdocs：待排序的文档数组\n\tids：_id集合\n\tid_key: 默认为_id\n\treturn 按照ids的顺序返回新的文档集合\n###\nCreator.getOrderlySetByIds = (docs, ids, id_key, hit_first)->\n\n\tif !id_key\n\t\tid_key = \"_id\"\n\n\tif hit_first\n\n\t\t#由于不能使用_.findIndex函数，因此此处先将对象数组转为普通数组类型，在获取其index\n\t\tvalues = docs.getProperty(id_key)\n\n\t\treturn\t_.sortBy docs, (doc)->\n\t\t\t\t\t_index = ids.indexOf(doc[id_key])\n\t\t\t\t\tif _index > -1\n\t\t\t\t\t\treturn _index\n\t\t\t\t\telse\n\t\t\t\t\t\treturn ids.length + _.indexOf(values, doc[id_key])\n\telse\n\t\treturn\t_.sortBy docs, (doc)->\n\t\t\treturn ids.indexOf(doc[id_key])\n\n###\n\t按用户所属本地化语言进行排序，支持中文、数值、日期等字段排序\n\t对于Object类型，如果提供作用域中key属性，则取值为value[key]进行排序比较，反之整个Object.toString()后排序比较\n###\nCreator.sortingMethod = (value1, value2) ->\n\tif this.key\n\t\tvalue1 = value1[this.key]\n\t\tvalue2 = value2[this.key]\n\tif value1 instanceof Date\n\t\tvalue1 = value1.getTime()\n\tif value2 instanceof Date\n\t\tvalue2 = value2.getTime()\n\tif typeof value1 is \"number\" and typeof value2 is \"number\"\n\t\treturn value1 - value2\n\t# Handling null values\n\tisValue1Empty = value1 == null or value1 == undefined\n\tisValue2Empty = value2 == null or value2 == undefined\n\tif isValue1Empty and !isValue2Empty\n\t\treturn -1\n\tif isValue1Empty and isValue2Empty\n\t\treturn 0\n\tif !isValue1Empty and isValue2Empty\n\t\treturn 1\n\tlocale = Steedos.locale()\n\treturn value1.toString().localeCompare value2.toString(), locale\n\n\n# 该函数只在初始化Object时，把相关对象的计算结果保存到Object的related_objects属性中，后续可以直接从related_objects属性中取得计算结果而不用再次调用该函数来计算\nCreator.getObjectRelateds = (object_name)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\n\trelated_objects = []\n\t# _object = Creator.getObject(object_name)\n\t# 因Creator.getObject函数内部要调用该函数，所以这里不可以调用Creator.getObject取对象，只能调用Creator.Objects来取对象\n\t_object = Creator.Objects[object_name]\n\tif !_object\n\t\treturn related_objects\n\n\tif _object.enable_files\n\t\trelated_objects.push {object_name:\"cms_files\", foreign_key: \"parent\"}\n\n\t_.each Creator.Objects, (related_object, related_object_name)->\n\t\t_.each related_object.fields, (related_field, related_field_name)->\n\t\t\tif related_field.type == \"master_detail\" and related_field.reference_to and related_field.reference_to == object_name\n\t\t\t\tif related_object_name == \"object_fields\"\n\t\t\t\t\t#TODO 待相关列表支持排序后，删除此判断\n\t\t\t\t\trelated_objects.splice(0, 0, {object_name:related_object_name, foreign_key: related_field_name})\n\t\t\t\telse\n\t\t\t\t\trelated_objects.push {object_name:related_object_name, foreign_key: related_field_name}\n\n\tif _object.enable_tasks\n\t\trelated_objects.push {object_name:\"tasks\", foreign_key: \"related_to\"}\n\tif _object.enable_notes\n\t\trelated_objects.push {object_name:\"notes\", foreign_key: \"related_to\"}\n\tif _object.enable_events\n\t\trelated_objects.push {object_name:\"events\", foreign_key: \"related_to\"}\n\tif _object.enable_instances\n\t\trelated_objects.push {object_name:\"instances\", foreign_key: \"record_ids\"}\n\tif _object.enable_approvals\n\t\trelated_objects.push {object_name:\"approvals\", foreign_key: \"related_to\"}\n\t#record 详细下的audit_records仅modifyAllRecords权限可见\n\tif Meteor.isClient\n\t\tpermissions = Creator.getPermissions(object_name)\n\t\tif _object.enable_audit && permissions?.modifyAllRecords\n\t\t\trelated_objects.push {object_name:\"audit_records\", foreign_key: \"related_to\"}\n\n\treturn related_objects\n\nCreator.getUserContext = (userId, spaceId, isUnSafeMode)->\n\tif Meteor.isClient\n\t\treturn Creator.USER_CONTEXT\n\telse\n\t\tif !(userId and spaceId)\n\t\t\tthrow new Meteor.Error 500, \"the params userId and spaceId is required for the function Creator.getUserContext\"\n\t\t\treturn null\n\t\tsuFields = {name: 1, mobile: 1, position: 1, email: 1, company: 1, organization: 1, space: 1, company_id: 1, company_ids: 1}\n\t\t# check if user in the space\n\t\tsu = Creator.Collections[\"space_users\"].findOne({space: spaceId, user: userId}, {fields: suFields})\n\t\tif !su\n\t\t\tspaceId = null\n\n\t\t# if spaceId not exists, get the first one.\n\t\tif !spaceId\n\t\t\tif isUnSafeMode\n\t\t\t\tsu = Creator.Collections[\"space_users\"].findOne({user: userId}, {fields: suFields})\n\t\t\t\tif !su\n\t\t\t\t\treturn null\n\t\t\t\tspaceId = su.space\n\t\t\telse\n\t\t\t\treturn null\n\n\t\tUSER_CONTEXT = {}\n\t\tUSER_CONTEXT.userId = userId\n\t\tUSER_CONTEXT.spaceId = spaceId\n\t\tUSER_CONTEXT.user = {\n\t\t\t_id: userId\n\t\t\tname: su.name,\n\t\t\tmobile: su.mobile,\n\t\t\tposition: su.position,\n\t\t\temail: su.email\n\t\t\tcompany: su.company\n\t\t\tcompany_id: su.company_id\n\t\t\tcompany_ids: su.company_ids\n\t\t}\n\t\tspace_user_org = Creator.getCollection(\"organizations\")?.findOne(su.organization)\n\t\tif space_user_org\n\t\t\tUSER_CONTEXT.user.organization = {\n\t\t\t\t_id: space_user_org._id,\n\t\t\t\tname: space_user_org.name,\n\t\t\t\tfullname: space_user_org.fullname\n\t\t\t}\n\t\treturn USER_CONTEXT\n\nCreator.getRelativeUrl = (url)->\n\tif url\n\t\t# url开头没有\"/\"，需要添加\"/\"\n\t\tif !/^\\//.test(url)\n\t\t\turl = \"/\" + url\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url\n\telse\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX\n\nCreator.getUserCompanyId = (userId, spaceId)->\n\tuserId = userId || Meteor.userId()\n\tif Meteor.isClient\n\t\tspaceId = spaceId || Session.get('spaceId')\n\telse\n\t\tif !spaceId\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_id:1}})\n\treturn su.company_id\n\nCreator.getUserCompanyIds = (userId, spaceId)->\n\tuserId = userId || Meteor.userId()\n\tif Meteor.isClient\n\t\tspaceId = spaceId || Session.get('spaceId')\n\telse\n\t\tif !spaceId\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_ids:1}})\n\treturn su?.company_ids\n\nCreator.processPermissions = (po)->\n\tif po.allowCreate\n\t\tpo.allowRead = true\n\tif po.allowEdit\n\t\tpo.allowRead = true\n\tif po.allowDelete\n\t\tpo.allowEdit = true\n\t\tpo.allowRead = true\n\tif po.viewAllRecords\n\t\tpo.allowRead = true\n\tif po.modifyAllRecords\n\t\tpo.allowRead = true\n\t\tpo.allowEdit = true\n\t\tpo.allowDelete = true\n\t\tpo.viewAllRecords = true\n\tif po.viewCompanyRecords\n\t\tpo.allowRead = true\n\tif po.modifyCompanyRecords\n\t\tpo.allowRead = true\n\t\tpo.allowEdit = true\n\t\tpo.allowDelete = true\n\t\tpo.viewCompanyRecords = true\n\treturn po\n\nif Meteor.isServer\n\tif process.env.STEEDOS_STORAGE_DIR\n\t\tCreator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR\n\telse\n\t\tpath = require('path')\n\t\tCreator.steedosStorageDir = path.resolve(path.join(__meteor_bootstrap__.serverDir, '../../../cfs'))\n","var Fiber, path;\n\nCreator.deps = {\n  app: new Tracker.Dependency,\n  object: new Tracker.Dependency\n};\n\nCreator._TEMPLATE = {\n  Apps: {},\n  Objects: {}\n};\n\nMeteor.startup(function() {\n  SimpleSchema.extendOptions({\n    filtersFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  SimpleSchema.extendOptions({\n    optionsFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  return SimpleSchema.extendOptions({\n    createFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n});\n\nif (Meteor.isServer) {\n  Fiber = require('fibers');\n  Creator.fiberLoadObjects = function(obj, object_name) {\n    return Fiber(function() {\n      return Creator.loadObjects(obj, object_name);\n    }).run();\n  };\n}\n\nCreator.loadObjects = function(obj, object_name) {\n  if (!object_name) {\n    object_name = obj.name;\n  }\n  if (!obj.list_views) {\n    obj.list_views = {};\n  }\n  if (obj.space) {\n    object_name = 'c_' + obj.space + '_' + obj.name;\n  }\n  Creator.convertObject(obj);\n  new Creator.Object(obj);\n  Creator.initTriggers(object_name);\n  Creator.initListViews(object_name);\n  return obj;\n};\n\nCreator.getObjectName = function(object) {\n  if (object.space) {\n    return \"c_\" + object.space + \"_\" + object.name;\n  }\n  return object.name;\n};\n\nCreator.getObject = function(object_name, space_id) {\n  var obj, ref, ref1;\n  if (_.isArray(object_name)) {\n    return;\n  }\n  if (Meteor.isClient) {\n    if ((ref = Creator.deps) != null) {\n      if ((ref1 = ref.object) != null) {\n        ref1.depend();\n      }\n    }\n  }\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (!space_id && object_name) {\n    if (Meteor.isClient && !object_name.startsWith('c_')) {\n      space_id = Session.get(\"spaceId\");\n    }\n  }\n  if (object_name) {\n    if (space_id) {\n      obj = Creator.objectsByName[\"c_\" + space_id + \"_\" + object_name];\n      if (obj) {\n        return obj;\n      }\n    }\n    obj = _.find(Creator.objectsByName, function(o) {\n      return o._collection_name === object_name;\n    });\n    if (obj) {\n      return obj;\n    }\n    return Creator.objectsByName[object_name];\n  }\n};\n\nCreator.getObjectById = function(object_id) {\n  return _.findWhere(Creator.objectsByName, {\n    _id: object_id\n  });\n};\n\nCreator.removeObject = function(object_name) {\n  console.log(\"removeObject\", object_name);\n  delete Creator.Objects[object_name];\n  return delete Creator.objectsByName[object_name];\n};\n\nCreator.getCollection = function(object_name, spaceId) {\n  var ref;\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (object_name) {\n    return Creator.Collections[(ref = Creator.getObject(object_name, spaceId)) != null ? ref._collection_name : void 0];\n  }\n};\n\nCreator.removeCollection = function(object_name) {\n  return delete Creator.Collections[object_name];\n};\n\nCreator.isSpaceAdmin = function(spaceId, userId) {\n  var ref, ref1, space;\n  if (Meteor.isClient) {\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  space = (ref = Creator.getObject(\"spaces\")) != null ? (ref1 = ref.db) != null ? ref1.findOne(spaceId) : void 0 : void 0;\n  if (space != null ? space.admins : void 0) {\n    return space.admins.indexOf(userId) >= 0;\n  }\n};\n\nCreator.evaluateFormula = function(formular, context, options) {\n  if (!_.isString(formular)) {\n    return formular;\n  }\n  if (Creator.Formular.checkFormula(formular)) {\n    return Creator.Formular.run(formular, context, options);\n  }\n  return formular;\n};\n\nCreator.evaluateFilters = function(filters, context) {\n  var selector;\n  selector = {};\n  _.each(filters, function(filter) {\n    var action, name, value;\n    if ((filter != null ? filter.length : void 0) === 3) {\n      name = filter[0];\n      action = filter[1];\n      value = Creator.evaluateFormula(filter[2], context);\n      selector[name] = {};\n      return selector[name][action] = value;\n    }\n  });\n  console.log(\"evaluateFilters-->selector\", selector);\n  return selector;\n};\n\nCreator.isCommonSpace = function(spaceId) {\n  return spaceId === 'common';\n};\n\n\n/*\n\tdocs：待排序的文档数组\n\tids：_id集合\n\tid_key: 默认为_id\n\treturn 按照ids的顺序返回新的文档集合\n */\n\nCreator.getOrderlySetByIds = function(docs, ids, id_key, hit_first) {\n  var values;\n  if (!id_key) {\n    id_key = \"_id\";\n  }\n  if (hit_first) {\n    values = docs.getProperty(id_key);\n    return _.sortBy(docs, function(doc) {\n      var _index;\n      _index = ids.indexOf(doc[id_key]);\n      if (_index > -1) {\n        return _index;\n      } else {\n        return ids.length + _.indexOf(values, doc[id_key]);\n      }\n    });\n  } else {\n    return _.sortBy(docs, function(doc) {\n      return ids.indexOf(doc[id_key]);\n    });\n  }\n};\n\n\n/*\n\t按用户所属本地化语言进行排序，支持中文、数值、日期等字段排序\n\t对于Object类型，如果提供作用域中key属性，则取值为value[key]进行排序比较，反之整个Object.toString()后排序比较\n */\n\nCreator.sortingMethod = function(value1, value2) {\n  var isValue1Empty, isValue2Empty, locale;\n  if (this.key) {\n    value1 = value1[this.key];\n    value2 = value2[this.key];\n  }\n  if (value1 instanceof Date) {\n    value1 = value1.getTime();\n  }\n  if (value2 instanceof Date) {\n    value2 = value2.getTime();\n  }\n  if (typeof value1 === \"number\" && typeof value2 === \"number\") {\n    return value1 - value2;\n  }\n  isValue1Empty = value1 === null || value1 === void 0;\n  isValue2Empty = value2 === null || value2 === void 0;\n  if (isValue1Empty && !isValue2Empty) {\n    return -1;\n  }\n  if (isValue1Empty && isValue2Empty) {\n    return 0;\n  }\n  if (!isValue1Empty && isValue2Empty) {\n    return 1;\n  }\n  locale = Steedos.locale();\n  return value1.toString().localeCompare(value2.toString(), locale);\n};\n\nCreator.getObjectRelateds = function(object_name) {\n  var _object, permissions, related_objects;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n  }\n  related_objects = [];\n  _object = Creator.Objects[object_name];\n  if (!_object) {\n    return related_objects;\n  }\n  if (_object.enable_files) {\n    related_objects.push({\n      object_name: \"cms_files\",\n      foreign_key: \"parent\"\n    });\n  }\n  _.each(Creator.Objects, function(related_object, related_object_name) {\n    return _.each(related_object.fields, function(related_field, related_field_name) {\n      if (related_field.type === \"master_detail\" && related_field.reference_to && related_field.reference_to === object_name) {\n        if (related_object_name === \"object_fields\") {\n          return related_objects.splice(0, 0, {\n            object_name: related_object_name,\n            foreign_key: related_field_name\n          });\n        } else {\n          return related_objects.push({\n            object_name: related_object_name,\n            foreign_key: related_field_name\n          });\n        }\n      }\n    });\n  });\n  if (_object.enable_tasks) {\n    related_objects.push({\n      object_name: \"tasks\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_notes) {\n    related_objects.push({\n      object_name: \"notes\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_events) {\n    related_objects.push({\n      object_name: \"events\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_instances) {\n    related_objects.push({\n      object_name: \"instances\",\n      foreign_key: \"record_ids\"\n    });\n  }\n  if (_object.enable_approvals) {\n    related_objects.push({\n      object_name: \"approvals\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (Meteor.isClient) {\n    permissions = Creator.getPermissions(object_name);\n    if (_object.enable_audit && (permissions != null ? permissions.modifyAllRecords : void 0)) {\n      related_objects.push({\n        object_name: \"audit_records\",\n        foreign_key: \"related_to\"\n      });\n    }\n  }\n  return related_objects;\n};\n\nCreator.getUserContext = function(userId, spaceId, isUnSafeMode) {\n  var USER_CONTEXT, ref, space_user_org, su, suFields;\n  if (Meteor.isClient) {\n    return Creator.USER_CONTEXT;\n  } else {\n    if (!(userId && spaceId)) {\n      throw new Meteor.Error(500, \"the params userId and spaceId is required for the function Creator.getUserContext\");\n      return null;\n    }\n    suFields = {\n      name: 1,\n      mobile: 1,\n      position: 1,\n      email: 1,\n      company: 1,\n      organization: 1,\n      space: 1,\n      company_id: 1,\n      company_ids: 1\n    };\n    su = Creator.Collections[\"space_users\"].findOne({\n      space: spaceId,\n      user: userId\n    }, {\n      fields: suFields\n    });\n    if (!su) {\n      spaceId = null;\n    }\n    if (!spaceId) {\n      if (isUnSafeMode) {\n        su = Creator.Collections[\"space_users\"].findOne({\n          user: userId\n        }, {\n          fields: suFields\n        });\n        if (!su) {\n          return null;\n        }\n        spaceId = su.space;\n      } else {\n        return null;\n      }\n    }\n    USER_CONTEXT = {};\n    USER_CONTEXT.userId = userId;\n    USER_CONTEXT.spaceId = spaceId;\n    USER_CONTEXT.user = {\n      _id: userId,\n      name: su.name,\n      mobile: su.mobile,\n      position: su.position,\n      email: su.email,\n      company: su.company,\n      company_id: su.company_id,\n      company_ids: su.company_ids\n    };\n    space_user_org = (ref = Creator.getCollection(\"organizations\")) != null ? ref.findOne(su.organization) : void 0;\n    if (space_user_org) {\n      USER_CONTEXT.user.organization = {\n        _id: space_user_org._id,\n        name: space_user_org.name,\n        fullname: space_user_org.fullname\n      };\n    }\n    return USER_CONTEXT;\n  }\n};\n\nCreator.getRelativeUrl = function(url) {\n  if (url) {\n    if (!/^\\//.test(url)) {\n      url = \"/\" + url;\n    }\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url;\n  } else {\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n  }\n};\n\nCreator.getUserCompanyId = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_id: 1\n    }\n  });\n  return su.company_id;\n};\n\nCreator.getUserCompanyIds = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_ids: 1\n    }\n  });\n  return su != null ? su.company_ids : void 0;\n};\n\nCreator.processPermissions = function(po) {\n  if (po.allowCreate) {\n    po.allowRead = true;\n  }\n  if (po.allowEdit) {\n    po.allowRead = true;\n  }\n  if (po.allowDelete) {\n    po.allowEdit = true;\n    po.allowRead = true;\n  }\n  if (po.viewAllRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyAllRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewAllRecords = true;\n  }\n  if (po.viewCompanyRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyCompanyRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewCompanyRecords = true;\n  }\n  return po;\n};\n\nif (Meteor.isServer) {\n  if (process.env.STEEDOS_STORAGE_DIR) {\n    Creator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR;\n  } else {\n    path = require('path');\n    Creator.steedosStorageDir = path.resolve(path.join(__meteor_bootstrap__.serverDir, '../../../cfs'));\n  }\n}\n","Meteor.methods\n\t# 用户获取lookup 、master_detail类型字段的选项值\n\t\"creator.object_options\": (options)->\n\t\tif options?.params?.reference_to\n\n\t\t\tobject = Creator.getObject(options.params.reference_to, options.params.space)\n\n\t\t\tname_field_key = object.NAME_FIELD_KEY\n\n\t\t\tquery = {}\n\t\t\tif options.params.space\n\t\t\t\tquery.space = options.params.space\n\n\t\t\t\tsort = options?.sort\n\n\t\t\t\tselected = options?.selected || []\n\n\t\t\t\toptions_limit = options?.options_limit || 10\n\n\t\t\t\tif options.searchText\n\t\t\t\t\tsearchTextQuery = {}\n\t\t\t\t\tsearchTextQuery[name_field_key] = {$regex: options.searchText}\n\n\t\t\t\tif options?.values?.length\n\t\t\t\t\tif options.searchText\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}, searchTextQuery]\n\t\t\t\t\telse\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}]\n\t\t\t\telse\n\t\t\t\t\tif options.searchText\n\t\t\t\t\t\t_.extend(query, searchTextQuery)\n\t\t\t\t\tquery._id = {$nin: selected}\n\n\t\t\t\tcollection = object.db\n\n\t\t\t\tif options.filterQuery\n\t\t\t\t\t_.extend query, options.filterQuery\n\n\t\t\t\tquery_options = {limit: options_limit}\n\n\t\t\t\tif sort && _.isObject(sort)\n\t\t\t\t\tquery_options.sort = sort\n\n\t\t\t\tif collection\n\t\t\t\t\ttry\n\t\t\t\t\t\trecords = collection.find(query, query_options).fetch()\n\t\t\t\t\t\tresults = []\n\t\t\t\t\t\t_.each records, (record)->\n\t\t\t\t\t\t\tresults.push\n\t\t\t\t\t\t\t\tlabel: record[name_field_key]\n\t\t\t\t\t\t\t\tvalue: record._id\n\t\t\t\t\t\treturn results\n\t\t\t\t\tcatch e\n\t\t\t\t\t\tthrow new Meteor.Error 500, e.message + \"-->\" + JSON.stringify(options)\n\t\treturn [] ","Meteor.methods({\n  \"creator.object_options\": function(options) {\n    var collection, e, name_field_key, object, options_limit, query, query_options, records, ref, ref1, results, searchTextQuery, selected, sort;\n    if (options != null ? (ref = options.params) != null ? ref.reference_to : void 0 : void 0) {\n      object = Creator.getObject(options.params.reference_to, options.params.space);\n      name_field_key = object.NAME_FIELD_KEY;\n      query = {};\n      if (options.params.space) {\n        query.space = options.params.space;\n        sort = options != null ? options.sort : void 0;\n        selected = (options != null ? options.selected : void 0) || [];\n        options_limit = (options != null ? options.options_limit : void 0) || 10;\n        if (options.searchText) {\n          searchTextQuery = {};\n          searchTextQuery[name_field_key] = {\n            $regex: options.searchText\n          };\n        }\n        if (options != null ? (ref1 = options.values) != null ? ref1.length : void 0 : void 0) {\n          if (options.searchText) {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }, searchTextQuery\n            ];\n          } else {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }\n            ];\n          }\n        } else {\n          if (options.searchText) {\n            _.extend(query, searchTextQuery);\n          }\n          query._id = {\n            $nin: selected\n          };\n        }\n        collection = object.db;\n        if (options.filterQuery) {\n          _.extend(query, options.filterQuery);\n        }\n        query_options = {\n          limit: options_limit\n        };\n        if (sort && _.isObject(sort)) {\n          query_options.sort = sort;\n        }\n        if (collection) {\n          try {\n            records = collection.find(query, query_options).fetch();\n            results = [];\n            _.each(records, function(record) {\n              return results.push({\n                label: record[name_field_key],\n                value: record._id\n              });\n            });\n            return results;\n          } catch (error) {\n            e = error;\n            throw new Meteor.Error(500, e.message + \"-->\" + JSON.stringify(options));\n          }\n        }\n      }\n    }\n    return [];\n  }\n});\n","JsonRoutes.add 'post', '/api/workflow/view/:instanceId', (req, res, next) ->\n\ttry\n\t\tcurrent_user_info = uuflowManager.check_authorization(req)\n\t\tcurrent_user_id = current_user_info._id\n\n\t\thashData = req.body\n\t\tobject_name = hashData.object_name\n\t\trecord_id = hashData.record_id\n\t\tspace_id = hashData.space_id\n\n\t\tcheck object_name, String\n\t\tcheck record_id, String\n\t\tcheck space_id, String\n\n\t\tinsId = req.params.instanceId\n\t\tx_user_id = req.query['X-User-Id']\n\t\tx_auth_token = req.query['X-Auth-Token']\n\n\t\tredirect_url = \"/\"\n\t\tins = Creator.getCollection('instances').findOne(insId)\n\t\t# - 我的草稿就跳转至草稿箱\n\t\t# - 我的待审核就跳转至待审核\n\t\t# - 不是我的申请单则跳转至打印页面\n\t\t# - 如申请单不存在则提示用户申请单已删除，并且更新record的状态，使用户可以重新发起审批\n\t\tif ins\n\t\t\tworkflowUrl = Meteor.settings.public.webservices.workflow.url\n\t\t\tbox = ''\n\t\t\tspaceId = ins.space\n\t\t\tflowId = ins.flow\n\n\t\t\tif (ins.inbox_users?.includes current_user_id) or (ins.cc_users?.includes current_user_id)\n\t\t\t\tbox = 'inbox'\n\t\t\telse if ins.outbox_users?.includes current_user_id\n\t\t\t\tbox = 'outbox'\n\t\t\telse if ins.state is 'draft' and ins.submitter is current_user_id\n\t\t\t\tbox = 'draft'\n\t\t\telse if ins.state is 'pending' and (ins.submitter is current_user_id or ins.applicant is current_user_id)\n\t\t\t\tbox = 'pending'\n\t\t\telse if ins.state is 'completed' and ins.submitter is current_user_id\n\t\t\t\tbox = 'completed'\n\t\t\telse\n\t\t\t\t# 验证login user_id对该流程有管理申请单的权限\n\t\t\t\tpermissions = permissionManager.getFlowPermissions(flowId, current_user_id)\n\t\t\t\tspace = db.spaces.findOne(spaceId, { fields: { admins: 1 } })\n\t\t\t\tif permissions.includes(\"admin\") or space.admins.includes(current_user_id)\n\t\t\t\t\tbox = 'monitor'\n\n\t\t\tif box\n\t\t\t\tredirect_url = workflowUrl + \"workflow/space/#{spaceId}/#{box}/#{insId}?X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\n\t\t\telse\n\t\t\t\tredirect_url = workflowUrl + \"workflow/space/#{spaceId}/print/#{insId}?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\n\n\t\t\tJsonRoutes.sendResult res, {\n\t\t\t\tcode: 200\n\t\t\t\tdata: { redirect_url: redirect_url }\n\t\t\t}\n\t\t\treturn\n\t\telse\n\t\t\tcollection = Creator.getCollection(object_name, space_id)\n\t\t\tif collection\n\t\t\t\tcollection.update(record_id, {\n\t\t\t\t\t$pull: {\n\t\t\t\t\t\t\"instances\": {\n\t\t\t\t\t\t\t\"_id\": insId\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tthrow new Meteor.Error('error', '申请单已删除')\n\n\tcatch e\n\t\tJsonRoutes.sendResult res, {\n\t\t\tcode: 200\n\t\t\tdata: { errors: [{ errorMessage: e.reason || e.message }] }\n\t\t}\n\n","JsonRoutes.add('post', '/api/workflow/view/:instanceId', function(req, res, next) {\n  var box, collection, current_user_id, current_user_info, e, flowId, hashData, ins, insId, object_name, permissions, record_id, redirect_url, ref, ref1, ref2, space, spaceId, space_id, workflowUrl, x_auth_token, x_user_id;\n  try {\n    current_user_info = uuflowManager.check_authorization(req);\n    current_user_id = current_user_info._id;\n    hashData = req.body;\n    object_name = hashData.object_name;\n    record_id = hashData.record_id;\n    space_id = hashData.space_id;\n    check(object_name, String);\n    check(record_id, String);\n    check(space_id, String);\n    insId = req.params.instanceId;\n    x_user_id = req.query['X-User-Id'];\n    x_auth_token = req.query['X-Auth-Token'];\n    redirect_url = \"/\";\n    ins = Creator.getCollection('instances').findOne(insId);\n    if (ins) {\n      workflowUrl = Meteor.settings[\"public\"].webservices.workflow.url;\n      box = '';\n      spaceId = ins.space;\n      flowId = ins.flow;\n      if (((ref = ins.inbox_users) != null ? ref.includes(current_user_id) : void 0) || ((ref1 = ins.cc_users) != null ? ref1.includes(current_user_id) : void 0)) {\n        box = 'inbox';\n      } else if ((ref2 = ins.outbox_users) != null ? ref2.includes(current_user_id) : void 0) {\n        box = 'outbox';\n      } else if (ins.state === 'draft' && ins.submitter === current_user_id) {\n        box = 'draft';\n      } else if (ins.state === 'pending' && (ins.submitter === current_user_id || ins.applicant === current_user_id)) {\n        box = 'pending';\n      } else if (ins.state === 'completed' && ins.submitter === current_user_id) {\n        box = 'completed';\n      } else {\n        permissions = permissionManager.getFlowPermissions(flowId, current_user_id);\n        space = db.spaces.findOne(spaceId, {\n          fields: {\n            admins: 1\n          }\n        });\n        if (permissions.includes(\"admin\") || space.admins.includes(current_user_id)) {\n          box = 'monitor';\n        }\n      }\n      if (box) {\n        redirect_url = workflowUrl + (\"workflow/space/\" + spaceId + \"/\" + box + \"/\" + insId + \"?X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      } else {\n        redirect_url = workflowUrl + (\"workflow/space/\" + spaceId + \"/print/\" + insId + \"?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      }\n      JsonRoutes.sendResult(res, {\n        code: 200,\n        data: {\n          redirect_url: redirect_url\n        }\n      });\n    } else {\n      collection = Creator.getCollection(object_name, space_id);\n      if (collection) {\n        collection.update(record_id, {\n          $pull: {\n            \"instances\": {\n              \"_id\": insId\n            }\n          }\n        });\n        throw new Meteor.Error('error', '申请单已删除');\n      }\n    }\n  } catch (error) {\n    e = error;\n    return JsonRoutes.sendResult(res, {\n      code: 200,\n      data: {\n        errors: [\n          {\n            errorMessage: e.reason || e.message\n          }\n        ]\n      }\n    });\n  }\n});\n","Creator.getInitWidthPercent = (object_name, columns) ->\n\t_schema = Creator.getSchema(object_name)?._schema\n\tcolumn_num = 0\n\tif _schema\n\t\t_.each columns, (field_name) ->\n\t\t\tfield = _.pick(_schema, field_name)\n\t\t\tis_wide = field[field_name]?.autoform?.is_wide\n\t\t\tif is_wide\n\t\t\t\tcolumn_num += 2\n\t\t\telse\n\t\t\t\tcolumn_num += 1\n\n\t\tinit_width_percent = 100 / column_num\n\t\treturn init_width_percent\n\nCreator.getFieldIsWide = (object_name, field_name) ->\n\t_schema = Creator.getSchema(object_name)._schema\n\tif _schema\n\t\tfield = _.pick(_schema, field_name)\n\t\tis_wide = field[field_name]?.autoform?.is_wide\n\t\treturn is_wide\n\nCreator.getTabularOrder = (object_name, list_view_id, columns) ->\n\tsetting = Creator.Collections?.settings?.findOne({object_name: object_name, record_id: \"object_listviews\"})\n\tobj = Creator.getObject(object_name)\n\tcolumns = _.map columns, (column)->\n\t\tfield = obj.fields[column]\n\t\tif field?.type and !field.hidden\n\t\t\treturn column\n\t\telse\n\t\t\treturn undefined\n\tcolumns = _.compact columns\n\tif setting and setting.settings\n\t\tsort = setting.settings[list_view_id]?.sort || []\n\t\tsort = _.map sort, (order)->\n\t\t\tkey = order[0]\n\t\t\tindex = _.indexOf(columns, key)\n\t\t\torder[0] = index + 1\n\t\t\treturn order\n\t\treturn sort\n\treturn []\n\n\nCreator.initListViews = (object_name)->\n\tobject = Creator.getObject(object_name)\n\tcolumns = Creator.getObjectDefaultColumns(object_name) || [\"name\"]\n\textra_columns = [\"owner\"]\n\tdefault_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"]\n\tif default_extra_columns\n\t\textra_columns = _.union extra_columns, default_extra_columns\n\n\torder = Creator.getObjectDefaultSort(object_name) || []\n\tif Meteor.isClient\n\t\tCreator.TabularSelectedIds?[object_name] = []\n\nCreator.convertListView = (default_columens, list_view, list_view_name)->\n\toitem = _.clone(list_view)\n\tif !_.has(oitem, \"name\")\n\t\toitem.name = list_view_name\n\tif !oitem.columns\n\t\tif default_columens\n\t\t\toitem.columns = default_columens\n\tif !oitem.columns\n\t\toitem.columns = [\"name\"]\n\tif !oitem.filter_scope\n\t\t# listview视图的filter_scope默认值改为space #131\n\t\toitem.filter_scope = \"space\"\n\n\tif !_.has(oitem, \"_id\")\n\t\toitem._id = list_view_name\n\telse\n\t\toitem.label = oitem.label || list_view.name\n\n\tif _.isString(oitem.options)\n\t\toitem.options = JSON.parse(oitem.options)\n\n\t_.forEach oitem.filters, (filter, _index)->\n\t\tif !_.isArray(filter) && _.isObject(filter)\n\t\t\tif Meteor.isServer\n\t\t\t\tif _.isFunction(filter?.value)\n\t\t\t\t\tfilter._value = filter.value.toString()\n\t\t\telse\n\t\t\t\tif _.isString(filter?._value)\n\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\n\treturn oitem\n\n\nif Meteor.isClient\n\tCreator.getRelatedList = (object_name)->\n\t\tlist = []\n\t\trelated_objects = Creator.getRelatedObjects(object_name)\n\n\t\t_.each related_objects, (related_object_item) ->\n\t\t\trelated_object_name = related_object_item.object_name\n\t\t\trelated_field_name = related_object_item.foreign_key\n\t\t\trelated_object = Creator.getObject(related_object_name)\n\t\t\tunless related_object\n\t\t\t\treturn\n\t\t\tcolumns = Creator.getObjectDefaultColumns(related_object_name) || [\"name\"]\n\t\t\tcolumns = _.without(columns, related_field_name)\n\n\t\t\torder = Creator.getObjectDefaultSort(related_object_name)\n\t\t\ttabular_order = Creator.transformSortToTabular(order, columns)\n\n\t\t\tif /\\w+\\.\\$\\.\\w+/g.test(related_field_name)\n\t\t\t\t# object类型带子属性的related_field_name要去掉中间的美元符号，否则显示不出字段值\n\t\t\t\trelated_field_name = related_field_name.replace(/\\$\\./,\"\")\n\t\t\trelated =\n\t\t\t\tobject_name: related_object_name\n\t\t\t\tcolumns: columns\n\t\t\t\trelated_field_name: related_field_name\n\t\t\t\tis_file: related_object_name == \"cms_files\"\n\n\t\t\tlist.push related\n\n\t\treturn list\n\nCreator.getObjectFirstListView = (object_name)->\n\treturn _.first(Creator.getListViews(object_name))\n\n### \n\t取出list_view_id对应的视图，如果不存在或者没有权限，就返回第一个视图\n\texac为true时，需要强制按list_view_id精确查找，不默认返回第一个视图\n###\nCreator.getListView = (object_name, list_view_id, exac)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !list_view_id\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\treturn\n\tlistViews = Creator.getListViews(object_name)\n\tunless listViews?.length\n\t\treturn\n\tlist_view = _.findWhere(listViews,{\"_id\":list_view_id})\n\tunless list_view\n\t\t# 如果不需要强制按list_view_id精确查找，则默认返回第一个视图，反之返回空\n\t\tif exac\n\t\t\treturn\n\t\telse\n\t\t\tlist_view = listViews[0]\n\treturn list_view\n\n#获取list_view_id对应的视图是否是最近查看视图\nCreator.getListViewIsRecent = (object_name, list_view_id)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !list_view_id\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\tif typeof(list_view_id) == \"string\"\n\t\tobject = Creator.getObject(object_name)\n\t\tif !object\n\t\t\treturn\n\t\tlistView = _.findWhere(object.list_views,{_id: list_view_id})\n\telse\n\t\tlistView = list_view_id\n\treturn listView?.name == \"recent\"\n\n\n###\n    获取默认视图\n###\nCreator.getObjectDefaultView = (object_name)->\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\tobject = Creator.Objects[object_name]\n\tif object?.list_views?.default\n\t\t#TODO 此代码只是暂时兼容以前code中定义的default视图，待code中的default清理完成后，需要删除此代码\n\t\tdefaultView = object.list_views.default\n\telse\n\t\t_.each object?.list_views, (list_view, key)->\n\t\t\tif list_view.name == \"all\" || key == \"all\"\n\t\t\t\tdefaultView = list_view\n\treturn defaultView;\n\n###\n    获取对象的列表默认显示字段\n###\nCreator.getObjectDefaultColumns = (object_name)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\treturn defaultView?.columns\n\n###\n\t获取对象的列表默认额外加载的字段\n###\nCreator.getObjectDefaultExtraColumns = (object_name)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\treturn defaultView?.extra_columns\n\n###\n\t获取对象的默认排序\n###\nCreator.getObjectDefaultSort = (object_name)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\tif defaultView\n\t\tif defaultView.sort\n\t\t\treturn defaultView.sort\n\t\telse\n\t\t\treturn [[\"created\", \"desc\"]]\n\n\n###\n    判断是否All view\n###\nCreator.isAllView = (list_view)->\n\treturn list_view?.name == \"all\"\n\n###\n    判断是否最近查看 view\n###\nCreator.isRecentView = (list_view)->\n\treturn list_view?.name == \"recent\"\n\n###\n    将sort转换为Tabular控件所需要的格式\n###\nCreator.transformSortToTabular = (sort, tabularColumns)->\n\ttabular_sort = []\n\t_.each sort, (item)->\n\t\tif _.isArray(item)\n\t\t\t# 兼容旧的数据格式[[\"field_name\", \"order\"]]\n\t\t\tif item.length == 1\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, \"asc\"]\n\t\t\telse if item.length == 2\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, item[1]]\n\t\telse if _.isObject(item)\n\t\t\t#新数据格式：[{field_name: , order: }]\n\t\t\tfield_name = item.field_name\n\t\t\torder = item.order\n\t\t\tif field_name && order\n\t\t\t\tcolumn_index = tabularColumns.indexOf(field_name)\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, order]\n\n\treturn tabular_sort\n\n###\n    将sort转换为DevExpress控件所需要的格式\n###\nCreator.transformSortToDX = (sort)->\n\tdx_sort = []\n\t_.each sort, (item)->\n\t\tif _.isArray(item)\n\t\t\t#兼容旧格式：[[\"field_name\", \"order\"]]\n\t\t\tdx_sort.push(item)\n\t\telse if _.isObject(item)\n\t\t\t#新数据格式：[{field_name: , order: }]\n\t\t\tfield_name = item.field_name\n\t\t\torder = item.order\n\t\t\tif field_name && order\n\t\t\t\tdx_sort.push [field_name, order]\n\n\treturn dx_sort\n","Creator.getInitWidthPercent = function(object_name, columns) {\n  var _schema, column_num, init_width_percent, ref;\n  _schema = (ref = Creator.getSchema(object_name)) != null ? ref._schema : void 0;\n  column_num = 0;\n  if (_schema) {\n    _.each(columns, function(field_name) {\n      var field, is_wide, ref1, ref2;\n      field = _.pick(_schema, field_name);\n      is_wide = (ref1 = field[field_name]) != null ? (ref2 = ref1.autoform) != null ? ref2.is_wide : void 0 : void 0;\n      if (is_wide) {\n        return column_num += 2;\n      } else {\n        return column_num += 1;\n      }\n    });\n    init_width_percent = 100 / column_num;\n    return init_width_percent;\n  }\n};\n\nCreator.getFieldIsWide = function(object_name, field_name) {\n  var _schema, field, is_wide, ref, ref1;\n  _schema = Creator.getSchema(object_name)._schema;\n  if (_schema) {\n    field = _.pick(_schema, field_name);\n    is_wide = (ref = field[field_name]) != null ? (ref1 = ref.autoform) != null ? ref1.is_wide : void 0 : void 0;\n    return is_wide;\n  }\n};\n\nCreator.getTabularOrder = function(object_name, list_view_id, columns) {\n  var obj, ref, ref1, ref2, setting, sort;\n  setting = (ref = Creator.Collections) != null ? (ref1 = ref.settings) != null ? ref1.findOne({\n    object_name: object_name,\n    record_id: \"object_listviews\"\n  }) : void 0 : void 0;\n  obj = Creator.getObject(object_name);\n  columns = _.map(columns, function(column) {\n    var field;\n    field = obj.fields[column];\n    if ((field != null ? field.type : void 0) && !field.hidden) {\n      return column;\n    } else {\n      return void 0;\n    }\n  });\n  columns = _.compact(columns);\n  if (setting && setting.settings) {\n    sort = ((ref2 = setting.settings[list_view_id]) != null ? ref2.sort : void 0) || [];\n    sort = _.map(sort, function(order) {\n      var index, key;\n      key = order[0];\n      index = _.indexOf(columns, key);\n      order[0] = index + 1;\n      return order;\n    });\n    return sort;\n  }\n  return [];\n};\n\nCreator.initListViews = function(object_name) {\n  var columns, default_extra_columns, extra_columns, object, order, ref;\n  object = Creator.getObject(object_name);\n  columns = Creator.getObjectDefaultColumns(object_name) || [\"name\"];\n  extra_columns = [\"owner\"];\n  default_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"];\n  if (default_extra_columns) {\n    extra_columns = _.union(extra_columns, default_extra_columns);\n  }\n  order = Creator.getObjectDefaultSort(object_name) || [];\n  if (Meteor.isClient) {\n    return (ref = Creator.TabularSelectedIds) != null ? ref[object_name] = [] : void 0;\n  }\n};\n\nCreator.convertListView = function(default_columens, list_view, list_view_name) {\n  var oitem;\n  oitem = _.clone(list_view);\n  if (!_.has(oitem, \"name\")) {\n    oitem.name = list_view_name;\n  }\n  if (!oitem.columns) {\n    if (default_columens) {\n      oitem.columns = default_columens;\n    }\n  }\n  if (!oitem.columns) {\n    oitem.columns = [\"name\"];\n  }\n  if (!oitem.filter_scope) {\n    oitem.filter_scope = \"space\";\n  }\n  if (!_.has(oitem, \"_id\")) {\n    oitem._id = list_view_name;\n  } else {\n    oitem.label = oitem.label || list_view.name;\n  }\n  if (_.isString(oitem.options)) {\n    oitem.options = JSON.parse(oitem.options);\n  }\n  _.forEach(oitem.filters, function(filter, _index) {\n    if (!_.isArray(filter) && _.isObject(filter)) {\n      if (Meteor.isServer) {\n        if (_.isFunction(filter != null ? filter.value : void 0)) {\n          return filter._value = filter.value.toString();\n        }\n      } else {\n        if (_.isString(filter != null ? filter._value : void 0)) {\n          return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n        }\n      }\n    }\n  });\n  return oitem;\n};\n\nif (Meteor.isClient) {\n  Creator.getRelatedList = function(object_name) {\n    var list, related_objects;\n    list = [];\n    related_objects = Creator.getRelatedObjects(object_name);\n    _.each(related_objects, function(related_object_item) {\n      var columns, order, related, related_field_name, related_object, related_object_name, tabular_order;\n      related_object_name = related_object_item.object_name;\n      related_field_name = related_object_item.foreign_key;\n      related_object = Creator.getObject(related_object_name);\n      if (!related_object) {\n        return;\n      }\n      columns = Creator.getObjectDefaultColumns(related_object_name) || [\"name\"];\n      columns = _.without(columns, related_field_name);\n      order = Creator.getObjectDefaultSort(related_object_name);\n      tabular_order = Creator.transformSortToTabular(order, columns);\n      if (/\\w+\\.\\$\\.\\w+/g.test(related_field_name)) {\n        related_field_name = related_field_name.replace(/\\$\\./, \"\");\n      }\n      related = {\n        object_name: related_object_name,\n        columns: columns,\n        related_field_name: related_field_name,\n        is_file: related_object_name === \"cms_files\"\n      };\n      return list.push(related);\n    });\n    return list;\n  };\n}\n\nCreator.getObjectFirstListView = function(object_name) {\n  return _.first(Creator.getListViews(object_name));\n};\n\n\n/* \n\t取出list_view_id对应的视图，如果不存在或者没有权限，就返回第一个视图\n\texac为true时，需要强制按list_view_id精确查找，不默认返回第一个视图\n */\n\nCreator.getListView = function(object_name, list_view_id, exac) {\n  var listViews, list_view, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return;\n  }\n  listViews = Creator.getListViews(object_name);\n  if (!(listViews != null ? listViews.length : void 0)) {\n    return;\n  }\n  list_view = _.findWhere(listViews, {\n    \"_id\": list_view_id\n  });\n  if (!list_view) {\n    if (exac) {\n      return;\n    } else {\n      list_view = listViews[0];\n    }\n  }\n  return list_view;\n};\n\nCreator.getListViewIsRecent = function(object_name, list_view_id) {\n  var listView, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  if (typeof list_view_id === \"string\") {\n    object = Creator.getObject(object_name);\n    if (!object) {\n      return;\n    }\n    listView = _.findWhere(object.list_views, {\n      _id: list_view_id\n    });\n  } else {\n    listView = list_view_id;\n  }\n  return (listView != null ? listView.name : void 0) === \"recent\";\n};\n\n\n/*\n    获取默认视图\n */\n\nCreator.getObjectDefaultView = function(object_name) {\n  var defaultView, object, ref;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    object = Creator.Objects[object_name];\n  }\n  if (object != null ? (ref = object.list_views) != null ? ref[\"default\"] : void 0 : void 0) {\n    defaultView = object.list_views[\"default\"];\n  } else {\n    _.each(object != null ? object.list_views : void 0, function(list_view, key) {\n      if (list_view.name === \"all\" || key === \"all\") {\n        return defaultView = list_view;\n      }\n    });\n  }\n  return defaultView;\n};\n\n\n/*\n    获取对象的列表默认显示字段\n */\n\nCreator.getObjectDefaultColumns = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  return defaultView != null ? defaultView.columns : void 0;\n};\n\n\n/*\n\t获取对象的列表默认额外加载的字段\n */\n\nCreator.getObjectDefaultExtraColumns = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  return defaultView != null ? defaultView.extra_columns : void 0;\n};\n\n\n/*\n\t获取对象的默认排序\n */\n\nCreator.getObjectDefaultSort = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  if (defaultView) {\n    if (defaultView.sort) {\n      return defaultView.sort;\n    } else {\n      return [[\"created\", \"desc\"]];\n    }\n  }\n};\n\n\n/*\n    判断是否All view\n */\n\nCreator.isAllView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"all\";\n};\n\n\n/*\n    判断是否最近查看 view\n */\n\nCreator.isRecentView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"recent\";\n};\n\n\n/*\n    将sort转换为Tabular控件所需要的格式\n */\n\nCreator.transformSortToTabular = function(sort, tabularColumns) {\n  var tabular_sort;\n  tabular_sort = [];\n  _.each(sort, function(item) {\n    var column_index, field_name, order;\n    if (_.isArray(item)) {\n      if (item.length === 1) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, \"asc\"]);\n        }\n      } else if (item.length === 2) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, item[1]]);\n        }\n      }\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        column_index = tabularColumns.indexOf(field_name);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, order]);\n        }\n      }\n    }\n  });\n  return tabular_sort;\n};\n\n\n/*\n    将sort转换为DevExpress控件所需要的格式\n */\n\nCreator.transformSortToDX = function(sort) {\n  var dx_sort;\n  dx_sort = [];\n  _.each(sort, function(item) {\n    var field_name, order;\n    if (_.isArray(item)) {\n      return dx_sort.push(item);\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        return dx_sort.push([field_name, order]);\n      }\n    }\n  });\n  return dx_sort;\n};\n","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$')\n\nif Meteor.isClient\n\tMeteor.startup ()->\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.code, msg: \"[label] 只能以字母、_开头，且只能包含字母、数字、_\"}\n\t\tSimpleSchema.messages({\n\t\t\tregEx: _regExMessages,\n\t\t})","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.code,\n      msg: \"[label] 只能以字母、_开头，且只能包含字母、数字、_\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$')\n\nif Meteor.isClient\n\tMeteor.startup ()->\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.field, msg: \"[label] 只能以字母、_开头，.$.前后必须包含字符\"}\n\t\tSimpleSchema.messages({\n\t\t\tregEx: _regExMessages,\n\t\t})","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.field,\n      msg: \"[label] 只能以字母、_开头，.$.前后必须包含字符\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","// 因为meteor编译coffeescript会导致eval函数报错，所以单独写在一个js文件中。\nCreator.evalInContext = function(js, context) {\n    //# Return the results of the in-line anonymous function we .call with the passed context\n    return function() { \n    \treturn eval(js); \n\t}.call(context);\n}\n\n\nCreator.eval = function(js){\n\treturn eval(js)\n}","\tgetOption = (option)->\n\t\tfoo = option.split(\":\")\n\t\tif foo.length > 1\n\t\t\treturn {label: foo[0], value: foo[1]}\n\t\telse\n\t\t\treturn {label: foo[0], value: foo[0]}\n\n\tCreator.convertObject = (object)->\n\t\t_.forEach object.triggers, (trigger, key)->\n\n\t\t\tif (Meteor.isServer && trigger.on == \"server\") || (Meteor.isClient && trigger.on == \"client\")\n\t\t\t\t_todo_from_code = trigger?._todo\n\t\t\t\t_todo_from_db = trigger.todo\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\n\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_code})\")\n\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\n\t\t\t\t\t#只有update时， fieldNames, modifier, options 才有值\n\t\t\t\t\t#TODO 控制可使用的变量，尤其是Collection\n\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_db})\")\n\t\t\t\t\telse\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(function(userId, doc, fieldNames, modifier, options){#{_todo_from_db}})\")\n\n\t\t\tif Meteor.isServer && trigger.on == \"client\"\n\t\t\t\t_todo = trigger.todo\n\t\t\t\tif _todo && _.isFunction(_todo)\n\t\t\t\t\ttrigger._todo = _todo.toString()\n\n\t\tif Meteor.isClient\n\t\t\t_.forEach object.actions, (action, key)->\n\t\t\t\t_todo_from_code = action?._todo\n\t\t\t\t_todo_from_db = action?.todo\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\n\t\t\t\t\t#TODO 控制可使用的变量\n\t\t\t\t\ttry\n\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_code})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"todo_from_code\", _todo_from_code\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\n\t\t\t\t\t#TODO 控制可使用的变量\n\t\t\t\t\ttry\n\t\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\n\t\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_db})\")\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isFunction(Creator.actionsByName[_todo_from_db])\n\t\t\t\t\t\t\t\taction.todo = _todo_from_db\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\taction.todo = Creator.eval(\"(function(){#{_todo_from_db}})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"todo_from_db\", _todo_from_db, error\n\n\t\t\t\t_visible = action?._visible\n\t\t\t\tif _visible\n\t\t\t\t\ttry\n\t\t\t\t\t\taction.visible = Creator.eval(\"(#{_visible})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"action.visible to function error: \", error, _visible\n\t\telse\n\t\t\t_.forEach object.actions, (action, key)->\n\t\t\t\t_todo = action?.todo\n\t\t\t\tif _todo && _.isFunction(_todo)\n\t\t\t\t\t#TODO 控制可使用的变量\n\t\t\t\t\taction._todo = _todo.toString()\n\n\t\t\t\t_visible = action?.visible\n\n\t\t\t\tif _visible && _.isFunction(_visible)\n\t\t\t\t\taction._visible = _visible.toString()\n\n\t\t_.forEach object.fields, (field, key)->\n\t\t\tif field.options && _.isString(field.options)\n\t\t\t\ttry\n\t\t\t\t\t_options = []\n\t\t\t\t\t#支持\\n或者英文逗号分割,\n\t\t\t\t\t_.forEach field.options.split(\"\\n\"), (option)->\n\t\t\t\t\t\tif option.indexOf(\",\")\n\t\t\t\t\t\t\toptions = option.split(\",\")\n\t\t\t\t\t\t\t_.forEach options, (_option)->\n\t\t\t\t\t\t\t\t_options.push(getOption(_option))\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_options.push(getOption(option))\n\t\t\t\t\tfield.options = _options\n\t\t\t\tcatch error\n\t\t\t\t\tconsole.error \"Creator.convertFieldsOptions\", field.options, error\n\n\t\t\telse if field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)\n\t\t\t\t_options = []\n\t\t\t\t_.each field.options, (v, k)->\n\t\t\t\t\t_options.push {label: v, value: k}\n\t\t\t\tfield.options = _options\n\n\t\t\tif Meteor.isServer\n\t\t\t\toptions = field.options\n\t\t\t\tif options && _.isFunction(options)\n\t\t\t\t\tfield._options = field.options.toString()\n\t\t\telse\n\t\t\t\toptions = field._options\n\t\t\t\tif options && _.isString(options)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.options = Creator.eval(\"(#{options})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tregEx = field.regEx\n\t\t\t\tif regEx\n\t\t\t\t\tfield._regEx = field.regEx.toString()\n\t\t\telse\n\t\t\t\tregEx = field._regEx\n\t\t\t\tif regEx\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.regEx = Creator.eval(\"(#{regEx})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tif field.autoform\n\t\t\t\t\t_type = field.autoform.type\n\t\t\t\t\tif _type && _.isFunction(_type) && _type != Object && _type != String && _type != Number && _type != Boolean && !_.isArray(_type)\n\t\t\t\t\t\tfield.autoform._type = _type.toString()\n\t\t\telse\n\t\t\t\tif field.autoform\n\t\t\t\t\t_type = field.autoform._type\n\t\t\t\t\tif _type && _.isString(_type)\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t\tfield.autoform.type = Creator.eval(\"(#{_type})\")\n\t\t\t\t\t\tcatch error\n\t\t\t\t\t\t\tconsole.error \"convert field -> type error\", field, error\n\n\t\t\tif Meteor.isServer\n\n\t\t\t\toptionsFunction = field.optionsFunction\n\t\t\t\treference_to = field.reference_to\n\t\t\t\tcreateFunction = field.createFunction\n\t\t\t\tbeforeOpenFunction = field.beforeOpenFunction\n\t\t\t\tfiltersFunction = field.filtersFunction\n\n\t\t\t\tif optionsFunction && _.isFunction(optionsFunction)\n\t\t\t\t\tfield._optionsFunction = optionsFunction.toString()\n\n\t\t\t\tif reference_to && _.isFunction(reference_to)\n\t\t\t\t\tfield._reference_to = reference_to.toString()\n\n\t\t\t\tif createFunction && _.isFunction(createFunction)\n\t\t\t\t\tfield._createFunction = createFunction.toString()\n\t\t\t\tif beforeOpenFunction && _.isFunction(beforeOpenFunction)\n\t\t\t\t\tfield._beforeOpenFunction = beforeOpenFunction.toString()\n\n\t\t\t\tif filtersFunction && _.isFunction(filtersFunction)\n\t\t\t\t\tfield._filtersFunction = filtersFunction.toString()\n\t\t\telse\n\n\t\t\t\toptionsFunction = field._optionsFunction || field.optionsFunction\n\t\t\t\treference_to = field._reference_to\n\t\t\t\tcreateFunction = field._createFunction\n\t\t\t\tbeforeOpenFunction = field._beforeOpenFunction\n\t\t\t\tfiltersFunction = field._filtersFunction\n\n\t\t\t\tif optionsFunction && _.isString(optionsFunction)\n\t\t\t\t\tfield.optionsFunction = Creator.eval(\"(#{optionsFunction})\")\n\n\t\t\t\tif reference_to && _.isString(reference_to)\n\t\t\t\t\tfield.reference_to = Creator.eval(\"(#{reference_to})\")\n\n\t\t\t\tif createFunction && _.isString(createFunction)\n\t\t\t\t\tfield.createFunction = Creator.eval(\"(#{createFunction})\")\n\n\t\t\t\tif beforeOpenFunction && _.isString(beforeOpenFunction)\n\t\t\t\t\tfield.beforeOpenFunction = Creator.eval(\"(#{beforeOpenFunction})\")\n\n\t\t\t\tif filtersFunction && _.isString(filtersFunction)\n\t\t\t\t\tfield.filtersFunction = Creator.eval(\"(#{filtersFunction})\")\n\n\t\t\tif Meteor.isServer\n\t\t\t\tdefaultValue = field.defaultValue\n\t\t\t\tif defaultValue && _.isFunction(defaultValue)\n\t\t\t\t\tfield._defaultValue = field.defaultValue.toString()\n\t\t\telse\n\t\t\t\tdefaultValue = field._defaultValue\n\n\t\t\t\tif !defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")\n\t\t\t\t\tdefaultValue = field.defaultValue\n\n\t\t\t\tif defaultValue && _.isString(defaultValue)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.defaultValue = Creator.eval(\"(#{defaultValue})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\t\t\t\n\t\t\tif Meteor.isServer\n\t\t\t\tis_company_limited = field.is_company_limited\n\t\t\t\tif is_company_limited && _.isFunction(is_company_limited)\n\t\t\t\t\tfield._is_company_limited = field.is_company_limited.toString()\n\t\t\telse\n\t\t\t\tis_company_limited = field._is_company_limited\n\t\t\t\tif is_company_limited && _.isString(is_company_limited)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.is_company_limited = Creator.eval(\"(#{is_company_limited})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t_.forEach object.list_views, (list_view, key) ->\n\t\t\t###\n\t\t\t视图过虑器需要支持function，后台转成字符串，前台eval成函数\n\t\t\t让过虑器支持两种function方式：\n\t\t\t1. 整个filters为function:\n\t\t\t如：\n\t\t\tfilters: ()->\n\t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\n\t\t\t2. filters内的filter.value为function\n\t\t\t如：\n\t\t\tfilters: [[\"object_name\", \"=\", ()->\n\t\t\t\treturn \"project_issues\"\n\t\t\t]]\n\t\t\t或\n\t\t\tfilters: [{\n\t\t\t\t\"field\": \"object_name\"\n\t\t\t\t\"operation\": \"=\"\n\t\t\t\t\"value\": ()->\n\t\t\t\t\treturn \"project_issues\"\n\t\t\t}]\n\t\t\t###\n\t\t\tif _.isFunction(list_view.filters)\n\t\t\t\tif Meteor.isServer\n\t\t\t\t\tlist_view._filters = list_view.filters.toString()\n\t\t\telse if _.isString(list_view._filters)\n\t\t\t\tif Meteor.isClient\n\t\t\t\t\tlist_view.filters = Creator.eval(\"(#{list_view._filters})\")\n\t\t\telse\n\t\t\t\t_.forEach list_view.filters, (filter, _index)->\n\t\t\t\t\tif _.isArray(filter)\n\t\t\t\t\t\tif Meteor.isServer\n\t\t\t\t\t\t\tif filter.length == 3 and _.isFunction(filter[2])\n\t\t\t\t\t\t\t\tfilter[2] = filter[2].toString()\n\t\t\t\t\t\t\t\tfilter[3] = \"FUNCTION\"\n\t\t\t\t\t\t\telse if filter.length == 3 and _.isDate(filter[2])\n\t\t\t\t\t\t\t\t# 如果是Date类型，则filter[2]值到前端会自动转成字符串，格式：\"2018-03-29T03:43:21.787Z\"\n\t\t\t\t\t\t\t\t# 包括grid列表请求的接口在内的所有OData接口，Date类型字段都会以上述格式返回\n\t\t\t\t\t\t\t\tfilter[3] = \"DATE\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"FUNCTION\"\n\t\t\t\t\t\t\t\tfilter[2] = Creator.eval(\"(#{filter[2]})\")\n\t\t\t\t\t\t\t\tfilter.pop()\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"DATE\"\n\t\t\t\t\t\t\t\tfilter[2] = new Date(filter[2])\n\t\t\t\t\t\t\t\tfilter.pop()\n\t\t\t\t\telse if _.isObject(filter)\n\t\t\t\t\t\tif Meteor.isServer\n\t\t\t\t\t\t\tif _.isFunction(filter?.value)\n\t\t\t\t\t\t\t\tfilter._value = filter.value.toString()\n\t\t\t\t\t\t\telse if _.isDate(filter?.value)\n\t\t\t\t\t\t\t\tfilter._is_date = true\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isString(filter?._value)\n\t\t\t\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\n\t\t\t\t\t\t\telse if filter._is_date == true\n\t\t\t\t\t\t\t\tfilter.value = new Date(filter.value)\n\t\treturn object\n\n\n","var getOption;\n\ngetOption = function(option) {\n  var foo;\n  foo = option.split(\":\");\n  if (foo.length > 1) {\n    return {\n      label: foo[0],\n      value: foo[1]\n    };\n  } else {\n    return {\n      label: foo[0],\n      value: foo[0]\n    };\n  }\n};\n\nCreator.convertObject = function(object) {\n  _.forEach(object.triggers, function(trigger, key) {\n    var _todo, _todo_from_code, _todo_from_db;\n    if ((Meteor.isServer && trigger.on === \"server\") || (Meteor.isClient && trigger.on === \"client\")) {\n      _todo_from_code = trigger != null ? trigger._todo : void 0;\n      _todo_from_db = trigger.todo;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        if (_todo_from_db.startsWith(\"function\")) {\n          trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n        } else {\n          trigger.todo = Creator[\"eval\"](\"(function(userId, doc, fieldNames, modifier, options){\" + _todo_from_db + \"})\");\n        }\n      }\n    }\n    if (Meteor.isServer && trigger.on === \"client\") {\n      _todo = trigger.todo;\n      if (_todo && _.isFunction(_todo)) {\n        return trigger._todo = _todo.toString();\n      }\n    }\n  });\n  if (Meteor.isClient) {\n    _.forEach(object.actions, function(action, key) {\n      var _todo_from_code, _todo_from_db, _visible, error;\n      _todo_from_code = action != null ? action._todo : void 0;\n      _todo_from_db = action != null ? action.todo : void 0;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        try {\n          action.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_code\", _todo_from_code);\n        }\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        try {\n          if (_todo_from_db.startsWith(\"function\")) {\n            action.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n          } else {\n            if (_.isFunction(Creator.actionsByName[_todo_from_db])) {\n              action.todo = _todo_from_db;\n            } else {\n              action.todo = Creator[\"eval\"](\"(function(){\" + _todo_from_db + \"})\");\n            }\n          }\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_db\", _todo_from_db, error);\n        }\n      }\n      _visible = action != null ? action._visible : void 0;\n      if (_visible) {\n        try {\n          return action.visible = Creator[\"eval\"](\"(\" + _visible + \")\");\n        } catch (error1) {\n          error = error1;\n          return console.error(\"action.visible to function error: \", error, _visible);\n        }\n      }\n    });\n  } else {\n    _.forEach(object.actions, function(action, key) {\n      var _todo, _visible;\n      _todo = action != null ? action.todo : void 0;\n      if (_todo && _.isFunction(_todo)) {\n        action._todo = _todo.toString();\n      }\n      _visible = action != null ? action.visible : void 0;\n      if (_visible && _.isFunction(_visible)) {\n        return action._visible = _visible.toString();\n      }\n    });\n  }\n  _.forEach(object.fields, function(field, key) {\n    var _options, _type, beforeOpenFunction, createFunction, defaultValue, error, filtersFunction, is_company_limited, options, optionsFunction, reference_to, regEx;\n    if (field.options && _.isString(field.options)) {\n      try {\n        _options = [];\n        _.forEach(field.options.split(\"\\n\"), function(option) {\n          var options;\n          if (option.indexOf(\",\")) {\n            options = option.split(\",\");\n            return _.forEach(options, function(_option) {\n              return _options.push(getOption(_option));\n            });\n          } else {\n            return _options.push(getOption(option));\n          }\n        });\n        field.options = _options;\n      } catch (error1) {\n        error = error1;\n        console.error(\"Creator.convertFieldsOptions\", field.options, error);\n      }\n    } else if (field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)) {\n      _options = [];\n      _.each(field.options, function(v, k) {\n        return _options.push({\n          label: v,\n          value: k\n        });\n      });\n      field.options = _options;\n    }\n    if (Meteor.isServer) {\n      options = field.options;\n      if (options && _.isFunction(options)) {\n        field._options = field.options.toString();\n      }\n    } else {\n      options = field._options;\n      if (options && _.isString(options)) {\n        try {\n          field.options = Creator[\"eval\"](\"(\" + options + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      regEx = field.regEx;\n      if (regEx) {\n        field._regEx = field.regEx.toString();\n      }\n    } else {\n      regEx = field._regEx;\n      if (regEx) {\n        try {\n          field.regEx = Creator[\"eval\"](\"(\" + regEx + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      if (field.autoform) {\n        _type = field.autoform.type;\n        if (_type && _.isFunction(_type) && _type !== Object && _type !== String && _type !== Number && _type !== Boolean && !_.isArray(_type)) {\n          field.autoform._type = _type.toString();\n        }\n      }\n    } else {\n      if (field.autoform) {\n        _type = field.autoform._type;\n        if (_type && _.isString(_type)) {\n          try {\n            field.autoform.type = Creator[\"eval\"](\"(\" + _type + \")\");\n          } catch (error1) {\n            error = error1;\n            console.error(\"convert field -> type error\", field, error);\n          }\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      optionsFunction = field.optionsFunction;\n      reference_to = field.reference_to;\n      createFunction = field.createFunction;\n      beforeOpenFunction = field.beforeOpenFunction;\n      filtersFunction = field.filtersFunction;\n      if (optionsFunction && _.isFunction(optionsFunction)) {\n        field._optionsFunction = optionsFunction.toString();\n      }\n      if (reference_to && _.isFunction(reference_to)) {\n        field._reference_to = reference_to.toString();\n      }\n      if (createFunction && _.isFunction(createFunction)) {\n        field._createFunction = createFunction.toString();\n      }\n      if (beforeOpenFunction && _.isFunction(beforeOpenFunction)) {\n        field._beforeOpenFunction = beforeOpenFunction.toString();\n      }\n      if (filtersFunction && _.isFunction(filtersFunction)) {\n        field._filtersFunction = filtersFunction.toString();\n      }\n    } else {\n      optionsFunction = field._optionsFunction || field.optionsFunction;\n      reference_to = field._reference_to;\n      createFunction = field._createFunction;\n      beforeOpenFunction = field._beforeOpenFunction;\n      filtersFunction = field._filtersFunction;\n      if (optionsFunction && _.isString(optionsFunction)) {\n        field.optionsFunction = Creator[\"eval\"](\"(\" + optionsFunction + \")\");\n      }\n      if (reference_to && _.isString(reference_to)) {\n        field.reference_to = Creator[\"eval\"](\"(\" + reference_to + \")\");\n      }\n      if (createFunction && _.isString(createFunction)) {\n        field.createFunction = Creator[\"eval\"](\"(\" + createFunction + \")\");\n      }\n      if (beforeOpenFunction && _.isString(beforeOpenFunction)) {\n        field.beforeOpenFunction = Creator[\"eval\"](\"(\" + beforeOpenFunction + \")\");\n      }\n      if (filtersFunction && _.isString(filtersFunction)) {\n        field.filtersFunction = Creator[\"eval\"](\"(\" + filtersFunction + \")\");\n      }\n    }\n    if (Meteor.isServer) {\n      defaultValue = field.defaultValue;\n      if (defaultValue && _.isFunction(defaultValue)) {\n        field._defaultValue = field.defaultValue.toString();\n      }\n    } else {\n      defaultValue = field._defaultValue;\n      if (!defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")) {\n        defaultValue = field.defaultValue;\n      }\n      if (defaultValue && _.isString(defaultValue)) {\n        try {\n          field.defaultValue = Creator[\"eval\"](\"(\" + defaultValue + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      is_company_limited = field.is_company_limited;\n      if (is_company_limited && _.isFunction(is_company_limited)) {\n        return field._is_company_limited = field.is_company_limited.toString();\n      }\n    } else {\n      is_company_limited = field._is_company_limited;\n      if (is_company_limited && _.isString(is_company_limited)) {\n        try {\n          return field.is_company_limited = Creator[\"eval\"](\"(\" + is_company_limited + \")\");\n        } catch (error1) {\n          error = error1;\n          return console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n  });\n  _.forEach(object.list_views, function(list_view, key) {\n\n    /*\n    \t\t\t视图过虑器需要支持function，后台转成字符串，前台eval成函数\n    \t\t\t让过虑器支持两种function方式：\n    \t\t\t1. 整个filters为function:\n    \t\t\t如：\n    \t\t\tfilters: ()->\n    \t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\n    \t\t\t2. filters内的filter.value为function\n    \t\t\t如：\n    \t\t\tfilters: [[\"object_name\", \"=\", ()->\n    \t\t\t\treturn \"project_issues\"\n    \t\t\t]]\n    \t\t\t或\n    \t\t\tfilters: [{\n    \t\t\t\t\"field\": \"object_name\"\n    \t\t\t\t\"operation\": \"=\"\n    \t\t\t\t\"value\": ()->\n    \t\t\t\t\treturn \"project_issues\"\n    \t\t\t}]\n     */\n    if (_.isFunction(list_view.filters)) {\n      if (Meteor.isServer) {\n        return list_view._filters = list_view.filters.toString();\n      }\n    } else if (_.isString(list_view._filters)) {\n      if (Meteor.isClient) {\n        return list_view.filters = Creator[\"eval\"](\"(\" + list_view._filters + \")\");\n      }\n    } else {\n      return _.forEach(list_view.filters, function(filter, _index) {\n        if (_.isArray(filter)) {\n          if (Meteor.isServer) {\n            if (filter.length === 3 && _.isFunction(filter[2])) {\n              filter[2] = filter[2].toString();\n              return filter[3] = \"FUNCTION\";\n            } else if (filter.length === 3 && _.isDate(filter[2])) {\n              return filter[3] = \"DATE\";\n            }\n          } else {\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"FUNCTION\") {\n              filter[2] = Creator[\"eval\"](\"(\" + filter[2] + \")\");\n              filter.pop();\n            }\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"DATE\") {\n              filter[2] = new Date(filter[2]);\n              return filter.pop();\n            }\n          }\n        } else if (_.isObject(filter)) {\n          if (Meteor.isServer) {\n            if (_.isFunction(filter != null ? filter.value : void 0)) {\n              return filter._value = filter.value.toString();\n            } else if (_.isDate(filter != null ? filter.value : void 0)) {\n              return filter._is_date = true;\n            }\n          } else {\n            if (_.isString(filter != null ? filter._value : void 0)) {\n              return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n            } else if (filter._is_date === true) {\n              return filter.value = new Date(filter.value);\n            }\n          }\n        }\n      });\n    }\n  });\n  return object;\n};\n","Creator.Formular = {}\n\nCreator.Formular.PREFIX = \"_VALUES\"\n\nCreator.Formular._prependPrefixForFormula = (prefix,fieldVariable)->\n\treg = /(\\{[^{}]*\\})/g;\n\n\trev = fieldVariable.replace reg, (m, $1)->\n\t\treturn prefix + $1.replace(/\\{\\s*/,\"[\\\"\").replace(/\\s*\\}/,\"\\\"]\").replace(/\\s*\\.\\s*/g,\"\\\"][\\\"\");\n\n\treturn rev\n\nCreator.Formular.checkFormula = (formula_str)->\n\tif _.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1\n\t\treturn true\n\treturn false\n\nCreator.Formular.run = (formula_str, _CONTEXT, options)->\n\tif formula_str && _.isString(formula_str)\n\n\t\tif !_.isBoolean(options?.extend)\n\t\t\textend = true\n\n\t\t_VALUES = {}\n\t\t_VALUES = _.extend(_VALUES, _CONTEXT)\n\t\tif extend\n\t\t\t_VALUES = _.extend(_VALUES, Creator.getUserContext(options?.userId, options?.spaceId))\n\t\tformula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str)\n\n\t\ttry\n\t\t\tdata = Creator.evalInContext(formula_str, _VALUES)   # 此处不能用window.eval ，会导致变量作用域异常\n\t\t\treturn data\n\t\tcatch e\n\t\t\tconsole.error(\"Creator.Formular.run: #{formula_str}\", e)\n\t\t\tif Meteor.isClient\n\t\t\t\ttoastr?.error(\"公式执行出错了，请检查公式配置是否正确！\")\n\t\t\tthrow new Meteor.Error 500, \"Creator.Formular.run: #{formula_str}#{e}\"\n\n\treturn formula_str\n","Creator.Formular = {};\n\nCreator.Formular.PREFIX = \"_VALUES\";\n\nCreator.Formular._prependPrefixForFormula = function(prefix, fieldVariable) {\n  var reg, rev;\n  reg = /(\\{[^{}]*\\})/g;\n  rev = fieldVariable.replace(reg, function(m, $1) {\n    return prefix + $1.replace(/\\{\\s*/, \"[\\\"\").replace(/\\s*\\}/, \"\\\"]\").replace(/\\s*\\.\\s*/g, \"\\\"][\\\"\");\n  });\n  return rev;\n};\n\nCreator.Formular.checkFormula = function(formula_str) {\n  if (_.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Formular.run = function(formula_str, _CONTEXT, options) {\n  var _VALUES, data, e, extend;\n  if (formula_str && _.isString(formula_str)) {\n    if (!_.isBoolean(options != null ? options.extend : void 0)) {\n      extend = true;\n    }\n    _VALUES = {};\n    _VALUES = _.extend(_VALUES, _CONTEXT);\n    if (extend) {\n      _VALUES = _.extend(_VALUES, Creator.getUserContext(options != null ? options.userId : void 0, options != null ? options.spaceId : void 0));\n    }\n    formula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str);\n    try {\n      data = Creator.evalInContext(formula_str, _VALUES);\n      return data;\n    } catch (error) {\n      e = error;\n      console.error(\"Creator.Formular.run: \" + formula_str, e);\n      if (Meteor.isClient) {\n        if (typeof toastr !== \"undefined\" && toastr !== null) {\n          toastr.error(\"公式执行出错了，请检查公式配置是否正确！\");\n        }\n      }\n      throw new Meteor.Error(500, \"Creator.Formular.run: \" + formula_str + e);\n    }\n  }\n  return formula_str;\n};\n","\nCreator.objectsByName = {}   # 此对象只能在确保所有Object初始化完成后调用， 否则获取到的object不全\n\nCreator.formatObjectName = (object_name)->\n\tif object_name.startsWith('cfs.files.')\n\t\tobject_name = object_name.replace(new RegExp('\\\\.', 'g'), '_')\n\treturn object_name\n\nCreator.Object = (options)->\n\tself = this\n\tif (!options.name)\n\t\tconsole.error(options)\n\t\tthrow new Error('Creator.Object options must specify name');\n\n\tself._id = options._id || options.name\n\tself.space = options.space\n\tself.name = options.name\n\tself.label = options.label\n\tself.icon = options.icon\n\tself.description = options.description\n\tself.is_view = options.is_view\n\tif !_.isBoolean(options.is_enable)  || options.is_enable == true\n\t\tself.is_enable = true\n\telse\n\t\tself.is_enable = false\n\tself.enable_search = options.enable_search\n\tself.enable_files = options.enable_files\n\tself.enable_tasks = options.enable_tasks\n\tself.enable_notes = options.enable_notes\n\tself.enable_audit = options.enable_audit\n\tself.hidden = options.hidden\n\tself.enable_api = (options.enable_api == undefined) or options.enable_api\n\tself.custom = options.custom\n\tself.enable_share = options.enable_share\n\tself.enable_instances = options.enable_instances\n\tself.enable_tree = options.enable_tree\n\tself.open_window = options.open_window\n\tself.filter_company = options.filter_company\n\tself.calendar = _.clone(options.calendar)\n\tself.sidebar = _.clone(options.sidebar)\n\tself.enable_chatter = options.enable_chatter\n\tself.enable_trash = options.enable_trash\n\tself.enable_space_global = options.enable_space_global\n\tself.enable_approvals = options.enable_approvals\n\tself.idFieldName = '_id'\n\tif options.database_name\n\t\tself.database_name = options.database_name\n\tif (!options.fields)\n\t\tconsole.error(options)\n\t\tthrow new Error('Creator.Object options must specify name');\n\n\tself.fields = _.clone(options.fields)\n\n\t_.each self.fields, (field, field_name)->\n\t\tif field_name == 'name' || field.is_name\n\t\t\tself.NAME_FIELD_KEY = field_name\n\t\tif field.primary\n\t\t\tself.idFieldName = field_name\n\n\tif !options.database_name || options.database_name == 'meteor-mongo'\n\t\t_.each Creator.baseObject.fields, (field, field_name)->\n\t\t\tif !self.fields[field_name]\n\t\t\t\tself.fields[field_name] = {}\n\t\t\tself.fields[field_name] = _.extend(_.clone(field), self.fields[field_name])\n\n\tself.list_views = {}\n\tdefaultColumns = Creator.getObjectDefaultColumns(self.name)\n\t_.each options.list_views, (item, item_name)->\n\t\toitem = Creator.convertListView(defaultColumns, item, item_name)\n\t\tself.list_views[item_name] = oitem\n\n\tself.triggers = _.clone(Creator.baseObject.triggers)\n\t_.each options.triggers, (item, item_name)->\n\t\tif !self.triggers[item_name]\n\t\t\tself.triggers[item_name] = {}\n\t\tself.triggers[item_name].name = item_name\n\t\tself.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item)\n\n\tself.actions = _.clone(Creator.baseObject.actions)\n\t_.each options.actions, (item, item_name)->\n\t\tif !self.actions[item_name]\n\t\t\tself.actions[item_name] = {}\n\t\tcopyItem = _.clone(self.actions[item_name])\n\t\tdelete self.actions[item_name] #先删除相关属性再重建才能保证后续重复定义的属性顺序生效\n\t\tself.actions[item_name] = _.extend(copyItem, item)\n\n\t_.each self.actions, (item, item_name)->\n\t\titem.name = item_name\n\n\tself.related_objects = Creator.getObjectRelateds(self.name)\n\n\t# 让所有object默认有所有list_views/actions/related_objects/readable_fields/editable_fields完整权限，该权限可能被数据库中设置的admin/user权限覆盖\n\tself.permission_set = _.clone(Creator.baseObject.permission_set)\n\t# defaultListViews = _.keys(self.list_views)\n\t# defaultActions = _.keys(self.actions)\n\t# defaultRelatedObjects = _.pluck(self.related_objects,\"object_name\")\n\t# defaultReadableFields = []\n\t# defaultEditableFields = []\n\t# _.each self.fields, (field, field_name)->\n\t# \tif !(field.hidden)    #231 omit字段支持在非编辑页面查看, 因此删除了此处对omit的判断\n\t# \t\tdefaultReadableFields.push field_name\n\t# \t\tif !field.readonly\n\t# \t\t\tdefaultEditableFields.push field_name\n\n\t# _.each self.permission_set, (item, item_name)->\n\t# \tif item_name == \"none\"\n\t# \t\treturn\n\t# \tif self.list_views\n\t# \t\tself.permission_set[item_name].list_views = defaultListViews\n\t# \tif self.actions\n\t# \t\tself.permission_set[item_name].actions = defaultActions\n\t# \tif self.related_objects\n\t# \t\tself.permission_set[item_name].related_objects = defaultRelatedObjects\n\t# \tif self.fields\n\t# \t\tself.permission_set[item_name].readable_fields = defaultReadableFields\n\t# \t\tself.permission_set[item_name].editable_fields = defaultEditableFields\n\tunless options.permission_set\n\t\toptions.permission_set = {}\n\tif !(options.permission_set?.admin)\n\t\toptions.permission_set.admin = _.clone(self.permission_set[\"admin\"])\n\tif !(options.permission_set?.user)\n\t\toptions.permission_set.user = _.clone(self.permission_set[\"user\"])\n\t_.each options.permission_set, (item, item_name)->\n\t\tif !self.permission_set[item_name]\n\t\t\tself.permission_set[item_name] = {}\n\t\tself.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item)\n\n\t# 前端根据permissions改写field相关属性，后端只要走默认属性就行，不需要改写\n\tif Meteor.isClient\n\t\tpermissions = options.permissions\n\t\tdisabled_list_views = permissions?.disabled_list_views\n\t\tif disabled_list_views?.length\n\t\t\tdefaultListViewId = options.list_views?.all?._id\n\t\t\tif defaultListViewId\n\t\t\t\t# 把视图权限配置中默认的all视图id转换成all关键字\n\t\t\t\tpermissions.disabled_list_views = _.map disabled_list_views, (list_view_item) ->\n\t\t\t\t\treturn if defaultListViewId == list_view_item then \"all\" else list_view_item\n\t\tself.permissions = new ReactiveVar(permissions)\n\t\t_.each self.fields, (field, field_name)->\n\t\t\tif field\n\t\t\t\tif _.indexOf(permissions?.unreadable_fields, field_name) < 0\n\t\t\t\t\tif field.hidden\n\t\t\t\t\t\treturn\n\t\t\t\t\tif _.indexOf(permissions?.uneditable_fields, field_name) > -1\n\t\t\t\t\t\tfield.readonly = true\n\t\t\t\t\t\tfield.disabled = true\n\t\t\t\t\t\t# 当只读时，如果不去掉必填字段，autoform是会报错的\n\t\t\t\t\t\tfield.required = false\n\t\t\t\telse\n\t\t\t\t\tfield.hidden = true\n\telse\n\t\tself.permissions = null\n\n\t_db = Creator.createCollection(options)\n\n\tCreator.Collections[_db._name] = _db\n\n\tself.db = _db\n\n\tself._collection_name = _db._name\n\n\tschema = Creator.getObjectSchema(self)\n\tself.schema = new SimpleSchema(schema)\n\tif self.name != \"users\" and self.name != \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)\n\t\tif Meteor.isClient\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\t\telse\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\tif self.name == \"users\"\n\t\t_db._simpleSchema = self.schema\n\n\tif _.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)\n\t\tif Meteor.isClient\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\n\tCreator.objectsByName[self._collection_name] = self\n\n\treturn self\n\nCreator.Object.prototype.i18n = ()->\n\t# set object label\n\tself = this\n\n\tkey = self.name\n\tif t(key) == key\n\t\tif !self.label\n\t\t\tself.label = self.name\n\telse\n\t\tself.label = t(key)\n\n\t# set field labels\n\t_.each self.fields, (field, field_name)->\n\t\tfkey = self.name + \"_\" + field_name\n\t\tif t(fkey) == fkey\n\t\t\tif !field.label\n\t\t\t\tfield.label = field_name\n\t\telse\n\t\t\tfield.label = t(fkey)\n\t\tself.schema?._schema?[field_name]?.label = field.label\n\n\n\t# set listview labels\n\t_.each self.list_views, (item, item_name)->\n\t\ti18n_key = self.name + \"_listview_\" + item_name\n\t\tif t(i18n_key) == i18n_key\n\t\t\tif !item.label\n\t\t\t\titem.label = item_name\n\t\telse\n\t\t\titem.label = t(i18n_key)\n\n\nCreator.getObjectODataRouterPrefix = (object)->\n\tif object\n\t\tif !object.database_name || object.database_name == 'meteor-mongo'\n\t\t\treturn \"/api/odata/v4\"\n\t\telse\n\t\t\treturn \"/api/odata/#{object.database_name}\"\n\nif Meteor.isClient\n\n\tMeteor.startup ->\n\t\tTracker.autorun ->\n\t\t\tif Session.get(\"steedos-locale\") && Creator.bootstrapLoaded?.get()\n\t\t\t\t_.each Creator.objectsByName, (object, object_name)->\n\t\t\t\t\tobject.i18n()\n\nMeteor.startup ->\n\tif !Creator.bootstrapLoaded && Creator.Objects\n\t\t_.each Creator.Objects, (object)->\n\t\t\tnew Creator.Object(object)\n\n","Creator.objectsByName = {};\n\nCreator.formatObjectName = function(object_name) {\n  if (object_name.startsWith('cfs.files.')) {\n    object_name = object_name.replace(new RegExp('\\\\.', 'g'), '_');\n  }\n  return object_name;\n};\n\nCreator.Object = function(options) {\n  var _db, defaultColumns, defaultListViewId, disabled_list_views, permissions, ref, ref1, ref2, ref3, schema, self;\n  self = this;\n  if (!options.name) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify name');\n  }\n  self._id = options._id || options.name;\n  self.space = options.space;\n  self.name = options.name;\n  self.label = options.label;\n  self.icon = options.icon;\n  self.description = options.description;\n  self.is_view = options.is_view;\n  if (!_.isBoolean(options.is_enable) || options.is_enable === true) {\n    self.is_enable = true;\n  } else {\n    self.is_enable = false;\n  }\n  self.enable_search = options.enable_search;\n  self.enable_files = options.enable_files;\n  self.enable_tasks = options.enable_tasks;\n  self.enable_notes = options.enable_notes;\n  self.enable_audit = options.enable_audit;\n  self.hidden = options.hidden;\n  self.enable_api = (options.enable_api === void 0) || options.enable_api;\n  self.custom = options.custom;\n  self.enable_share = options.enable_share;\n  self.enable_instances = options.enable_instances;\n  self.enable_tree = options.enable_tree;\n  self.open_window = options.open_window;\n  self.filter_company = options.filter_company;\n  self.calendar = _.clone(options.calendar);\n  self.sidebar = _.clone(options.sidebar);\n  self.enable_chatter = options.enable_chatter;\n  self.enable_trash = options.enable_trash;\n  self.enable_space_global = options.enable_space_global;\n  self.enable_approvals = options.enable_approvals;\n  self.idFieldName = '_id';\n  if (options.database_name) {\n    self.database_name = options.database_name;\n  }\n  if (!options.fields) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify name');\n  }\n  self.fields = _.clone(options.fields);\n  _.each(self.fields, function(field, field_name) {\n    if (field_name === 'name' || field.is_name) {\n      self.NAME_FIELD_KEY = field_name;\n    }\n    if (field.primary) {\n      return self.idFieldName = field_name;\n    }\n  });\n  if (!options.database_name || options.database_name === 'meteor-mongo') {\n    _.each(Creator.baseObject.fields, function(field, field_name) {\n      if (!self.fields[field_name]) {\n        self.fields[field_name] = {};\n      }\n      return self.fields[field_name] = _.extend(_.clone(field), self.fields[field_name]);\n    });\n  }\n  self.list_views = {};\n  defaultColumns = Creator.getObjectDefaultColumns(self.name);\n  _.each(options.list_views, function(item, item_name) {\n    var oitem;\n    oitem = Creator.convertListView(defaultColumns, item, item_name);\n    return self.list_views[item_name] = oitem;\n  });\n  self.triggers = _.clone(Creator.baseObject.triggers);\n  _.each(options.triggers, function(item, item_name) {\n    if (!self.triggers[item_name]) {\n      self.triggers[item_name] = {};\n    }\n    self.triggers[item_name].name = item_name;\n    return self.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item);\n  });\n  self.actions = _.clone(Creator.baseObject.actions);\n  _.each(options.actions, function(item, item_name) {\n    var copyItem;\n    if (!self.actions[item_name]) {\n      self.actions[item_name] = {};\n    }\n    copyItem = _.clone(self.actions[item_name]);\n    delete self.actions[item_name];\n    return self.actions[item_name] = _.extend(copyItem, item);\n  });\n  _.each(self.actions, function(item, item_name) {\n    return item.name = item_name;\n  });\n  self.related_objects = Creator.getObjectRelateds(self.name);\n  self.permission_set = _.clone(Creator.baseObject.permission_set);\n  if (!options.permission_set) {\n    options.permission_set = {};\n  }\n  if (!((ref = options.permission_set) != null ? ref.admin : void 0)) {\n    options.permission_set.admin = _.clone(self.permission_set[\"admin\"]);\n  }\n  if (!((ref1 = options.permission_set) != null ? ref1.user : void 0)) {\n    options.permission_set.user = _.clone(self.permission_set[\"user\"]);\n  }\n  _.each(options.permission_set, function(item, item_name) {\n    if (!self.permission_set[item_name]) {\n      self.permission_set[item_name] = {};\n    }\n    return self.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item);\n  });\n  if (Meteor.isClient) {\n    permissions = options.permissions;\n    disabled_list_views = permissions != null ? permissions.disabled_list_views : void 0;\n    if (disabled_list_views != null ? disabled_list_views.length : void 0) {\n      defaultListViewId = (ref2 = options.list_views) != null ? (ref3 = ref2.all) != null ? ref3._id : void 0 : void 0;\n      if (defaultListViewId) {\n        permissions.disabled_list_views = _.map(disabled_list_views, function(list_view_item) {\n          if (defaultListViewId === list_view_item) {\n            return \"all\";\n          } else {\n            return list_view_item;\n          }\n        });\n      }\n    }\n    self.permissions = new ReactiveVar(permissions);\n    _.each(self.fields, function(field, field_name) {\n      if (field) {\n        if (_.indexOf(permissions != null ? permissions.unreadable_fields : void 0, field_name) < 0) {\n          if (field.hidden) {\n            return;\n          }\n          if (_.indexOf(permissions != null ? permissions.uneditable_fields : void 0, field_name) > -1) {\n            field.readonly = true;\n            field.disabled = true;\n            return field.required = false;\n          }\n        } else {\n          return field.hidden = true;\n        }\n      }\n    });\n  } else {\n    self.permissions = null;\n  }\n  _db = Creator.createCollection(options);\n  Creator.Collections[_db._name] = _db;\n  self.db = _db;\n  self._collection_name = _db._name;\n  schema = Creator.getObjectSchema(self);\n  self.schema = new SimpleSchema(schema);\n  if (self.name !== \"users\" && self.name !== \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    } else {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  if (self.name === \"users\") {\n    _db._simpleSchema = self.schema;\n  }\n  if (_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  Creator.objectsByName[self._collection_name] = self;\n  return self;\n};\n\nCreator.Object.prototype.i18n = function() {\n  var key, self;\n  self = this;\n  key = self.name;\n  if (t(key) === key) {\n    if (!self.label) {\n      self.label = self.name;\n    }\n  } else {\n    self.label = t(key);\n  }\n  _.each(self.fields, function(field, field_name) {\n    var fkey, ref, ref1, ref2;\n    fkey = self.name + \"_\" + field_name;\n    if (t(fkey) === fkey) {\n      if (!field.label) {\n        field.label = field_name;\n      }\n    } else {\n      field.label = t(fkey);\n    }\n    return (ref = self.schema) != null ? (ref1 = ref._schema) != null ? (ref2 = ref1[field_name]) != null ? ref2.label = field.label : void 0 : void 0 : void 0;\n  });\n  return _.each(self.list_views, function(item, item_name) {\n    var i18n_key;\n    i18n_key = self.name + \"_listview_\" + item_name;\n    if (t(i18n_key) === i18n_key) {\n      if (!item.label) {\n        return item.label = item_name;\n      }\n    } else {\n      return item.label = t(i18n_key);\n    }\n  });\n};\n\nCreator.getObjectODataRouterPrefix = function(object) {\n  if (object) {\n    if (!object.database_name || object.database_name === 'meteor-mongo') {\n      return \"/api/odata/v4\";\n    } else {\n      return \"/api/odata/\" + object.database_name;\n    }\n  }\n};\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    return Tracker.autorun(function() {\n      var ref;\n      if (Session.get(\"steedos-locale\") && ((ref = Creator.bootstrapLoaded) != null ? ref.get() : void 0)) {\n        return _.each(Creator.objectsByName, function(object, object_name) {\n          return object.i18n();\n        });\n      }\n    });\n  });\n}\n\nMeteor.startup(function() {\n  if (!Creator.bootstrapLoaded && Creator.Objects) {\n    return _.each(Creator.Objects, function(object) {\n      return new Creator.Object(object);\n    });\n  }\n});\n","Creator.getObjectSchema = (obj) ->\n\tschema = {}\n\n\tfieldsArr = []\n\n\t_.each obj.fields , (field, field_name)->\n\t\tif !_.has(field, \"name\")\n\t\t\tfield.name = field_name\n\t\tfieldsArr.push field\n\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\n\n\t\tfield_name = field.name\n\n\t\tfs = {}\n\t\tif field.regEx\n\t\t\tfs.regEx = field.regEx\n\t\tfs.autoform = {}\n\t\tfs.autoform.multiple = field.multiple\n\t\tfs.autoform.reference_to = field.reference_to\n\n\t\tautoform_type = field.autoform?.type\n\n\t\tif field.type == \"text\" or field.type == \"phone\"\n\t\t\tfs.type = String\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tfs.autoform.type = \"tags\"\n\t\telse if field.type == \"[text]\" or field.type == \"[phone]\"\n\t\t\tfs.type = [String]\n\t\t\tfs.autoform.type = \"tags\"\n\t\telse if field.type == 'code'\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"widearea\"\n\t\t\tfs.autoform.rows = field.rows || 12\n\t\t\tif field.language\n\t\t\t\tfs.autoform.language = field.language\n\t\telse if field.type == \"textarea\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"widearea\"\n\t\t\tfs.autoform.rows = field.rows || 6\n\t\telse if field.type == \"password\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"password\"\n\t\telse if field.type == \"date\"\n\t\t\tfs.type = Date\n\t\t\tif Meteor.isClient\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\n\t\t\t\t\t# 这里用afFieldInput而不直接用autoform的原因是当字段被hidden的时候去执行dxDateBoxOptions参数会报错\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"steedos-date-mobile\"\n\t\t\t\t\t\tdateMobileOptions:\n\t\t\t\t\t\t\ttype: \"date\"\n\t\t\t\telse\n\t\t\t\t\tfs.autoform.outFormat = 'yyyy-MM-dd';\n\t\t\t\t\t# 这里用afFieldInput而不直接用autoform的原因是当字段被hidden的时候去执行dxDateBoxOptions参数会报错\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\ttimezoneId: \"utc\"\n\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\ttype: \"date\"\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd\"\n\n\t\telse if field.type == \"datetime\"\n\t\t\tfs.type = Date\n\t\t\tif Meteor.isClient\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\n\t\t\t\t\t# 这里用afFieldInput而不直接用autoform的原因是当字段被hidden的时候去执行dxDateBoxOptions参数会报错\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"steedos-date-mobile\"\n\t\t\t\t\t\tdateMobileOptions:\n\t\t\t\t\t\t\ttype: \"datetime\"\n\t\t\t\telse\n\t\t\t\t\t# 这里用afFieldInput而不直接用autoform的原因是当字段被hidden的时候去执行dxDateBoxOptions参数会报错\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\ttype: \"datetime\"\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd HH:mm\"\n\t\telse if field.type == \"[Object]\"\n\t\t\tfs.type = [Object]\n\t\telse if field.type == \"html\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.afFieldInput =\n\t\t\t\ttype: \"summernote\"\n\t\t\t\tclass: 'editor'\n\t\t\t\tsettings:\n\t\t\t\t\theight: 200\n\t\t\t\t\tdialogsInBody: true\n\t\t\t\t\ttoolbar:  [\n\t\t\t\t\t\t['font1', ['style']],\n\t\t\t\t\t\t['font2', ['bold', 'underline', 'italic', 'clear']],\n\t\t\t\t\t\t['font3', ['fontname']],\n\t\t\t\t\t\t['color', ['color']],\n\t\t\t\t\t\t['para', ['ul', 'ol', 'paragraph']],\n\t\t\t\t\t\t['table', ['table']],\n\t\t\t\t\t\t['insert', ['link', 'picture']],\n\t\t\t\t\t\t['view', ['codeview']]\n\t\t\t\t\t]\n\t\t\t\t\tfontNames: ['Arial', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', '宋体','黑体','微软雅黑','仿宋','楷体','隶书','幼圆']\n\n\t\telse if (field.type == \"lookup\" or field.type == \"master_detail\")\n\t\t\tfs.type = String\n\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\n\t\t\tif !field.hidden\n\n\t\t\t\tfs.autoform.filters = field.filters\n\n\t\t\t\tfs.autoform.dependOn = field.depend_on\n\n\t\t\t\tif field.beforeOpenFunction\n\t\t\t\t\tfs.beforeOpenFunction = field.beforeOpenFunction\n\n\t\t\t\tfs.filtersFunction = if field.filtersFunction then field.filtersFunction else Creator.evaluateFilters\n\n\t\t\t\tif field.optionsFunction\n\t\t\t\t\tfs.optionsFunction = field.optionsFunction\n\n\t\t\t\tif field.reference_to\n\n\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\tif field.createFunction && _.isFunction(field.createFunction)\n\t\t\t\t\t\t\tfs.createFunction = field.createFunction\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isString(field.reference_to)\n\t\t\t\t\t\t\t\t_ref_obj = Creator.Objects[field.reference_to]\n\t\t\t\t\t\t\t\tif _ref_obj?.permissions?.allowCreate\n\t\t\t\t\t\t\t\t\tfs.autoform.create = true\n\t\t\t\t\t\t\t\t\tfs.createFunction = (lookup_field)->\n\t\t\t\t\t\t\t\t\t\tModal.show(\"CreatorObjectModal\", {\n\t\t\t\t\t\t\t\t\t\t\tcollection: \"Creator.Collections.#{Creator.getCollection(field.reference_to)._name}\",\n\t\t\t\t\t\t\t\t\t\t\tformId: \"new#{field.reference_to.replace('.','_')}\",\n\t\t\t\t\t\t\t\t\t\t\tobject_name: \"#{field.reference_to}\",\n\t\t\t\t\t\t\t\t\t\t\toperation: \"insert\",\n\t\t\t\t\t\t\t\t\t\t\tonSuccess: (operation, result)->\n\t\t\t\t\t\t\t\t\t\t\t\tobject = Creator.getObject(result.object_name)\n\t\t\t\t\t\t\t\t\t\t\t\tif result.object_name == \"objects\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value.label, value: result.value.name, icon: result.value.icon}], result.value.name)\n\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name, value: result._id}], result._id)\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tfs.autoform.create = false\n\n\t\t\t\t\tif _.isBoolean(field.create)\n\t\t\t\t\t\tfs.autoform.create = field.create\n\n\t\t\t\t\tif field.reference_sort\n\t\t\t\t\t\tfs.autoform.optionsSort = field.reference_sort\n\n\t\t\t\t\tif field.reference_limit\n\t\t\t\t\t\tfs.autoform.optionsLimit = field.reference_limit\n\n\t\t\t\t\tif field.reference_to == \"users\"\n\t\t\t\t\t\tfs.autoform.type = \"selectuser\"\n\t\t\t\t\t\tif !field.hidden && !field.omit\n\t\t\t\t\t\t\t# is_company_limited表示过滤数据时是否只显示本单位下的数据\n\t\t\t\t\t\t\t# is_company_limited可以被改写覆盖成true/false或其他function\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\n\t\t\t\t\t\t\t\t# 未定义is_company_limited属性时默认处理逻辑：\n\t\t\t\t\t\t\t\t# 对当前对象有viewAllRecords权限则不限制所属单位列表查看权限，否则只显示当前所属单位\n\t\t\t\t\t\t\t\t# 注意不是reference_to对象的viewAllRecords权限，而是当前对象的\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\n\t\t\t\t\t\t\t\t\t\t# 如果字段所属对象是用户或组织，则是否限制显示所属单位部门与modifyAllRecords权限关联\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\n\t\t\t\t\t\t\t\t\tif isUnLimited\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\t# 传入当前对象的权限，在函数中根据权限计算是否要限制只查看本单位\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t# 服务端用不到is_company_limited\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\telse if field.reference_to == \"organizations\"\n\t\t\t\t\t\tfs.autoform.type = \"selectorg\"\n\t\t\t\t\t\tif !field.hidden && !field.omit\n\t\t\t\t\t\t\t# is_company_limited表示过滤数据时是否只显示本单位下的数据\n\t\t\t\t\t\t\t# is_company_limited可以被改写覆盖成true/false或其他function\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\n\t\t\t\t\t\t\t\t# 未定义is_company_limited属性时默认处理逻辑：\n\t\t\t\t\t\t\t\t# 对当前对象有viewAllRecords权限则不限制所属单位列表查看权限，否则只显示当前所属单位\n\t\t\t\t\t\t\t\t# 注意不是reference_to对象的viewAllRecords权限，而是当前对象的\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\n\t\t\t\t\t\t\t\t\t\t# 如果字段所属对象是用户或组织，则是否限制显示所属单位部门与modifyAllRecords权限关联\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\n\t\t\t\t\t\t\t\t\tif isUnLimited\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\t# 传入当前对象的权限，在函数中根据权限计算是否要限制只查看本单位\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t# 服务端用不到is_company_limited\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\telse\n\t\t\t\t\t\tif typeof(field.reference_to) == \"function\"\n\t\t\t\t\t\t\t_reference_to = field.reference_to()\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_reference_to = field.reference_to\n\n\t\t\t\t\t\tif _.isArray(_reference_to)\n\t\t\t\t\t\t\tfs.type = Object\n\t\t\t\t\t\t\tfs.blackbox = true\n\t\t\t\t\t\t\tfs.autoform.objectSwitche = true\n\n\t\t\t\t\t\t\tschema[field_name + \".o\"] = {\n\t\t\t\t\t\t\t\ttype: String\n\t\t\t\t\t\t\t\tautoform: {omit: true}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tschema[field_name + \".ids\"] = {\n\t\t\t\t\t\t\t\ttype: [String]\n\t\t\t\t\t\t\t\tautoform: {omit: true}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_reference_to = [_reference_to]\n\n\t\t\t\t\t\t_object = Creator.Objects[_reference_to[0]]\n\t\t\t\t\t\tif _object and _object.enable_tree\n\t\t\t\t\t\t\tfs.autoform.type = \"selectTree\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\t\t\t\tfs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\"\n\n\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\tfs.autoform.optionsMethodParams = ()->\n\t\t\t\t\t\t\t\t\treturn {space: Session.get(\"spaceId\")}\n\t\t\t\t\t\t\t\tfs.autoform.references = []\n\t\t\t\t\t\t\t\t_reference_to.forEach (_reference)->\n\t\t\t\t\t\t\t\t\t_object = Creator.Objects[_reference]\n\t\t\t\t\t\t\t\t\tif _object\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\n\t\t\t\t\t\t\t\t\t\t\tlabel: _object?.label\n\t\t\t\t\t\t\t\t\t\t\ticon: _object?.icon\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\telse\n\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\t\tfs.autoform.defaultIcon = field.defaultIcon\n\n\t\telse if field.type == \"select\"\n\t\t\tfs.type = String\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\tfs.autoform.showIcon = false\n\t\t\t\tfs.autoform.options = field.options\n\t\t\telse\n\t\t\t\tfs.autoform.type = \"select\"\n\t\t\t\tfs.autoform.options = field.options\n\t\t\t\tfs.autoform.firstOption = \"\"\n\t\telse if field.type == \"currency\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = \"steedosNumber\"\n\t\t\tfs.autoform.precision = field.precision || 18\n\t\t\tif field?.scale\n\t\t\t\tfs.autoform.scale = field.scale\n\t\t\t\tfs.decimal = true\n\t\t\telse if field?.scale != 0\n\t\t\t\tfs.autoform.scale = 2\n\t\t\t\tfs.decimal = true\n\t\telse if field.type == \"number\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = \"steedosNumber\"\n\t\t\tfs.autoform.precision = field.precision || 18\n\t\t\tif field?.scale\n\t\t\t\tfs.autoform.scale = field.scale\n\t\t\t\tfs.decimal = true\n\t\telse if field.type == \"boolean\"\n\t\t\tfs.type = Boolean\n\t\t\tfs.autoform.type = \"steedos-boolean-checkbox\"\n\t\telse if field.type == \"reference\"\n\t\t\tfs.type = String\n\t\telse if field.type == \"checkbox\"\n\t\t\tfs.type = [String]\n\t\t\tfs.autoform.type = \"select-checkbox\"\n\t\t\tfs.autoform.options = field.options\n\t\telse if field.type == \"file\" and field.collection\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: field.collection\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = field.collection\n\t\telse if field.type == \"filesize\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = 'filesize'\n\t\telse if field.type == \"Object\" || field.type == \"object\"\n\t\t\tfs.type = Object\n\t\telse if field.type == \"grid\"\n\t\t\tfs.type = Array\n\t\t\tfs.autoform.editable = true\n\t\t\tfs.autoform.type = \"steedosGrid\"\n\n\t\t\tschema[field_name + \".$\"] =\n\t\t\t\ttype: Object\n\t\telse if field.type == \"image\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'images'\n\t\t\t\t\t\taccept: 'image/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'images'\n\t\t\t\tfs.autoform.accept = 'image/*'\n\t\telse if field.type == \"avatar\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'avatars'\n\t\t\t\t\t\taccept: 'image/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'avatars'\n\t\t\t\tfs.autoform.accept = 'image/*'\n\t\telse if field.type == \"audio\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'audios'\n\t\t\t\t\t\taccept: 'audio/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'audios'\n\t\t\t\tfs.autoform.accept = 'audio/*'\n\t\telse if field.type == \"video\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'videos'\n\t\t\t\t\t\taccept: 'video/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'videos'\n\t\t\t\tfs.autoform.accept = 'video/*'\n\t\telse if field.type == \"location\"\n\t\t\tfs.type = Object\n\t\t\tfs.autoform.type = \"location\"\n\t\t\tfs.autoform.system = field.system || \"wgs84\"\n\t\t\tfs.blackbox = true\n\t\telse if field.type == \"markdown\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"steedos-markdown\"\n\t\telse if field.type == 'url'\n\t\t\tfs.type = String\n\t\t\t# fs.regEx = SimpleSchema.RegEx.Url\n\t\t\tfs.autoform.type = 'steedosUrl'\n\t\telse if field.type == 'email'\n\t\t\tfs.type = String\n\t\t\tfs.regEx = SimpleSchema.RegEx.Email\n\t\t\tfs.autoform.type = 'steedosEmail'\n\t\telse if field.type == 'autonumber'\n\t\t\tfs.type = String\n\t\telse\n\t\t\tfs.type = field.type\n\n\t\tif field.label\n\t\t\tfs.label = field.label\n\n\t\tif field.allowedValues\n\t\t\tfs.allowedValues = field.allowedValues\n\n\t\tif !field.required\n\t\t\tfs.optional = true\n\n\t\tif field.unique\n\t\t\tfs.unique = true\n\n\t\tif field.omit\n\t\t\tfs.autoform.omit = true\n\n\t\tif field.group\n\t\t\tfs.autoform.group = field.group\n\n\t\tif field.is_wide\n\t\t\tfs.autoform.is_wide = true\n\n\t\tif field.hidden\n\t\t\tfs.autoform.type = \"hidden\"\n\n\t\tif (field.type == \"select\") or (field.type == \"lookup\") or (field.type == \"master_detail\")\n\t\t\tif typeof(field.filterable) == 'undefined'\n\t\t\t\tfield.filterable = true\n\t\tif field.name == 'name' || field.is_name\n\t\t\tif typeof(field.searchable) == 'undefined'\n\t\t\t\tfield.searchable = true\n\n\t\tif autoform_type\n\t\t\tfs.autoform.type = autoform_type\n\n\t\tif field.defaultValue\n\t\t\tif Meteor.isClient and Creator.Formular.checkFormula(field.defaultValue)\n\t\t\t\tfs.autoform.defaultValue = ()->\n\t\t\t\t\treturn Creator.Formular.run(field.defaultValue, {userId: Meteor.userId(), spaceId: Session.get(\"spaceId\")})\n\t\t\telse\n\t\t\t\tfs.autoform.defaultValue = field.defaultValue\n\t\t\t\tif !_.isFunction(field.defaultValue)\n\t\t\t\t\tfs.defaultValue = field.defaultValue\n\n\t\tif field.readonly\n\t\t\tfs.autoform.readonly = true\n\n\t\tif field.disabled\n\t\t\tfs.autoform.disabled = true\n\n\t\tif field.inlineHelpText\n\t\t\tfs.autoform.inlineHelpText = field.inlineHelpText\n\n\t\tif field.blackbox\n\t\t\tfs.blackbox = true\n\n\t\t# 只有生产环境才重建索引\n\t\tif Meteor.isProduction\n\t\t\tif field.index\n\t\t\t\tfs.index = field.index\n\t\t\telse if field.sortable\n\t\t\t\tfs.index = true\n\n\t\tschema[field_name] = fs\n\n\treturn schema\n\n\nCreator.getFieldDisplayValue = (object_name, field_name, field_value)->\n\thtml = field_value\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\treturn \"\"\n\tfield = object.fields(field_name)\n\tif !field\n\t\treturn \"\"\n\n\tif field.type == \"datetime\"\n\t\thtml = moment(this.val).format('YYYY-MM-DD H:mm')\n\telse if field.type == \"date\"\n\t\thtml = moment(this.val).format('YYYY-MM-DD')\n\n\treturn html\n\nCreator.checkFieldTypeSupportBetweenQuery = (field_type)->\n\treturn [\"date\", \"datetime\", \"currency\", \"number\"].includes(field_type)\n\nCreator.pushBetweenBuiltinOptionals = (field_type, operations)->\n\tbuiltinValues = Creator.getBetweenBuiltinValues(field_type)\n\tif builtinValues\n\t\t_.forEach builtinValues, (builtinItem, key)->\n\t\t\toperations.push({label: builtinItem.label, value: key})\n\nCreator.getBetweenBuiltinValues = (field_type, is_check_only)->\n\t# 过滤器字段类型对应的内置选项\n\tif [\"date\", \"datetime\"].includes(field_type)\n\t\treturn Creator.getBetweenTimeBuiltinValues(is_check_only, field_type)\n\nCreator.getBetweenBuiltinValueItem = (field_type, key)->\n\t# 过滤器字段类型对应的内置选项\n\tif [\"date\", \"datetime\"].includes(field_type)\n\t\treturn Creator.getBetweenTimeBuiltinValueItem(field_type, key)\n\nCreator.getBetweenBuiltinOperation = (field_type, value)->\n\t# 根据过滤器的过滤值，获取对应的内置运算符\n\t# 比如value为last_year，返回between_time_last_year\n\tunless _.isString(value)\n\t\treturn\n\tbetweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type)\n\tunless betweenBuiltinValues\n\t\treturn\n\tresult = null\n\t_.each betweenBuiltinValues, (item, operation)->\n\t\tif item.key == value\n\t\t\tresult = operation\n\treturn result\n\n# 如果只是为判断operation是否存在，则没必要计算values，传入is_check_only为true即可\nCreator.getBetweenTimeBuiltinValues = (is_check_only, field_type)->\n\t# 过滤器时间字段类型对应的内置选项\n\treturn {\n\t\t\"between_time_last_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\n\t\t\"between_time_this_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\n\t\t\"between_time_next_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\n\t\t\"between_time_last_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\n\t\t\"between_time_this_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\n\t\t\"between_time_next_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\n\t\t\"between_time_last_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\n\t\t\"between_time_this_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\n\t\t\"between_time_next_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\n\t\t\"between_time_last_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\n\t\t\"between_time_this_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\n\t\t\"between_time_next_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\n\t\t\"between_time_yestday\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\n\t\t\"between_time_today\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\n\t\t\"between_time_tomorrow\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\n\t\t\"between_time_last_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\n\t\t\"between_time_last_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\n\t\t\"between_time_last_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\n\t\t\"between_time_last_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\n\t\t\"between_time_last_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\n\t\t\"between_time_next_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\n\t\t\"between_time_next_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\n\t\t\"between_time_next_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\n\t\t\"between_time_next_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\n\t\t\"between_time_next_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\n\t}\n\nCreator.getQuarterStartMonth = (month)->\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\treturn 0\n\telse if month < 6\n\t\treturn 3\n\telse if month < 9\n\t\treturn 6\n\t\n\treturn 9\n\n\nCreator.getLastQuarterFirstDay = (year,month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\tyear--\n\t\tmonth = 9\n\telse if month < 6\n\t\tmonth = 0\n\telse if month < 9\n\t\tmonth = 3\n\telse \n\t\tmonth = 6\n\t\n\treturn new Date(year, month, 1)\n\t\n\nCreator.getNextQuarterFirstDay = (year,month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\tmonth = 3\n\telse if month < 6\n\t\tmonth = 6\n\telse if month < 9\n\t\tmonth = 9\n\telse\n\t\tyear++\n\t\tmonth = 0\n\t\n\treturn new Date(year, month, 1)\n\nCreator.getMonthDays = (year,month)->\n\tif month == 11\n\t\treturn 31\n\t\n\tmillisecond = 1000 * 60 * 60 * 24\n\tstartDate = new Date(year, month, 1)\n\tendDate = new Date(year, month+1, 1)\n\tdays = (endDate-startDate)/millisecond\n\treturn days\n\nCreator.getLastMonthFirstDay = (year, month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\t# 月份为0代表本年的第一月\n\tif month == 0\n\t\tmonth = 11\n\t\tyear--\n\t\treturn new Date(year, month, 1)\n\t\n\t# 否则,只减去月份\n\tmonth--;\n\treturn new Date(year, month, 1)\n\t\nCreator.getBetweenTimeBuiltinValueItem = (field_type, key)->\n\t# 过滤器between运算符，现算日期/日期时间类型字段的values值\n\tnow = new Date()\n\t# 一天的毫秒数\n\tmillisecond = 1000 * 60 * 60 * 24\n\tyestday = new Date(now.getTime() - millisecond)\n\ttomorrow = new Date(now.getTime() + millisecond)\n\t# 一周中的某一天\n\tweek = now.getDay()\n\t# 减去的天数\n\tminusDay = if week != 0 then week - 1 else 6\n\tmonday = new Date(now.getTime() - (minusDay * millisecond))\n\tsunday = new Date(monday.getTime() + (6 * millisecond))\n\t# 上周日\n\tlastSunday = new Date(monday.getTime() - millisecond)\n\t# 上周一\n\tlastMonday = new Date(lastSunday.getTime() - (millisecond * 6))\n\t# 下周一\n\tnextMonday = new Date(sunday.getTime() + millisecond)\n\t# 下周日\n\tnextSunday = new Date(nextMonday.getTime() + (millisecond * 6))\n\tcurrentYear = now.getFullYear()\n\tpreviousYear = currentYear - 1\n\tnextYear = currentYear + 1\n\t# 当前月份\n\tcurrentMonth = now.getMonth()\n\t# 计数年、月\n\tyear = now.getFullYear()\n\tmonth = now.getMonth()\n\t# 本月第一天\n\tfirstDay = new Date(currentYear,currentMonth,1)\n\n\t# 当为12月的时候年份需要加1\n\t# 月份需要更新为0 也就是下一年的第一个月\n\tif currentMonth == 11\n\t\tyear++\n\t\tmonth++\n\telse\n\t\tmonth++\n\t\n\t# 下月第一天\n\tnextMonthFirstDay = new Date(year, month, 1)\n\t# 下月最后一天\n\tnextMonthFinalDay = new Date(year,month,Creator.getMonthDays(year,month))\n\t# 本月最后一天\n\tlastDay = new Date(nextMonthFirstDay.getTime() - millisecond)\n\t# 上月第一天\n\tlastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear,currentMonth)\n\t# 上月最后一天\n\tlastMonthFinalDay = new Date(firstDay.getTime() - millisecond)\n\t# 本季度开始日\n\tthisQuarterStartDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth),1)\n\t# 本季度结束日\n\tthisQuarterEndDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth)+2,Creator.getMonthDays(currentYear,Creator.getQuarterStartMonth(currentMonth)+2))\n\t# 上季度开始日\n\tlastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear,currentMonth)\n\t# 上季度结束日\n\tlastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2,Creator.getMonthDays(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2))\n\t# 下季度开始日\n\tnextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear,currentMonth)\n\t# 下季度结束日\n\tnextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2,Creator.getMonthDays(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2))\n\t# 过去7天 \n\tlast_7_days = new Date(now.getTime() - (6 * millisecond))\n\t# 过去30天\n\tlast_30_days = new Date(now.getTime() - (29 * millisecond))\n\t# 过去60天\n\tlast_60_days = new Date(now.getTime() - (59 * millisecond))\n\t# 过去90天\n\tlast_90_days = new Date(now.getTime() - (89 * millisecond))\n\t# 过去120天\n\tlast_120_days = new Date(now.getTime() - (119 * millisecond))\n\t# 未来7天 \n\tnext_7_days = new Date(now.getTime() + (6 * millisecond))\n\t# 未来30天\n\tnext_30_days = new Date(now.getTime() + (29 * millisecond))\n\t# 未来60天\n\tnext_60_days = new Date(now.getTime() + (59 * millisecond))\n\t# 未来90天\n\tnext_90_days = new Date(now.getTime() + (89 * millisecond))\n\t# 未来120天\n\tnext_120_days = new Date(now.getTime() + (119 * millisecond))\n\n\tswitch key\n\t\twhen \"last_year\"\n\t\t\t#去年\n\t\t\tlabel = t(\"creator_filter_operation_between_last_year\")\n\t\t\tstartValue = new Date(\"#{previousYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{previousYear}-12-31T23:59:59Z\")\n\t\twhen \"this_year\"\n\t\t\t#今年\n\t\t\tlabel = t(\"creator_filter_operation_between_this_year\")\n\t\t\tstartValue = new Date(\"#{currentYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{currentYear}-12-31T23:59:59Z\")\n\t\twhen \"next_year\"\n\t\t\t#明年\n\t\t\tlabel = t(\"creator_filter_operation_between_next_year\")\n\t\t\tstartValue = new Date(\"#{nextYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{nextYear}-12-31T23:59:59Z\")\n\t\twhen \"last_quarter\"\n\t\t\t#上季度\n\t\t\tstrFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"this_quarter\"\n\t\t\t#本季度\n\t\t\tstrFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"next_quarter\"\n\t\t\t#下季度\n\t\t\tstrFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"last_month\"\n\t\t\t#上月\n\t\t\tstrFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"this_month\"\n\t\t\t#本月\n\t\t\tstrFirstDay = moment(firstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"next_month\"\n\t\t\t#下月\n\t\t\tstrFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"last_week\"\n\t\t\t#上周\n\t\t\tstrMonday = moment(lastMonday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(lastSunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"this_week\"\n\t\t\t#本周\n\t\t\tstrMonday = moment(monday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(sunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"next_week\"\n\t\t\t#下周\n\t\t\tstrMonday = moment(nextMonday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(nextSunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"yestday\"\n\t\t\t#昨天\n\t\t\tstrYestday = moment(yestday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_yestday\")\n\t\t\tstartValue = new Date(\"#{strYestday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strYestday}T23:59:59Z\")\n\t\twhen \"today\"\n\t\t\t#今天\n\t\t\tstrToday = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_today\")\n\t\t\tstartValue = new Date(\"#{strToday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strToday}T23:59:59Z\")\n\t\twhen \"tomorrow\"\n\t\t\t#明天\n\t\t\tstrTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_tomorrow\")\n\t\t\tstartValue = new Date(\"#{strTomorrow}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strTomorrow}T23:59:59Z\")\n\t\twhen \"last_7_days\"\n\t\t\t#过去7天\n\t\t\tstrStartDay = moment(last_7_days).format(\"YYYY-MM-DD\") \n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_7_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_30_days\"\n\t\t\t#过去30天\n\t\t\tstrStartDay = moment(last_30_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_30_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_60_days\"\n\t\t\t#过去60天\n\t\t\tstrStartDay = moment(last_60_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_60_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_90_days\"\n\t\t\t#过去90天\n\t\t\tstrStartDay = moment(last_90_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_90_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_120_days\"\n\t\t\t#过去120天\n\t\t\tstrStartDay = moment(last_120_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_120_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_7_days\"\n\t\t\t#未来7天\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_7_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_7_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_30_days\"\n\t\t\t#未来30天\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_30_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_30_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_60_days\"\n\t\t\t#未来60天\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_60_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_60_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_90_days\"\n\t\t\t#未来90天\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_90_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_90_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_120_days\"\n\t\t\t#未来120天\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_120_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_120_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\n\tvalues = [startValue, endValue]\n\tif field_type == \"datetime\"\n\t\t# 时间类型字段，内置时间范围应该考虑偏移时区值，否则过滤数据存在偏差\n\t\t# 非内置时间范围时，用户通过时间控件选择的范围，会自动处理时区偏差情况\n\t\t# 日期类型字段，数据库本来就存的是UTC的0点，不存在偏差\n\t\t_.forEach values, (fv)->\n\t\t\tif fv\n\t\t\t\tfv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60 )\n\t\n\treturn {\n\t\tlabel: label\n\t\tkey: key\n\t\tvalues: values\n\t}\n\nCreator.getFieldDefaultOperation = (field_type)->\n\tif field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)\n\t\treturn 'between'\n\telse if [\"textarea\", \"text\", \"code\"].includes(field_type)\n\t\treturn 'contains'\n\telse\n\t\treturn \"=\"\n\nCreator.getFieldOperation = (field_type) ->\n\t# 日期类型: date, datetime  支持操作符: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\n\t# 文本类型: text, textarea, html  支持操作符: \"=\", \"<>\", \"contains\", \"notcontains\", \"startswith\"\n\t# 选择类型: lookup, master_detail, select 支持操作符: \"=\", \"<>\"\n\t# 数值类型: currency, number  支持操作符: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\n\t# 布尔类型: boolean  支持操作符: \"=\", \"<>\"\n\t# 数组类型: checkbox, [text]  支持操作符: \"=\", \"<>\"\n\n\toptionals = {\n\t\tequal: {label: t(\"creator_filter_operation_equal\"), value: \"=\"},\n\t\tunequal: {label: t(\"creator_filter_operation_unequal\"), value: \"<>\"},\n\t\tless_than: {label: t(\"creator_filter_operation_less_than\"), value: \"<\"},\n\t\tgreater_than: {label: t(\"creator_filter_operation_greater_than\"), value: \">\"},\n\t\tless_or_equal: {label: t(\"creator_filter_operation_less_or_equal\"), value: \"<=\"},\n\t\tgreater_or_equal: {label: t(\"creator_filter_operation_greater_or_equal\"), value: \">=\"},\n\t\tcontains: {label: t(\"creator_filter_operation_contains\"), value: \"contains\"},\n\t\tnot_contain: {label: t(\"creator_filter_operation_does_not_contain\"), value: \"notcontains\"},\n\t\tstarts_with: {label: t(\"creator_filter_operation_starts_with\"), value: \"startswith\"},\n\t\tbetween: {label: t(\"creator_filter_operation_between\"), value: \"between\"},\n\t}\n\n\tif field_type == undefined\n\t\treturn _.values(optionals)\n\n\toperations = []\n\n\tif Creator.checkFieldTypeSupportBetweenQuery(field_type)\n\t\toperations.push(optionals.between)\n\t\tCreator.pushBetweenBuiltinOptionals(field_type, operations)\n\telse if field_type == \"text\" or field_type == \"textarea\" or field_type == \"html\" or field_type == \"code\"\n#\t\toperations.push(optionals.equal, optionals.unequal, optionals.contains, optionals.not_contain, optionals.starts_with)\n\t\toperations.push(optionals.contains)\n\telse if field_type == \"lookup\" or field_type == \"master_detail\" or field_type == \"select\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"currency\" or field_type == \"number\"\n\t\toperations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal)\n\telse if field_type == \"boolean\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"checkbox\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"[text]\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse\n\t\toperations.push(optionals.equal, optionals.unequal)\n\n\treturn operations\n\n###\n    先按照有排序号的小的在前，大的在后\n    再将没有排序号的显示在\n###\nCreator.getObjectFieldsName = (object_name)->\n\tfields = Creator.getObject(object_name)?.fields\n\tfieldsArr = []\n\n\t_.each fields, (field)->\n\t\tfieldsArr.push {name: field.name, sort_no: field.sort_no}\n\n\tfieldsName = []\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\n\t\tfieldsName.push(field.name)\n\treturn fieldsName\n","Creator.getObjectSchema = function(obj) {\n  var fieldsArr, schema;\n  schema = {};\n  fieldsArr = [];\n  _.each(obj.fields, function(field, field_name) {\n    if (!_.has(field, \"name\")) {\n      field.name = field_name;\n    }\n    return fieldsArr.push(field);\n  });\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    var _object, _ref_obj, _reference_to, autoform_type, field_name, fs, isUnLimited, permissions, ref, ref1, ref2, ref3;\n    field_name = field.name;\n    fs = {};\n    if (field.regEx) {\n      fs.regEx = field.regEx;\n    }\n    fs.autoform = {};\n    fs.autoform.multiple = field.multiple;\n    fs.autoform.reference_to = field.reference_to;\n    autoform_type = (ref = field.autoform) != null ? ref.type : void 0;\n    if (field.type === \"text\" || field.type === \"phone\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"tags\";\n      }\n    } else if (field.type === \"[text]\" || field.type === \"[phone]\") {\n      fs.type = [String];\n      fs.autoform.type = \"tags\";\n    } else if (field.type === 'code') {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 12;\n      if (field.language) {\n        fs.autoform.language = field.language;\n      }\n    } else if (field.type === \"textarea\") {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 6;\n    } else if (field.type === \"password\") {\n      fs.type = String;\n      fs.autoform.type = \"password\";\n    } else if (field.type === \"date\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          fs.autoform.afFieldInput = {\n            type: \"steedos-date-mobile\",\n            dateMobileOptions: {\n              type: \"date\"\n            }\n          };\n        } else {\n          fs.autoform.outFormat = 'yyyy-MM-dd';\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            timezoneId: \"utc\",\n            dxDateBoxOptions: {\n              type: \"date\",\n              displayFormat: \"yyyy-MM-dd\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"datetime\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          fs.autoform.afFieldInput = {\n            type: \"steedos-date-mobile\",\n            dateMobileOptions: {\n              type: \"datetime\"\n            }\n          };\n        } else {\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            dxDateBoxOptions: {\n              type: \"datetime\",\n              displayFormat: \"yyyy-MM-dd HH:mm\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"[Object]\") {\n      fs.type = [Object];\n    } else if (field.type === \"html\") {\n      fs.type = String;\n      fs.autoform.afFieldInput = {\n        type: \"summernote\",\n        \"class\": 'editor',\n        settings: {\n          height: 200,\n          dialogsInBody: true,\n          toolbar: [['font1', ['style']], ['font2', ['bold', 'underline', 'italic', 'clear']], ['font3', ['fontname']], ['color', ['color']], ['para', ['ul', 'ol', 'paragraph']], ['table', ['table']], ['insert', ['link', 'picture']], ['view', ['codeview']]],\n          fontNames: ['Arial', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', '宋体', '黑体', '微软雅黑', '仿宋', '楷体', '隶书', '幼圆']\n        }\n      };\n    } else if (field.type === \"lookup\" || field.type === \"master_detail\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n      }\n      if (!field.hidden) {\n        fs.autoform.filters = field.filters;\n        fs.autoform.dependOn = field.depend_on;\n        if (field.beforeOpenFunction) {\n          fs.beforeOpenFunction = field.beforeOpenFunction;\n        }\n        fs.filtersFunction = field.filtersFunction ? field.filtersFunction : Creator.evaluateFilters;\n        if (field.optionsFunction) {\n          fs.optionsFunction = field.optionsFunction;\n        }\n        if (field.reference_to) {\n          if (Meteor.isClient) {\n            if (field.createFunction && _.isFunction(field.createFunction)) {\n              fs.createFunction = field.createFunction;\n            } else {\n              if (_.isString(field.reference_to)) {\n                _ref_obj = Creator.Objects[field.reference_to];\n                if (_ref_obj != null ? (ref1 = _ref_obj.permissions) != null ? ref1.allowCreate : void 0 : void 0) {\n                  fs.autoform.create = true;\n                  fs.createFunction = function(lookup_field) {\n                    return Modal.show(\"CreatorObjectModal\", {\n                      collection: \"Creator.Collections.\" + (Creator.getCollection(field.reference_to)._name),\n                      formId: \"new\" + (field.reference_to.replace('.', '_')),\n                      object_name: \"\" + field.reference_to,\n                      operation: \"insert\",\n                      onSuccess: function(operation, result) {\n                        var object;\n                        object = Creator.getObject(result.object_name);\n                        if (result.object_name === \"objects\") {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value.label,\n                              value: result.value.name,\n                              icon: result.value.icon\n                            }\n                          ], result.value.name);\n                        } else {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name,\n                              value: result._id\n                            }\n                          ], result._id);\n                        }\n                      }\n                    });\n                  };\n                } else {\n                  fs.autoform.create = false;\n                }\n              }\n            }\n          }\n          if (_.isBoolean(field.create)) {\n            fs.autoform.create = field.create;\n          }\n          if (field.reference_sort) {\n            fs.autoform.optionsSort = field.reference_sort;\n          }\n          if (field.reference_limit) {\n            fs.autoform.optionsLimit = field.reference_limit;\n          }\n          if (field.reference_to === \"users\") {\n            fs.autoform.type = \"selectuser\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref2 = obj.permissions) != null ? ref2.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else if (field.reference_to === \"organizations\") {\n            fs.autoform.type = \"selectorg\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref3 = obj.permissions) != null ? ref3.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else {\n            if (typeof field.reference_to === \"function\") {\n              _reference_to = field.reference_to();\n            } else {\n              _reference_to = field.reference_to;\n            }\n            if (_.isArray(_reference_to)) {\n              fs.type = Object;\n              fs.blackbox = true;\n              fs.autoform.objectSwitche = true;\n              schema[field_name + \".o\"] = {\n                type: String,\n                autoform: {\n                  omit: true\n                }\n              };\n              schema[field_name + \".ids\"] = {\n                type: [String],\n                autoform: {\n                  omit: true\n                }\n              };\n            } else {\n              _reference_to = [_reference_to];\n            }\n            _object = Creator.Objects[_reference_to[0]];\n            if (_object && _object.enable_tree) {\n              fs.autoform.type = \"selectTree\";\n            } else {\n              fs.autoform.type = \"steedosLookups\";\n              fs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\";\n              if (Meteor.isClient) {\n                fs.autoform.optionsMethodParams = function() {\n                  return {\n                    space: Session.get(\"spaceId\")\n                  };\n                };\n                fs.autoform.references = [];\n                _reference_to.forEach(function(_reference) {\n                  _object = Creator.Objects[_reference];\n                  if (_object) {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      label: _object != null ? _object.label : void 0,\n                      icon: _object != null ? _object.icon : void 0,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  } else {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  }\n                });\n              }\n            }\n          }\n        } else {\n          fs.autoform.type = \"steedosLookups\";\n          fs.autoform.defaultIcon = field.defaultIcon;\n        }\n      }\n    } else if (field.type === \"select\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"steedosLookups\";\n        fs.autoform.showIcon = false;\n        fs.autoform.options = field.options;\n      } else {\n        fs.autoform.type = \"select\";\n        fs.autoform.options = field.options;\n        fs.autoform.firstOption = \"\";\n      }\n    } else if (field.type === \"currency\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      } else if ((field != null ? field.scale : void 0) !== 0) {\n        fs.autoform.scale = 2;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"number\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"boolean\") {\n      fs.type = Boolean;\n      fs.autoform.type = \"steedos-boolean-checkbox\";\n    } else if (field.type === \"reference\") {\n      fs.type = String;\n    } else if (field.type === \"checkbox\") {\n      fs.type = [String];\n      fs.autoform.type = \"select-checkbox\";\n      fs.autoform.options = field.options;\n    } else if (field.type === \"file\" && field.collection) {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: field.collection\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = field.collection;\n      }\n    } else if (field.type === \"filesize\") {\n      fs.type = Number;\n      fs.autoform.type = 'filesize';\n    } else if (field.type === \"Object\" || field.type === \"object\") {\n      fs.type = Object;\n    } else if (field.type === \"grid\") {\n      fs.type = Array;\n      fs.autoform.editable = true;\n      fs.autoform.type = \"steedosGrid\";\n      schema[field_name + \".$\"] = {\n        type: Object\n      };\n    } else if (field.type === \"image\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'images',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'images';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"avatar\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'avatars',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'avatars';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"audio\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'audios',\n            accept: 'audio/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'audios';\n        fs.autoform.accept = 'audio/*';\n      }\n    } else if (field.type === \"video\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'videos',\n            accept: 'video/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'videos';\n        fs.autoform.accept = 'video/*';\n      }\n    } else if (field.type === \"location\") {\n      fs.type = Object;\n      fs.autoform.type = \"location\";\n      fs.autoform.system = field.system || \"wgs84\";\n      fs.blackbox = true;\n    } else if (field.type === \"markdown\") {\n      fs.type = String;\n      fs.autoform.type = \"steedos-markdown\";\n    } else if (field.type === 'url') {\n      fs.type = String;\n      fs.autoform.type = 'steedosUrl';\n    } else if (field.type === 'email') {\n      fs.type = String;\n      fs.regEx = SimpleSchema.RegEx.Email;\n      fs.autoform.type = 'steedosEmail';\n    } else if (field.type === 'autonumber') {\n      fs.type = String;\n    } else {\n      fs.type = field.type;\n    }\n    if (field.label) {\n      fs.label = field.label;\n    }\n    if (field.allowedValues) {\n      fs.allowedValues = field.allowedValues;\n    }\n    if (!field.required) {\n      fs.optional = true;\n    }\n    if (field.unique) {\n      fs.unique = true;\n    }\n    if (field.omit) {\n      fs.autoform.omit = true;\n    }\n    if (field.group) {\n      fs.autoform.group = field.group;\n    }\n    if (field.is_wide) {\n      fs.autoform.is_wide = true;\n    }\n    if (field.hidden) {\n      fs.autoform.type = \"hidden\";\n    }\n    if ((field.type === \"select\") || (field.type === \"lookup\") || (field.type === \"master_detail\")) {\n      if (typeof field.filterable === 'undefined') {\n        field.filterable = true;\n      }\n    }\n    if (field.name === 'name' || field.is_name) {\n      if (typeof field.searchable === 'undefined') {\n        field.searchable = true;\n      }\n    }\n    if (autoform_type) {\n      fs.autoform.type = autoform_type;\n    }\n    if (field.defaultValue) {\n      if (Meteor.isClient && Creator.Formular.checkFormula(field.defaultValue)) {\n        fs.autoform.defaultValue = function() {\n          return Creator.Formular.run(field.defaultValue, {\n            userId: Meteor.userId(),\n            spaceId: Session.get(\"spaceId\")\n          });\n        };\n      } else {\n        fs.autoform.defaultValue = field.defaultValue;\n        if (!_.isFunction(field.defaultValue)) {\n          fs.defaultValue = field.defaultValue;\n        }\n      }\n    }\n    if (field.readonly) {\n      fs.autoform.readonly = true;\n    }\n    if (field.disabled) {\n      fs.autoform.disabled = true;\n    }\n    if (field.inlineHelpText) {\n      fs.autoform.inlineHelpText = field.inlineHelpText;\n    }\n    if (field.blackbox) {\n      fs.blackbox = true;\n    }\n    if (Meteor.isProduction) {\n      if (field.index) {\n        fs.index = field.index;\n      } else if (field.sortable) {\n        fs.index = true;\n      }\n    }\n    return schema[field_name] = fs;\n  });\n  return schema;\n};\n\nCreator.getFieldDisplayValue = function(object_name, field_name, field_value) {\n  var field, html, object;\n  html = field_value;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return \"\";\n  }\n  field = object.fields(field_name);\n  if (!field) {\n    return \"\";\n  }\n  if (field.type === \"datetime\") {\n    html = moment(this.val).format('YYYY-MM-DD H:mm');\n  } else if (field.type === \"date\") {\n    html = moment(this.val).format('YYYY-MM-DD');\n  }\n  return html;\n};\n\nCreator.checkFieldTypeSupportBetweenQuery = function(field_type) {\n  return [\"date\", \"datetime\", \"currency\", \"number\"].includes(field_type);\n};\n\nCreator.pushBetweenBuiltinOptionals = function(field_type, operations) {\n  var builtinValues;\n  builtinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (builtinValues) {\n    return _.forEach(builtinValues, function(builtinItem, key) {\n      return operations.push({\n        label: builtinItem.label,\n        value: key\n      });\n    });\n  }\n};\n\nCreator.getBetweenBuiltinValues = function(field_type, is_check_only) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValues(is_check_only, field_type);\n  }\n};\n\nCreator.getBetweenBuiltinValueItem = function(field_type, key) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValueItem(field_type, key);\n  }\n};\n\nCreator.getBetweenBuiltinOperation = function(field_type, value) {\n  var betweenBuiltinValues, result;\n  if (!_.isString(value)) {\n    return;\n  }\n  betweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (!betweenBuiltinValues) {\n    return;\n  }\n  result = null;\n  _.each(betweenBuiltinValues, function(item, operation) {\n    if (item.key === value) {\n      return result = operation;\n    }\n  });\n  return result;\n};\n\nCreator.getBetweenTimeBuiltinValues = function(is_check_only, field_type) {\n  return {\n    \"between_time_last_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\n    \"between_time_this_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\n    \"between_time_next_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\n    \"between_time_last_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\n    \"between_time_this_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\n    \"between_time_next_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\n    \"between_time_last_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\n    \"between_time_this_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\n    \"between_time_next_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\n    \"between_time_last_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\n    \"between_time_this_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\n    \"between_time_next_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\n    \"between_time_yestday\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\n    \"between_time_today\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\n    \"between_time_tomorrow\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\n    \"between_time_last_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\n    \"between_time_last_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\n    \"between_time_last_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\n    \"between_time_last_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\n    \"between_time_last_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\n    \"between_time_next_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\n    \"between_time_next_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\n    \"between_time_next_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\n    \"between_time_next_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\n    \"between_time_next_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\n  };\n};\n\nCreator.getQuarterStartMonth = function(month) {\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    return 0;\n  } else if (month < 6) {\n    return 3;\n  } else if (month < 9) {\n    return 6;\n  }\n  return 9;\n};\n\nCreator.getLastQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    year--;\n    month = 9;\n  } else if (month < 6) {\n    month = 0;\n  } else if (month < 9) {\n    month = 3;\n  } else {\n    month = 6;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getNextQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    month = 3;\n  } else if (month < 6) {\n    month = 6;\n  } else if (month < 9) {\n    month = 9;\n  } else {\n    year++;\n    month = 0;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getMonthDays = function(year, month) {\n  var days, endDate, millisecond, startDate;\n  if (month === 11) {\n    return 31;\n  }\n  millisecond = 1000 * 60 * 60 * 24;\n  startDate = new Date(year, month, 1);\n  endDate = new Date(year, month + 1, 1);\n  days = (endDate - startDate) / millisecond;\n  return days;\n};\n\nCreator.getLastMonthFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month === 0) {\n    month = 11;\n    year--;\n    return new Date(year, month, 1);\n  }\n  month--;\n  return new Date(year, month, 1);\n};\n\nCreator.getBetweenTimeBuiltinValueItem = function(field_type, key) {\n  var currentMonth, currentYear, endValue, firstDay, label, lastDay, lastMonday, lastMonthFinalDay, lastMonthFirstDay, lastQuarterEndDay, lastQuarterStartDay, lastSunday, last_120_days, last_30_days, last_60_days, last_7_days, last_90_days, millisecond, minusDay, monday, month, nextMonday, nextMonthFinalDay, nextMonthFirstDay, nextQuarterEndDay, nextQuarterStartDay, nextSunday, nextYear, next_120_days, next_30_days, next_60_days, next_7_days, next_90_days, now, previousYear, startValue, strEndDay, strFirstDay, strLastDay, strMonday, strStartDay, strSunday, strToday, strTomorrow, strYestday, sunday, thisQuarterEndDay, thisQuarterStartDay, tomorrow, values, week, year, yestday;\n  now = new Date();\n  millisecond = 1000 * 60 * 60 * 24;\n  yestday = new Date(now.getTime() - millisecond);\n  tomorrow = new Date(now.getTime() + millisecond);\n  week = now.getDay();\n  minusDay = week !== 0 ? week - 1 : 6;\n  monday = new Date(now.getTime() - (minusDay * millisecond));\n  sunday = new Date(monday.getTime() + (6 * millisecond));\n  lastSunday = new Date(monday.getTime() - millisecond);\n  lastMonday = new Date(lastSunday.getTime() - (millisecond * 6));\n  nextMonday = new Date(sunday.getTime() + millisecond);\n  nextSunday = new Date(nextMonday.getTime() + (millisecond * 6));\n  currentYear = now.getFullYear();\n  previousYear = currentYear - 1;\n  nextYear = currentYear + 1;\n  currentMonth = now.getMonth();\n  year = now.getFullYear();\n  month = now.getMonth();\n  firstDay = new Date(currentYear, currentMonth, 1);\n  if (currentMonth === 11) {\n    year++;\n    month++;\n  } else {\n    month++;\n  }\n  nextMonthFirstDay = new Date(year, month, 1);\n  nextMonthFinalDay = new Date(year, month, Creator.getMonthDays(year, month));\n  lastDay = new Date(nextMonthFirstDay.getTime() - millisecond);\n  lastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear, currentMonth);\n  lastMonthFinalDay = new Date(firstDay.getTime() - millisecond);\n  thisQuarterStartDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth), 1);\n  thisQuarterEndDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2, Creator.getMonthDays(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2));\n  lastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear, currentMonth);\n  lastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2, Creator.getMonthDays(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2));\n  nextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear, currentMonth);\n  nextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2, Creator.getMonthDays(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2));\n  last_7_days = new Date(now.getTime() - (6 * millisecond));\n  last_30_days = new Date(now.getTime() - (29 * millisecond));\n  last_60_days = new Date(now.getTime() - (59 * millisecond));\n  last_90_days = new Date(now.getTime() - (89 * millisecond));\n  last_120_days = new Date(now.getTime() - (119 * millisecond));\n  next_7_days = new Date(now.getTime() + (6 * millisecond));\n  next_30_days = new Date(now.getTime() + (29 * millisecond));\n  next_60_days = new Date(now.getTime() + (59 * millisecond));\n  next_90_days = new Date(now.getTime() + (89 * millisecond));\n  next_120_days = new Date(now.getTime() + (119 * millisecond));\n  switch (key) {\n    case \"last_year\":\n      label = t(\"creator_filter_operation_between_last_year\");\n      startValue = new Date(previousYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(previousYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"this_year\":\n      label = t(\"creator_filter_operation_between_this_year\");\n      startValue = new Date(currentYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(currentYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"next_year\":\n      label = t(\"creator_filter_operation_between_next_year\");\n      startValue = new Date(nextYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(nextYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"last_quarter\":\n      strFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_quarter\":\n      strFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_quarter\":\n      strFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_month\":\n      strFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_month\":\n      strFirstDay = moment(firstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_month\":\n      strFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_week\":\n      strMonday = moment(lastMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(lastSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"this_week\":\n      strMonday = moment(monday).format(\"YYYY-MM-DD\");\n      strSunday = moment(sunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"next_week\":\n      strMonday = moment(nextMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(nextSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"yestday\":\n      strYestday = moment(yestday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_yestday\");\n      startValue = new Date(strYestday + \"T00:00:00Z\");\n      endValue = new Date(strYestday + \"T23:59:59Z\");\n      break;\n    case \"today\":\n      strToday = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_today\");\n      startValue = new Date(strToday + \"T00:00:00Z\");\n      endValue = new Date(strToday + \"T23:59:59Z\");\n      break;\n    case \"tomorrow\":\n      strTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_tomorrow\");\n      startValue = new Date(strTomorrow + \"T00:00:00Z\");\n      endValue = new Date(strTomorrow + \"T23:59:59Z\");\n      break;\n    case \"last_7_days\":\n      strStartDay = moment(last_7_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_30_days\":\n      strStartDay = moment(last_30_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_60_days\":\n      strStartDay = moment(last_60_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_90_days\":\n      strStartDay = moment(last_90_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_120_days\":\n      strStartDay = moment(last_120_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_7_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_7_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_30_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_30_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_60_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_60_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_90_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_90_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_120_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_120_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n  }\n  values = [startValue, endValue];\n  if (field_type === \"datetime\") {\n    _.forEach(values, function(fv) {\n      if (fv) {\n        return fv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60);\n      }\n    });\n  }\n  return {\n    label: label,\n    key: key,\n    values: values\n  };\n};\n\nCreator.getFieldDefaultOperation = function(field_type) {\n  if (field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    return 'between';\n  } else if ([\"textarea\", \"text\", \"code\"].includes(field_type)) {\n    return 'contains';\n  } else {\n    return \"=\";\n  }\n};\n\nCreator.getFieldOperation = function(field_type) {\n  var operations, optionals;\n  optionals = {\n    equal: {\n      label: t(\"creator_filter_operation_equal\"),\n      value: \"=\"\n    },\n    unequal: {\n      label: t(\"creator_filter_operation_unequal\"),\n      value: \"<>\"\n    },\n    less_than: {\n      label: t(\"creator_filter_operation_less_than\"),\n      value: \"<\"\n    },\n    greater_than: {\n      label: t(\"creator_filter_operation_greater_than\"),\n      value: \">\"\n    },\n    less_or_equal: {\n      label: t(\"creator_filter_operation_less_or_equal\"),\n      value: \"<=\"\n    },\n    greater_or_equal: {\n      label: t(\"creator_filter_operation_greater_or_equal\"),\n      value: \">=\"\n    },\n    contains: {\n      label: t(\"creator_filter_operation_contains\"),\n      value: \"contains\"\n    },\n    not_contain: {\n      label: t(\"creator_filter_operation_does_not_contain\"),\n      value: \"notcontains\"\n    },\n    starts_with: {\n      label: t(\"creator_filter_operation_starts_with\"),\n      value: \"startswith\"\n    },\n    between: {\n      label: t(\"creator_filter_operation_between\"),\n      value: \"between\"\n    }\n  };\n  if (field_type === void 0) {\n    return _.values(optionals);\n  }\n  operations = [];\n  if (Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    operations.push(optionals.between);\n    Creator.pushBetweenBuiltinOptionals(field_type, operations);\n  } else if (field_type === \"text\" || field_type === \"textarea\" || field_type === \"html\" || field_type === \"code\") {\n    operations.push(optionals.contains);\n  } else if (field_type === \"lookup\" || field_type === \"master_detail\" || field_type === \"select\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"currency\" || field_type === \"number\") {\n    operations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal);\n  } else if (field_type === \"boolean\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"checkbox\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"[text]\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else {\n    operations.push(optionals.equal, optionals.unequal);\n  }\n  return operations;\n};\n\n\n/*\n    先按照有排序号的小的在前，大的在后\n    再将没有排序号的显示在\n */\n\nCreator.getObjectFieldsName = function(object_name) {\n  var fields, fieldsArr, fieldsName, ref;\n  fields = (ref = Creator.getObject(object_name)) != null ? ref.fields : void 0;\n  fieldsArr = [];\n  _.each(fields, function(field) {\n    return fieldsArr.push({\n      name: field.name,\n      sort_no: field.sort_no\n    });\n  });\n  fieldsName = [];\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    return fieldsName.push(field.name);\n  });\n  return fieldsName;\n};\n","Creator._trigger_hooks = {}\n\ninitTrigger = (object_name, trigger)->\n\ttry\n\t\tcollection = Creator.getCollection(object_name)\n\t\tif !trigger.todo\n\t\t\treturn\n\t\ttodoWrapper = ()->\n\t\t\t  this.object_name = object_name\n\t\t\t  return trigger.todo.apply(this, arguments)\n\t\tif trigger.when == \"before.insert\"\n\t\t\t  return collection.before.insert(todoWrapper)\n\t\t  else if trigger.when == \"before.update\"\n\t\t\t  return collection.before.update(todoWrapper)\n\t\t  else if trigger.when == \"before.remove\"\n\t\t\t  return collection.before.remove(todoWrapper)\n\t\t  else if trigger.when == \"after.insert\"\n\t\t\t  return collection.after.insert(todoWrapper)\n\t\t  else if trigger.when == \"after.update\"\n\t\t\t  return collection.after.update(todoWrapper)\n\t\t  else if trigger.when == \"after.remove\"\n\t\t\t  return collection.after.remove(todoWrapper)\n\tcatch error\n\t\tconsole.error('initTrigger error', error)\n\ncleanTrigger = (object_name)->\n\t###\n    \t由于collection-hooks package 的remove函数是使用下标删除对象的，所以此处反转hooks集合后，再删除\n    \t因为一个数组元素删除后，其他元素的下标会发生变化\n\t###\n    #TODO 由于collection-hooks package 的remove函数bug\n\tCreator._trigger_hooks[object_name]?.reverse().forEach (_hook)->\n\t\t_hook.remove()\n\nCreator.initTriggers = (object_name)->\n#\tconsole.log('Creator.initTriggers object_name', object_name)\n\tobj = Creator.getObject(object_name)\n\n\tcleanTrigger(object_name)\n\n\tCreator._trigger_hooks[object_name] = []\n\n\t_.each obj.triggers, (trigger, trigger_name)->\n\t\tif Meteor.isServer and trigger.on == \"server\" and trigger.todo and trigger.when\n\t\t\t_trigger_hook = initTrigger object_name, trigger\n\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)\n\t\tif Meteor.isClient and trigger.on == \"client\" and trigger.todo and trigger.when\n\t\t\t_trigger_hook = initTrigger object_name, trigger\n\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)","var cleanTrigger, initTrigger;\n\nCreator._trigger_hooks = {};\n\ninitTrigger = function(object_name, trigger) {\n  var collection, error, todoWrapper;\n  try {\n    collection = Creator.getCollection(object_name);\n    if (!trigger.todo) {\n      return;\n    }\n    todoWrapper = function() {\n      this.object_name = object_name;\n      return trigger.todo.apply(this, arguments);\n    };\n    if (trigger.when === \"before.insert\") {\n      return collection.before.insert(todoWrapper);\n    } else if (trigger.when === \"before.update\") {\n      return collection.before.update(todoWrapper);\n    } else if (trigger.when === \"before.remove\") {\n      return collection.before.remove(todoWrapper);\n    } else if (trigger.when === \"after.insert\") {\n      return collection.after.insert(todoWrapper);\n    } else if (trigger.when === \"after.update\") {\n      return collection.after.update(todoWrapper);\n    } else if (trigger.when === \"after.remove\") {\n      return collection.after.remove(todoWrapper);\n    }\n  } catch (error1) {\n    error = error1;\n    return console.error('initTrigger error', error);\n  }\n};\n\ncleanTrigger = function(object_name) {\n\n  /*\n     \t由于collection-hooks package 的remove函数是使用下标删除对象的，所以此处反转hooks集合后，再删除\n     \t因为一个数组元素删除后，其他元素的下标会发生变化\n   */\n  var ref;\n  return (ref = Creator._trigger_hooks[object_name]) != null ? ref.reverse().forEach(function(_hook) {\n    return _hook.remove();\n  }) : void 0;\n};\n\nCreator.initTriggers = function(object_name) {\n  var obj;\n  obj = Creator.getObject(object_name);\n  cleanTrigger(object_name);\n  Creator._trigger_hooks[object_name] = [];\n  return _.each(obj.triggers, function(trigger, trigger_name) {\n    var _trigger_hook;\n    if (Meteor.isServer && trigger.on === \"server\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      Creator._trigger_hooks[object_name].push(_trigger_hook);\n    }\n    if (Meteor.isClient && trigger.on === \"client\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      return Creator._trigger_hooks[object_name].push(_trigger_hook);\n    }\n  });\n};\n","Creator.getPermissions = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tobj = Creator.getObject(object_name)\n\t\tif !obj\n\t\t\treturn\n\t\treturn obj.permissions.get()\n\telse if Meteor.isServer\n\t\tCreator.getObjectPermissions(spaceId, userId, object_name)\n\nCreator.getRecordPermissions = (object_name, record, userId, spaceId)->\n\tif !object_name and Meteor.isClient\n\t\tobject_name = Session.get(\"object_name\")\n\n\tpermissions = _.clone(Creator.getPermissions(object_name))\n\n\tif record\n\t\tisOwner = record.owner == userId || record.owner?._id == userId\n\t\tif Meteor.isClient\n\t\t\tuser_company_ids = Steedos.getUserCompanyIds()\n\t\telse\n\t\t\tuser_company_ids = Creator.getUserCompanyIds(userId, spaceId)\n\t\trecord_company_id = record?.company_id\n\t\tif record_company_id and _.isObject(record_company_id) and record_company_id._id\n\t\t\t# 因record_company_id是lookup类型，有可能dx控件会把它映射转为对应的object，所以这里取出其_id值\n\t\t\trecord_company_id = record_company_id._id\n\t\tif !permissions.modifyAllRecords and !isOwner and !permissions.modifyCompanyRecords\n\t\t\tpermissions.allowEdit = false\n\t\t\tpermissions.allowDelete = false\n\t\telse if permissions.modifyCompanyRecords\n\t\t\tif record_company_id and _.isString(record_company_id)\n\t\t\t\tif user_company_ids and user_company_ids.length\n\t\t\t\t\tif !_.include(user_company_ids, record_company_id)\n\t\t\t\t\t\t# 记录的company_id属性不在当前用户user_company_ids范围内时，认为无权修改\n\t\t\t\t\t\tpermissions.allowEdit = false\n\t\t\t\t\t\tpermissions.allowDelete = false\n\t\t\t\telse\n\t\t\t\t\t# 记录有company_id属性，但是当前用户user_company_ids为空时，认为无权修改\n\t\t\t\t\tpermissions.allowEdit = false\n\t\t\t\t\tpermissions.allowDelete = false\n\t\t\n\t\tif record.locked and !permissions.modifyAllRecords\n\t\t\tpermissions.allowEdit = false\n\t\t\tpermissions.allowDelete = false\n\n\t\tif !permissions.viewAllRecords and !isOwner and !permissions.viewCompanyRecords\n\t\t\tpermissions.allowRead = false\n\t\telse if permissions.viewCompanyRecords\n\t\t\tif record_company_id and _.isString(record_company_id)\n\t\t\t\tif user_company_ids and user_company_ids.length\n\t\t\t\t\tif !_.include(user_company_ids, record_company_id)\n\t\t\t\t\t\t# 记录的company_id属性不在当前用户user_company_ids范围内时，认为无权查看\n\t\t\t\t\t\tpermissions.allowRead = false\n\t\t\t\telse\n\t\t\t\t\t# 记录有company_id属性，但是当前用户user_company_ids为空时，认为无权查看\n\t\t\t\t\tpermissions.allowRead = false\n\n\treturn permissions\n\nif Meteor.isServer\n\n\tCreator.getAllPermissions = (spaceId, userId) ->\n\t\tpermissions =\n\t\t\tobjects: {}\n\t\t\tassigned_apps: []\n\t\tpsetsAdmin = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsUser = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsMember = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsGuest = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsWorkflowAdmin = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'workflow_admin'}, {fields:{_id:1, assigned_apps:1, users:1}}) || null\n\t\tpsetsOrganizationAdmin = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'organization_admin'}, {fields:{_id:1, assigned_apps:1, users:1}}) || null\n\t\tpsetsCurrent = Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\n\t\tpsetsAdmin_pos = null\n\t\tpsetsUser_pos = null\n\t\tpsetsMember_pos = null\n\t\tpsetsGuest_pos = null\n\t\tpsetsWorkflowAdmin_pos = null\n\t\tpsetsOrganizationAdmin_pos = null\n\t\tpsetsCurrent_pos = null\n\n\t\tif psetsAdmin?._id\n\t\t\tpsetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsAdmin._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsUser?._id\n\t\t\tpsetsUser_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsUser._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsMember?._id\n\t\t\tpsetsMember_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsMember._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsGuest?._id\n\t\t\tpsetsGuest_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsGuest._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsWorkflowAdmin?._id\n\t\t\tpsetsWorkflowAdmin_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsWorkflowAdmin._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsOrganizationAdmin?._id\n\t\t\tpsetsOrganizationAdmin_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsOrganizationAdmin._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsCurrent.length > 0\n\t\t\tset_ids = _.pluck psetsCurrent, \"_id\"\n\t\t\tpsetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: {$in: set_ids}}).fetch()\n\t\t\tpsetsCurrentNames = _.pluck psetsCurrent, \"name\"\n\t\tisSpaceAdmin = false\n\t\tspaceUser = null\n\t\tif userId\n\t\t\tisSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId)\n\t\t\tisWorkflowAdmin = psetsWorkflowAdmin?.users?.includes(userId)\n\t\t\tisOrganizationAdmin = psetsOrganizationAdmin?.users?.includes(userId)\n\t\t\tspaceUser = Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\n\t\tpsets = { \n\t\t\tpsetsAdmin, \n\t\t\tpsetsUser, \n\t\t\tpsetsCurrent, \n\t\t\tpsetsMember, \n\t\t\tpsetsGuest, \n\t\t\tpsetsWorkflowAdmin, \n\t\t\tpsetsOrganizationAdmin, \n\t\t\tisSpaceAdmin, \n\t\t\tisWorkflowAdmin,\n\t\t\tisOrganizationAdmin,\n\t\t\tspaceUser, \n\t\t\tpsetsAdmin_pos, \n\t\t\tpsetsUser_pos, \n\t\t\tpsetsMember_pos, \n\t\t\tpsetsGuest_pos, \n\t\t\tpsetsWorkflowAdmin_pos, \n\t\t\tpsetsOrganizationAdmin_pos, \n\t\t\tpsetsCurrent_pos\n\t\t}\n\t\tpermissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId)\n\t\tpermissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId)\n\t\tpermissions.user_permission_sets = psetsCurrentNames\n\t\t_i = 0\n\t\t_.each Creator.objectsByName, (object, object_name)->\n\t\t\t_i++\n\t\t\tif !_.has(object, 'space') || !object.space || object.space == spaceId\n\t\t\t\tpermissions.objects[object_name] = _.clone Creator.convertObject(Creator.Objects[object_name])\n\t\t\t\tpermissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name)\n\t\treturn permissions\n\n\tunionPlus = (array, other) ->\n\t\tif !array and !other\n\t\t\treturn undefined\n\t\tif !array\n\t\t\tarray = []\n\t\tif !other\n\t\t\tother = []\n\t\treturn _.union(array, other)\n\n\tCreator.getAssignedApps = (spaceId, userId)->\n\t\tpsetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}})\n\t\tpsetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}})\n\t\t# psetsMember = this.psetsMember || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}})\n\t\t# psetsGuest = this.psetsGuest || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}})\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\t\tapps = []\n\t\tif isSpaceAdmin\n\t\t\treturn []\n\t\telse\n\t\t\tpsetBase = psetsUser\n\t\t\tif psetBase?.assigned_apps\n\t\t\t\tapps = _.union apps, psetBase.assigned_apps\n\t\t\t_.each psets, (pset)->\n\t\t\t\tif !pset.assigned_apps\n\t\t\t\t\treturn\n\t\t\t\tif pset.name == \"admin\" ||  pset.name == \"user\"\n\t\t\t\t\treturn\n\t\t\t\tapps = _.union apps, pset.assigned_apps\n\t\t\treturn _.without(_.uniq(apps),undefined,null)\n\n\tCreator.getAssignedMenus = (spaceId, userId)->\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, name:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\t\tadminMenus = Creator.Apps.admin?.admin_menus\n\t\t# 如果没有admin菜单说明不需要相关功能，直接返回空\n\t\tunless adminMenus\n\t\t\treturn []\n\t\taboutMenu = adminMenus.find (n) ->\n\t\t\tn._id == 'about'\n\t\tadminMenus = adminMenus.filter (n) ->\n\t\t\tn._id != 'about'\n\t\totherMenuApps = _.sortBy _.filter(_.values(Creator.Apps), (n) ->\n\t\t\treturn n.admin_menus and n._id != 'admin'\n\t\t), 'sort'\n\t\totherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"))\n\t\t# 菜单有三部分组成设置APP菜单、其他APP菜单以及about菜单\n\t\tallMenus = _.union(adminMenus, otherMenus, [aboutMenu])\n\t\tif isSpaceAdmin\n\t\t\t# 工作区管理员有全部菜单功能\n\t\t\treturn allMenus\n\t\telse\n\t\t\tcurrentPsetNames = psets.map (n) ->\n\t\t\t\treturn n.name\n\t\t\tmenus = allMenus.filter (menu)->\n\t\t\t\tpsetsMenu = menu.permission_sets\n\t\t\t\t# 如果普通用户有权限，则直接返回true\n\t\t\t\tif psetsMenu && psetsMenu.indexOf(\"user\") > -1\n\t\t\t\t\treturn true\n\t\t\t\t# 否则取当前用户的权限集与menu菜单要求的权限集对比，如果交集大于1个则返回true\n\t\t\t\treturn _.intersection(currentPsetNames, psetsMenu).length\n\t\t\treturn menus\n\n\tfindOne_permission_object = (permission_objects, object_name, permission_set_id)->\n\n\t\tif _.isNull(permission_objects)\n\t\t\treturn null\n\t\tif _.isArray(permission_objects)\n\t\t\treturn _.find permission_objects, (po)->\n\t\t\t\t\treturn po.object_name == object_name\n\t\treturn Creator.getCollection(\"permission_objects\").findOne({object_name: object_name, permission_set_id: permission_set_id})\n\n\tfind_permission_object = (permission_objects, object_name, permission_set_ids)->\n\t\tif _.isNull(permission_objects)\n\t\t\treturn null\n\t\tif _.isArray(permission_objects)\n\t\t\treturn _.filter permission_objects, (po)->\n\t\t\t\treturn po.object_name == object_name\n\t\tCreator.getCollection(\"permission_objects\").find({object_name: object_name, permission_set_id: {$in: permission_set_ids}}).fetch()\n\n\tCreator.getObjectPermissions = (spaceId, userId, object_name)->\n\t\tpermissions = {}\n\t\tobject = Creator.getObject(object_name, spaceId)\n\n\t\tif spaceId is 'guest' || object_name == \"users\"\n\t\t\tpermissions = _.clone(object.permission_set.guest) || {}\n\t\t\tCreator.processPermissions permissions\n\t\t\treturn permissions\n\t\tpsetsAdmin = if _.isNull(this.psetsAdmin) or this.psetsAdmin then this.psetsAdmin else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1}})\n\t\tpsetsUser = if _.isNull(this.psetsUser) or this.psetsUser then this.psetsUser else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1}})\n\t\tpsetsMember = if _.isNull(this.psetsMember) or this.psetsMember then this.psetsMember else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1}})\n\t\tpsetsGuest = if _.isNull(this.psetsGuest) or this.psetsGuest then this.psetsGuest else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1}})\n\t\tpsetsWorkflowAdmin = if _.isNull(this.psetsWorkflowAdmin) or this.psetsWorkflowAdmin then this.psetsWorkflowAdmin else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'workflow_admin'}, {fields:{_id:1, users:1}})\n\t\tpsetsOrganizationAdmin = if _.isNull(this.psetsOrganizationAdmin) or this.psetsOrganizationAdmin then this.psetsOrganizationAdmin else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'organization_admin'}, {fields:{_id:1, users:1}})\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\t\tisWorkflowAdmin = if _.isBoolean(this.isWorkflowAdmin) then this.isWorkflowAdmin else psetsWorkflowAdmin?.users?.includes(userId)\n\t\tisOrganizationAdmin = if _.isBoolean(this.isOrganizationAdmin) then this.isOrganizationAdmin else psetsOrganizationAdmin?.users?.includes(userId)\n\n\t\tpsetsAdmin_pos = this.psetsAdmin_pos\n\t\tpsetsUser_pos = this.psetsUser_pos\n\t\tpsetsMember_pos = this.psetsMember_pos\n\t\tpsetsGuest_pos = this.psetsGuest_pos\n\t\tpsetsWorkflowAdmin_pos = this.psetsWorkflowAdmin_pos\n\t\tpsetsOrganizationAdmin_pos = this.psetsOrganizationAdmin_pos\n\t\tpsetsCurrent_pos = this.psetsCurrent_pos\n\n\t\topsetAdmin = _.clone(object.permission_set.admin) || {}\n\t\topsetUser = _.clone(object.permission_set.user) || {}\n\t\topsetMember = _.clone(object.permission_set.member) || {}\n\t\topsetGuest = _.clone(object.permission_set.guest) || {}\n\t\topsetWorkflowAdmin = _.clone(object.permission_set.workflow_admin) || {}\n\t\topsetOrganizationAdmin = _.clone(object.permission_set.organization_admin) || {}\n\t\t# sharedListViews = Creator.getCollection('object_listviews').find({space: spaceId, object_name: object_name, shared: true}, {fields:{_id:1}}).fetch()\n\t\t# sharedListViews = _.pluck(sharedListViews,\"_id\")\n\t\t# if sharedListViews.length\n\t\t# \tunless opsetAdmin.list_views\n\t\t# \t\topsetAdmin.list_views = []\n\t\t# \topsetAdmin.list_views = _.union opsetAdmin.list_views, sharedListViews\n\t\t# \tunless opsetUser.list_views\n\t\t# \t\topsetUser.list_views = []\n\t\t# \topsetUser.list_views = _.union opsetUser.list_views, sharedListViews\n\t\t# 数据库中如果配置了默认的admin/user权限集设置，应该覆盖代码中admin/user的权限集设置\n\t\tif psetsAdmin\n\t\t\tposAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id)\n\t\t\tif posAdmin\n\t\t\t\topsetAdmin.allowCreate = posAdmin.allowCreate\n\t\t\t\topsetAdmin.allowDelete = posAdmin.allowDelete\n\t\t\t\topsetAdmin.allowEdit = posAdmin.allowEdit\n\t\t\t\topsetAdmin.allowRead = posAdmin.allowRead\n\t\t\t\topsetAdmin.modifyAllRecords = posAdmin.modifyAllRecords\n\t\t\t\topsetAdmin.viewAllRecords = posAdmin.viewAllRecords\n\t\t\t\topsetAdmin.modifyCompanyRecords = posAdmin.modifyCompanyRecords\n\t\t\t\topsetAdmin.viewCompanyRecords = posAdmin.viewCompanyRecords\n\t\t\t\topsetAdmin.disabled_list_views = posAdmin.disabled_list_views\n\t\t\t\topsetAdmin.disabled_actions = posAdmin.disabled_actions\n\t\t\t\topsetAdmin.unreadable_fields = posAdmin.unreadable_fields\n\t\t\t\topsetAdmin.uneditable_fields = posAdmin.uneditable_fields\n\t\t\t\topsetAdmin.unrelated_objects = posAdmin.unrelated_objects\n\t\tif psetsUser\n\t\t\tposUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id)\n\t\t\tif posUser\n\t\t\t\topsetUser.allowCreate = posUser.allowCreate\n\t\t\t\topsetUser.allowDelete = posUser.allowDelete\n\t\t\t\topsetUser.allowEdit = posUser.allowEdit\n\t\t\t\topsetUser.allowRead = posUser.allowRead\n\t\t\t\topsetUser.modifyAllRecords = posUser.modifyAllRecords\n\t\t\t\topsetUser.viewAllRecords = posUser.viewAllRecords\n\t\t\t\topsetUser.modifyCompanyRecords = posUser.modifyCompanyRecords\n\t\t\t\topsetUser.viewCompanyRecords = posUser.viewCompanyRecords\n\t\t\t\topsetUser.disabled_list_views = posUser.disabled_list_views\n\t\t\t\topsetUser.disabled_actions = posUser.disabled_actions\n\t\t\t\topsetUser.unreadable_fields = posUser.unreadable_fields\n\t\t\t\topsetUser.uneditable_fields = posUser.uneditable_fields\n\t\t\t\topsetUser.unrelated_objects = posUser.unrelated_objects\n\t\tif psetsMember\n\t\t\tposMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id)\n\t\t\tif posMember\n\t\t\t\topsetMember.allowCreate = posMember.allowCreate\n\t\t\t\topsetMember.allowDelete = posMember.allowDelete\n\t\t\t\topsetMember.allowEdit = posMember.allowEdit\n\t\t\t\topsetMember.allowRead = posMember.allowRead\n\t\t\t\topsetMember.modifyAllRecords = posMember.modifyAllRecords\n\t\t\t\topsetMember.viewAllRecords = posMember.viewAllRecords\n\t\t\t\topsetMember.modifyCompanyRecords = posMember.modifyCompanyRecords\n\t\t\t\topsetMember.viewCompanyRecords = posMember.viewCompanyRecords\n\t\t\t\topsetMember.disabled_list_views = posMember.disabled_list_views\n\t\t\t\topsetMember.disabled_actions = posMember.disabled_actions\n\t\t\t\topsetMember.unreadable_fields = posMember.unreadable_fields\n\t\t\t\topsetMember.uneditable_fields = posMember.uneditable_fields\n\t\t\t\topsetMember.unrelated_objects = posMember.unrelated_objects\n\t\tif psetsGuest\n\t\t\tposGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id)\n\t\t\tif posGuest\n\t\t\t\topsetGuest.allowCreate = posGuest.allowCreate\n\t\t\t\topsetGuest.allowDelete = posGuest.allowDelete\n\t\t\t\topsetGuest.allowEdit = posGuest.allowEdit\n\t\t\t\topsetGuest.allowRead = posGuest.allowRead\n\t\t\t\topsetGuest.modifyAllRecords = posGuest.modifyAllRecords\n\t\t\t\topsetGuest.viewAllRecords = posGuest.viewAllRecords\n\t\t\t\topsetGuest.modifyCompanyRecords = posGuest.modifyCompanyRecords\n\t\t\t\topsetGuest.viewCompanyRecords = posGuest.viewCompanyRecords\n\t\t\t\topsetGuest.disabled_list_views = posGuest.disabled_list_views\n\t\t\t\topsetGuest.disabled_actions = posGuest.disabled_actions\n\t\t\t\topsetGuest.unreadable_fields = posGuest.unreadable_fields\n\t\t\t\topsetGuest.uneditable_fields = posGuest.uneditable_fields\n\t\t\t\topsetGuest.unrelated_objects = posGuest.unrelated_objects\n\t\tif psetsWorkflowAdmin\n\t\t\tposWorkflowAdmin = findOne_permission_object(psetsWorkflowAdmin_pos, object_name, psetsWorkflowAdmin._id)\n\t\t\tif posWorkflowAdmin\n\t\t\t\topsetWorkflowAdmin.allowCreate = posWorkflowAdmin.allowCreate\n\t\t\t\topsetWorkflowAdmin.allowDelete = posWorkflowAdmin.allowDelete\n\t\t\t\topsetWorkflowAdmin.allowEdit = posWorkflowAdmin.allowEdit\n\t\t\t\topsetWorkflowAdmin.allowRead = posWorkflowAdmin.allowRead\n\t\t\t\topsetWorkflowAdmin.modifyAllRecords = posWorkflowAdmin.modifyAllRecords\n\t\t\t\topsetWorkflowAdmin.viewAllRecords = posWorkflowAdmin.viewAllRecords\n\t\t\t\topsetWorkflowAdmin.modifyCompanyRecords = posWorkflowAdmin.modifyCompanyRecords\n\t\t\t\topsetWorkflowAdmin.viewCompanyRecords = posWorkflowAdmin.viewCompanyRecords\n\t\t\t\topsetWorkflowAdmin.disabled_list_views = posWorkflowAdmin.disabled_list_views\n\t\t\t\topsetWorkflowAdmin.disabled_actions = posWorkflowAdmin.disabled_actions\n\t\t\t\topsetWorkflowAdmin.unreadable_fields = posWorkflowAdmin.unreadable_fields\n\t\t\t\topsetWorkflowAdmin.uneditable_fields = posWorkflowAdmin.uneditable_fields\n\t\t\t\topsetWorkflowAdmin.unrelated_objects = posWorkflowAdmin.unrelated_objects\n\t\tif psetsOrganizationAdmin\n\t\t\tposOrganizationAdmin = findOne_permission_object(psetsOrganizationAdmin_pos, object_name, psetsOrganizationAdmin._id)\n\t\t\tif posOrganizationAdmin\n\t\t\t\topsetOrganizationAdmin.allowCreate = posOrganizationAdmin.allowCreate\n\t\t\t\topsetOrganizationAdmin.allowDelete = posOrganizationAdmin.allowDelete\n\t\t\t\topsetOrganizationAdmin.allowEdit = posOrganizationAdmin.allowEdit\n\t\t\t\topsetOrganizationAdmin.allowRead = posOrganizationAdmin.allowRead\n\t\t\t\topsetOrganizationAdmin.modifyAllRecords = posOrganizationAdmin.modifyAllRecords\n\t\t\t\topsetOrganizationAdmin.viewAllRecords = posOrganizationAdmin.viewAllRecords\n\t\t\t\topsetOrganizationAdmin.modifyCompanyRecords = posOrganizationAdmin.modifyCompanyRecords\n\t\t\t\topsetOrganizationAdmin.viewCompanyRecords = posOrganizationAdmin.viewCompanyRecords\n\t\t\t\topsetOrganizationAdmin.disabled_list_views = posOrganizationAdmin.disabled_list_views\n\t\t\t\topsetOrganizationAdmin.disabled_actions = posOrganizationAdmin.disabled_actions\n\t\t\t\topsetOrganizationAdmin.unreadable_fields = posOrganizationAdmin.unreadable_fields\n\t\t\t\topsetOrganizationAdmin.uneditable_fields = posOrganizationAdmin.uneditable_fields\n\t\t\t\topsetOrganizationAdmin.unrelated_objects = posOrganizationAdmin.unrelated_objects\n\t\tif !userId\n\t\t\tpermissions = opsetAdmin\n\t\telse\n\t\t\tif isSpaceAdmin\n\t\t\t\tpermissions = opsetAdmin\n\t\t\telse\n\t\t\t\tif spaceId is 'common'\n\t\t\t\t\tpermissions = opsetUser\n\t\t\t\telse\n\t\t\t\t\tspaceUser = if _.isNull(this.spaceUser) or this.spaceUser then this.spaceUser else Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\t\t\t\t\tif spaceUser\n\t\t\t\t\t\tprof = spaceUser.profile\n\t\t\t\t\t\tif prof\n\t\t\t\t\t\t\tif prof is 'user'\n\t\t\t\t\t\t\t\tpermissions = opsetUser\n\t\t\t\t\t\t\telse if prof is 'member'\n\t\t\t\t\t\t\t\tpermissions = opsetMember\n\t\t\t\t\t\t\telse if prof is 'guest'\n\t\t\t\t\t\t\t\tpermissions = opsetGuest\n\t\t\t\t\t\telse # 没有profile则认为是user权限\n\t\t\t\t\t\t\tpermissions = opsetUser\n\t\t\t\t\telse\n\t\t\t\t\t\tpermissions = opsetGuest\n\n\t\tif psets.length > 0\n\t\t\tset_ids = _.pluck psets, \"_id\"\n\t\t\tpos = find_permission_object(psetsCurrent_pos, object_name, set_ids)\n\t\t\t_.each pos, (po)->\n\t\t\t\tif po.permission_set_id == psetsAdmin?._id or \n\t\t\t\tpo.permission_set_id == psetsUser?._id or \n\t\t\t\tpo.permission_set_id == psetsMember?._id or \n\t\t\t\tpo.permission_set_id == psetsGuest?._id or \n\t\t\t\tpo.permission_set_id == psetsWorkflowAdmin?._id or \n\t\t\t\tpo.permission_set_id == psetsOrganizationAdmin?._id\n\t\t\t\t\t# 默认的admin/user权限值只实行上面的默认值覆盖，不做算法判断\n\t\t\t\t\treturn\n\t\t\t\tif po.allowRead\n\t\t\t\t\tpermissions.allowRead = true\n\t\t\t\tif po.allowCreate\n\t\t\t\t\tpermissions.allowCreate = true\n\t\t\t\tif po.allowEdit\n\t\t\t\t\tpermissions.allowEdit = true\n\t\t\t\tif po.allowDelete\n\t\t\t\t\tpermissions.allowDelete = true\n\t\t\t\tif po.modifyAllRecords\n\t\t\t\t\tpermissions.modifyAllRecords = true\n\t\t\t\tif po.viewAllRecords\n\t\t\t\t\tpermissions.viewAllRecords = true\n\t\t\t\tif po.modifyCompanyRecords\n\t\t\t\t\tpermissions.modifyCompanyRecords = true\n\t\t\t\tif po.viewCompanyRecords\n\t\t\t\t\tpermissions.viewCompanyRecords = true\n\n\t\t\t\tpermissions.disabled_list_views = unionPlus(permissions.disabled_list_views, po.disabled_list_views)\n\t\t\t\tpermissions.disabled_actions = unionPlus(permissions.disabled_actions, po.disabled_actions)\n\t\t\t\tpermissions.unreadable_fields = unionPlus(permissions.unreadable_fields, po.unreadable_fields)\n\t\t\t\tpermissions.uneditable_fields = unionPlus(permissions.uneditable_fields, po.uneditable_fields)\n\t\t\t\tpermissions.unrelated_objects = unionPlus(permissions.unrelated_objects, po.unrelated_objects)\n\n\t\t\tif isWorkflowAdmin\n\t\t\t\tif opsetWorkflowAdmin.allowRead\n\t\t\t\t\tpermissions.allowRead = true\n\t\t\t\tif opsetWorkflowAdmin.allowCreate\n\t\t\t\t\tpermissions.allowCreate = true\n\t\t\t\tif opsetWorkflowAdmin.allowEdit\n\t\t\t\t\tpermissions.allowEdit = true\n\t\t\t\tif opsetWorkflowAdmin.allowDelete\n\t\t\t\t\tpermissions.allowDelete = true\n\t\t\t\tif opsetWorkflowAdmin.modifyAllRecords\n\t\t\t\t\tpermissions.modifyAllRecords = true\n\t\t\t\tif opsetWorkflowAdmin.viewAllRecords\n\t\t\t\t\tpermissions.viewAllRecords = true\n\t\t\t\tif opsetWorkflowAdmin.modifyCompanyRecords\n\t\t\t\t\tpermissions.modifyCompanyRecords = true\n\t\t\t\tif opsetWorkflowAdmin.viewCompanyRecords\n\t\t\t\t\tpermissions.viewCompanyRecords = true\n\n\t\t\t\tpermissions.disabled_list_views = unionPlus(permissions.disabled_list_views, opsetWorkflowAdmin.disabled_list_views)\n\t\t\t\tpermissions.disabled_actions = unionPlus(permissions.disabled_actions, opsetWorkflowAdmin.disabled_actions)\n\t\t\t\tpermissions.unreadable_fields = unionPlus(permissions.unreadable_fields, opsetWorkflowAdmin.unreadable_fields)\n\t\t\t\tpermissions.uneditable_fields = unionPlus(permissions.uneditable_fields, opsetWorkflowAdmin.uneditable_fields)\n\t\t\t\tpermissions.unrelated_objects = unionPlus(permissions.unrelated_objects, opsetWorkflowAdmin.unrelated_objects)\n\n\t\t\tif isOrganizationAdmin\n\t\t\t\tif opsetOrganizationAdmin.allowRead\n\t\t\t\t\tpermissions.allowRead = true\n\t\t\t\tif opsetOrganizationAdmin.allowCreate\n\t\t\t\t\tpermissions.allowCreate = true\n\t\t\t\tif opsetOrganizationAdmin.allowEdit\n\t\t\t\t\tpermissions.allowEdit = true\n\t\t\t\tif opsetOrganizationAdmin.allowDelete\n\t\t\t\t\tpermissions.allowDelete = true\n\t\t\t\tif opsetOrganizationAdmin.modifyAllRecords\n\t\t\t\t\tpermissions.modifyAllRecords = true\n\t\t\t\tif opsetOrganizationAdmin.viewAllRecords\n\t\t\t\t\tpermissions.viewAllRecords = true\n\t\t\t\tif opsetOrganizationAdmin.modifyCompanyRecords\n\t\t\t\t\tpermissions.modifyCompanyRecords = true\n\t\t\t\tif opsetOrganizationAdmin.viewCompanyRecords\n\t\t\t\t\tpermissions.viewCompanyRecords = true\n\n\t\t\t\tpermissions.disabled_list_views = unionPlus(permissions.disabled_list_views, opsetOrganizationAdmin.disabled_list_views)\n\t\t\t\tpermissions.disabled_actions = unionPlus(permissions.disabled_actions, opsetOrganizationAdmin.disabled_actions)\n\t\t\t\tpermissions.unreadable_fields = unionPlus(permissions.unreadable_fields, opsetOrganizationAdmin.unreadable_fields)\n\t\t\t\tpermissions.uneditable_fields = unionPlus(permissions.uneditable_fields, opsetOrganizationAdmin.uneditable_fields)\n\t\t\t\tpermissions.unrelated_objects = unionPlus(permissions.unrelated_objects, opsetOrganizationAdmin.unrelated_objects)\n\t\t\n\t\tif object.is_view\n\t\t\tpermissions.allowCreate = false\n\t\t\tpermissions.allowEdit = false\n\t\t\tpermissions.allowDelete = false\n\t\t\tpermissions.modifyAllRecords = false\n\t\t\tpermissions.modifyCompanyRecords = false\n\t\t\tpermissions.disabled_actions = []\n\t\tCreator.processPermissions permissions\n\t\treturn permissions\n\n\n\t# Creator.initPermissions = (object_name) ->\n\n\t\t# # 应该把计算出来的\n\t\t# Creator.Collections[object_name].allow\n\t\t# \tinsert: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t    \t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowCreate\n\t\t# \t\t\treturn false\n\n\t\t# \t\treturn true\n\t\t# \tupdate: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowEdit\n\t\t# \t\t\treturn false\n\t\t# \t\treturn true\n\t\t# \tremove: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowDelete\n\t\t# \t\t\treturn false\n\t\t# \t\treturn true\n\n\tMeteor.methods\n\t\t# Calculate Permissions on Server\n\t\t\"creator.object_permissions\": (spaceId)->\n\t\t\treturn Creator.getAllPermissions(spaceId, this.userId)\n","var findOne_permission_object, find_permission_object, unionPlus;\n\nCreator.getPermissions = function(object_name, spaceId, userId) {\n  var obj;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    obj = Creator.getObject(object_name);\n    if (!obj) {\n      return;\n    }\n    return obj.permissions.get();\n  } else if (Meteor.isServer) {\n    return Creator.getObjectPermissions(spaceId, userId, object_name);\n  }\n};\n\nCreator.getRecordPermissions = function(object_name, record, userId, spaceId) {\n  var isOwner, permissions, record_company_id, ref, user_company_ids;\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  permissions = _.clone(Creator.getPermissions(object_name));\n  if (record) {\n    isOwner = record.owner === userId || ((ref = record.owner) != null ? ref._id : void 0) === userId;\n    if (Meteor.isClient) {\n      user_company_ids = Steedos.getUserCompanyIds();\n    } else {\n      user_company_ids = Creator.getUserCompanyIds(userId, spaceId);\n    }\n    record_company_id = record != null ? record.company_id : void 0;\n    if (record_company_id && _.isObject(record_company_id) && record_company_id._id) {\n      record_company_id = record_company_id._id;\n    }\n    if (!permissions.modifyAllRecords && !isOwner && !permissions.modifyCompanyRecords) {\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n    } else if (permissions.modifyCompanyRecords) {\n      if (record_company_id && _.isString(record_company_id)) {\n        if (user_company_ids && user_company_ids.length) {\n          if (!_.include(user_company_ids, record_company_id)) {\n            permissions.allowEdit = false;\n            permissions.allowDelete = false;\n          }\n        } else {\n          permissions.allowEdit = false;\n          permissions.allowDelete = false;\n        }\n      }\n    }\n    if (record.locked && !permissions.modifyAllRecords) {\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n    }\n    if (!permissions.viewAllRecords && !isOwner && !permissions.viewCompanyRecords) {\n      permissions.allowRead = false;\n    } else if (permissions.viewCompanyRecords) {\n      if (record_company_id && _.isString(record_company_id)) {\n        if (user_company_ids && user_company_ids.length) {\n          if (!_.include(user_company_ids, record_company_id)) {\n            permissions.allowRead = false;\n          }\n        } else {\n          permissions.allowRead = false;\n        }\n      }\n    }\n  }\n  return permissions;\n};\n\nif (Meteor.isServer) {\n  Creator.getAllPermissions = function(spaceId, userId) {\n    var _i, isOrganizationAdmin, isSpaceAdmin, isWorkflowAdmin, permissions, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent, psetsCurrentNames, psetsCurrent_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsOrganizationAdmin, psetsOrganizationAdmin_pos, psetsUser, psetsUser_pos, psetsWorkflowAdmin, psetsWorkflowAdmin_pos, ref, ref1, set_ids, spaceUser;\n    permissions = {\n      objects: {},\n      assigned_apps: []\n    };\n    psetsAdmin = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsUser = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsMember = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsGuest = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsWorkflowAdmin = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'workflow_admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        users: 1\n      }\n    }) || null;\n    psetsOrganizationAdmin = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'organization_admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        users: 1\n      }\n    }) || null;\n    psetsCurrent = Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    psetsAdmin_pos = null;\n    psetsUser_pos = null;\n    psetsMember_pos = null;\n    psetsGuest_pos = null;\n    psetsWorkflowAdmin_pos = null;\n    psetsOrganizationAdmin_pos = null;\n    psetsCurrent_pos = null;\n    if (psetsAdmin != null ? psetsAdmin._id : void 0) {\n      psetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsAdmin._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsUser != null ? psetsUser._id : void 0) {\n      psetsUser_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsUser._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsMember != null ? psetsMember._id : void 0) {\n      psetsMember_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsMember._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsGuest != null ? psetsGuest._id : void 0) {\n      psetsGuest_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsGuest._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsWorkflowAdmin != null ? psetsWorkflowAdmin._id : void 0) {\n      psetsWorkflowAdmin_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsWorkflowAdmin._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsOrganizationAdmin != null ? psetsOrganizationAdmin._id : void 0) {\n      psetsOrganizationAdmin_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsOrganizationAdmin._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsCurrent.length > 0) {\n      set_ids = _.pluck(psetsCurrent, \"_id\");\n      psetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: {\n          $in: set_ids\n        }\n      }).fetch();\n      psetsCurrentNames = _.pluck(psetsCurrent, \"name\");\n    }\n    isSpaceAdmin = false;\n    spaceUser = null;\n    if (userId) {\n      isSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId);\n      isWorkflowAdmin = psetsWorkflowAdmin != null ? (ref = psetsWorkflowAdmin.users) != null ? ref.includes(userId) : void 0 : void 0;\n      isOrganizationAdmin = psetsOrganizationAdmin != null ? (ref1 = psetsOrganizationAdmin.users) != null ? ref1.includes(userId) : void 0 : void 0;\n      spaceUser = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      });\n    }\n    psets = {\n      psetsAdmin: psetsAdmin,\n      psetsUser: psetsUser,\n      psetsCurrent: psetsCurrent,\n      psetsMember: psetsMember,\n      psetsGuest: psetsGuest,\n      psetsWorkflowAdmin: psetsWorkflowAdmin,\n      psetsOrganizationAdmin: psetsOrganizationAdmin,\n      isSpaceAdmin: isSpaceAdmin,\n      isWorkflowAdmin: isWorkflowAdmin,\n      isOrganizationAdmin: isOrganizationAdmin,\n      spaceUser: spaceUser,\n      psetsAdmin_pos: psetsAdmin_pos,\n      psetsUser_pos: psetsUser_pos,\n      psetsMember_pos: psetsMember_pos,\n      psetsGuest_pos: psetsGuest_pos,\n      psetsWorkflowAdmin_pos: psetsWorkflowAdmin_pos,\n      psetsOrganizationAdmin_pos: psetsOrganizationAdmin_pos,\n      psetsCurrent_pos: psetsCurrent_pos\n    };\n    permissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId);\n    permissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId);\n    permissions.user_permission_sets = psetsCurrentNames;\n    _i = 0;\n    _.each(Creator.objectsByName, function(object, object_name) {\n      _i++;\n      if (!_.has(object, 'space') || !object.space || object.space === spaceId) {\n        permissions.objects[object_name] = _.clone(Creator.convertObject(Creator.Objects[object_name]));\n        return permissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name);\n      }\n    });\n    return permissions;\n  };\n  unionPlus = function(array, other) {\n    if (!array && !other) {\n      return void 0;\n    }\n    if (!array) {\n      array = [];\n    }\n    if (!other) {\n      other = [];\n    }\n    return _.union(array, other);\n  };\n  Creator.getAssignedApps = function(spaceId, userId) {\n    var apps, isSpaceAdmin, psetBase, psets, psetsAdmin, psetsUser;\n    psetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    apps = [];\n    if (isSpaceAdmin) {\n      return [];\n    } else {\n      psetBase = psetsUser;\n      if (psetBase != null ? psetBase.assigned_apps : void 0) {\n        apps = _.union(apps, psetBase.assigned_apps);\n      }\n      _.each(psets, function(pset) {\n        if (!pset.assigned_apps) {\n          return;\n        }\n        if (pset.name === \"admin\" || pset.name === \"user\") {\n          return;\n        }\n        return apps = _.union(apps, pset.assigned_apps);\n      });\n      return _.without(_.uniq(apps), void 0, null);\n    }\n  };\n  Creator.getAssignedMenus = function(spaceId, userId) {\n    var aboutMenu, adminMenus, allMenus, currentPsetNames, isSpaceAdmin, menus, otherMenuApps, otherMenus, psets, ref;\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        name: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    adminMenus = (ref = Creator.Apps.admin) != null ? ref.admin_menus : void 0;\n    if (!adminMenus) {\n      return [];\n    }\n    aboutMenu = adminMenus.find(function(n) {\n      return n._id === 'about';\n    });\n    adminMenus = adminMenus.filter(function(n) {\n      return n._id !== 'about';\n    });\n    otherMenuApps = _.sortBy(_.filter(_.values(Creator.Apps), function(n) {\n      return n.admin_menus && n._id !== 'admin';\n    }), 'sort');\n    otherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"));\n    allMenus = _.union(adminMenus, otherMenus, [aboutMenu]);\n    if (isSpaceAdmin) {\n      return allMenus;\n    } else {\n      currentPsetNames = psets.map(function(n) {\n        return n.name;\n      });\n      menus = allMenus.filter(function(menu) {\n        var psetsMenu;\n        psetsMenu = menu.permission_sets;\n        if (psetsMenu && psetsMenu.indexOf(\"user\") > -1) {\n          return true;\n        }\n        return _.intersection(currentPsetNames, psetsMenu).length;\n      });\n      return menus;\n    }\n  };\n  findOne_permission_object = function(permission_objects, object_name, permission_set_id) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.find(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").findOne({\n      object_name: object_name,\n      permission_set_id: permission_set_id\n    });\n  };\n  find_permission_object = function(permission_objects, object_name, permission_set_ids) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.filter(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").find({\n      object_name: object_name,\n      permission_set_id: {\n        $in: permission_set_ids\n      }\n    }).fetch();\n  };\n  Creator.getObjectPermissions = function(spaceId, userId, object_name) {\n    var isOrganizationAdmin, isSpaceAdmin, isWorkflowAdmin, object, opsetAdmin, opsetGuest, opsetMember, opsetOrganizationAdmin, opsetUser, opsetWorkflowAdmin, permissions, pos, posAdmin, posGuest, posMember, posOrganizationAdmin, posUser, posWorkflowAdmin, prof, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsOrganizationAdmin, psetsOrganizationAdmin_pos, psetsUser, psetsUser_pos, psetsWorkflowAdmin, psetsWorkflowAdmin_pos, ref, ref1, set_ids, spaceUser;\n    permissions = {};\n    object = Creator.getObject(object_name, spaceId);\n    if (spaceId === 'guest' || object_name === \"users\") {\n      permissions = _.clone(object.permission_set.guest) || {};\n      Creator.processPermissions(permissions);\n      return permissions;\n    }\n    psetsAdmin = _.isNull(this.psetsAdmin) || this.psetsAdmin ? this.psetsAdmin : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsUser = _.isNull(this.psetsUser) || this.psetsUser ? this.psetsUser : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsMember = _.isNull(this.psetsMember) || this.psetsMember ? this.psetsMember : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsGuest = _.isNull(this.psetsGuest) || this.psetsGuest ? this.psetsGuest : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsWorkflowAdmin = _.isNull(this.psetsWorkflowAdmin) || this.psetsWorkflowAdmin ? this.psetsWorkflowAdmin : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'workflow_admin'\n    }, {\n      fields: {\n        _id: 1,\n        users: 1\n      }\n    });\n    psetsOrganizationAdmin = _.isNull(this.psetsOrganizationAdmin) || this.psetsOrganizationAdmin ? this.psetsOrganizationAdmin : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'organization_admin'\n    }, {\n      fields: {\n        _id: 1,\n        users: 1\n      }\n    });\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    isWorkflowAdmin = _.isBoolean(this.isWorkflowAdmin) ? this.isWorkflowAdmin : psetsWorkflowAdmin != null ? (ref = psetsWorkflowAdmin.users) != null ? ref.includes(userId) : void 0 : void 0;\n    isOrganizationAdmin = _.isBoolean(this.isOrganizationAdmin) ? this.isOrganizationAdmin : psetsOrganizationAdmin != null ? (ref1 = psetsOrganizationAdmin.users) != null ? ref1.includes(userId) : void 0 : void 0;\n    psetsAdmin_pos = this.psetsAdmin_pos;\n    psetsUser_pos = this.psetsUser_pos;\n    psetsMember_pos = this.psetsMember_pos;\n    psetsGuest_pos = this.psetsGuest_pos;\n    psetsWorkflowAdmin_pos = this.psetsWorkflowAdmin_pos;\n    psetsOrganizationAdmin_pos = this.psetsOrganizationAdmin_pos;\n    psetsCurrent_pos = this.psetsCurrent_pos;\n    opsetAdmin = _.clone(object.permission_set.admin) || {};\n    opsetUser = _.clone(object.permission_set.user) || {};\n    opsetMember = _.clone(object.permission_set.member) || {};\n    opsetGuest = _.clone(object.permission_set.guest) || {};\n    opsetWorkflowAdmin = _.clone(object.permission_set.workflow_admin) || {};\n    opsetOrganizationAdmin = _.clone(object.permission_set.organization_admin) || {};\n    if (psetsAdmin) {\n      posAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id);\n      if (posAdmin) {\n        opsetAdmin.allowCreate = posAdmin.allowCreate;\n        opsetAdmin.allowDelete = posAdmin.allowDelete;\n        opsetAdmin.allowEdit = posAdmin.allowEdit;\n        opsetAdmin.allowRead = posAdmin.allowRead;\n        opsetAdmin.modifyAllRecords = posAdmin.modifyAllRecords;\n        opsetAdmin.viewAllRecords = posAdmin.viewAllRecords;\n        opsetAdmin.modifyCompanyRecords = posAdmin.modifyCompanyRecords;\n        opsetAdmin.viewCompanyRecords = posAdmin.viewCompanyRecords;\n        opsetAdmin.disabled_list_views = posAdmin.disabled_list_views;\n        opsetAdmin.disabled_actions = posAdmin.disabled_actions;\n        opsetAdmin.unreadable_fields = posAdmin.unreadable_fields;\n        opsetAdmin.uneditable_fields = posAdmin.uneditable_fields;\n        opsetAdmin.unrelated_objects = posAdmin.unrelated_objects;\n      }\n    }\n    if (psetsUser) {\n      posUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id);\n      if (posUser) {\n        opsetUser.allowCreate = posUser.allowCreate;\n        opsetUser.allowDelete = posUser.allowDelete;\n        opsetUser.allowEdit = posUser.allowEdit;\n        opsetUser.allowRead = posUser.allowRead;\n        opsetUser.modifyAllRecords = posUser.modifyAllRecords;\n        opsetUser.viewAllRecords = posUser.viewAllRecords;\n        opsetUser.modifyCompanyRecords = posUser.modifyCompanyRecords;\n        opsetUser.viewCompanyRecords = posUser.viewCompanyRecords;\n        opsetUser.disabled_list_views = posUser.disabled_list_views;\n        opsetUser.disabled_actions = posUser.disabled_actions;\n        opsetUser.unreadable_fields = posUser.unreadable_fields;\n        opsetUser.uneditable_fields = posUser.uneditable_fields;\n        opsetUser.unrelated_objects = posUser.unrelated_objects;\n      }\n    }\n    if (psetsMember) {\n      posMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id);\n      if (posMember) {\n        opsetMember.allowCreate = posMember.allowCreate;\n        opsetMember.allowDelete = posMember.allowDelete;\n        opsetMember.allowEdit = posMember.allowEdit;\n        opsetMember.allowRead = posMember.allowRead;\n        opsetMember.modifyAllRecords = posMember.modifyAllRecords;\n        opsetMember.viewAllRecords = posMember.viewAllRecords;\n        opsetMember.modifyCompanyRecords = posMember.modifyCompanyRecords;\n        opsetMember.viewCompanyRecords = posMember.viewCompanyRecords;\n        opsetMember.disabled_list_views = posMember.disabled_list_views;\n        opsetMember.disabled_actions = posMember.disabled_actions;\n        opsetMember.unreadable_fields = posMember.unreadable_fields;\n        opsetMember.uneditable_fields = posMember.uneditable_fields;\n        opsetMember.unrelated_objects = posMember.unrelated_objects;\n      }\n    }\n    if (psetsGuest) {\n      posGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id);\n      if (posGuest) {\n        opsetGuest.allowCreate = posGuest.allowCreate;\n        opsetGuest.allowDelete = posGuest.allowDelete;\n        opsetGuest.allowEdit = posGuest.allowEdit;\n        opsetGuest.allowRead = posGuest.allowRead;\n        opsetGuest.modifyAllRecords = posGuest.modifyAllRecords;\n        opsetGuest.viewAllRecords = posGuest.viewAllRecords;\n        opsetGuest.modifyCompanyRecords = posGuest.modifyCompanyRecords;\n        opsetGuest.viewCompanyRecords = posGuest.viewCompanyRecords;\n        opsetGuest.disabled_list_views = posGuest.disabled_list_views;\n        opsetGuest.disabled_actions = posGuest.disabled_actions;\n        opsetGuest.unreadable_fields = posGuest.unreadable_fields;\n        opsetGuest.uneditable_fields = posGuest.uneditable_fields;\n        opsetGuest.unrelated_objects = posGuest.unrelated_objects;\n      }\n    }\n    if (psetsWorkflowAdmin) {\n      posWorkflowAdmin = findOne_permission_object(psetsWorkflowAdmin_pos, object_name, psetsWorkflowAdmin._id);\n      if (posWorkflowAdmin) {\n        opsetWorkflowAdmin.allowCreate = posWorkflowAdmin.allowCreate;\n        opsetWorkflowAdmin.allowDelete = posWorkflowAdmin.allowDelete;\n        opsetWorkflowAdmin.allowEdit = posWorkflowAdmin.allowEdit;\n        opsetWorkflowAdmin.allowRead = posWorkflowAdmin.allowRead;\n        opsetWorkflowAdmin.modifyAllRecords = posWorkflowAdmin.modifyAllRecords;\n        opsetWorkflowAdmin.viewAllRecords = posWorkflowAdmin.viewAllRecords;\n        opsetWorkflowAdmin.modifyCompanyRecords = posWorkflowAdmin.modifyCompanyRecords;\n        opsetWorkflowAdmin.viewCompanyRecords = posWorkflowAdmin.viewCompanyRecords;\n        opsetWorkflowAdmin.disabled_list_views = posWorkflowAdmin.disabled_list_views;\n        opsetWorkflowAdmin.disabled_actions = posWorkflowAdmin.disabled_actions;\n        opsetWorkflowAdmin.unreadable_fields = posWorkflowAdmin.unreadable_fields;\n        opsetWorkflowAdmin.uneditable_fields = posWorkflowAdmin.uneditable_fields;\n        opsetWorkflowAdmin.unrelated_objects = posWorkflowAdmin.unrelated_objects;\n      }\n    }\n    if (psetsOrganizationAdmin) {\n      posOrganizationAdmin = findOne_permission_object(psetsOrganizationAdmin_pos, object_name, psetsOrganizationAdmin._id);\n      if (posOrganizationAdmin) {\n        opsetOrganizationAdmin.allowCreate = posOrganizationAdmin.allowCreate;\n        opsetOrganizationAdmin.allowDelete = posOrganizationAdmin.allowDelete;\n        opsetOrganizationAdmin.allowEdit = posOrganizationAdmin.allowEdit;\n        opsetOrganizationAdmin.allowRead = posOrganizationAdmin.allowRead;\n        opsetOrganizationAdmin.modifyAllRecords = posOrganizationAdmin.modifyAllRecords;\n        opsetOrganizationAdmin.viewAllRecords = posOrganizationAdmin.viewAllRecords;\n        opsetOrganizationAdmin.modifyCompanyRecords = posOrganizationAdmin.modifyCompanyRecords;\n        opsetOrganizationAdmin.viewCompanyRecords = posOrganizationAdmin.viewCompanyRecords;\n        opsetOrganizationAdmin.disabled_list_views = posOrganizationAdmin.disabled_list_views;\n        opsetOrganizationAdmin.disabled_actions = posOrganizationAdmin.disabled_actions;\n        opsetOrganizationAdmin.unreadable_fields = posOrganizationAdmin.unreadable_fields;\n        opsetOrganizationAdmin.uneditable_fields = posOrganizationAdmin.uneditable_fields;\n        opsetOrganizationAdmin.unrelated_objects = posOrganizationAdmin.unrelated_objects;\n      }\n    }\n    if (!userId) {\n      permissions = opsetAdmin;\n    } else {\n      if (isSpaceAdmin) {\n        permissions = opsetAdmin;\n      } else {\n        if (spaceId === 'common') {\n          permissions = opsetUser;\n        } else {\n          spaceUser = _.isNull(this.spaceUser) || this.spaceUser ? this.spaceUser : Creator.getCollection(\"space_users\").findOne({\n            space: spaceId,\n            user: userId\n          }, {\n            fields: {\n              profile: 1\n            }\n          });\n          if (spaceUser) {\n            prof = spaceUser.profile;\n            if (prof) {\n              if (prof === 'user') {\n                permissions = opsetUser;\n              } else if (prof === 'member') {\n                permissions = opsetMember;\n              } else if (prof === 'guest') {\n                permissions = opsetGuest;\n              }\n            } else {\n              permissions = opsetUser;\n            }\n          } else {\n            permissions = opsetGuest;\n          }\n        }\n      }\n    }\n    if (psets.length > 0) {\n      set_ids = _.pluck(psets, \"_id\");\n      pos = find_permission_object(psetsCurrent_pos, object_name, set_ids);\n      _.each(pos, function(po) {\n        if (po.permission_set_id === (psetsAdmin != null ? psetsAdmin._id : void 0) || po.permission_set_id === (psetsUser != null ? psetsUser._id : void 0) || po.permission_set_id === (psetsMember != null ? psetsMember._id : void 0) || po.permission_set_id === (psetsGuest != null ? psetsGuest._id : void 0) || po.permission_set_id === (psetsWorkflowAdmin != null ? psetsWorkflowAdmin._id : void 0) || po.permission_set_id === (psetsOrganizationAdmin != null ? psetsOrganizationAdmin._id : void 0)) {\n          return;\n        }\n        if (po.allowRead) {\n          permissions.allowRead = true;\n        }\n        if (po.allowCreate) {\n          permissions.allowCreate = true;\n        }\n        if (po.allowEdit) {\n          permissions.allowEdit = true;\n        }\n        if (po.allowDelete) {\n          permissions.allowDelete = true;\n        }\n        if (po.modifyAllRecords) {\n          permissions.modifyAllRecords = true;\n        }\n        if (po.viewAllRecords) {\n          permissions.viewAllRecords = true;\n        }\n        if (po.modifyCompanyRecords) {\n          permissions.modifyCompanyRecords = true;\n        }\n        if (po.viewCompanyRecords) {\n          permissions.viewCompanyRecords = true;\n        }\n        permissions.disabled_list_views = unionPlus(permissions.disabled_list_views, po.disabled_list_views);\n        permissions.disabled_actions = unionPlus(permissions.disabled_actions, po.disabled_actions);\n        permissions.unreadable_fields = unionPlus(permissions.unreadable_fields, po.unreadable_fields);\n        permissions.uneditable_fields = unionPlus(permissions.uneditable_fields, po.uneditable_fields);\n        return permissions.unrelated_objects = unionPlus(permissions.unrelated_objects, po.unrelated_objects);\n      });\n      if (isWorkflowAdmin) {\n        if (opsetWorkflowAdmin.allowRead) {\n          permissions.allowRead = true;\n        }\n        if (opsetWorkflowAdmin.allowCreate) {\n          permissions.allowCreate = true;\n        }\n        if (opsetWorkflowAdmin.allowEdit) {\n          permissions.allowEdit = true;\n        }\n        if (opsetWorkflowAdmin.allowDelete) {\n          permissions.allowDelete = true;\n        }\n        if (opsetWorkflowAdmin.modifyAllRecords) {\n          permissions.modifyAllRecords = true;\n        }\n        if (opsetWorkflowAdmin.viewAllRecords) {\n          permissions.viewAllRecords = true;\n        }\n        if (opsetWorkflowAdmin.modifyCompanyRecords) {\n          permissions.modifyCompanyRecords = true;\n        }\n        if (opsetWorkflowAdmin.viewCompanyRecords) {\n          permissions.viewCompanyRecords = true;\n        }\n        permissions.disabled_list_views = unionPlus(permissions.disabled_list_views, opsetWorkflowAdmin.disabled_list_views);\n        permissions.disabled_actions = unionPlus(permissions.disabled_actions, opsetWorkflowAdmin.disabled_actions);\n        permissions.unreadable_fields = unionPlus(permissions.unreadable_fields, opsetWorkflowAdmin.unreadable_fields);\n        permissions.uneditable_fields = unionPlus(permissions.uneditable_fields, opsetWorkflowAdmin.uneditable_fields);\n        permissions.unrelated_objects = unionPlus(permissions.unrelated_objects, opsetWorkflowAdmin.unrelated_objects);\n      }\n      if (isOrganizationAdmin) {\n        if (opsetOrganizationAdmin.allowRead) {\n          permissions.allowRead = true;\n        }\n        if (opsetOrganizationAdmin.allowCreate) {\n          permissions.allowCreate = true;\n        }\n        if (opsetOrganizationAdmin.allowEdit) {\n          permissions.allowEdit = true;\n        }\n        if (opsetOrganizationAdmin.allowDelete) {\n          permissions.allowDelete = true;\n        }\n        if (opsetOrganizationAdmin.modifyAllRecords) {\n          permissions.modifyAllRecords = true;\n        }\n        if (opsetOrganizationAdmin.viewAllRecords) {\n          permissions.viewAllRecords = true;\n        }\n        if (opsetOrganizationAdmin.modifyCompanyRecords) {\n          permissions.modifyCompanyRecords = true;\n        }\n        if (opsetOrganizationAdmin.viewCompanyRecords) {\n          permissions.viewCompanyRecords = true;\n        }\n        permissions.disabled_list_views = unionPlus(permissions.disabled_list_views, opsetOrganizationAdmin.disabled_list_views);\n        permissions.disabled_actions = unionPlus(permissions.disabled_actions, opsetOrganizationAdmin.disabled_actions);\n        permissions.unreadable_fields = unionPlus(permissions.unreadable_fields, opsetOrganizationAdmin.unreadable_fields);\n        permissions.uneditable_fields = unionPlus(permissions.uneditable_fields, opsetOrganizationAdmin.uneditable_fields);\n        permissions.unrelated_objects = unionPlus(permissions.unrelated_objects, opsetOrganizationAdmin.unrelated_objects);\n      }\n    }\n    if (object.is_view) {\n      permissions.allowCreate = false;\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n      permissions.modifyAllRecords = false;\n      permissions.modifyCompanyRecords = false;\n      permissions.disabled_actions = [];\n    }\n    Creator.processPermissions(permissions);\n    return permissions;\n  };\n  Meteor.methods({\n    \"creator.object_permissions\": function(spaceId) {\n      return Creator.getAllPermissions(spaceId, this.userId);\n    }\n  });\n}\n","Meteor.startup ()->\n\tif Meteor.isServer\n\t\tcreator_db_url = process.env.MONGO_URL_CREATOR\n\t\toplog_url = process.env.MONGO_OPLOG_URL_CREATOR\n\t\tif creator_db_url\n\t\t\tif !oplog_url\n\t\t\t\tthrow new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\")\n\t\t\tCreator._CREATOR_DATASOURCE = {_driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {oplogUrl: oplog_url})}\n\nCreator.createCollection = (object)->\n\tcollection_key = object.name\n\tif object.space #object.custom &&\n\t\tcollection_key = \"c_\" + object.space + \"_\" + object.name\n\n\tif db[collection_key]\n\t\treturn db[collection_key]\n\telse if object.db\n\t\treturn object.db\n\n\tif Creator.Collections[collection_key]\n\t\treturn Creator.Collections[collection_key]\n\telse\n\t\tif object.custom\n\t\t\treturn new Meteor.Collection(collection_key, Creator._CREATOR_DATASOURCE)\n\t\telse\n\t\t\treturn new Meteor.Collection(collection_key)\n\n\n","Meteor.startup(function() {\n  var creator_db_url, oplog_url;\n  if (Meteor.isServer) {\n    creator_db_url = process.env.MONGO_URL_CREATOR;\n    oplog_url = process.env.MONGO_OPLOG_URL_CREATOR;\n    if (creator_db_url) {\n      if (!oplog_url) {\n        throw new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\");\n      }\n      return Creator._CREATOR_DATASOURCE = {\n        _driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {\n          oplogUrl: oplog_url\n        })\n      };\n    }\n  }\n});\n\nCreator.createCollection = function(object) {\n  var collection_key;\n  collection_key = object.name;\n  if (object.space) {\n    collection_key = \"c_\" + object.space + \"_\" + object.name;\n  }\n  if (db[collection_key]) {\n    return db[collection_key];\n  } else if (object.db) {\n    return object.db;\n  }\n  if (Creator.Collections[collection_key]) {\n    return Creator.Collections[collection_key];\n  } else {\n    if (object.custom) {\n      return new Meteor.Collection(collection_key, Creator._CREATOR_DATASOURCE);\n    } else {\n      return new Meteor.Collection(collection_key);\n    }\n  }\n};\n","Creator.actionsByName = {}\n\nif Meteor.isClient\n\n\t# 定义全局 actions 函数\t\n\tCreator.actions = (actions)->\n\t\t_.each actions, (todo, action_name)->\n\t\t\tCreator.actionsByName[action_name] = todo \n\n\tCreator.executeAction = (object_name, action, record_id, item_element, list_view_id, record)->\n\t\tobj = Creator.getObject(object_name)\n\t\tif action?.todo\n\t\t\tif typeof action.todo == \"string\"\n\t\t\t\ttodo = Creator.actionsByName[action.todo]\n\t\t\telse if typeof action.todo == \"function\"\n\t\t\t\ttodo = action.todo\t\n\t\t\tif !record && object_name && record_id\n\t\t\t\trecord = Creator.odata.get(object_name, record_id)\n\t\t\tif todo\n\t\t\t\t# item_element为空时应该设置默认值（对象的name字段），否则moreArgs拿到的后续参数位置就不对\n\t\t\t\titem_element = if item_element then item_element else \"\"\n\t\t\t\tmoreArgs = Array.prototype.slice.call(arguments, 3)\n\t\t\t\ttodoArgs = [object_name, record_id].concat(moreArgs)\n\t\t\t\ttodo.apply {\n\t\t\t\t\tobject_name: object_name\n\t\t\t\t\trecord_id: record_id\n\t\t\t\t\tobject: obj\n\t\t\t\t\taction: action\n\t\t\t\t\titem_element: item_element\n\t\t\t\t\trecord: record\n\t\t\t\t}, todoArgs\n\t\t\t\t\n\n\tCreator.actions \n\t\t# 在此定义全局 actions\n\t\t\"standard_query\": ()->\n\t\t\tModal.show(\"standard_query_modal\")\n\n\t\t\"standard_new\": (object_name, record_id, fields)->\n\t\t\tids = Creator.TabularSelectedIds[object_name]\n\t\t\tif ids?.length\n\t\t\t\t# 列表有选中项时，取第一个选中项，复制其内容到新建窗口中\n\t\t\t\t# 这的第一个指的是第一次勾选的选中项，而不是列表中已勾选的第一项\n\t\t\t\trecord_id = ids[0]\n\t\t\t\tdoc = Creator.odata.get(object_name, record_id)\n\t\t\t\tSession.set 'cmDoc', doc\n\t\t\t\t# “保存并新建”操作中自动打开的新窗口中需要再次复制最新的doc内容到新窗口中\n\t\t\t\tSession.set 'cmShowAgainDuplicated', true\n\t\t\tMeteor.defer ()->\n\t\t\t\t$(\".creator-add\").click()\n\t\t\treturn \n\t\t\t\n\t\t\"standard_open_view\": (object_name, record_id, fields)->\n\t\t\thref = Creator.getObjectUrl(object_name, record_id)\n\t\t\twindow.open(\n\t\t\t\thref,\n\t\t\t\t'_blank',\n\t\t\t\t'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes'\n\t\t\t)\n\t\t\treturn false\n\n\t\t\"standard_open_view\": (object_name, record_id, fields)->\n\t\t\thref = Creator.getObjectUrl(object_name, record_id)\n\t\t\twindow.open(\n\t\t\t\thref,\n\t\t\t\t'_blank',\n\t\t\t\t'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes'\n\t\t\t)\n\t\t\treturn false\n\n\t\t\"standard_edit\": (object_name, record_id, fields)->\n\t\t\tif record_id\n\t\t\t\tif Steedos.isMobile() && false\n#\t\t\t\t\trecord = Creator.getObjectRecord(object_name, record_id)\n#\t\t\t\t\tSession.set 'cmDoc', record\n#\t\t\t\t\tSession.set 'reload_dxlist', false\n\t\t\t\t\tSession.set 'action_object_name', object_name\n\t\t\t\t\tSession.set 'action_record_id', record_id\n\t\t\t\t\tif this.record\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\n\t\t\t\t\tMeteor.defer ()->\n\t\t\t\t\t\t$(\".btn-edit-record\").click()\n\t\t\t\telse\n\t\t\t\t\tSession.set 'action_object_name', object_name\n\t\t\t\t\tSession.set 'action_record_id', record_id\n\t\t\t\t\tif this.record\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\n\t\t\t\t\t\tMeteor.defer ()->\n\t\t\t\t\t\t\t$(\".btn.creator-edit\").click()\n\n\t\t\"standard_delete\": (object_name, record_id, record_title, list_view_id, call_back)->\n\t\t\tconsole.log(\"standard_delete\", object_name, record_id, record_title, list_view_id)\n\t\t\tobject = Creator.getObject(object_name)\n\n\t\t\tif(!_.isString(record_title) && record_title?.name)\n\t\t\t\trecord_title = record_title?.name\n\n\t\t\tif record_title\n\t\t\t\ttext = \"是否确定要删除此#{object.label}\\\"#{record_title}\\\"\"\n\t\t\telse\n\t\t\t\ttext = \"是否确定要删除此#{object.label}\"\n\t\t\tswal\n\t\t\t\ttitle: \"删除#{object.label}\"\n\t\t\t\ttext: \"<div class='delete-creator-warning'>#{text}？</div>\"\n\t\t\t\thtml: true\n\t\t\t\tshowCancelButton:true\n\t\t\t\tconfirmButtonText: t('Delete')\n\t\t\t\tcancelButtonText: t('Cancel')\n\t\t\t\t(option) ->\n\t\t\t\t\tif option\n\t\t\t\t\t\tCreator.odata.delete object_name, record_id, ()->\n\t\t\t\t\t\t\tif record_title\n\t\t\t\t\t\t\t\tinfo = object.label + \"\\\"#{record_title}\\\"\" + \"已删除\"\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tinfo = \"删除成功\"\n\t\t\t\t\t\t\ttoastr.success info\n\t\t\t\t\t\t\t# 文件版本为\"cfs.files.filerecord\"，需要替换为\"cfs-files-filerecord\"\n\t\t\t\t\t\t\tgridObjectNameClass = object_name.replace(/\\./g,\"-\")\n\t\t\t\t\t\t\tgridContainer = $(\".gridContainer.#{gridObjectNameClass}\")\n\t\t\t\t\t\t\tunless gridContainer?.length\n\t\t\t\t\t\t\t\tif window.opener\n\t\t\t\t\t\t\t\t\tisOpenerRemove = true\n\t\t\t\t\t\t\t\t\tgridContainer = window.opener.$(\".gridContainer.#{gridObjectNameClass}\")\n\t\t\t\t\t\t\tif gridContainer?.length\n\t\t\t\t\t\t\t\tif object.enable_tree\n\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance')\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance')\n\t\t\t\t\t\t\tif dxDataGridInstance\n\t\t\t\t\t\t\t\tif object.enable_tree\n\t\t\t\t\t\t\t\t\tdxDataGridInstance.refresh()\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tTemplate.creator_grid.refresh(dxDataGridInstance)\n\t\t\t\t\t\t\tif isOpenerRemove or !dxDataGridInstance\n\t\t\t\t\t\t\t\tif isOpenerRemove\n\t\t\t\t\t\t\t\t\twindow.close()\n\t\t\t\t\t\t\t\telse if record_id == Session.get(\"record_id\") and !Steedos.isMobile() and list_view_id != 'calendar'\n\t\t\t\t\t\t\t\t\tappid = Session.get(\"app_id\")\n\t\t\t\t\t\t\t\t\tunless list_view_id\n\t\t\t\t\t\t\t\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\t\t\t\t\t\t\t\t\tunless list_view_id\n\t\t\t\t\t\t\t\t\t\tlist_view_id = \"all\"\n\t\t\t\t\t\t\t\t\tFlowRouter.go \"/app/#{appid}/#{object_name}/grid/#{list_view_id}\"\n\t\t\t\t\t\t\tif call_back and typeof call_back == \"function\"\n\t\t\t\t\t\t\t\tcall_back()\n","Creator.actionsByName = {};\n\nif (Meteor.isClient) {\n  Creator.actions = function(actions) {\n    return _.each(actions, function(todo, action_name) {\n      return Creator.actionsByName[action_name] = todo;\n    });\n  };\n  Creator.executeAction = function(object_name, action, record_id, item_element, list_view_id, record) {\n    var moreArgs, obj, todo, todoArgs;\n    obj = Creator.getObject(object_name);\n    if (action != null ? action.todo : void 0) {\n      if (typeof action.todo === \"string\") {\n        todo = Creator.actionsByName[action.todo];\n      } else if (typeof action.todo === \"function\") {\n        todo = action.todo;\n      }\n      if (!record && object_name && record_id) {\n        record = Creator.odata.get(object_name, record_id);\n      }\n      if (todo) {\n        item_element = item_element ? item_element : \"\";\n        moreArgs = Array.prototype.slice.call(arguments, 3);\n        todoArgs = [object_name, record_id].concat(moreArgs);\n        return todo.apply({\n          object_name: object_name,\n          record_id: record_id,\n          object: obj,\n          action: action,\n          item_element: item_element,\n          record: record\n        }, todoArgs);\n      }\n    }\n  };\n  Creator.actions({\n    \"standard_query\": function() {\n      return Modal.show(\"standard_query_modal\");\n    },\n    \"standard_new\": function(object_name, record_id, fields) {\n      var doc, ids;\n      ids = Creator.TabularSelectedIds[object_name];\n      if (ids != null ? ids.length : void 0) {\n        record_id = ids[0];\n        doc = Creator.odata.get(object_name, record_id);\n        Session.set('cmDoc', doc);\n        Session.set('cmShowAgainDuplicated', true);\n      }\n      Meteor.defer(function() {\n        return $(\".creator-add\").click();\n      });\n    },\n    \"standard_open_view\": function(object_name, record_id, fields) {\n      var href;\n      href = Creator.getObjectUrl(object_name, record_id);\n      window.open(href, '_blank', 'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes');\n      return false;\n    },\n    \"standard_open_view\": function(object_name, record_id, fields) {\n      var href;\n      href = Creator.getObjectUrl(object_name, record_id);\n      window.open(href, '_blank', 'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes');\n      return false;\n    },\n    \"standard_edit\": function(object_name, record_id, fields) {\n      if (record_id) {\n        if (Steedos.isMobile() && false) {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n          }\n          return Meteor.defer(function() {\n            return $(\".btn-edit-record\").click();\n          });\n        } else {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n            return Meteor.defer(function() {\n              return $(\".btn.creator-edit\").click();\n            });\n          }\n        }\n      }\n    },\n    \"standard_delete\": function(object_name, record_id, record_title, list_view_id, call_back) {\n      var object, text;\n      console.log(\"standard_delete\", object_name, record_id, record_title, list_view_id);\n      object = Creator.getObject(object_name);\n      if (!_.isString(record_title) && (record_title != null ? record_title.name : void 0)) {\n        record_title = record_title != null ? record_title.name : void 0;\n      }\n      if (record_title) {\n        text = \"是否确定要删除此\" + object.label + \"\\\"\" + record_title + \"\\\"\";\n      } else {\n        text = \"是否确定要删除此\" + object.label;\n      }\n      return swal({\n        title: \"删除\" + object.label,\n        text: \"<div class='delete-creator-warning'>\" + text + \"？</div>\",\n        html: true,\n        showCancelButton: true,\n        confirmButtonText: t('Delete'),\n        cancelButtonText: t('Cancel')\n      }, function(option) {\n        if (option) {\n          return Creator.odata[\"delete\"](object_name, record_id, function() {\n            var appid, dxDataGridInstance, gridContainer, gridObjectNameClass, info, isOpenerRemove;\n            if (record_title) {\n              info = object.label + (\"\\\"\" + record_title + \"\\\"\") + \"已删除\";\n            } else {\n              info = \"删除成功\";\n            }\n            toastr.success(info);\n            gridObjectNameClass = object_name.replace(/\\./g, \"-\");\n            gridContainer = $(\".gridContainer.\" + gridObjectNameClass);\n            if (!(gridContainer != null ? gridContainer.length : void 0)) {\n              if (window.opener) {\n                isOpenerRemove = true;\n                gridContainer = window.opener.$(\".gridContainer.\" + gridObjectNameClass);\n              }\n            }\n            if (gridContainer != null ? gridContainer.length : void 0) {\n              if (object.enable_tree) {\n                dxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance');\n              } else {\n                dxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance');\n              }\n            }\n            if (dxDataGridInstance) {\n              if (object.enable_tree) {\n                dxDataGridInstance.refresh();\n              } else {\n                Template.creator_grid.refresh(dxDataGridInstance);\n              }\n            }\n            if (isOpenerRemove || !dxDataGridInstance) {\n              if (isOpenerRemove) {\n                window.close();\n              } else if (record_id === Session.get(\"record_id\") && !Steedos.isMobile() && list_view_id !== 'calendar') {\n                appid = Session.get(\"app_id\");\n                if (!list_view_id) {\n                  list_view_id = Session.get(\"list_view_id\");\n                }\n                if (!list_view_id) {\n                  list_view_id = \"all\";\n                }\n                FlowRouter.go(\"/app/\" + appid + \"/\" + object_name + \"/grid/\" + list_view_id);\n              }\n            }\n            if (call_back && typeof call_back === \"function\") {\n              return call_back();\n            }\n          });\n        }\n      });\n    }\n  });\n}\n"]}