name: process_instance_history
label: process_instance_history
icon: record
paging:
  enabled: false
fields:
  name:
    type: text
  process_instance:
    type: lookup
    reference_to: process_instance
  target_object:
    type: lookup
    reference_to: !!js/function
      function(){
        return ['contracts']
      }
  step_status:
    type: select
    options:
      - approved
      - fault
      - held
      - no_response
      - pending
      - reassigned
      - rejected
      - removed
      - started
  original_actor:
    type: lookup
    reference_to: users
  actor:
    type: lookup
    reference_to: users
  comments:
    type: textarea
  step_node:
    type: lookup
    reference_to: process_node
  elapsed_time_in_days:
    type: number
    precision: 18
    scale: 0
    hidden: true
    omit: true
  elapsed_time_in_hours:
    type: number
    precision: 5
    scale: 2
    hidden: true
    omit: true
  elapsed_time_in_minutes:
    type: number
    precision: 8
    scale: 0
    hidden: true
    omit: true
  created_by:
    label: 提交人
  modified:
    hidden: true
    omit: true
  modified_by:
    hidden: true
    omit: true
list_views:
  all:
    label: All
    filter_scope: space
    columns:
      - name
      - step_status
      - comments
      - step_node
      - original_actor
      - actor
      - target_object
actions:
  approve:
    label: Approve
    on: record_only
    visible: true
  reject:
    label: Reject
    on: record_only
    visible: true
  reassign:
    label: Reassign
    on: record_only
    visible: true
  remove:
    label: Recall
    on: record_only
    visible: true
permission_set:
  user:
    allowCreate: false
    allowDelete: false
    allowEdit: false
    allowRead: true
    modifyAllRecords: false
    viewAllRecords: true
  admin:
    allowCreate: false
    allowDelete: false
    allowEdit: false
    allowRead: true
    modifyAllRecords: false
    viewAllRecords: true
form:
  afterView: !!js/function |
    function(){
      var step_status = this.doc.step_status;
      $("div", $(".crm-header-title")).css("display", "inline");
      switch (step_status) {
        case 'approved':
            $(".crm-header-title").append('<span class="slds-badge slds-theme_success">approved</span>')
            break;
        case 'rejected':
            $(".crm-header-title").append('<span class="slds-badge slds-theme_error">rejected</span>')
            break;
        default:
            $(".crm-header-title").append('<span class="slds-badge" style="background-color: #706e6b;color: #fff;">'+step_status+'</span>')
            break;
      }
    }